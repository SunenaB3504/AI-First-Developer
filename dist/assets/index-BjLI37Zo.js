(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();function Hf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Oh={exports:{}},lc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hw;function LI(){if(hw)return lc;hw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(i,a,c){var p=null;if(c!==void 0&&(p=""+c),a.key!==void 0&&(p=""+a.key),"key"in a){c={};for(var h in a)h!=="key"&&(c[h]=a[h])}else c=a;return a=c.ref,{$$typeof:r,type:i,key:p,ref:a!==void 0?a:null,props:c}}return lc.Fragment=e,lc.jsx=n,lc.jsxs=n,lc}var fw;function qI(){return fw||(fw=1,Oh.exports=LI()),Oh.exports}var R=qI(),Uh={exports:{}},ke={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gw;function jI(){if(gw)return ke;gw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),p=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),E=Symbol.iterator;function C(k){return k===null||typeof k!="object"?null:(k=E&&k[E]||k["@@iterator"],typeof k=="function"?k:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z=Object.assign,Q={};function $(k,J,ce){this.props=k,this.context=J,this.refs=Q,this.updater=ce||M}$.prototype.isReactComponent={},$.prototype.setState=function(k,J){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,J,"setState")},$.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function ie(){}ie.prototype=$.prototype;function re(k,J,ce){this.props=k,this.context=J,this.refs=Q,this.updater=ce||M}var ae=re.prototype=new ie;ae.constructor=re,z(ae,$.prototype),ae.isPureReactComponent=!0;var ve=Array.isArray,he={H:null,A:null,T:null,S:null,V:null},De=Object.prototype.hasOwnProperty;function U(k,J,ce,ne,we,ge){return ce=ge.ref,{$$typeof:r,type:k,key:J,ref:ce!==void 0?ce:null,props:ge}}function _(k,J){return U(k.type,J,void 0,void 0,void 0,k.props)}function A(k){return typeof k=="object"&&k!==null&&k.$$typeof===r}function O(k){var J={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(ce){return J[ce]})}var D=/\/+/g;function q(k,J){return typeof k=="object"&&k!==null&&k.key!=null?O(""+k.key):J.toString(36)}function x(){}function At(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(x,x):(k.status="pending",k.then(function(J){k.status==="pending"&&(k.status="fulfilled",k.value=J)},function(J){k.status==="pending"&&(k.status="rejected",k.reason=J)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function pt(k,J,ce,ne,we){var ge=typeof k;(ge==="undefined"||ge==="boolean")&&(k=null);var Se=!1;if(k===null)Se=!0;else switch(ge){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(k.$$typeof){case r:case e:Se=!0;break;case b:return Se=k._init,pt(Se(k._payload),J,ce,ne,we)}}if(Se)return we=we(k),Se=ne===""?"."+q(k,0):ne,ve(we)?(ce="",Se!=null&&(ce=Se.replace(D,"$&/")+"/"),pt(we,J,ce,"",function(Dn){return Dn})):we!=null&&(A(we)&&(we=_(we,ce+(we.key==null||k&&k.key===we.key?"":(""+we.key).replace(D,"$&/")+"/")+Se)),J.push(we)),1;Se=0;var Tt=ne===""?".":ne+":";if(ve(k))for(var Qe=0;Qe<k.length;Qe++)ne=k[Qe],ge=Tt+q(ne,Qe),Se+=pt(ne,J,ce,ge,we);else if(Qe=C(k),typeof Qe=="function")for(k=Qe.call(k),Qe=0;!(ne=k.next()).done;)ne=ne.value,ge=Tt+q(ne,Qe++),Se+=pt(ne,J,ce,ge,we);else if(ge==="object"){if(typeof k.then=="function")return pt(At(k),J,ce,ne,we);throw J=String(k),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return Se}function K(k,J,ce){if(k==null)return k;var ne=[],we=0;return pt(k,ne,"","",function(ge){return J.call(ce,ge,we++)}),ne}function le(k){if(k._status===-1){var J=k._result;J=J(),J.then(function(ce){(k._status===0||k._status===-1)&&(k._status=1,k._result=ce)},function(ce){(k._status===0||k._status===-1)&&(k._status=2,k._result=ce)}),k._status===-1&&(k._status=0,k._result=J)}if(k._status===1)return k._result.default;throw k._result}var ye=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)};function Ge(){}return ke.Children={map:K,forEach:function(k,J,ce){K(k,function(){J.apply(this,arguments)},ce)},count:function(k){var J=0;return K(k,function(){J++}),J},toArray:function(k){return K(k,function(J){return J})||[]},only:function(k){if(!A(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},ke.Component=$,ke.Fragment=n,ke.Profiler=a,ke.PureComponent=re,ke.StrictMode=i,ke.Suspense=f,ke.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=he,ke.__COMPILER_RUNTIME={__proto__:null,c:function(k){return he.H.useMemoCache(k)}},ke.cache=function(k){return function(){return k.apply(null,arguments)}},ke.cloneElement=function(k,J,ce){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var ne=z({},k.props),we=k.key,ge=void 0;if(J!=null)for(Se in J.ref!==void 0&&(ge=void 0),J.key!==void 0&&(we=""+J.key),J)!De.call(J,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&J.ref===void 0||(ne[Se]=J[Se]);var Se=arguments.length-2;if(Se===1)ne.children=ce;else if(1<Se){for(var Tt=Array(Se),Qe=0;Qe<Se;Qe++)Tt[Qe]=arguments[Qe+2];ne.children=Tt}return U(k.type,we,void 0,void 0,ge,ne)},ke.createContext=function(k){return k={$$typeof:p,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:c,_context:k},k},ke.createElement=function(k,J,ce){var ne,we={},ge=null;if(J!=null)for(ne in J.key!==void 0&&(ge=""+J.key),J)De.call(J,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(we[ne]=J[ne]);var Se=arguments.length-2;if(Se===1)we.children=ce;else if(1<Se){for(var Tt=Array(Se),Qe=0;Qe<Se;Qe++)Tt[Qe]=arguments[Qe+2];we.children=Tt}if(k&&k.defaultProps)for(ne in Se=k.defaultProps,Se)we[ne]===void 0&&(we[ne]=Se[ne]);return U(k,ge,void 0,void 0,null,we)},ke.createRef=function(){return{current:null}},ke.forwardRef=function(k){return{$$typeof:h,render:k}},ke.isValidElement=A,ke.lazy=function(k){return{$$typeof:b,_payload:{_status:-1,_result:k},_init:le}},ke.memo=function(k,J){return{$$typeof:g,type:k,compare:J===void 0?null:J}},ke.startTransition=function(k){var J=he.T,ce={};he.T=ce;try{var ne=k(),we=he.S;we!==null&&we(ce,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(Ge,ye)}catch(ge){ye(ge)}finally{he.T=J}},ke.unstable_useCacheRefresh=function(){return he.H.useCacheRefresh()},ke.use=function(k){return he.H.use(k)},ke.useActionState=function(k,J,ce){return he.H.useActionState(k,J,ce)},ke.useCallback=function(k,J){return he.H.useCallback(k,J)},ke.useContext=function(k){return he.H.useContext(k)},ke.useDebugValue=function(){},ke.useDeferredValue=function(k,J){return he.H.useDeferredValue(k,J)},ke.useEffect=function(k,J,ce){var ne=he.H;if(typeof ce=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ne.useEffect(k,J)},ke.useId=function(){return he.H.useId()},ke.useImperativeHandle=function(k,J,ce){return he.H.useImperativeHandle(k,J,ce)},ke.useInsertionEffect=function(k,J){return he.H.useInsertionEffect(k,J)},ke.useLayoutEffect=function(k,J){return he.H.useLayoutEffect(k,J)},ke.useMemo=function(k,J){return he.H.useMemo(k,J)},ke.useOptimistic=function(k,J){return he.H.useOptimistic(k,J)},ke.useReducer=function(k,J,ce){return he.H.useReducer(k,J,ce)},ke.useRef=function(k){return he.H.useRef(k)},ke.useState=function(k){return he.H.useState(k)},ke.useSyncExternalStore=function(k,J,ce){return he.H.useSyncExternalStore(k,J,ce)},ke.useTransition=function(){return he.H.useTransition()},ke.version="19.1.1",ke}var yw;function Gf(){return yw||(yw=1,Uh.exports=jI()),Uh.exports}var F=Gf();const BI=Hf(F);var Mh={exports:{}},cc={},Lh={exports:{}},qh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vw;function zI(){return vw||(vw=1,(function(r){function e(K,le){var ye=K.length;K.push(le);e:for(;0<ye;){var Ge=ye-1>>>1,k=K[Ge];if(0<a(k,le))K[Ge]=le,K[ye]=k,ye=Ge;else break e}}function n(K){return K.length===0?null:K[0]}function i(K){if(K.length===0)return null;var le=K[0],ye=K.pop();if(ye!==le){K[0]=ye;e:for(var Ge=0,k=K.length,J=k>>>1;Ge<J;){var ce=2*(Ge+1)-1,ne=K[ce],we=ce+1,ge=K[we];if(0>a(ne,ye))we<k&&0>a(ge,ne)?(K[Ge]=ge,K[we]=ye,Ge=we):(K[Ge]=ne,K[ce]=ye,Ge=ce);else if(we<k&&0>a(ge,ye))K[Ge]=ge,K[we]=ye,Ge=we;else break e}}return le}function a(K,le){var ye=K.sortIndex-le.sortIndex;return ye!==0?ye:K.id-le.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;r.unstable_now=function(){return c.now()}}else{var p=Date,h=p.now();r.unstable_now=function(){return p.now()-h}}var f=[],g=[],b=1,E=null,C=3,M=!1,z=!1,Q=!1,$=!1,ie=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,ae=typeof setImmediate<"u"?setImmediate:null;function ve(K){for(var le=n(g);le!==null;){if(le.callback===null)i(g);else if(le.startTime<=K)i(g),le.sortIndex=le.expirationTime,e(f,le);else break;le=n(g)}}function he(K){if(Q=!1,ve(K),!z)if(n(f)!==null)z=!0,De||(De=!0,q());else{var le=n(g);le!==null&&pt(he,le.startTime-K)}}var De=!1,U=-1,_=5,A=-1;function O(){return $?!0:!(r.unstable_now()-A<_)}function D(){if($=!1,De){var K=r.unstable_now();A=K;var le=!0;try{e:{z=!1,Q&&(Q=!1,re(U),U=-1),M=!0;var ye=C;try{t:{for(ve(K),E=n(f);E!==null&&!(E.expirationTime>K&&O());){var Ge=E.callback;if(typeof Ge=="function"){E.callback=null,C=E.priorityLevel;var k=Ge(E.expirationTime<=K);if(K=r.unstable_now(),typeof k=="function"){E.callback=k,ve(K),le=!0;break t}E===n(f)&&i(f),ve(K)}else i(f);E=n(f)}if(E!==null)le=!0;else{var J=n(g);J!==null&&pt(he,J.startTime-K),le=!1}}break e}finally{E=null,C=ye,M=!1}le=void 0}}finally{le?q():De=!1}}}var q;if(typeof ae=="function")q=function(){ae(D)};else if(typeof MessageChannel<"u"){var x=new MessageChannel,At=x.port2;x.port1.onmessage=D,q=function(){At.postMessage(null)}}else q=function(){ie(D,0)};function pt(K,le){U=ie(function(){K(r.unstable_now())},le)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(K){K.callback=null},r.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<K?Math.floor(1e3/K):5},r.unstable_getCurrentPriorityLevel=function(){return C},r.unstable_next=function(K){switch(C){case 1:case 2:case 3:var le=3;break;default:le=C}var ye=C;C=le;try{return K()}finally{C=ye}},r.unstable_requestPaint=function(){$=!0},r.unstable_runWithPriority=function(K,le){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ye=C;C=K;try{return le()}finally{C=ye}},r.unstable_scheduleCallback=function(K,le,ye){var Ge=r.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?Ge+ye:Ge):ye=Ge,K){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=ye+k,K={id:b++,callback:le,priorityLevel:K,startTime:ye,expirationTime:k,sortIndex:-1},ye>Ge?(K.sortIndex=ye,e(g,K),n(f)===null&&K===n(g)&&(Q?(re(U),U=-1):Q=!0,pt(he,ye-Ge))):(K.sortIndex=k,e(f,K),z||M||(z=!0,De||(De=!0,q()))),K},r.unstable_shouldYield=O,r.unstable_wrapCallback=function(K){var le=C;return function(){var ye=C;C=le;try{return K.apply(this,arguments)}finally{C=ye}}}})(qh)),qh}var bw;function FI(){return bw||(bw=1,Lh.exports=zI()),Lh.exports}var jh={exports:{}},gn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ww;function VI(){if(ww)return gn;ww=1;var r=Gf();function e(f){var g="https://react.dev/errors/"+f;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function c(f,g,b){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:E==null?null:""+E,children:f,containerInfo:g,implementation:b}}var p=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,g){if(f==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return gn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,gn.createPortal=function(f,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return c(f,g,null,b)},gn.flushSync=function(f){var g=p.T,b=i.p;try{if(p.T=null,i.p=2,f)return f()}finally{p.T=g,i.p=b,i.d.f()}},gn.preconnect=function(f,g){typeof f=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,i.d.C(f,g))},gn.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},gn.preinit=function(f,g){if(typeof f=="string"&&g&&typeof g.as=="string"){var b=g.as,E=h(b,g.crossOrigin),C=typeof g.integrity=="string"?g.integrity:void 0,M=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;b==="style"?i.d.S(f,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:E,integrity:C,fetchPriority:M}):b==="script"&&i.d.X(f,{crossOrigin:E,integrity:C,fetchPriority:M,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},gn.preinitModule=function(f,g){if(typeof f=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var b=h(g.as,g.crossOrigin);i.d.M(f,{crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&i.d.M(f)},gn.preload=function(f,g){if(typeof f=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var b=g.as,E=h(b,g.crossOrigin);i.d.L(f,b,{crossOrigin:E,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},gn.preloadModule=function(f,g){if(typeof f=="string")if(g){var b=h(g.as,g.crossOrigin);i.d.m(f,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else i.d.m(f)},gn.requestFormReset=function(f){i.d.r(f)},gn.unstable_batchedUpdates=function(f,g){return f(g)},gn.useFormState=function(f,g,b){return p.H.useFormState(f,g,b)},gn.useFormStatus=function(){return p.H.useHostTransitionStatus()},gn.version="19.1.1",gn}var Tw;function HI(){if(Tw)return jh.exports;Tw=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),jh.exports=VI(),jh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sw;function GI(){if(Sw)return cc;Sw=1;var r=FI(),e=Gf(),n=HI();function i(t){var s="https://react.dev/errors/"+t;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var s=t,o=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,(s.flags&4098)!==0&&(o=s.return),t=s.return;while(t)}return s.tag===3?o:null}function p(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function h(t){if(c(t)!==t)throw Error(i(188))}function f(t){var s=t.alternate;if(!s){if(s=c(t),s===null)throw Error(i(188));return s!==t?null:t}for(var o=t,l=s;;){var d=o.return;if(d===null)break;var m=d.alternate;if(m===null){if(l=d.return,l!==null){o=l;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===o)return h(d),t;if(m===l)return h(d),s;m=m.sibling}throw Error(i(188))}if(o.return!==l.return)o=d,l=m;else{for(var w=!1,T=d.child;T;){if(T===o){w=!0,o=d,l=m;break}if(T===l){w=!0,l=d,o=m;break}T=T.sibling}if(!w){for(T=m.child;T;){if(T===o){w=!0,o=m,l=d;break}if(T===l){w=!0,l=m,o=d;break}T=T.sibling}if(!w)throw Error(i(189))}}if(o.alternate!==l)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?t:s}function g(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t;for(t=t.child;t!==null;){if(s=g(t),s!==null)return s;t=t.sibling}return null}var b=Object.assign,E=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),M=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),re=Symbol.for("react.consumer"),ae=Symbol.for("react.context"),ve=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),De=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function q(t){return t===null||typeof t!="object"?null:(t=D&&t[D]||t["@@iterator"],typeof t=="function"?t:null)}var x=Symbol.for("react.client.reference");function At(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===x?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case z:return"Fragment";case $:return"Profiler";case Q:return"StrictMode";case he:return"Suspense";case De:return"SuspenseList";case A:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case M:return"Portal";case ae:return(t.displayName||"Context")+".Provider";case re:return(t._context.displayName||"Context")+".Consumer";case ve:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case U:return s=t.displayName||null,s!==null?s:At(t.type)||"Memo";case _:s=t._payload,t=t._init;try{return At(t(s))}catch{}}return null}var pt=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye={pending:!1,data:null,method:null,action:null},Ge=[],k=-1;function J(t){return{current:t}}function ce(t){0>k||(t.current=Ge[k],Ge[k]=null,k--)}function ne(t,s){k++,Ge[k]=t.current,t.current=s}var we=J(null),ge=J(null),Se=J(null),Tt=J(null);function Qe(t,s){switch(ne(Se,s),ne(ge,t),ne(we,null),s.nodeType){case 9:case 11:t=(t=s.documentElement)&&(t=t.namespaceURI)?Fb(t):0;break;default:if(t=s.tagName,s=s.namespaceURI)s=Fb(s),t=Vb(s,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}ce(we),ne(we,t)}function Dn(){ce(we),ce(ge),ce(Se)}function Sr(t){t.memoizedState!==null&&ne(Tt,t);var s=we.current,o=Vb(s,t.type);s!==o&&(ne(ge,t),ne(we,o))}function Xn(t){ge.current===t&&(ce(we),ce(ge)),Tt.current===t&&(ce(Tt),rc._currentValue=ye)}var Pn=Object.prototype.hasOwnProperty,Zn=r.unstable_scheduleCallback,Tn=r.unstable_cancelCallback,gs=r.unstable_shouldYield,Xs=r.unstable_requestPaint,jt=r.unstable_now,Zs=r.unstable_getCurrentPriorityLevel,Fr=r.unstable_ImmediatePriority,ys=r.unstable_UserBlockingPriority,Vr=r.unstable_NormalPriority,cl=r.unstable_LowPriority,Hr=r.unstable_IdlePriority,Er=r.log,Cr=r.unstable_setDisableYieldValue,Xe=null,$e=null;function mn(t){if(typeof Er=="function"&&Cr(t),$e&&typeof $e.setStrictMode=="function")try{$e.setStrictMode(Xe,t)}catch{}}var Bt=Math.clz32?Math.clz32:er,ei=Math.log,Go=Math.LN2;function er(t){return t>>>=0,t===0?32:31-(ei(t)/Go|0)|0}var tr=256,sn=4194304;function Kt(t){var s=t&42;if(s!==0)return s;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Gr(t,s,o){var l=t.pendingLanes;if(l===0)return 0;var d=0,m=t.suspendedLanes,w=t.pingedLanes;t=t.warmLanes;var T=l&134217727;return T!==0?(l=T&~m,l!==0?d=Kt(l):(w&=T,w!==0?d=Kt(w):o||(o=T&~t,o!==0&&(d=Kt(o))))):(T=l&~m,T!==0?d=Kt(T):w!==0?d=Kt(w):o||(o=l&~t,o!==0&&(d=Kt(o)))),d===0?0:s!==0&&s!==d&&(s&m)===0&&(m=d&-d,o=s&-s,m>=o||m===32&&(o&4194048)!==0)?s:d}function _r(t,s){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&s)===0}function Qi(t,s){switch(t){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $r(){var t=tr;return tr<<=1,(tr&4194048)===0&&(tr=256),t}function Wr(){var t=sn;return sn<<=1,(sn&62914560)===0&&(sn=4194304),t}function Ar(t){for(var s=[],o=0;31>o;o++)s.push(t);return s}function Sn(t,s){t.pendingLanes|=s,s!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Xi(t,s,o,l,d,m){var w=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var T=t.entanglements,I=t.expirationTimes,V=t.hiddenUpdates;for(o=w&~o;0<o;){var Y=31-Bt(o),ee=1<<Y;T[Y]=0,I[Y]=-1;var H=V[Y];if(H!==null)for(V[Y]=null,Y=0;Y<H.length;Y++){var G=H[Y];G!==null&&(G.lane&=-536870913)}o&=~ee}l!==0&&nr(t,l,0),m!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=m&~(w&~s))}function nr(t,s,o){t.pendingLanes|=s,t.suspendedLanes&=~s;var l=31-Bt(s);t.entangledLanes|=s,t.entanglements[l]=t.entanglements[l]|1073741824|o&4194090}function mt(t,s){var o=t.entangledLanes|=s;for(t=t.entanglements;o;){var l=31-Bt(o),d=1<<l;d&s|t[l]&s&&(t[l]|=s),o&=~d}}function En(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function ti(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ir(){var t=le.p;return t!==0?t:(t=window.event,t===void 0?32:lw(t.type))}function ni(t,s){var o=le.p;try{return le.p=t,s()}finally{le.p=o}}var ot=Math.random().toString(36).slice(2),St="__reactFiber$"+ot,Et="__reactProps$"+ot,yt="__reactContainer$"+ot,rr="__reactEvents$"+ot,$o="__reactListeners$"+ot,xr="__reactHandles$"+ot,ri="__reactResources$"+ot,Kr="__reactMarker$"+ot;function Jt(t){delete t[St],delete t[Et],delete t[rr],delete t[$o],delete t[xr]}function sr(t){var s=t[St];if(s)return s;for(var o=t.parentNode;o;){if(s=o[yt]||o[St]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(t=Wb(t);t!==null;){if(o=t[St])return o;t=Wb(t)}return s}t=o,o=t.parentNode}return null}function jn(t){if(t=t[St]||t[yt]){var s=t.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return t}return null}function Bn(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t.stateNode;throw Error(i(33))}function Yt(t){var s=t[ri];return s||(s=t[ri]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function vt(t){t[Kr]=!0}var fe=new Set,N={};function se(t,s){de(t,s),de(t+"Capture",s)}function de(t,s){for(N[t]=s,t=0;t<s.length;t++)fe.add(s[t])}var Ze=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),It={},at={};function zt(t){return Pn.call(at,t)?!0:Pn.call(It,t)?!1:Ze.test(t)?at[t]=!0:(It[t]=!0,!1)}function Qt(t,s,o){if(zt(s))if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(s);return;case"boolean":var l=s.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(s);return}}t.setAttribute(s,""+o)}}function hn(t,s,o){if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttribute(s,""+o)}}function xt(t,s,o,l){if(l===null)t.removeAttribute(o);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(s,o,""+l)}}var ht,Zi;function ir(t){if(ht===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);ht=s&&s[1]||"",Zi=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ht+t+Zi}var Wo=!1;function Ko(t,s){if(!t||Wo)return"";Wo=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(s){var ee=function(){throw Error()};if(Object.defineProperty(ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ee,[])}catch(G){var H=G}Reflect.construct(t,[],ee)}else{try{ee.call()}catch(G){H=G}t.call(ee.prototype)}}else{try{throw Error()}catch(G){H=G}(ee=t())&&typeof ee.catch=="function"&&ee.catch(function(){})}}catch(G){if(G&&H&&typeof G.stack=="string")return[G.stack,H.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=l.DetermineComponentFrameRoot(),w=m[0],T=m[1];if(w&&T){var I=w.split(`
`),V=T.split(`
`);for(d=l=0;l<I.length&&!I[l].includes("DetermineComponentFrameRoot");)l++;for(;d<V.length&&!V[d].includes("DetermineComponentFrameRoot");)d++;if(l===I.length||d===V.length)for(l=I.length-1,d=V.length-1;1<=l&&0<=d&&I[l]!==V[d];)d--;for(;1<=l&&0<=d;l--,d--)if(I[l]!==V[d]){if(l!==1||d!==1)do if(l--,d--,0>d||I[l]!==V[d]){var Y=`
`+I[l].replace(" at new "," at ");return t.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",t.displayName)),Y}while(1<=l&&0<=d);break}}}finally{Wo=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?ir(o):""}function ul(t){switch(t.tag){case 26:case 27:case 5:return ir(t.type);case 16:return ir("Lazy");case 13:return ir("Suspense");case 19:return ir("SuspenseList");case 0:case 15:return Ko(t.type,!1);case 11:return Ko(t.type.render,!1);case 1:return Ko(t.type,!0);case 31:return ir("Activity");default:return""}}function Jo(t){try{var s="";do s+=ul(t),t=t.return;while(t);return s}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function Cn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function dl(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function qp(t){var s=dl(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),l=""+t[s];if(!t.hasOwnProperty(s)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var d=o.get,m=o.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return d.call(this)},set:function(w){l=""+w,m.call(this,w)}}),Object.defineProperty(t,s,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(w){l=""+w},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Yo(t){t._valueTracker||(t._valueTracker=qp(t))}function pl(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var o=s.getValue(),l="";return t&&(l=dl(t)?t.checked?"true":"false":t.value),t=l,t!==o?(s.setValue(t),!0):!1}function eo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var jp=/[\n"\\]/g;function Nt(t){return t.replace(jp,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function zn(t,s,o,l,d,m,w,T){t.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?t.type=w:t.removeAttribute("type"),s!=null?w==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+Cn(s)):t.value!==""+Cn(s)&&(t.value=""+Cn(s)):w!=="submit"&&w!=="reset"||t.removeAttribute("value"),s!=null?si(t,w,Cn(s)):o!=null?si(t,w,Cn(o)):l!=null&&t.removeAttribute("value"),d==null&&m!=null&&(t.defaultChecked=!!m),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?t.name=""+Cn(T):t.removeAttribute("name")}function to(t,s,o,l,d,m,w,T){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(t.type=m),s!=null||o!=null){if(!(m!=="submit"&&m!=="reset"||s!=null))return;o=o!=null?""+Cn(o):"",s=s!=null?""+Cn(s):o,T||s===t.value||(t.value=s),t.defaultValue=s}l=l??d,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=T?t.checked:!!l,t.defaultChecked=!!l,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(t.name=w)}function si(t,s,o){s==="number"&&eo(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function vs(t,s,o,l){if(t=t.options,s){s={};for(var d=0;d<o.length;d++)s["$"+o[d]]=!0;for(o=0;o<t.length;o++)d=s.hasOwnProperty("$"+t[o].value),t[o].selected!==d&&(t[o].selected=d),d&&l&&(t[o].defaultSelected=!0)}else{for(o=""+Cn(o),s=null,d=0;d<t.length;d++){if(t[d].value===o){t[d].selected=!0,l&&(t[d].defaultSelected=!0);return}s!==null||t[d].disabled||(s=t[d])}s!==null&&(s.selected=!0)}}function nt(t,s,o){if(s!=null&&(s=""+Cn(s),s!==t.value&&(t.value=s),o==null)){t.defaultValue!==s&&(t.defaultValue=s);return}t.defaultValue=o!=null?""+Cn(o):""}function no(t,s,o,l){if(s==null){if(l!=null){if(o!=null)throw Error(i(92));if(pt(l)){if(1<l.length)throw Error(i(93));l=l[0]}o=l}o==null&&(o=""),s=o}o=Cn(s),t.defaultValue=o,l=t.textContent,l===o&&l!==""&&l!==null&&(t.value=l)}function or(t,s){if(s){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=s;return}}t.textContent=s}var ro=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tu(t,s,o){var l=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?l?t.setProperty(s,""):s==="float"?t.cssFloat="":t[s]="":l?t.setProperty(s,o):typeof o!="number"||o===0||ro.has(s)?s==="float"?t.cssFloat=o:t[s]=(""+o).trim():t[s]=o+"px"}function ml(t,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(t=t.style,o!=null){for(var l in o)!o.hasOwnProperty(l)||s!=null&&s.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var d in s)l=s[d],s.hasOwnProperty(d)&&o[d]!==l&&tu(t,d,l)}else for(var m in s)s.hasOwnProperty(m)&&tu(t,m,s[m])}function hl(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qo(t){return zp.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var bs=null;function ar(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ws=null,Ts=null;function fl(t){var s=jn(t);if(s&&(t=s.stateNode)){var o=t[Et]||null;e:switch(t=s.stateNode,s.type){case"input":if(zn(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Nt(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var l=o[s];if(l!==t&&l.form===t.form){var d=l[Et]||null;if(!d)throw Error(i(90));zn(l,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(s=0;s<o.length;s++)l=o[s],l.form===t.form&&pl(l)}break e;case"textarea":nt(t,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&vs(t,!!o.multiple,s,!1)}}}var Jr=!1;function nu(t,s,o){if(Jr)return t(s,o);Jr=!0;try{var l=t(s);return l}finally{if(Jr=!1,(ws!==null||Ts!==null)&&(Ju(),ws&&(s=ws,t=Ts,Ts=ws=null,fl(s),t)))for(s=0;s<t.length;s++)fl(t[s])}}function so(t,s){var o=t.stateNode;if(o===null)return null;var l=o[Et]||null;if(l===null)return null;o=l[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var Rr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lr=!1;if(Rr)try{var io={};Object.defineProperty(io,"passive",{get:function(){lr=!0}}),window.addEventListener("test",io,io),window.removeEventListener("test",io,io)}catch{lr=!1}var Yr=null,ii=null,Ss=null;function gl(){if(Ss)return Ss;var t,s=ii,o=s.length,l,d="value"in Yr?Yr.value:Yr.textContent,m=d.length;for(t=0;t<o&&s[t]===d[t];t++);var w=o-t;for(l=1;l<=w&&s[o-l]===d[m-l];l++);return Ss=d.slice(t,1<l?1-l:void 0)}function Qr(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Xr(){return!0}function yl(){return!1}function Xt(t){function s(o,l,d,m,w){this._reactName=o,this._targetInst=d,this.type=l,this.nativeEvent=m,this.target=w,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(o=t[T],this[T]=o?o(m):m[T]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Xr:yl,this.isPropagationStopped=yl,this}return b(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Xr)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Xr)},persist:function(){},isPersistent:Xr}),s}var Je={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xo=Xt(Je),oo=b({},Je,{view:0,detail:0}),ru=Xt(oo),Zo,ea,Zr,ao=b({},oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uo,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Zr&&(Zr&&t.type==="mousemove"?(Zo=t.screenX-Zr.screenX,ea=t.screenY-Zr.screenY):ea=Zo=0,Zr=t),Zo)},movementY:function(t){return"movementY"in t?t.movementY:ea}}),cr=Xt(ao),su=b({},ao,{dataTransfer:0}),Fp=Xt(su),lo=b({},oo,{relatedTarget:0}),ta=Xt(lo),vl=b({},Je,{animationName:0,elapsedTime:0,pseudoElement:0}),na=Xt(vl),iu=b({},Je,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ra=Xt(iu),Vp=b({},Je,{data:0}),bl=Xt(Vp),co={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ou={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},au={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wl(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=au[t])?!!s[t]:!1}function uo(){return wl}var lu=b({},oo,{key:function(t){if(t.key){var s=co[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=Qr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ou[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uo,charCode:function(t){return t.type==="keypress"?Qr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Qr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),sa=Xt(lu),cu=b({},ao,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tl=Xt(cu),Es=b({},oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uo}),uu=Xt(Es),du=b({},Je,{propertyName:0,elapsedTime:0,pseudoElement:0}),pu=Xt(du),mu=b({},ao,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ia=Xt(mu),_n=b({},Je,{newState:0,oldState:0}),hu=Xt(_n),fu=[9,13,27,32],es=Rr&&"CompositionEvent"in window,u=null;Rr&&"documentMode"in document&&(u=document.documentMode);var y=Rr&&"TextEvent"in window&&!u,v=Rr&&(!es||u&&8<u&&11>=u),S=" ",j=!1;function W(t,s){switch(t){case"keyup":return fu.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ze=!1;function Ft(t,s){switch(t){case"compositionend":return oe(s);case"keypress":return s.which!==32?null:(j=!0,S);case"textInput":return t=s.data,t===S&&j?null:t;default:return null}}function Fe(t,s){if(ze)return t==="compositionend"||!es&&W(t,s)?(t=gl(),Ss=ii=Yr=null,ze=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return v&&s.locale!=="ko"?null:s.data;default:return null}}var Zt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vt(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!Zt[t.type]:s==="textarea"}function Cs(t,s,o,l){ws?Ts?Ts.push(l):Ts=[l]:ws=l,s=td(s,"onChange"),0<s.length&&(o=new Xo("onChange","change",null,o,l),t.push({event:o,listeners:s}))}var on=null,ts=null;function Sl(t){Lb(t,0)}function gu(t){var s=Bn(t);if(pl(s))return t}function sy(t,s){if(t==="change")return s}var iy=!1;if(Rr){var Hp;if(Rr){var Gp="oninput"in document;if(!Gp){var oy=document.createElement("div");oy.setAttribute("oninput","return;"),Gp=typeof oy.oninput=="function"}Hp=Gp}else Hp=!1;iy=Hp&&(!document.documentMode||9<document.documentMode)}function ay(){on&&(on.detachEvent("onpropertychange",ly),ts=on=null)}function ly(t){if(t.propertyName==="value"&&gu(ts)){var s=[];Cs(s,ts,t,ar(t)),nu(Sl,s)}}function mA(t,s,o){t==="focusin"?(ay(),on=s,ts=o,on.attachEvent("onpropertychange",ly)):t==="focusout"&&ay()}function hA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return gu(ts)}function fA(t,s){if(t==="click")return gu(s)}function gA(t,s){if(t==="input"||t==="change")return gu(s)}function yA(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Fn=typeof Object.is=="function"?Object.is:yA;function El(t,s){if(Fn(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var o=Object.keys(t),l=Object.keys(s);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var d=o[l];if(!Pn.call(s,d)||!Fn(t[d],s[d]))return!1}return!0}function cy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function uy(t,s){var o=cy(t);t=0;for(var l;o;){if(o.nodeType===3){if(l=t+o.textContent.length,t<=s&&l>=s)return{node:o,offset:s-t};t=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=cy(o)}}function dy(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?dy(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function py(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var s=eo(t.document);s instanceof t.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)t=s.contentWindow;else break;s=eo(t.document)}return s}function $p(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}var vA=Rr&&"documentMode"in document&&11>=document.documentMode,oa=null,Wp=null,Cl=null,Kp=!1;function my(t,s,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Kp||oa==null||oa!==eo(l)||(l=oa,"selectionStart"in l&&$p(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Cl&&El(Cl,l)||(Cl=l,l=td(Wp,"onSelect"),0<l.length&&(s=new Xo("onSelect","select",null,s,o),t.push({event:s,listeners:l}),s.target=oa)))}function po(t,s){var o={};return o[t.toLowerCase()]=s.toLowerCase(),o["Webkit"+t]="webkit"+s,o["Moz"+t]="moz"+s,o}var aa={animationend:po("Animation","AnimationEnd"),animationiteration:po("Animation","AnimationIteration"),animationstart:po("Animation","AnimationStart"),transitionrun:po("Transition","TransitionRun"),transitionstart:po("Transition","TransitionStart"),transitioncancel:po("Transition","TransitionCancel"),transitionend:po("Transition","TransitionEnd")},Jp={},hy={};Rr&&(hy=document.createElement("div").style,"AnimationEvent"in window||(delete aa.animationend.animation,delete aa.animationiteration.animation,delete aa.animationstart.animation),"TransitionEvent"in window||delete aa.transitionend.transition);function mo(t){if(Jp[t])return Jp[t];if(!aa[t])return t;var s=aa[t],o;for(o in s)if(s.hasOwnProperty(o)&&o in hy)return Jp[t]=s[o];return t}var fy=mo("animationend"),gy=mo("animationiteration"),yy=mo("animationstart"),bA=mo("transitionrun"),wA=mo("transitionstart"),TA=mo("transitioncancel"),vy=mo("transitionend"),by=new Map,Yp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yp.push("scrollEnd");function kr(t,s){by.set(t,s),se(s,[t])}var wy=new WeakMap;function ur(t,s){if(typeof t=="object"&&t!==null){var o=wy.get(t);return o!==void 0?o:(s={value:t,source:s,stack:Jo(s)},wy.set(t,s),s)}return{value:t,source:s,stack:Jo(s)}}var dr=[],la=0,Qp=0;function yu(){for(var t=la,s=Qp=la=0;s<t;){var o=dr[s];dr[s++]=null;var l=dr[s];dr[s++]=null;var d=dr[s];dr[s++]=null;var m=dr[s];if(dr[s++]=null,l!==null&&d!==null){var w=l.pending;w===null?d.next=d:(d.next=w.next,w.next=d),l.pending=d}m!==0&&Ty(o,d,m)}}function vu(t,s,o,l){dr[la++]=t,dr[la++]=s,dr[la++]=o,dr[la++]=l,Qp|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function Xp(t,s,o,l){return vu(t,s,o,l),bu(t)}function ca(t,s){return vu(t,null,null,s),bu(t)}function Ty(t,s,o){t.lanes|=o;var l=t.alternate;l!==null&&(l.lanes|=o);for(var d=!1,m=t.return;m!==null;)m.childLanes|=o,l=m.alternate,l!==null&&(l.childLanes|=o),m.tag===22&&(t=m.stateNode,t===null||t._visibility&1||(d=!0)),t=m,m=m.return;return t.tag===3?(m=t.stateNode,d&&s!==null&&(d=31-Bt(o),t=m.hiddenUpdates,l=t[d],l===null?t[d]=[s]:l.push(s),s.lane=o|536870912),m):null}function bu(t){if(50<Jl)throw Jl=0,sh=null,Error(i(185));for(var s=t.return;s!==null;)t=s,s=t.return;return t.tag===3?t.stateNode:null}var ua={};function SA(t,s,o,l){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(t,s,o,l){return new SA(t,s,o,l)}function Zp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _s(t,s){var o=t.alternate;return o===null?(o=Vn(t.tag,s,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=s,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,s=t.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function Sy(t,s){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=s,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,s=o.dependencies,t.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t}function wu(t,s,o,l,d,m){var w=0;if(l=t,typeof t=="function")Zp(t)&&(w=1);else if(typeof t=="string")w=CI(t,o,we.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case A:return t=Vn(31,o,s,d),t.elementType=A,t.lanes=m,t;case z:return ho(o.children,d,m,s);case Q:w=8,d|=24;break;case $:return t=Vn(12,o,s,d|2),t.elementType=$,t.lanes=m,t;case he:return t=Vn(13,o,s,d),t.elementType=he,t.lanes=m,t;case De:return t=Vn(19,o,s,d),t.elementType=De,t.lanes=m,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ie:case ae:w=10;break e;case re:w=9;break e;case ve:w=11;break e;case U:w=14;break e;case _:w=16,l=null;break e}w=29,o=Error(i(130,t===null?"null":typeof t,"")),l=null}return s=Vn(w,o,s,d),s.elementType=t,s.type=l,s.lanes=m,s}function ho(t,s,o,l){return t=Vn(7,t,l,s),t.lanes=o,t}function em(t,s,o){return t=Vn(6,t,null,s),t.lanes=o,t}function tm(t,s,o){return s=Vn(4,t.children!==null?t.children:[],t.key,s),s.lanes=o,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}var da=[],pa=0,Tu=null,Su=0,pr=[],mr=0,fo=null,As=1,Is="";function go(t,s){da[pa++]=Su,da[pa++]=Tu,Tu=t,Su=s}function Ey(t,s,o){pr[mr++]=As,pr[mr++]=Is,pr[mr++]=fo,fo=t;var l=As;t=Is;var d=32-Bt(l)-1;l&=~(1<<d),o+=1;var m=32-Bt(s)+d;if(30<m){var w=d-d%5;m=(l&(1<<w)-1).toString(32),l>>=w,d-=w,As=1<<32-Bt(s)+d|o<<d|l,Is=m+t}else As=1<<m|o<<d|l,Is=t}function nm(t){t.return!==null&&(go(t,1),Ey(t,1,0))}function rm(t){for(;t===Tu;)Tu=da[--pa],da[pa]=null,Su=da[--pa],da[pa]=null;for(;t===fo;)fo=pr[--mr],pr[mr]=null,Is=pr[--mr],pr[mr]=null,As=pr[--mr],pr[mr]=null}var An=null,Ct=null,Ke=!1,yo=null,ns=!1,sm=Error(i(519));function vo(t){var s=Error(i(418,""));throw Il(ur(s,t)),sm}function Cy(t){var s=t.stateNode,o=t.type,l=t.memoizedProps;switch(s[St]=t,s[Et]=l,o){case"dialog":Me("cancel",s),Me("close",s);break;case"iframe":case"object":case"embed":Me("load",s);break;case"video":case"audio":for(o=0;o<Ql.length;o++)Me(Ql[o],s);break;case"source":Me("error",s);break;case"img":case"image":case"link":Me("error",s),Me("load",s);break;case"details":Me("toggle",s);break;case"input":Me("invalid",s),to(s,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Yo(s);break;case"select":Me("invalid",s);break;case"textarea":Me("invalid",s),no(s,l.value,l.defaultValue,l.children),Yo(s)}o=l.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||l.suppressHydrationWarning===!0||zb(s.textContent,o)?(l.popover!=null&&(Me("beforetoggle",s),Me("toggle",s)),l.onScroll!=null&&Me("scroll",s),l.onScrollEnd!=null&&Me("scrollend",s),l.onClick!=null&&(s.onclick=nd),s=!0):s=!1,s||vo(t)}function _y(t){for(An=t.return;An;)switch(An.tag){case 5:case 13:ns=!1;return;case 27:case 3:ns=!0;return;default:An=An.return}}function _l(t){if(t!==An)return!1;if(!Ke)return _y(t),Ke=!0,!1;var s=t.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||wh(t.type,t.memoizedProps)),o=!o),o&&Ct&&vo(t),_y(t),s===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8)if(o=t.data,o==="/$"){if(s===0){Ct=Pr(t.nextSibling);break e}s--}else o!=="$"&&o!=="$!"&&o!=="$?"||s++;t=t.nextSibling}Ct=null}}else s===27?(s=Ct,Ti(t.type)?(t=Ch,Ch=null,Ct=t):Ct=s):Ct=An?Pr(t.stateNode.nextSibling):null;return!0}function Al(){Ct=An=null,Ke=!1}function Ay(){var t=yo;return t!==null&&(Un===null?Un=t:Un.push.apply(Un,t),yo=null),t}function Il(t){yo===null?yo=[t]:yo.push(t)}var im=J(null),bo=null,xs=null;function oi(t,s,o){ne(im,s._currentValue),s._currentValue=o}function Rs(t){t._currentValue=im.current,ce(im)}function om(t,s,o){for(;t!==null;){var l=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,l!==null&&(l.childLanes|=s)):l!==null&&(l.childLanes&s)!==s&&(l.childLanes|=s),t===o)break;t=t.return}}function am(t,s,o,l){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var m=d.dependencies;if(m!==null){var w=d.child;m=m.firstContext;e:for(;m!==null;){var T=m;m=d;for(var I=0;I<s.length;I++)if(T.context===s[I]){m.lanes|=o,T=m.alternate,T!==null&&(T.lanes|=o),om(m.return,o,t),l||(w=null);break e}m=T.next}}else if(d.tag===18){if(w=d.return,w===null)throw Error(i(341));w.lanes|=o,m=w.alternate,m!==null&&(m.lanes|=o),om(w,o,t),w=null}else w=d.child;if(w!==null)w.return=d;else for(w=d;w!==null;){if(w===t){w=null;break}if(d=w.sibling,d!==null){d.return=w.return,w=d;break}w=w.return}d=w}}function xl(t,s,o,l){t=null;for(var d=s,m=!1;d!==null;){if(!m){if((d.flags&524288)!==0)m=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var w=d.alternate;if(w===null)throw Error(i(387));if(w=w.memoizedProps,w!==null){var T=d.type;Fn(d.pendingProps.value,w.value)||(t!==null?t.push(T):t=[T])}}else if(d===Tt.current){if(w=d.alternate,w===null)throw Error(i(387));w.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push(rc):t=[rc])}d=d.return}t!==null&&am(s,t,o,l),s.flags|=262144}function Eu(t){for(t=t.firstContext;t!==null;){if(!Fn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function wo(t){bo=t,xs=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function fn(t){return Iy(bo,t)}function Cu(t,s){return bo===null&&wo(t),Iy(t,s)}function Iy(t,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},xs===null){if(t===null)throw Error(i(308));xs=s,t.dependencies={lanes:0,firstContext:s},t.flags|=524288}else xs=xs.next=s;return o}var EA=typeof AbortController<"u"?AbortController:function(){var t=[],s=this.signal={aborted:!1,addEventListener:function(o,l){t.push(l)}};this.abort=function(){s.aborted=!0,t.forEach(function(o){return o()})}},CA=r.unstable_scheduleCallback,_A=r.unstable_NormalPriority,Ht={$$typeof:ae,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function lm(){return{controller:new EA,data:new Map,refCount:0}}function Rl(t){t.refCount--,t.refCount===0&&CA(_A,function(){t.controller.abort()})}var kl=null,cm=0,ma=0,ha=null;function AA(t,s){if(kl===null){var o=kl=[];cm=0,ma=dh(),ha={status:"pending",value:void 0,then:function(l){o.push(l)}}}return cm++,s.then(xy,xy),s}function xy(){if(--cm===0&&kl!==null){ha!==null&&(ha.status="fulfilled");var t=kl;kl=null,ma=0,ha=null;for(var s=0;s<t.length;s++)(0,t[s])()}}function IA(t,s){var o=[],l={status:"pending",value:null,reason:null,then:function(d){o.push(d)}};return t.then(function(){l.status="fulfilled",l.value=s;for(var d=0;d<o.length;d++)(0,o[d])(s)},function(d){for(l.status="rejected",l.reason=d,d=0;d<o.length;d++)(0,o[d])(void 0)}),l}var Ry=K.S;K.S=function(t,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&AA(t,s),Ry!==null&&Ry(t,s)};var To=J(null);function um(){var t=To.current;return t!==null?t:ct.pooledCache}function _u(t,s){s===null?ne(To,To.current):ne(To,s.pool)}function ky(){var t=um();return t===null?null:{parent:Ht._currentValue,pool:t}}var Dl=Error(i(460)),Dy=Error(i(474)),Au=Error(i(542)),dm={then:function(){}};function Py(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Iu(){}function Ny(t,s,o){switch(o=t[o],o===void 0?t.push(s):o!==s&&(s.then(Iu,Iu),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Uy(t),t;default:if(typeof s.status=="string")s.then(Iu,Iu);else{if(t=ct,t!==null&&100<t.shellSuspendCounter)throw Error(i(482));t=s,t.status="pending",t.then(function(l){if(s.status==="pending"){var d=s;d.status="fulfilled",d.value=l}},function(l){if(s.status==="pending"){var d=s;d.status="rejected",d.reason=l}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Uy(t),t}throw Pl=s,Dl}}var Pl=null;function Oy(){if(Pl===null)throw Error(i(459));var t=Pl;return Pl=null,t}function Uy(t){if(t===Dl||t===Au)throw Error(i(483))}var ai=!1;function pm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mm(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function li(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function ci(t,s,o){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(et&2)!==0){var d=l.pending;return d===null?s.next=s:(s.next=d.next,d.next=s),l.pending=s,s=bu(t),Ty(t,null,o),s}return vu(t,l,s,o),bu(t)}function Nl(t,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,mt(t,o)}}function hm(t,s){var o=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var d=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var w={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};m===null?d=m=w:m=m.next=w,o=o.next}while(o!==null);m===null?d=m=s:m=m.next=s}else d=m=s;o={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:l.shared,callbacks:l.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=s:t.next=s,o.lastBaseUpdate=s}var fm=!1;function Ol(){if(fm){var t=ha;if(t!==null)throw t}}function Ul(t,s,o,l){fm=!1;var d=t.updateQueue;ai=!1;var m=d.firstBaseUpdate,w=d.lastBaseUpdate,T=d.shared.pending;if(T!==null){d.shared.pending=null;var I=T,V=I.next;I.next=null,w===null?m=V:w.next=V,w=I;var Y=t.alternate;Y!==null&&(Y=Y.updateQueue,T=Y.lastBaseUpdate,T!==w&&(T===null?Y.firstBaseUpdate=V:T.next=V,Y.lastBaseUpdate=I))}if(m!==null){var ee=d.baseState;w=0,Y=V=I=null,T=m;do{var H=T.lane&-536870913,G=H!==T.lane;if(G?(Ve&H)===H:(l&H)===H){H!==0&&H===ma&&(fm=!0),Y!==null&&(Y=Y.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var Ie=t,Ee=T;H=s;var it=o;switch(Ee.tag){case 1:if(Ie=Ee.payload,typeof Ie=="function"){ee=Ie.call(it,ee,H);break e}ee=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=Ee.payload,H=typeof Ie=="function"?Ie.call(it,ee,H):Ie,H==null)break e;ee=b({},ee,H);break e;case 2:ai=!0}}H=T.callback,H!==null&&(t.flags|=64,G&&(t.flags|=8192),G=d.callbacks,G===null?d.callbacks=[H]:G.push(H))}else G={lane:H,tag:T.tag,payload:T.payload,callback:T.callback,next:null},Y===null?(V=Y=G,I=ee):Y=Y.next=G,w|=H;if(T=T.next,T===null){if(T=d.shared.pending,T===null)break;G=T,T=G.next,G.next=null,d.lastBaseUpdate=G,d.shared.pending=null}}while(!0);Y===null&&(I=ee),d.baseState=I,d.firstBaseUpdate=V,d.lastBaseUpdate=Y,m===null&&(d.shared.lanes=0),yi|=w,t.lanes=w,t.memoizedState=ee}}function My(t,s){if(typeof t!="function")throw Error(i(191,t));t.call(s)}function Ly(t,s){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)My(o[t],s)}var fa=J(null),xu=J(0);function qy(t,s){t=Ms,ne(xu,t),ne(fa,s),Ms=t|s.baseLanes}function gm(){ne(xu,Ms),ne(fa,fa.current)}function ym(){Ms=xu.current,ce(fa),ce(xu)}var ui=0,Pe=null,rt=null,Ot=null,Ru=!1,ga=!1,So=!1,ku=0,Ml=0,ya=null,xA=0;function Rt(){throw Error(i(321))}function vm(t,s){if(s===null)return!1;for(var o=0;o<s.length&&o<t.length;o++)if(!Fn(t[o],s[o]))return!1;return!0}function bm(t,s,o,l,d,m){return ui=m,Pe=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,K.H=t===null||t.memoizedState===null?Tv:Sv,So=!1,m=o(l,d),So=!1,ga&&(m=By(s,o,l,d)),jy(t),m}function jy(t){K.H=Mu;var s=rt!==null&&rt.next!==null;if(ui=0,Ot=rt=Pe=null,Ru=!1,Ml=0,ya=null,s)throw Error(i(300));t===null||en||(t=t.dependencies,t!==null&&Eu(t)&&(en=!0))}function By(t,s,o,l){Pe=t;var d=0;do{if(ga&&(ya=null),Ml=0,ga=!1,25<=d)throw Error(i(301));if(d+=1,Ot=rt=null,t.updateQueue!=null){var m=t.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}K.H=UA,m=s(o,l)}while(ga);return m}function RA(){var t=K.H,s=t.useState()[0];return s=typeof s.then=="function"?Ll(s):s,t=t.useState()[0],(rt!==null?rt.memoizedState:null)!==t&&(Pe.flags|=1024),s}function wm(){var t=ku!==0;return ku=0,t}function Tm(t,s,o){s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~o}function Sm(t){if(Ru){for(t=t.memoizedState;t!==null;){var s=t.queue;s!==null&&(s.pending=null),t=t.next}Ru=!1}ui=0,Ot=rt=Pe=null,ga=!1,Ml=ku=0,ya=null}function Nn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?Pe.memoizedState=Ot=t:Ot=Ot.next=t,Ot}function Ut(){if(rt===null){var t=Pe.alternate;t=t!==null?t.memoizedState:null}else t=rt.next;var s=Ot===null?Pe.memoizedState:Ot.next;if(s!==null)Ot=s,rt=t;else{if(t===null)throw Pe.alternate===null?Error(i(467)):Error(i(310));rt=t,t={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},Ot===null?Pe.memoizedState=Ot=t:Ot=Ot.next=t}return Ot}function Em(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ll(t){var s=Ml;return Ml+=1,ya===null&&(ya=[]),t=Ny(ya,t,s),s=Pe,(Ot===null?s.memoizedState:Ot.next)===null&&(s=s.alternate,K.H=s===null||s.memoizedState===null?Tv:Sv),t}function Du(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ll(t);if(t.$$typeof===ae)return fn(t)}throw Error(i(438,String(t)))}function Cm(t){var s=null,o=Pe.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var l=Pe.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(s={data:l.data.map(function(d){return d.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=Em(),Pe.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(t),l=0;l<t;l++)o[l]=O;return s.index++,o}function ks(t,s){return typeof s=="function"?s(t):s}function Pu(t){var s=Ut();return _m(s,rt,t)}function _m(t,s,o){var l=t.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=o;var d=t.baseQueue,m=l.pending;if(m!==null){if(d!==null){var w=d.next;d.next=m.next,m.next=w}s.baseQueue=d=m,l.pending=null}if(m=t.baseState,d===null)t.memoizedState=m;else{s=d.next;var T=w=null,I=null,V=s,Y=!1;do{var ee=V.lane&-536870913;if(ee!==V.lane?(Ve&ee)===ee:(ui&ee)===ee){var H=V.revertLane;if(H===0)I!==null&&(I=I.next={lane:0,revertLane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),ee===ma&&(Y=!0);else if((ui&H)===H){V=V.next,H===ma&&(Y=!0);continue}else ee={lane:0,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},I===null?(T=I=ee,w=m):I=I.next=ee,Pe.lanes|=H,yi|=H;ee=V.action,So&&o(m,ee),m=V.hasEagerState?V.eagerState:o(m,ee)}else H={lane:ee,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},I===null?(T=I=H,w=m):I=I.next=H,Pe.lanes|=ee,yi|=ee;V=V.next}while(V!==null&&V!==s);if(I===null?w=m:I.next=T,!Fn(m,t.memoizedState)&&(en=!0,Y&&(o=ha,o!==null)))throw o;t.memoizedState=m,t.baseState=w,t.baseQueue=I,l.lastRenderedState=m}return d===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function Am(t){var s=Ut(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=t;var l=o.dispatch,d=o.pending,m=s.memoizedState;if(d!==null){o.pending=null;var w=d=d.next;do m=t(m,w.action),w=w.next;while(w!==d);Fn(m,s.memoizedState)||(en=!0),s.memoizedState=m,s.baseQueue===null&&(s.baseState=m),o.lastRenderedState=m}return[m,l]}function zy(t,s,o){var l=Pe,d=Ut(),m=Ke;if(m){if(o===void 0)throw Error(i(407));o=o()}else o=s();var w=!Fn((rt||d).memoizedState,o);w&&(d.memoizedState=o,en=!0),d=d.queue;var T=Hy.bind(null,l,d,t);if(ql(2048,8,T,[t]),d.getSnapshot!==s||w||Ot!==null&&Ot.memoizedState.tag&1){if(l.flags|=2048,va(9,Nu(),Vy.bind(null,l,d,o,s),null),ct===null)throw Error(i(349));m||(ui&124)!==0||Fy(l,s,o)}return o}function Fy(t,s,o){t.flags|=16384,t={getSnapshot:s,value:o},s=Pe.updateQueue,s===null?(s=Em(),Pe.updateQueue=s,s.stores=[t]):(o=s.stores,o===null?s.stores=[t]:o.push(t))}function Vy(t,s,o,l){s.value=o,s.getSnapshot=l,Gy(s)&&$y(t)}function Hy(t,s,o){return o(function(){Gy(s)&&$y(t)})}function Gy(t){var s=t.getSnapshot;t=t.value;try{var o=s();return!Fn(t,o)}catch{return!0}}function $y(t){var s=ca(t,2);s!==null&&Kn(s,t,2)}function Im(t){var s=Nn();if(typeof t=="function"){var o=t;if(t=o(),So){mn(!0);try{o()}finally{mn(!1)}}}return s.memoizedState=s.baseState=t,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:t},s}function Wy(t,s,o,l){return t.baseState=o,_m(t,rt,typeof l=="function"?l:ks)}function kA(t,s,o,l,d){if(Uu(t))throw Error(i(485));if(t=s.action,t!==null){var m={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){m.listeners.push(w)}};K.T!==null?o(!0):m.isTransition=!1,l(m),o=s.pending,o===null?(m.next=s.pending=m,Ky(s,m)):(m.next=o.next,s.pending=o.next=m)}}function Ky(t,s){var o=s.action,l=s.payload,d=t.state;if(s.isTransition){var m=K.T,w={};K.T=w;try{var T=o(d,l),I=K.S;I!==null&&I(w,T),Jy(t,s,T)}catch(V){xm(t,s,V)}finally{K.T=m}}else try{m=o(d,l),Jy(t,s,m)}catch(V){xm(t,s,V)}}function Jy(t,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(l){Yy(t,s,l)},function(l){return xm(t,s,l)}):Yy(t,s,o)}function Yy(t,s,o){s.status="fulfilled",s.value=o,Qy(s),t.state=o,s=t.pending,s!==null&&(o=s.next,o===s?t.pending=null:(o=o.next,s.next=o,Ky(t,o)))}function xm(t,s,o){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do s.status="rejected",s.reason=o,Qy(s),s=s.next;while(s!==l)}t.action=null}function Qy(t){t=t.listeners;for(var s=0;s<t.length;s++)(0,t[s])()}function Xy(t,s){return s}function Zy(t,s){if(Ke){var o=ct.formState;if(o!==null){e:{var l=Pe;if(Ke){if(Ct){t:{for(var d=Ct,m=ns;d.nodeType!==8;){if(!m){d=null;break t}if(d=Pr(d.nextSibling),d===null){d=null;break t}}m=d.data,d=m==="F!"||m==="F"?d:null}if(d){Ct=Pr(d.nextSibling),l=d.data==="F!";break e}}vo(l)}l=!1}l&&(s=o[0])}}return o=Nn(),o.memoizedState=o.baseState=s,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xy,lastRenderedState:s},o.queue=l,o=vv.bind(null,Pe,l),l.dispatch=o,l=Im(!1),m=Nm.bind(null,Pe,!1,l.queue),l=Nn(),d={state:s,dispatch:null,action:t,pending:null},l.queue=d,o=kA.bind(null,Pe,d,m,o),d.dispatch=o,l.memoizedState=t,[s,o,!1]}function ev(t){var s=Ut();return tv(s,rt,t)}function tv(t,s,o){if(s=_m(t,s,Xy)[0],t=Pu(ks)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var l=Ll(s)}catch(w){throw w===Dl?Au:w}else l=s;s=Ut();var d=s.queue,m=d.dispatch;return o!==s.memoizedState&&(Pe.flags|=2048,va(9,Nu(),DA.bind(null,d,o),null)),[l,m,t]}function DA(t,s){t.action=s}function nv(t){var s=Ut(),o=rt;if(o!==null)return tv(s,o,t);Ut(),s=s.memoizedState,o=Ut();var l=o.queue.dispatch;return o.memoizedState=t,[s,l,!1]}function va(t,s,o,l){return t={tag:t,create:o,deps:l,inst:s,next:null},s=Pe.updateQueue,s===null&&(s=Em(),Pe.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=t.next=t:(l=o.next,o.next=t,t.next=l,s.lastEffect=t),t}function Nu(){return{destroy:void 0,resource:void 0}}function rv(){return Ut().memoizedState}function Ou(t,s,o,l){var d=Nn();l=l===void 0?null:l,Pe.flags|=t,d.memoizedState=va(1|s,Nu(),o,l)}function ql(t,s,o,l){var d=Ut();l=l===void 0?null:l;var m=d.memoizedState.inst;rt!==null&&l!==null&&vm(l,rt.memoizedState.deps)?d.memoizedState=va(s,m,o,l):(Pe.flags|=t,d.memoizedState=va(1|s,m,o,l))}function sv(t,s){Ou(8390656,8,t,s)}function iv(t,s){ql(2048,8,t,s)}function ov(t,s){return ql(4,2,t,s)}function av(t,s){return ql(4,4,t,s)}function lv(t,s){if(typeof s=="function"){t=t();var o=s(t);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function cv(t,s,o){o=o!=null?o.concat([t]):null,ql(4,4,lv.bind(null,s,t),o)}function Rm(){}function uv(t,s){var o=Ut();s=s===void 0?null:s;var l=o.memoizedState;return s!==null&&vm(s,l[1])?l[0]:(o.memoizedState=[t,s],t)}function dv(t,s){var o=Ut();s=s===void 0?null:s;var l=o.memoizedState;if(s!==null&&vm(s,l[1]))return l[0];if(l=t(),So){mn(!0);try{t()}finally{mn(!1)}}return o.memoizedState=[l,s],l}function km(t,s,o){return o===void 0||(ui&1073741824)!==0?t.memoizedState=s:(t.memoizedState=o,t=hb(),Pe.lanes|=t,yi|=t,o)}function pv(t,s,o,l){return Fn(o,s)?o:fa.current!==null?(t=km(t,o,l),Fn(t,s)||(en=!0),t):(ui&42)===0?(en=!0,t.memoizedState=o):(t=hb(),Pe.lanes|=t,yi|=t,s)}function mv(t,s,o,l,d){var m=le.p;le.p=m!==0&&8>m?m:8;var w=K.T,T={};K.T=T,Nm(t,!1,s,o);try{var I=d(),V=K.S;if(V!==null&&V(T,I),I!==null&&typeof I=="object"&&typeof I.then=="function"){var Y=IA(I,l);jl(t,s,Y,Wn(t))}else jl(t,s,l,Wn(t))}catch(ee){jl(t,s,{then:function(){},status:"rejected",reason:ee},Wn())}finally{le.p=m,K.T=w}}function PA(){}function Dm(t,s,o,l){if(t.tag!==5)throw Error(i(476));var d=hv(t).queue;mv(t,d,s,ye,o===null?PA:function(){return fv(t),o(l)})}function hv(t){var s=t.memoizedState;if(s!==null)return s;s={memoizedState:ye,baseState:ye,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:ye},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:o},next:null},t.memoizedState=s,t=t.alternate,t!==null&&(t.memoizedState=s),s}function fv(t){var s=hv(t).next.queue;jl(t,s,{},Wn())}function Pm(){return fn(rc)}function gv(){return Ut().memoizedState}function yv(){return Ut().memoizedState}function NA(t){for(var s=t.return;s!==null;){switch(s.tag){case 24:case 3:var o=Wn();t=li(o);var l=ci(s,t,o);l!==null&&(Kn(l,s,o),Nl(l,s,o)),s={cache:lm()},t.payload=s;return}s=s.return}}function OA(t,s,o){var l=Wn();o={lane:l,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},Uu(t)?bv(s,o):(o=Xp(t,s,o,l),o!==null&&(Kn(o,t,l),wv(o,s,l)))}function vv(t,s,o){var l=Wn();jl(t,s,o,l)}function jl(t,s,o,l){var d={lane:l,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(Uu(t))bv(s,d);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=s.lastRenderedReducer,m!==null))try{var w=s.lastRenderedState,T=m(w,o);if(d.hasEagerState=!0,d.eagerState=T,Fn(T,w))return vu(t,s,d,0),ct===null&&yu(),!1}catch{}finally{}if(o=Xp(t,s,d,l),o!==null)return Kn(o,t,l),wv(o,s,l),!0}return!1}function Nm(t,s,o,l){if(l={lane:2,revertLane:dh(),action:l,hasEagerState:!1,eagerState:null,next:null},Uu(t)){if(s)throw Error(i(479))}else s=Xp(t,o,l,2),s!==null&&Kn(s,t,2)}function Uu(t){var s=t.alternate;return t===Pe||s!==null&&s===Pe}function bv(t,s){ga=Ru=!0;var o=t.pending;o===null?s.next=s:(s.next=o.next,o.next=s),t.pending=s}function wv(t,s,o){if((o&4194048)!==0){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,mt(t,o)}}var Mu={readContext:fn,use:Du,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useLayoutEffect:Rt,useInsertionEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useSyncExternalStore:Rt,useId:Rt,useHostTransitionStatus:Rt,useFormState:Rt,useActionState:Rt,useOptimistic:Rt,useMemoCache:Rt,useCacheRefresh:Rt},Tv={readContext:fn,use:Du,useCallback:function(t,s){return Nn().memoizedState=[t,s===void 0?null:s],t},useContext:fn,useEffect:sv,useImperativeHandle:function(t,s,o){o=o!=null?o.concat([t]):null,Ou(4194308,4,lv.bind(null,s,t),o)},useLayoutEffect:function(t,s){return Ou(4194308,4,t,s)},useInsertionEffect:function(t,s){Ou(4,2,t,s)},useMemo:function(t,s){var o=Nn();s=s===void 0?null:s;var l=t();if(So){mn(!0);try{t()}finally{mn(!1)}}return o.memoizedState=[l,s],l},useReducer:function(t,s,o){var l=Nn();if(o!==void 0){var d=o(s);if(So){mn(!0);try{o(s)}finally{mn(!1)}}}else d=s;return l.memoizedState=l.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},l.queue=t,t=t.dispatch=OA.bind(null,Pe,t),[l.memoizedState,t]},useRef:function(t){var s=Nn();return t={current:t},s.memoizedState=t},useState:function(t){t=Im(t);var s=t.queue,o=vv.bind(null,Pe,s);return s.dispatch=o,[t.memoizedState,o]},useDebugValue:Rm,useDeferredValue:function(t,s){var o=Nn();return km(o,t,s)},useTransition:function(){var t=Im(!1);return t=mv.bind(null,Pe,t.queue,!0,!1),Nn().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,s,o){var l=Pe,d=Nn();if(Ke){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),ct===null)throw Error(i(349));(Ve&124)!==0||Fy(l,s,o)}d.memoizedState=o;var m={value:o,getSnapshot:s};return d.queue=m,sv(Hy.bind(null,l,m,t),[t]),l.flags|=2048,va(9,Nu(),Vy.bind(null,l,m,o,s),null),o},useId:function(){var t=Nn(),s=ct.identifierPrefix;if(Ke){var o=Is,l=As;o=(l&~(1<<32-Bt(l)-1)).toString(32)+o,s="«"+s+"R"+o,o=ku++,0<o&&(s+="H"+o.toString(32)),s+="»"}else o=xA++,s="«"+s+"r"+o.toString(32)+"»";return t.memoizedState=s},useHostTransitionStatus:Pm,useFormState:Zy,useActionState:Zy,useOptimistic:function(t){var s=Nn();s.memoizedState=s.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Nm.bind(null,Pe,!0,o),o.dispatch=s,[t,s]},useMemoCache:Cm,useCacheRefresh:function(){return Nn().memoizedState=NA.bind(null,Pe)}},Sv={readContext:fn,use:Du,useCallback:uv,useContext:fn,useEffect:iv,useImperativeHandle:cv,useInsertionEffect:ov,useLayoutEffect:av,useMemo:dv,useReducer:Pu,useRef:rv,useState:function(){return Pu(ks)},useDebugValue:Rm,useDeferredValue:function(t,s){var o=Ut();return pv(o,rt.memoizedState,t,s)},useTransition:function(){var t=Pu(ks)[0],s=Ut().memoizedState;return[typeof t=="boolean"?t:Ll(t),s]},useSyncExternalStore:zy,useId:gv,useHostTransitionStatus:Pm,useFormState:ev,useActionState:ev,useOptimistic:function(t,s){var o=Ut();return Wy(o,rt,t,s)},useMemoCache:Cm,useCacheRefresh:yv},UA={readContext:fn,use:Du,useCallback:uv,useContext:fn,useEffect:iv,useImperativeHandle:cv,useInsertionEffect:ov,useLayoutEffect:av,useMemo:dv,useReducer:Am,useRef:rv,useState:function(){return Am(ks)},useDebugValue:Rm,useDeferredValue:function(t,s){var o=Ut();return rt===null?km(o,t,s):pv(o,rt.memoizedState,t,s)},useTransition:function(){var t=Am(ks)[0],s=Ut().memoizedState;return[typeof t=="boolean"?t:Ll(t),s]},useSyncExternalStore:zy,useId:gv,useHostTransitionStatus:Pm,useFormState:nv,useActionState:nv,useOptimistic:function(t,s){var o=Ut();return rt!==null?Wy(o,rt,t,s):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:Cm,useCacheRefresh:yv},ba=null,Bl=0;function Lu(t){var s=Bl;return Bl+=1,ba===null&&(ba=[]),Ny(ba,t,s)}function zl(t,s){s=s.props.ref,t.ref=s!==void 0?s:null}function qu(t,s){throw s.$$typeof===E?Error(i(525)):(t=Object.prototype.toString.call(s),Error(i(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t)))}function Ev(t){var s=t._init;return s(t._payload)}function Cv(t){function s(L,P){if(t){var B=L.deletions;B===null?(L.deletions=[P],L.flags|=16):B.push(P)}}function o(L,P){if(!t)return null;for(;P!==null;)s(L,P),P=P.sibling;return null}function l(L){for(var P=new Map;L!==null;)L.key!==null?P.set(L.key,L):P.set(L.index,L),L=L.sibling;return P}function d(L,P){return L=_s(L,P),L.index=0,L.sibling=null,L}function m(L,P,B){return L.index=B,t?(B=L.alternate,B!==null?(B=B.index,B<P?(L.flags|=67108866,P):B):(L.flags|=67108866,P)):(L.flags|=1048576,P)}function w(L){return t&&L.alternate===null&&(L.flags|=67108866),L}function T(L,P,B,Z){return P===null||P.tag!==6?(P=em(B,L.mode,Z),P.return=L,P):(P=d(P,B),P.return=L,P)}function I(L,P,B,Z){var me=B.type;return me===z?Y(L,P,B.props.children,Z,B.key):P!==null&&(P.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===_&&Ev(me)===P.type)?(P=d(P,B.props),zl(P,B),P.return=L,P):(P=wu(B.type,B.key,B.props,null,L.mode,Z),zl(P,B),P.return=L,P)}function V(L,P,B,Z){return P===null||P.tag!==4||P.stateNode.containerInfo!==B.containerInfo||P.stateNode.implementation!==B.implementation?(P=tm(B,L.mode,Z),P.return=L,P):(P=d(P,B.children||[]),P.return=L,P)}function Y(L,P,B,Z,me){return P===null||P.tag!==7?(P=ho(B,L.mode,Z,me),P.return=L,P):(P=d(P,B),P.return=L,P)}function ee(L,P,B){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=em(""+P,L.mode,B),P.return=L,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case C:return B=wu(P.type,P.key,P.props,null,L.mode,B),zl(B,P),B.return=L,B;case M:return P=tm(P,L.mode,B),P.return=L,P;case _:var Z=P._init;return P=Z(P._payload),ee(L,P,B)}if(pt(P)||q(P))return P=ho(P,L.mode,B,null),P.return=L,P;if(typeof P.then=="function")return ee(L,Lu(P),B);if(P.$$typeof===ae)return ee(L,Cu(L,P),B);qu(L,P)}return null}function H(L,P,B,Z){var me=P!==null?P.key:null;if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return me!==null?null:T(L,P,""+B,Z);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case C:return B.key===me?I(L,P,B,Z):null;case M:return B.key===me?V(L,P,B,Z):null;case _:return me=B._init,B=me(B._payload),H(L,P,B,Z)}if(pt(B)||q(B))return me!==null?null:Y(L,P,B,Z,null);if(typeof B.then=="function")return H(L,P,Lu(B),Z);if(B.$$typeof===ae)return H(L,P,Cu(L,B),Z);qu(L,B)}return null}function G(L,P,B,Z,me){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return L=L.get(B)||null,T(P,L,""+Z,me);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case C:return L=L.get(Z.key===null?B:Z.key)||null,I(P,L,Z,me);case M:return L=L.get(Z.key===null?B:Z.key)||null,V(P,L,Z,me);case _:var Ne=Z._init;return Z=Ne(Z._payload),G(L,P,B,Z,me)}if(pt(Z)||q(Z))return L=L.get(B)||null,Y(P,L,Z,me,null);if(typeof Z.then=="function")return G(L,P,B,Lu(Z),me);if(Z.$$typeof===ae)return G(L,P,B,Cu(P,Z),me);qu(P,Z)}return null}function Ie(L,P,B,Z){for(var me=null,Ne=null,be=P,Ce=P=0,nn=null;be!==null&&Ce<B.length;Ce++){be.index>Ce?(nn=be,be=null):nn=be.sibling;var We=H(L,be,B[Ce],Z);if(We===null){be===null&&(be=nn);break}t&&be&&We.alternate===null&&s(L,be),P=m(We,P,Ce),Ne===null?me=We:Ne.sibling=We,Ne=We,be=nn}if(Ce===B.length)return o(L,be),Ke&&go(L,Ce),me;if(be===null){for(;Ce<B.length;Ce++)be=ee(L,B[Ce],Z),be!==null&&(P=m(be,P,Ce),Ne===null?me=be:Ne.sibling=be,Ne=be);return Ke&&go(L,Ce),me}for(be=l(be);Ce<B.length;Ce++)nn=G(be,L,Ce,B[Ce],Z),nn!==null&&(t&&nn.alternate!==null&&be.delete(nn.key===null?Ce:nn.key),P=m(nn,P,Ce),Ne===null?me=nn:Ne.sibling=nn,Ne=nn);return t&&be.forEach(function(Ai){return s(L,Ai)}),Ke&&go(L,Ce),me}function Ee(L,P,B,Z){if(B==null)throw Error(i(151));for(var me=null,Ne=null,be=P,Ce=P=0,nn=null,We=B.next();be!==null&&!We.done;Ce++,We=B.next()){be.index>Ce?(nn=be,be=null):nn=be.sibling;var Ai=H(L,be,We.value,Z);if(Ai===null){be===null&&(be=nn);break}t&&be&&Ai.alternate===null&&s(L,be),P=m(Ai,P,Ce),Ne===null?me=Ai:Ne.sibling=Ai,Ne=Ai,be=nn}if(We.done)return o(L,be),Ke&&go(L,Ce),me;if(be===null){for(;!We.done;Ce++,We=B.next())We=ee(L,We.value,Z),We!==null&&(P=m(We,P,Ce),Ne===null?me=We:Ne.sibling=We,Ne=We);return Ke&&go(L,Ce),me}for(be=l(be);!We.done;Ce++,We=B.next())We=G(be,L,Ce,We.value,Z),We!==null&&(t&&We.alternate!==null&&be.delete(We.key===null?Ce:We.key),P=m(We,P,Ce),Ne===null?me=We:Ne.sibling=We,Ne=We);return t&&be.forEach(function(MI){return s(L,MI)}),Ke&&go(L,Ce),me}function it(L,P,B,Z){if(typeof B=="object"&&B!==null&&B.type===z&&B.key===null&&(B=B.props.children),typeof B=="object"&&B!==null){switch(B.$$typeof){case C:e:{for(var me=B.key;P!==null;){if(P.key===me){if(me=B.type,me===z){if(P.tag===7){o(L,P.sibling),Z=d(P,B.props.children),Z.return=L,L=Z;break e}}else if(P.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===_&&Ev(me)===P.type){o(L,P.sibling),Z=d(P,B.props),zl(Z,B),Z.return=L,L=Z;break e}o(L,P);break}else s(L,P);P=P.sibling}B.type===z?(Z=ho(B.props.children,L.mode,Z,B.key),Z.return=L,L=Z):(Z=wu(B.type,B.key,B.props,null,L.mode,Z),zl(Z,B),Z.return=L,L=Z)}return w(L);case M:e:{for(me=B.key;P!==null;){if(P.key===me)if(P.tag===4&&P.stateNode.containerInfo===B.containerInfo&&P.stateNode.implementation===B.implementation){o(L,P.sibling),Z=d(P,B.children||[]),Z.return=L,L=Z;break e}else{o(L,P);break}else s(L,P);P=P.sibling}Z=tm(B,L.mode,Z),Z.return=L,L=Z}return w(L);case _:return me=B._init,B=me(B._payload),it(L,P,B,Z)}if(pt(B))return Ie(L,P,B,Z);if(q(B)){if(me=q(B),typeof me!="function")throw Error(i(150));return B=me.call(B),Ee(L,P,B,Z)}if(typeof B.then=="function")return it(L,P,Lu(B),Z);if(B.$$typeof===ae)return it(L,P,Cu(L,B),Z);qu(L,B)}return typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint"?(B=""+B,P!==null&&P.tag===6?(o(L,P.sibling),Z=d(P,B),Z.return=L,L=Z):(o(L,P),Z=em(B,L.mode,Z),Z.return=L,L=Z),w(L)):o(L,P)}return function(L,P,B,Z){try{Bl=0;var me=it(L,P,B,Z);return ba=null,me}catch(be){if(be===Dl||be===Au)throw be;var Ne=Vn(29,be,null,L.mode);return Ne.lanes=Z,Ne.return=L,Ne}finally{}}}var wa=Cv(!0),_v=Cv(!1),hr=J(null),rs=null;function di(t){var s=t.alternate;ne(Gt,Gt.current&1),ne(hr,t),rs===null&&(s===null||fa.current!==null||s.memoizedState!==null)&&(rs=t)}function Av(t){if(t.tag===22){if(ne(Gt,Gt.current),ne(hr,t),rs===null){var s=t.alternate;s!==null&&s.memoizedState!==null&&(rs=t)}}else pi()}function pi(){ne(Gt,Gt.current),ne(hr,hr.current)}function Ds(t){ce(hr),rs===t&&(rs=null),ce(Gt)}var Gt=J(0);function ju(t){for(var s=t;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||Eh(o)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Om(t,s,o,l){s=t.memoizedState,o=o(l,s),o=o==null?s:b({},s,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var Um={enqueueSetState:function(t,s,o){t=t._reactInternals;var l=Wn(),d=li(l);d.payload=s,o!=null&&(d.callback=o),s=ci(t,d,l),s!==null&&(Kn(s,t,l),Nl(s,t,l))},enqueueReplaceState:function(t,s,o){t=t._reactInternals;var l=Wn(),d=li(l);d.tag=1,d.payload=s,o!=null&&(d.callback=o),s=ci(t,d,l),s!==null&&(Kn(s,t,l),Nl(s,t,l))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var o=Wn(),l=li(o);l.tag=2,s!=null&&(l.callback=s),s=ci(t,l,o),s!==null&&(Kn(s,t,o),Nl(s,t,o))}};function Iv(t,s,o,l,d,m,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,m,w):s.prototype&&s.prototype.isPureReactComponent?!El(o,l)||!El(d,m):!0}function xv(t,s,o,l){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,l),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,l),s.state!==t&&Um.enqueueReplaceState(s,s.state,null)}function Eo(t,s){var o=s;if("ref"in s){o={};for(var l in s)l!=="ref"&&(o[l]=s[l])}if(t=t.defaultProps){o===s&&(o=b({},o));for(var d in t)o[d]===void 0&&(o[d]=t[d])}return o}var Bu=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Rv(t){Bu(t)}function kv(t){console.error(t)}function Dv(t){Bu(t)}function zu(t,s){try{var o=t.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(l){setTimeout(function(){throw l})}}function Pv(t,s,o){try{var l=t.onCaughtError;l(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Mm(t,s,o){return o=li(o),o.tag=3,o.payload={element:null},o.callback=function(){zu(t,s)},o}function Nv(t){return t=li(t),t.tag=3,t}function Ov(t,s,o,l){var d=o.type.getDerivedStateFromError;if(typeof d=="function"){var m=l.value;t.payload=function(){return d(m)},t.callback=function(){Pv(s,o,l)}}var w=o.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(t.callback=function(){Pv(s,o,l),typeof d!="function"&&(vi===null?vi=new Set([this]):vi.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})})}function MA(t,s,o,l,d){if(o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(s=o.alternate,s!==null&&xl(s,o,d,!0),o=hr.current,o!==null){switch(o.tag){case 13:return rs===null?oh():o.alternate===null&&_t===0&&(_t=3),o.flags&=-257,o.flags|=65536,o.lanes=d,l===dm?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([l]):s.add(l),lh(t,l,d)),!1;case 22:return o.flags|=65536,l===dm?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([l])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([l]):o.add(l)),lh(t,l,d)),!1}throw Error(i(435,o.tag))}return lh(t,l,d),oh(),!1}if(Ke)return s=hr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=d,l!==sm&&(t=Error(i(422),{cause:l}),Il(ur(t,o)))):(l!==sm&&(s=Error(i(423),{cause:l}),Il(ur(s,o))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,l=ur(l,o),d=Mm(t.stateNode,l,d),hm(t,d),_t!==4&&(_t=2)),!1;var m=Error(i(520),{cause:l});if(m=ur(m,o),Kl===null?Kl=[m]:Kl.push(m),_t!==4&&(_t=2),s===null)return!0;l=ur(l,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,t=d&-d,o.lanes|=t,t=Mm(o.stateNode,l,t),hm(o,t),!1;case 1:if(s=o.type,m=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(vi===null||!vi.has(m))))return o.flags|=65536,d&=-d,o.lanes|=d,d=Nv(d),Ov(d,t,o,l),hm(o,d),!1}o=o.return}while(o!==null);return!1}var Uv=Error(i(461)),en=!1;function an(t,s,o,l){s.child=t===null?_v(s,null,o,l):wa(s,t.child,o,l)}function Mv(t,s,o,l,d){o=o.render;var m=s.ref;if("ref"in l){var w={};for(var T in l)T!=="ref"&&(w[T]=l[T])}else w=l;return wo(s),l=bm(t,s,o,w,m,d),T=wm(),t!==null&&!en?(Tm(t,s,d),Ps(t,s,d)):(Ke&&T&&nm(s),s.flags|=1,an(t,s,l,d),s.child)}function Lv(t,s,o,l,d){if(t===null){var m=o.type;return typeof m=="function"&&!Zp(m)&&m.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=m,qv(t,s,m,l,d)):(t=wu(o.type,null,l,s,s.mode,d),t.ref=s.ref,t.return=s,s.child=t)}if(m=t.child,!Hm(t,d)){var w=m.memoizedProps;if(o=o.compare,o=o!==null?o:El,o(w,l)&&t.ref===s.ref)return Ps(t,s,d)}return s.flags|=1,t=_s(m,l),t.ref=s.ref,t.return=s,s.child=t}function qv(t,s,o,l,d){if(t!==null){var m=t.memoizedProps;if(El(m,l)&&t.ref===s.ref)if(en=!1,s.pendingProps=l=m,Hm(t,d))(t.flags&131072)!==0&&(en=!0);else return s.lanes=t.lanes,Ps(t,s,d)}return Lm(t,s,o,l,d)}function jv(t,s,o){var l=s.pendingProps,d=l.children,m=t!==null?t.memoizedState:null;if(l.mode==="hidden"){if((s.flags&128)!==0){if(l=m!==null?m.baseLanes|o:o,t!==null){for(d=s.child=t.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;s.childLanes=m&~l}else s.childLanes=0,s.child=null;return Bv(t,s,l,o)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},t!==null&&_u(s,m!==null?m.cachePool:null),m!==null?qy(s,m):gm(),Av(s);else return s.lanes=s.childLanes=536870912,Bv(t,s,m!==null?m.baseLanes|o:o,o)}else m!==null?(_u(s,m.cachePool),qy(s,m),pi(),s.memoizedState=null):(t!==null&&_u(s,null),gm(),pi());return an(t,s,d,o),s.child}function Bv(t,s,o,l){var d=um();return d=d===null?null:{parent:Ht._currentValue,pool:d},s.memoizedState={baseLanes:o,cachePool:d},t!==null&&_u(s,null),gm(),Av(s),t!==null&&xl(t,s,l,!0),null}function Fu(t,s){var o=s.ref;if(o===null)t!==null&&t.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(t===null||t.ref!==o)&&(s.flags|=4194816)}}function Lm(t,s,o,l,d){return wo(s),o=bm(t,s,o,l,void 0,d),l=wm(),t!==null&&!en?(Tm(t,s,d),Ps(t,s,d)):(Ke&&l&&nm(s),s.flags|=1,an(t,s,o,d),s.child)}function zv(t,s,o,l,d,m){return wo(s),s.updateQueue=null,o=By(s,l,o,d),jy(t),l=wm(),t!==null&&!en?(Tm(t,s,m),Ps(t,s,m)):(Ke&&l&&nm(s),s.flags|=1,an(t,s,o,m),s.child)}function Fv(t,s,o,l,d){if(wo(s),s.stateNode===null){var m=ua,w=o.contextType;typeof w=="object"&&w!==null&&(m=fn(w)),m=new o(l,m),s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Um,s.stateNode=m,m._reactInternals=s,m=s.stateNode,m.props=l,m.state=s.memoizedState,m.refs={},pm(s),w=o.contextType,m.context=typeof w=="object"&&w!==null?fn(w):ua,m.state=s.memoizedState,w=o.getDerivedStateFromProps,typeof w=="function"&&(Om(s,o,w,l),m.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(w=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),w!==m.state&&Um.enqueueReplaceState(m,m.state,null),Ul(s,l,m,d),Ol(),m.state=s.memoizedState),typeof m.componentDidMount=="function"&&(s.flags|=4194308),l=!0}else if(t===null){m=s.stateNode;var T=s.memoizedProps,I=Eo(o,T);m.props=I;var V=m.context,Y=o.contextType;w=ua,typeof Y=="object"&&Y!==null&&(w=fn(Y));var ee=o.getDerivedStateFromProps;Y=typeof ee=="function"||typeof m.getSnapshotBeforeUpdate=="function",T=s.pendingProps!==T,Y||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(T||V!==w)&&xv(s,m,l,w),ai=!1;var H=s.memoizedState;m.state=H,Ul(s,l,m,d),Ol(),V=s.memoizedState,T||H!==V||ai?(typeof ee=="function"&&(Om(s,o,ee,l),V=s.memoizedState),(I=ai||Iv(s,o,I,l,H,V,w))?(Y||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(s.flags|=4194308)):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=l,s.memoizedState=V),m.props=l,m.state=V,m.context=w,l=I):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),l=!1)}else{m=s.stateNode,mm(t,s),w=s.memoizedProps,Y=Eo(o,w),m.props=Y,ee=s.pendingProps,H=m.context,V=o.contextType,I=ua,typeof V=="object"&&V!==null&&(I=fn(V)),T=o.getDerivedStateFromProps,(V=typeof T=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(w!==ee||H!==I)&&xv(s,m,l,I),ai=!1,H=s.memoizedState,m.state=H,Ul(s,l,m,d),Ol();var G=s.memoizedState;w!==ee||H!==G||ai||t!==null&&t.dependencies!==null&&Eu(t.dependencies)?(typeof T=="function"&&(Om(s,o,T,l),G=s.memoizedState),(Y=ai||Iv(s,o,Y,l,H,G,I)||t!==null&&t.dependencies!==null&&Eu(t.dependencies))?(V||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(l,G,I),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(l,G,I)),typeof m.componentDidUpdate=="function"&&(s.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof m.componentDidUpdate!="function"||w===t.memoizedProps&&H===t.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||w===t.memoizedProps&&H===t.memoizedState||(s.flags|=1024),s.memoizedProps=l,s.memoizedState=G),m.props=l,m.state=G,m.context=I,l=Y):(typeof m.componentDidUpdate!="function"||w===t.memoizedProps&&H===t.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||w===t.memoizedProps&&H===t.memoizedState||(s.flags|=1024),l=!1)}return m=l,Fu(t,s),l=(s.flags&128)!==0,m||l?(m=s.stateNode,o=l&&typeof o.getDerivedStateFromError!="function"?null:m.render(),s.flags|=1,t!==null&&l?(s.child=wa(s,t.child,null,d),s.child=wa(s,null,o,d)):an(t,s,o,d),s.memoizedState=m.state,t=s.child):t=Ps(t,s,d),t}function Vv(t,s,o,l){return Al(),s.flags|=256,an(t,s,o,l),s.child}var qm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function jm(t){return{baseLanes:t,cachePool:ky()}}function Bm(t,s,o){return t=t!==null?t.childLanes&~o:0,s&&(t|=fr),t}function Hv(t,s,o){var l=s.pendingProps,d=!1,m=(s.flags&128)!==0,w;if((w=m)||(w=t!==null&&t.memoizedState===null?!1:(Gt.current&2)!==0),w&&(d=!0,s.flags&=-129),w=(s.flags&32)!==0,s.flags&=-33,t===null){if(Ke){if(d?di(s):pi(),Ke){var T=Ct,I;if(I=T){e:{for(I=T,T=ns;I.nodeType!==8;){if(!T){T=null;break e}if(I=Pr(I.nextSibling),I===null){T=null;break e}}T=I}T!==null?(s.memoizedState={dehydrated:T,treeContext:fo!==null?{id:As,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},I=Vn(18,null,null,0),I.stateNode=T,I.return=s,s.child=I,An=s,Ct=null,I=!0):I=!1}I||vo(s)}if(T=s.memoizedState,T!==null&&(T=T.dehydrated,T!==null))return Eh(T)?s.lanes=32:s.lanes=536870912,null;Ds(s)}return T=l.children,l=l.fallback,d?(pi(),d=s.mode,T=Vu({mode:"hidden",children:T},d),l=ho(l,d,o,null),T.return=s,l.return=s,T.sibling=l,s.child=T,d=s.child,d.memoizedState=jm(o),d.childLanes=Bm(t,w,o),s.memoizedState=qm,l):(di(s),zm(s,T))}if(I=t.memoizedState,I!==null&&(T=I.dehydrated,T!==null)){if(m)s.flags&256?(di(s),s.flags&=-257,s=Fm(t,s,o)):s.memoizedState!==null?(pi(),s.child=t.child,s.flags|=128,s=null):(pi(),d=l.fallback,T=s.mode,l=Vu({mode:"visible",children:l.children},T),d=ho(d,T,o,null),d.flags|=2,l.return=s,d.return=s,l.sibling=d,s.child=l,wa(s,t.child,null,o),l=s.child,l.memoizedState=jm(o),l.childLanes=Bm(t,w,o),s.memoizedState=qm,s=d);else if(di(s),Eh(T)){if(w=T.nextSibling&&T.nextSibling.dataset,w)var V=w.dgst;w=V,l=Error(i(419)),l.stack="",l.digest=w,Il({value:l,source:null,stack:null}),s=Fm(t,s,o)}else if(en||xl(t,s,o,!1),w=(o&t.childLanes)!==0,en||w){if(w=ct,w!==null&&(l=o&-o,l=(l&42)!==0?1:En(l),l=(l&(w.suspendedLanes|o))!==0?0:l,l!==0&&l!==I.retryLane))throw I.retryLane=l,ca(t,l),Kn(w,t,l),Uv;T.data==="$?"||oh(),s=Fm(t,s,o)}else T.data==="$?"?(s.flags|=192,s.child=t.child,s=null):(t=I.treeContext,Ct=Pr(T.nextSibling),An=s,Ke=!0,yo=null,ns=!1,t!==null&&(pr[mr++]=As,pr[mr++]=Is,pr[mr++]=fo,As=t.id,Is=t.overflow,fo=s),s=zm(s,l.children),s.flags|=4096);return s}return d?(pi(),d=l.fallback,T=s.mode,I=t.child,V=I.sibling,l=_s(I,{mode:"hidden",children:l.children}),l.subtreeFlags=I.subtreeFlags&65011712,V!==null?d=_s(V,d):(d=ho(d,T,o,null),d.flags|=2),d.return=s,l.return=s,l.sibling=d,s.child=l,l=d,d=s.child,T=t.child.memoizedState,T===null?T=jm(o):(I=T.cachePool,I!==null?(V=Ht._currentValue,I=I.parent!==V?{parent:V,pool:V}:I):I=ky(),T={baseLanes:T.baseLanes|o,cachePool:I}),d.memoizedState=T,d.childLanes=Bm(t,w,o),s.memoizedState=qm,l):(di(s),o=t.child,t=o.sibling,o=_s(o,{mode:"visible",children:l.children}),o.return=s,o.sibling=null,t!==null&&(w=s.deletions,w===null?(s.deletions=[t],s.flags|=16):w.push(t)),s.child=o,s.memoizedState=null,o)}function zm(t,s){return s=Vu({mode:"visible",children:s},t.mode),s.return=t,t.child=s}function Vu(t,s){return t=Vn(22,t,null,s),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Fm(t,s,o){return wa(s,t.child,null,o),t=zm(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function Gv(t,s,o){t.lanes|=s;var l=t.alternate;l!==null&&(l.lanes|=s),om(t.return,s,o)}function Vm(t,s,o,l,d){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:d}:(m.isBackwards=s,m.rendering=null,m.renderingStartTime=0,m.last=l,m.tail=o,m.tailMode=d)}function $v(t,s,o){var l=s.pendingProps,d=l.revealOrder,m=l.tail;if(an(t,s,l.children,o),l=Gt.current,(l&2)!==0)l=l&1|2,s.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Gv(t,o,s);else if(t.tag===19)Gv(t,o,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}l&=1}switch(ne(Gt,l),d){case"forwards":for(o=s.child,d=null;o!==null;)t=o.alternate,t!==null&&ju(t)===null&&(d=o),o=o.sibling;o=d,o===null?(d=s.child,s.child=null):(d=o.sibling,o.sibling=null),Vm(s,!1,d,o,m);break;case"backwards":for(o=null,d=s.child,s.child=null;d!==null;){if(t=d.alternate,t!==null&&ju(t)===null){s.child=d;break}t=d.sibling,d.sibling=o,o=d,d=t}Vm(s,!0,o,null,m);break;case"together":Vm(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Ps(t,s,o){if(t!==null&&(s.dependencies=t.dependencies),yi|=s.lanes,(o&s.childLanes)===0)if(t!==null){if(xl(t,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(t!==null&&s.child!==t.child)throw Error(i(153));if(s.child!==null){for(t=s.child,o=_s(t,t.pendingProps),s.child=o,o.return=s;t.sibling!==null;)t=t.sibling,o=o.sibling=_s(t,t.pendingProps),o.return=s;o.sibling=null}return s.child}function Hm(t,s){return(t.lanes&s)!==0?!0:(t=t.dependencies,!!(t!==null&&Eu(t)))}function LA(t,s,o){switch(s.tag){case 3:Qe(s,s.stateNode.containerInfo),oi(s,Ht,t.memoizedState.cache),Al();break;case 27:case 5:Sr(s);break;case 4:Qe(s,s.stateNode.containerInfo);break;case 10:oi(s,s.type,s.memoizedProps.value);break;case 13:var l=s.memoizedState;if(l!==null)return l.dehydrated!==null?(di(s),s.flags|=128,null):(o&s.child.childLanes)!==0?Hv(t,s,o):(di(s),t=Ps(t,s,o),t!==null?t.sibling:null);di(s);break;case 19:var d=(t.flags&128)!==0;if(l=(o&s.childLanes)!==0,l||(xl(t,s,o,!1),l=(o&s.childLanes)!==0),d){if(l)return $v(t,s,o);s.flags|=128}if(d=s.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),ne(Gt,Gt.current),l)break;return null;case 22:case 23:return s.lanes=0,jv(t,s,o);case 24:oi(s,Ht,t.memoizedState.cache)}return Ps(t,s,o)}function Wv(t,s,o){if(t!==null)if(t.memoizedProps!==s.pendingProps)en=!0;else{if(!Hm(t,o)&&(s.flags&128)===0)return en=!1,LA(t,s,o);en=(t.flags&131072)!==0}else en=!1,Ke&&(s.flags&1048576)!==0&&Ey(s,Su,s.index);switch(s.lanes=0,s.tag){case 16:e:{t=s.pendingProps;var l=s.elementType,d=l._init;if(l=d(l._payload),s.type=l,typeof l=="function")Zp(l)?(t=Eo(l,t),s.tag=1,s=Fv(null,s,l,t,o)):(s.tag=0,s=Lm(null,s,l,t,o));else{if(l!=null){if(d=l.$$typeof,d===ve){s.tag=11,s=Mv(null,s,l,t,o);break e}else if(d===U){s.tag=14,s=Lv(null,s,l,t,o);break e}}throw s=At(l)||l,Error(i(306,s,""))}}return s;case 0:return Lm(t,s,s.type,s.pendingProps,o);case 1:return l=s.type,d=Eo(l,s.pendingProps),Fv(t,s,l,d,o);case 3:e:{if(Qe(s,s.stateNode.containerInfo),t===null)throw Error(i(387));l=s.pendingProps;var m=s.memoizedState;d=m.element,mm(t,s),Ul(s,l,null,o);var w=s.memoizedState;if(l=w.cache,oi(s,Ht,l),l!==m.cache&&am(s,[Ht],o,!0),Ol(),l=w.element,m.isDehydrated)if(m={element:l,isDehydrated:!1,cache:w.cache},s.updateQueue.baseState=m,s.memoizedState=m,s.flags&256){s=Vv(t,s,l,o);break e}else if(l!==d){d=ur(Error(i(424)),s),Il(d),s=Vv(t,s,l,o);break e}else{switch(t=s.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Ct=Pr(t.firstChild),An=s,Ke=!0,yo=null,ns=!0,o=_v(s,null,l,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Al(),l===d){s=Ps(t,s,o);break e}an(t,s,l,o)}s=s.child}return s;case 26:return Fu(t,s),t===null?(o=Qb(s.type,null,s.pendingProps,null))?s.memoizedState=o:Ke||(o=s.type,t=s.pendingProps,l=rd(Se.current).createElement(o),l[St]=s,l[Et]=t,cn(l,o,t),vt(l),s.stateNode=l):s.memoizedState=Qb(s.type,t.memoizedProps,s.pendingProps,t.memoizedState),null;case 27:return Sr(s),t===null&&Ke&&(l=s.stateNode=Kb(s.type,s.pendingProps,Se.current),An=s,ns=!0,d=Ct,Ti(s.type)?(Ch=d,Ct=Pr(l.firstChild)):Ct=d),an(t,s,s.pendingProps.children,o),Fu(t,s),t===null&&(s.flags|=4194304),s.child;case 5:return t===null&&Ke&&((d=l=Ct)&&(l=dI(l,s.type,s.pendingProps,ns),l!==null?(s.stateNode=l,An=s,Ct=Pr(l.firstChild),ns=!1,d=!0):d=!1),d||vo(s)),Sr(s),d=s.type,m=s.pendingProps,w=t!==null?t.memoizedProps:null,l=m.children,wh(d,m)?l=null:w!==null&&wh(d,w)&&(s.flags|=32),s.memoizedState!==null&&(d=bm(t,s,RA,null,null,o),rc._currentValue=d),Fu(t,s),an(t,s,l,o),s.child;case 6:return t===null&&Ke&&((t=o=Ct)&&(o=pI(o,s.pendingProps,ns),o!==null?(s.stateNode=o,An=s,Ct=null,t=!0):t=!1),t||vo(s)),null;case 13:return Hv(t,s,o);case 4:return Qe(s,s.stateNode.containerInfo),l=s.pendingProps,t===null?s.child=wa(s,null,l,o):an(t,s,l,o),s.child;case 11:return Mv(t,s,s.type,s.pendingProps,o);case 7:return an(t,s,s.pendingProps,o),s.child;case 8:return an(t,s,s.pendingProps.children,o),s.child;case 12:return an(t,s,s.pendingProps.children,o),s.child;case 10:return l=s.pendingProps,oi(s,s.type,l.value),an(t,s,l.children,o),s.child;case 9:return d=s.type._context,l=s.pendingProps.children,wo(s),d=fn(d),l=l(d),s.flags|=1,an(t,s,l,o),s.child;case 14:return Lv(t,s,s.type,s.pendingProps,o);case 15:return qv(t,s,s.type,s.pendingProps,o);case 19:return $v(t,s,o);case 31:return l=s.pendingProps,o=s.mode,l={mode:l.mode,children:l.children},t===null?(o=Vu(l,o),o.ref=s.ref,s.child=o,o.return=s,s=o):(o=_s(t.child,l),o.ref=s.ref,s.child=o,o.return=s,s=o),s;case 22:return jv(t,s,o);case 24:return wo(s),l=fn(Ht),t===null?(d=um(),d===null&&(d=ct,m=lm(),d.pooledCache=m,m.refCount++,m!==null&&(d.pooledCacheLanes|=o),d=m),s.memoizedState={parent:l,cache:d},pm(s),oi(s,Ht,d)):((t.lanes&o)!==0&&(mm(t,s),Ul(s,null,null,o),Ol()),d=t.memoizedState,m=s.memoizedState,d.parent!==l?(d={parent:l,cache:l},s.memoizedState=d,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=d),oi(s,Ht,l)):(l=m.cache,oi(s,Ht,l),l!==d.cache&&am(s,[Ht],o,!0))),an(t,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Ns(t){t.flags|=4}function Kv(t,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!nw(s)){if(s=hr.current,s!==null&&((Ve&4194048)===Ve?rs!==null:(Ve&62914560)!==Ve&&(Ve&536870912)===0||s!==rs))throw Pl=dm,Dy;t.flags|=8192}}function Hu(t,s){s!==null&&(t.flags|=4),t.flags&16384&&(s=t.tag!==22?Wr():536870912,t.lanes|=s,Ca|=s)}function Fl(t,s){if(!Ke)switch(t.tailMode){case"hidden":s=t.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function bt(t){var s=t.alternate!==null&&t.alternate.child===t.child,o=0,l=0;if(s)for(var d=t.child;d!==null;)o|=d.lanes|d.childLanes,l|=d.subtreeFlags&65011712,l|=d.flags&65011712,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)o|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=l,t.childLanes=o,s}function qA(t,s,o){var l=s.pendingProps;switch(rm(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(s),null;case 1:return bt(s),null;case 3:return o=s.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Rs(Ht),Dn(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(_l(s)?Ns(s):t===null||t.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ay())),bt(s),null;case 26:return o=s.memoizedState,t===null?(Ns(s),o!==null?(bt(s),Kv(s,o)):(bt(s),s.flags&=-16777217)):o?o!==t.memoizedState?(Ns(s),bt(s),Kv(s,o)):(bt(s),s.flags&=-16777217):(t.memoizedProps!==l&&Ns(s),bt(s),s.flags&=-16777217),null;case 27:Xn(s),o=Se.current;var d=s.type;if(t!==null&&s.stateNode!=null)t.memoizedProps!==l&&Ns(s);else{if(!l){if(s.stateNode===null)throw Error(i(166));return bt(s),null}t=we.current,_l(s)?Cy(s):(t=Kb(d,l,o),s.stateNode=t,Ns(s))}return bt(s),null;case 5:if(Xn(s),o=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==l&&Ns(s);else{if(!l){if(s.stateNode===null)throw Error(i(166));return bt(s),null}if(t=we.current,_l(s))Cy(s);else{switch(d=rd(Se.current),t){case 1:t=d.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:t=d.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":t=d.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":t=d.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof l.is=="string"?d.createElement("select",{is:l.is}):d.createElement("select"),l.multiple?t.multiple=!0:l.size&&(t.size=l.size);break;default:t=typeof l.is=="string"?d.createElement(o,{is:l.is}):d.createElement(o)}}t[St]=s,t[Et]=l;e:for(d=s.child;d!==null;){if(d.tag===5||d.tag===6)t.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}s.stateNode=t;e:switch(cn(t,o,l),o){case"button":case"input":case"select":case"textarea":t=!!l.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&Ns(s)}}return bt(s),s.flags&=-16777217,null;case 6:if(t&&s.stateNode!=null)t.memoizedProps!==l&&Ns(s);else{if(typeof l!="string"&&s.stateNode===null)throw Error(i(166));if(t=Se.current,_l(s)){if(t=s.stateNode,o=s.memoizedProps,l=null,d=An,d!==null)switch(d.tag){case 27:case 5:l=d.memoizedProps}t[St]=s,t=!!(t.nodeValue===o||l!==null&&l.suppressHydrationWarning===!0||zb(t.nodeValue,o)),t||vo(s)}else t=rd(t).createTextNode(l),t[St]=s,s.stateNode=t}return bt(s),null;case 13:if(l=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=_l(s),l!==null&&l.dehydrated!==null){if(t===null){if(!d)throw Error(i(318));if(d=s.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));d[St]=s}else Al(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;bt(s),d=!1}else d=Ay(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=d),d=!0;if(!d)return s.flags&256?(Ds(s),s):(Ds(s),null)}if(Ds(s),(s.flags&128)!==0)return s.lanes=o,s;if(o=l!==null,t=t!==null&&t.memoizedState!==null,o){l=s.child,d=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(d=l.alternate.memoizedState.cachePool.pool);var m=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==d&&(l.flags|=2048)}return o!==t&&o&&(s.child.flags|=8192),Hu(s,s.updateQueue),bt(s),null;case 4:return Dn(),t===null&&fh(s.stateNode.containerInfo),bt(s),null;case 10:return Rs(s.type),bt(s),null;case 19:if(ce(Gt),d=s.memoizedState,d===null)return bt(s),null;if(l=(s.flags&128)!==0,m=d.rendering,m===null)if(l)Fl(d,!1);else{if(_t!==0||t!==null&&(t.flags&128)!==0)for(t=s.child;t!==null;){if(m=ju(t),m!==null){for(s.flags|=128,Fl(d,!1),t=m.updateQueue,s.updateQueue=t,Hu(s,t),s.subtreeFlags=0,t=o,o=s.child;o!==null;)Sy(o,t),o=o.sibling;return ne(Gt,Gt.current&1|2),s.child}t=t.sibling}d.tail!==null&&jt()>Wu&&(s.flags|=128,l=!0,Fl(d,!1),s.lanes=4194304)}else{if(!l)if(t=ju(m),t!==null){if(s.flags|=128,l=!0,t=t.updateQueue,s.updateQueue=t,Hu(s,t),Fl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!Ke)return bt(s),null}else 2*jt()-d.renderingStartTime>Wu&&o!==536870912&&(s.flags|=128,l=!0,Fl(d,!1),s.lanes=4194304);d.isBackwards?(m.sibling=s.child,s.child=m):(t=d.last,t!==null?t.sibling=m:s.child=m,d.last=m)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=jt(),s.sibling=null,t=Gt.current,ne(Gt,l?t&1|2:t&1),s):(bt(s),null);case 22:case 23:return Ds(s),ym(),l=s.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(s.flags|=8192):l&&(s.flags|=8192),l?(o&536870912)!==0&&(s.flags&128)===0&&(bt(s),s.subtreeFlags&6&&(s.flags|=8192)):bt(s),o=s.updateQueue,o!==null&&Hu(s,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),l=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),l!==o&&(s.flags|=2048),t!==null&&ce(To),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Rs(Ht),bt(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function jA(t,s){switch(rm(s),s.tag){case 1:return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return Rs(Ht),Dn(),t=s.flags,(t&65536)!==0&&(t&128)===0?(s.flags=t&-65537|128,s):null;case 26:case 27:case 5:return Xn(s),null;case 13:if(Ds(s),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(i(340));Al()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return ce(Gt),null;case 4:return Dn(),null;case 10:return Rs(s.type),null;case 22:case 23:return Ds(s),ym(),t!==null&&ce(To),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 24:return Rs(Ht),null;case 25:return null;default:return null}}function Jv(t,s){switch(rm(s),s.tag){case 3:Rs(Ht),Dn();break;case 26:case 27:case 5:Xn(s);break;case 4:Dn();break;case 13:Ds(s);break;case 19:ce(Gt);break;case 10:Rs(s.type);break;case 22:case 23:Ds(s),ym(),t!==null&&ce(To);break;case 24:Rs(Ht)}}function Vl(t,s){try{var o=s.updateQueue,l=o!==null?o.lastEffect:null;if(l!==null){var d=l.next;o=d;do{if((o.tag&t)===t){l=void 0;var m=o.create,w=o.inst;l=m(),w.destroy=l}o=o.next}while(o!==d)}}catch(T){lt(s,s.return,T)}}function mi(t,s,o){try{var l=s.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var m=d.next;l=m;do{if((l.tag&t)===t){var w=l.inst,T=w.destroy;if(T!==void 0){w.destroy=void 0,d=s;var I=o,V=T;try{V()}catch(Y){lt(d,I,Y)}}}l=l.next}while(l!==m)}}catch(Y){lt(s,s.return,Y)}}function Yv(t){var s=t.updateQueue;if(s!==null){var o=t.stateNode;try{Ly(s,o)}catch(l){lt(t,t.return,l)}}}function Qv(t,s,o){o.props=Eo(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(l){lt(t,s,l)}}function Hl(t,s){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof o=="function"?t.refCleanup=o(l):o.current=l}}catch(d){lt(t,s,d)}}function ss(t,s){var o=t.ref,l=t.refCleanup;if(o!==null)if(typeof l=="function")try{l()}catch(d){lt(t,s,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(d){lt(t,s,d)}else o.current=null}function Xv(t){var s=t.type,o=t.memoizedProps,l=t.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&l.focus();break e;case"img":o.src?l.src=o.src:o.srcSet&&(l.srcset=o.srcSet)}}catch(d){lt(t,t.return,d)}}function Gm(t,s,o){try{var l=t.stateNode;oI(l,t.type,o,s),l[Et]=s}catch(d){lt(t,t.return,d)}}function Zv(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ti(t.type)||t.tag===4}function $m(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Zv(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ti(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Wm(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(t),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=nd));else if(l!==4&&(l===27&&Ti(t.type)&&(o=t.stateNode,s=null),t=t.child,t!==null))for(Wm(t,s,o),t=t.sibling;t!==null;)Wm(t,s,o),t=t.sibling}function Gu(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?o.insertBefore(t,s):o.appendChild(t);else if(l!==4&&(l===27&&Ti(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(Gu(t,s,o),t=t.sibling;t!==null;)Gu(t,s,o),t=t.sibling}function eb(t){var s=t.stateNode,o=t.memoizedProps;try{for(var l=t.type,d=s.attributes;d.length;)s.removeAttributeNode(d[0]);cn(s,l,o),s[St]=t,s[Et]=o}catch(m){lt(t,t.return,m)}}var Os=!1,kt=!1,Km=!1,tb=typeof WeakSet=="function"?WeakSet:Set,tn=null;function BA(t,s){if(t=t.containerInfo,vh=cd,t=py(t),$p(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var d=l.anchorOffset,m=l.focusNode;l=l.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var w=0,T=-1,I=-1,V=0,Y=0,ee=t,H=null;t:for(;;){for(var G;ee!==o||d!==0&&ee.nodeType!==3||(T=w+d),ee!==m||l!==0&&ee.nodeType!==3||(I=w+l),ee.nodeType===3&&(w+=ee.nodeValue.length),(G=ee.firstChild)!==null;)H=ee,ee=G;for(;;){if(ee===t)break t;if(H===o&&++V===d&&(T=w),H===m&&++Y===l&&(I=w),(G=ee.nextSibling)!==null)break;ee=H,H=ee.parentNode}ee=G}o=T===-1||I===-1?null:{start:T,end:I}}else o=null}o=o||{start:0,end:0}}else o=null;for(bh={focusedElem:t,selectionRange:o},cd=!1,tn=s;tn!==null;)if(s=tn,t=s.child,(s.subtreeFlags&1024)!==0&&t!==null)t.return=s,tn=t;else for(;tn!==null;){switch(s=tn,m=s.alternate,t=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&m!==null){t=void 0,o=s,d=m.memoizedProps,m=m.memoizedState,l=o.stateNode;try{var Ie=Eo(o.type,d,o.elementType===o.type);t=l.getSnapshotBeforeUpdate(Ie,m),l.__reactInternalSnapshotBeforeUpdate=t}catch(Ee){lt(o,o.return,Ee)}}break;case 3:if((t&1024)!==0){if(t=s.stateNode.containerInfo,o=t.nodeType,o===9)Sh(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Sh(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(i(163))}if(t=s.sibling,t!==null){t.return=s.return,tn=t;break}tn=s.return}}function nb(t,s,o){var l=o.flags;switch(o.tag){case 0:case 11:case 15:hi(t,o),l&4&&Vl(5,o);break;case 1:if(hi(t,o),l&4)if(t=o.stateNode,s===null)try{t.componentDidMount()}catch(w){lt(o,o.return,w)}else{var d=Eo(o.type,s.memoizedProps);s=s.memoizedState;try{t.componentDidUpdate(d,s,t.__reactInternalSnapshotBeforeUpdate)}catch(w){lt(o,o.return,w)}}l&64&&Yv(o),l&512&&Hl(o,o.return);break;case 3:if(hi(t,o),l&64&&(t=o.updateQueue,t!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{Ly(t,s)}catch(w){lt(o,o.return,w)}}break;case 27:s===null&&l&4&&eb(o);case 26:case 5:hi(t,o),s===null&&l&4&&Xv(o),l&512&&Hl(o,o.return);break;case 12:hi(t,o);break;case 13:hi(t,o),l&4&&ib(t,o),l&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=JA.bind(null,o),mI(t,o))));break;case 22:if(l=o.memoizedState!==null||Os,!l){s=s!==null&&s.memoizedState!==null||kt,d=Os;var m=kt;Os=l,(kt=s)&&!m?fi(t,o,(o.subtreeFlags&8772)!==0):hi(t,o),Os=d,kt=m}break;case 30:break;default:hi(t,o)}}function rb(t){var s=t.alternate;s!==null&&(t.alternate=null,rb(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&Jt(s)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var ft=null,On=!1;function Us(t,s,o){for(o=o.child;o!==null;)sb(t,s,o),o=o.sibling}function sb(t,s,o){if($e&&typeof $e.onCommitFiberUnmount=="function")try{$e.onCommitFiberUnmount(Xe,o)}catch{}switch(o.tag){case 26:kt||ss(o,s),Us(t,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:kt||ss(o,s);var l=ft,d=On;Ti(o.type)&&(ft=o.stateNode,On=!1),Us(t,s,o),Zl(o.stateNode),ft=l,On=d;break;case 5:kt||ss(o,s);case 6:if(l=ft,d=On,ft=null,Us(t,s,o),ft=l,On=d,ft!==null)if(On)try{(ft.nodeType===9?ft.body:ft.nodeName==="HTML"?ft.ownerDocument.body:ft).removeChild(o.stateNode)}catch(m){lt(o,s,m)}else try{ft.removeChild(o.stateNode)}catch(m){lt(o,s,m)}break;case 18:ft!==null&&(On?(t=ft,$b(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),ac(t)):$b(ft,o.stateNode));break;case 4:l=ft,d=On,ft=o.stateNode.containerInfo,On=!0,Us(t,s,o),ft=l,On=d;break;case 0:case 11:case 14:case 15:kt||mi(2,o,s),kt||mi(4,o,s),Us(t,s,o);break;case 1:kt||(ss(o,s),l=o.stateNode,typeof l.componentWillUnmount=="function"&&Qv(o,s,l)),Us(t,s,o);break;case 21:Us(t,s,o);break;case 22:kt=(l=kt)||o.memoizedState!==null,Us(t,s,o),kt=l;break;default:Us(t,s,o)}}function ib(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{ac(t)}catch(o){lt(s,s.return,o)}}function zA(t){switch(t.tag){case 13:case 19:var s=t.stateNode;return s===null&&(s=t.stateNode=new tb),s;case 22:return t=t.stateNode,s=t._retryCache,s===null&&(s=t._retryCache=new tb),s;default:throw Error(i(435,t.tag))}}function Jm(t,s){var o=zA(t);s.forEach(function(l){var d=YA.bind(null,t,l);o.has(l)||(o.add(l),l.then(d,d))})}function Hn(t,s){var o=s.deletions;if(o!==null)for(var l=0;l<o.length;l++){var d=o[l],m=t,w=s,T=w;e:for(;T!==null;){switch(T.tag){case 27:if(Ti(T.type)){ft=T.stateNode,On=!1;break e}break;case 5:ft=T.stateNode,On=!1;break e;case 3:case 4:ft=T.stateNode.containerInfo,On=!0;break e}T=T.return}if(ft===null)throw Error(i(160));sb(m,w,d),ft=null,On=!1,m=d.alternate,m!==null&&(m.return=null),d.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)ob(s,t),s=s.sibling}var Dr=null;function ob(t,s){var o=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Hn(s,t),Gn(t),l&4&&(mi(3,t,t.return),Vl(3,t),mi(5,t,t.return));break;case 1:Hn(s,t),Gn(t),l&512&&(kt||o===null||ss(o,o.return)),l&64&&Os&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?l:o.concat(l))));break;case 26:var d=Dr;if(Hn(s,t),Gn(t),l&512&&(kt||o===null||ss(o,o.return)),l&4){var m=o!==null?o.memoizedState:null;if(l=t.memoizedState,o===null)if(l===null)if(t.stateNode===null){e:{l=t.type,o=t.memoizedProps,d=d.ownerDocument||d;t:switch(l){case"title":m=d.getElementsByTagName("title")[0],(!m||m[Kr]||m[St]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=d.createElement(l),d.head.insertBefore(m,d.querySelector("head > title"))),cn(m,l,o),m[St]=t,vt(m),l=m;break e;case"link":var w=ew("link","href",d).get(l+(o.href||""));if(w){for(var T=0;T<w.length;T++)if(m=w[T],m.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&m.getAttribute("rel")===(o.rel==null?null:o.rel)&&m.getAttribute("title")===(o.title==null?null:o.title)&&m.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){w.splice(T,1);break t}}m=d.createElement(l),cn(m,l,o),d.head.appendChild(m);break;case"meta":if(w=ew("meta","content",d).get(l+(o.content||""))){for(T=0;T<w.length;T++)if(m=w[T],m.getAttribute("content")===(o.content==null?null:""+o.content)&&m.getAttribute("name")===(o.name==null?null:o.name)&&m.getAttribute("property")===(o.property==null?null:o.property)&&m.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&m.getAttribute("charset")===(o.charSet==null?null:o.charSet)){w.splice(T,1);break t}}m=d.createElement(l),cn(m,l,o),d.head.appendChild(m);break;default:throw Error(i(468,l))}m[St]=t,vt(m),l=m}t.stateNode=l}else tw(d,t.type,t.stateNode);else t.stateNode=Zb(d,l,t.memoizedProps);else m!==l?(m===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):m.count--,l===null?tw(d,t.type,t.stateNode):Zb(d,l,t.memoizedProps)):l===null&&t.stateNode!==null&&Gm(t,t.memoizedProps,o.memoizedProps)}break;case 27:Hn(s,t),Gn(t),l&512&&(kt||o===null||ss(o,o.return)),o!==null&&l&4&&Gm(t,t.memoizedProps,o.memoizedProps);break;case 5:if(Hn(s,t),Gn(t),l&512&&(kt||o===null||ss(o,o.return)),t.flags&32){d=t.stateNode;try{or(d,"")}catch(G){lt(t,t.return,G)}}l&4&&t.stateNode!=null&&(d=t.memoizedProps,Gm(t,d,o!==null?o.memoizedProps:d)),l&1024&&(Km=!0);break;case 6:if(Hn(s,t),Gn(t),l&4){if(t.stateNode===null)throw Error(i(162));l=t.memoizedProps,o=t.stateNode;try{o.nodeValue=l}catch(G){lt(t,t.return,G)}}break;case 3:if(od=null,d=Dr,Dr=sd(s.containerInfo),Hn(s,t),Dr=d,Gn(t),l&4&&o!==null&&o.memoizedState.isDehydrated)try{ac(s.containerInfo)}catch(G){lt(t,t.return,G)}Km&&(Km=!1,ab(t));break;case 4:l=Dr,Dr=sd(t.stateNode.containerInfo),Hn(s,t),Gn(t),Dr=l;break;case 12:Hn(s,t),Gn(t);break;case 13:Hn(s,t),Gn(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(th=jt()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Jm(t,l)));break;case 22:d=t.memoizedState!==null;var I=o!==null&&o.memoizedState!==null,V=Os,Y=kt;if(Os=V||d,kt=Y||I,Hn(s,t),kt=Y,Os=V,Gn(t),l&8192)e:for(s=t.stateNode,s._visibility=d?s._visibility&-2:s._visibility|1,d&&(o===null||I||Os||kt||Co(t)),o=null,s=t;;){if(s.tag===5||s.tag===26){if(o===null){I=o=s;try{if(m=I.stateNode,d)w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{T=I.stateNode;var ee=I.memoizedProps.style,H=ee!=null&&ee.hasOwnProperty("display")?ee.display:null;T.style.display=H==null||typeof H=="boolean"?"":(""+H).trim()}}catch(G){lt(I,I.return,G)}}}else if(s.tag===6){if(o===null){I=s;try{I.stateNode.nodeValue=d?"":I.memoizedProps}catch(G){lt(I,I.return,G)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===t)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;s.sibling===null;){if(s.return===null||s.return===t)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}l&4&&(l=t.updateQueue,l!==null&&(o=l.retryQueue,o!==null&&(l.retryQueue=null,Jm(t,o))));break;case 19:Hn(s,t),Gn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Jm(t,l)));break;case 30:break;case 21:break;default:Hn(s,t),Gn(t)}}function Gn(t){var s=t.flags;if(s&2){try{for(var o,l=t.return;l!==null;){if(Zv(l)){o=l;break}l=l.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var d=o.stateNode,m=$m(t);Gu(t,m,d);break;case 5:var w=o.stateNode;o.flags&32&&(or(w,""),o.flags&=-33);var T=$m(t);Gu(t,T,w);break;case 3:case 4:var I=o.stateNode.containerInfo,V=$m(t);Wm(t,V,I);break;default:throw Error(i(161))}}catch(Y){lt(t,t.return,Y)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function ab(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var s=t;ab(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),t=t.sibling}}function hi(t,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)nb(t,s.alternate,s),s=s.sibling}function Co(t){for(t=t.child;t!==null;){var s=t;switch(s.tag){case 0:case 11:case 14:case 15:mi(4,s,s.return),Co(s);break;case 1:ss(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Qv(s,s.return,o),Co(s);break;case 27:Zl(s.stateNode);case 26:case 5:ss(s,s.return),Co(s);break;case 22:s.memoizedState===null&&Co(s);break;case 30:Co(s);break;default:Co(s)}t=t.sibling}}function fi(t,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var l=s.alternate,d=t,m=s,w=m.flags;switch(m.tag){case 0:case 11:case 15:fi(d,m,o),Vl(4,m);break;case 1:if(fi(d,m,o),l=m,d=l.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(V){lt(l,l.return,V)}if(l=m,d=l.updateQueue,d!==null){var T=l.stateNode;try{var I=d.shared.hiddenCallbacks;if(I!==null)for(d.shared.hiddenCallbacks=null,d=0;d<I.length;d++)My(I[d],T)}catch(V){lt(l,l.return,V)}}o&&w&64&&Yv(m),Hl(m,m.return);break;case 27:eb(m);case 26:case 5:fi(d,m,o),o&&l===null&&w&4&&Xv(m),Hl(m,m.return);break;case 12:fi(d,m,o);break;case 13:fi(d,m,o),o&&w&4&&ib(d,m);break;case 22:m.memoizedState===null&&fi(d,m,o),Hl(m,m.return);break;case 30:break;default:fi(d,m,o)}s=s.sibling}}function Ym(t,s){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&Rl(o))}function Qm(t,s){t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Rl(t))}function is(t,s,o,l){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)lb(t,s,o,l),s=s.sibling}function lb(t,s,o,l){var d=s.flags;switch(s.tag){case 0:case 11:case 15:is(t,s,o,l),d&2048&&Vl(9,s);break;case 1:is(t,s,o,l);break;case 3:is(t,s,o,l),d&2048&&(t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Rl(t)));break;case 12:if(d&2048){is(t,s,o,l),t=s.stateNode;try{var m=s.memoizedProps,w=m.id,T=m.onPostCommit;typeof T=="function"&&T(w,s.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(I){lt(s,s.return,I)}}else is(t,s,o,l);break;case 13:is(t,s,o,l);break;case 23:break;case 22:m=s.stateNode,w=s.alternate,s.memoizedState!==null?m._visibility&2?is(t,s,o,l):Gl(t,s):m._visibility&2?is(t,s,o,l):(m._visibility|=2,Ta(t,s,o,l,(s.subtreeFlags&10256)!==0)),d&2048&&Ym(w,s);break;case 24:is(t,s,o,l),d&2048&&Qm(s.alternate,s);break;default:is(t,s,o,l)}}function Ta(t,s,o,l,d){for(d=d&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var m=t,w=s,T=o,I=l,V=w.flags;switch(w.tag){case 0:case 11:case 15:Ta(m,w,T,I,d),Vl(8,w);break;case 23:break;case 22:var Y=w.stateNode;w.memoizedState!==null?Y._visibility&2?Ta(m,w,T,I,d):Gl(m,w):(Y._visibility|=2,Ta(m,w,T,I,d)),d&&V&2048&&Ym(w.alternate,w);break;case 24:Ta(m,w,T,I,d),d&&V&2048&&Qm(w.alternate,w);break;default:Ta(m,w,T,I,d)}s=s.sibling}}function Gl(t,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=t,l=s,d=l.flags;switch(l.tag){case 22:Gl(o,l),d&2048&&Ym(l.alternate,l);break;case 24:Gl(o,l),d&2048&&Qm(l.alternate,l);break;default:Gl(o,l)}s=s.sibling}}var $l=8192;function Sa(t){if(t.subtreeFlags&$l)for(t=t.child;t!==null;)cb(t),t=t.sibling}function cb(t){switch(t.tag){case 26:Sa(t),t.flags&$l&&t.memoizedState!==null&&AI(Dr,t.memoizedState,t.memoizedProps);break;case 5:Sa(t);break;case 3:case 4:var s=Dr;Dr=sd(t.stateNode.containerInfo),Sa(t),Dr=s;break;case 22:t.memoizedState===null&&(s=t.alternate,s!==null&&s.memoizedState!==null?(s=$l,$l=16777216,Sa(t),$l=s):Sa(t));break;default:Sa(t)}}function ub(t){var s=t.alternate;if(s!==null&&(t=s.child,t!==null)){s.child=null;do s=t.sibling,t.sibling=null,t=s;while(t!==null)}}function Wl(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];tn=l,pb(l,t)}ub(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)db(t),t=t.sibling}function db(t){switch(t.tag){case 0:case 11:case 15:Wl(t),t.flags&2048&&mi(9,t,t.return);break;case 3:Wl(t);break;case 12:Wl(t);break;case 22:var s=t.stateNode;t.memoizedState!==null&&s._visibility&2&&(t.return===null||t.return.tag!==13)?(s._visibility&=-3,$u(t)):Wl(t);break;default:Wl(t)}}function $u(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];tn=l,pb(l,t)}ub(t)}for(t=t.child;t!==null;){switch(s=t,s.tag){case 0:case 11:case 15:mi(8,s,s.return),$u(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,$u(s));break;default:$u(s)}t=t.sibling}}function pb(t,s){for(;tn!==null;){var o=tn;switch(o.tag){case 0:case 11:case 15:mi(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var l=o.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Rl(o.memoizedState.cache)}if(l=o.child,l!==null)l.return=o,tn=l;else e:for(o=t;tn!==null;){l=tn;var d=l.sibling,m=l.return;if(rb(l),l===o){tn=null;break e}if(d!==null){d.return=m,tn=d;break e}tn=m}}}var FA={getCacheForType:function(t){var s=fn(Ht),o=s.data.get(t);return o===void 0&&(o=t(),s.data.set(t,o)),o}},VA=typeof WeakMap=="function"?WeakMap:Map,et=0,ct=null,Ue=null,Ve=0,tt=0,$n=null,gi=!1,Ea=!1,Xm=!1,Ms=0,_t=0,yi=0,_o=0,Zm=0,fr=0,Ca=0,Kl=null,Un=null,eh=!1,th=0,Wu=1/0,Ku=null,vi=null,ln=0,bi=null,_a=null,Aa=0,nh=0,rh=null,mb=null,Jl=0,sh=null;function Wn(){if((et&2)!==0&&Ve!==0)return Ve&-Ve;if(K.T!==null){var t=ma;return t!==0?t:dh()}return Ir()}function hb(){fr===0&&(fr=(Ve&536870912)===0||Ke?$r():536870912);var t=hr.current;return t!==null&&(t.flags|=32),fr}function Kn(t,s,o){(t===ct&&(tt===2||tt===9)||t.cancelPendingCommit!==null)&&(Ia(t,0),wi(t,Ve,fr,!1)),Sn(t,o),((et&2)===0||t!==ct)&&(t===ct&&((et&2)===0&&(_o|=o),_t===4&&wi(t,Ve,fr,!1)),os(t))}function fb(t,s,o){if((et&6)!==0)throw Error(i(327));var l=!o&&(s&124)===0&&(s&t.expiredLanes)===0||_r(t,s),d=l?$A(t,s):ah(t,s,!0),m=l;do{if(d===0){Ea&&!l&&wi(t,s,0,!1);break}else{if(o=t.current.alternate,m&&!HA(o)){d=ah(t,s,!1),m=!1;continue}if(d===2){if(m=s,t.errorRecoveryDisabledLanes&m)var w=0;else w=t.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){s=w;e:{var T=t;d=Kl;var I=T.current.memoizedState.isDehydrated;if(I&&(Ia(T,w).flags|=256),w=ah(T,w,!1),w!==2){if(Xm&&!I){T.errorRecoveryDisabledLanes|=m,_o|=m,d=4;break e}m=Un,Un=d,m!==null&&(Un===null?Un=m:Un.push.apply(Un,m))}d=w}if(m=!1,d!==2)continue}}if(d===1){Ia(t,0),wi(t,s,0,!0);break}e:{switch(l=t,m=d,m){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:wi(l,s,fr,!gi);break e;case 2:Un=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(d=th+300-jt(),10<d)){if(wi(l,s,fr,!gi),Gr(l,0,!0)!==0)break e;l.timeoutHandle=Hb(gb.bind(null,l,o,Un,Ku,eh,s,fr,_o,Ca,gi,m,2,-0,0),d);break e}gb(l,o,Un,Ku,eh,s,fr,_o,Ca,gi,m,0,-0,0)}}break}while(!0);os(t)}function gb(t,s,o,l,d,m,w,T,I,V,Y,ee,H,G){if(t.timeoutHandle=-1,ee=s.subtreeFlags,(ee&8192||(ee&16785408)===16785408)&&(nc={stylesheets:null,count:0,unsuspend:_I},cb(s),ee=II(),ee!==null)){t.cancelPendingCommit=ee(Eb.bind(null,t,s,m,o,l,d,w,T,I,Y,1,H,G)),wi(t,m,w,!V);return}Eb(t,s,m,o,l,d,w,T,I)}function HA(t){for(var s=t;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var l=0;l<o.length;l++){var d=o[l],m=d.getSnapshot;d=d.value;try{if(!Fn(m(),d))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function wi(t,s,o,l){s&=~Zm,s&=~_o,t.suspendedLanes|=s,t.pingedLanes&=~s,l&&(t.warmLanes|=s),l=t.expirationTimes;for(var d=s;0<d;){var m=31-Bt(d),w=1<<m;l[m]=-1,d&=~w}o!==0&&nr(t,o,s)}function Ju(){return(et&6)===0?(Yl(0),!1):!0}function ih(){if(Ue!==null){if(tt===0)var t=Ue.return;else t=Ue,xs=bo=null,Sm(t),ba=null,Bl=0,t=Ue;for(;t!==null;)Jv(t.alternate,t),t=t.return;Ue=null}}function Ia(t,s){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,lI(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),ih(),ct=t,Ue=o=_s(t.current,null),Ve=s,tt=0,$n=null,gi=!1,Ea=_r(t,s),Xm=!1,Ca=fr=Zm=_o=yi=_t=0,Un=Kl=null,eh=!1,(s&8)!==0&&(s|=s&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=s;0<l;){var d=31-Bt(l),m=1<<d;s|=t[d],l&=~m}return Ms=s,yu(),o}function yb(t,s){Pe=null,K.H=Mu,s===Dl||s===Au?(s=Oy(),tt=3):s===Dy?(s=Oy(),tt=4):tt=s===Uv?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,$n=s,Ue===null&&(_t=1,zu(t,ur(s,t.current)))}function vb(){var t=K.H;return K.H=Mu,t===null?Mu:t}function bb(){var t=K.A;return K.A=FA,t}function oh(){_t=4,gi||(Ve&4194048)!==Ve&&hr.current!==null||(Ea=!0),(yi&134217727)===0&&(_o&134217727)===0||ct===null||wi(ct,Ve,fr,!1)}function ah(t,s,o){var l=et;et|=2;var d=vb(),m=bb();(ct!==t||Ve!==s)&&(Ku=null,Ia(t,s)),s=!1;var w=_t;e:do try{if(tt!==0&&Ue!==null){var T=Ue,I=$n;switch(tt){case 8:ih(),w=6;break e;case 3:case 2:case 9:case 6:hr.current===null&&(s=!0);var V=tt;if(tt=0,$n=null,xa(t,T,I,V),o&&Ea){w=0;break e}break;default:V=tt,tt=0,$n=null,xa(t,T,I,V)}}GA(),w=_t;break}catch(Y){yb(t,Y)}while(!0);return s&&t.shellSuspendCounter++,xs=bo=null,et=l,K.H=d,K.A=m,Ue===null&&(ct=null,Ve=0,yu()),w}function GA(){for(;Ue!==null;)wb(Ue)}function $A(t,s){var o=et;et|=2;var l=vb(),d=bb();ct!==t||Ve!==s?(Ku=null,Wu=jt()+500,Ia(t,s)):Ea=_r(t,s);e:do try{if(tt!==0&&Ue!==null){s=Ue;var m=$n;t:switch(tt){case 1:tt=0,$n=null,xa(t,s,m,1);break;case 2:case 9:if(Py(m)){tt=0,$n=null,Tb(s);break}s=function(){tt!==2&&tt!==9||ct!==t||(tt=7),os(t)},m.then(s,s);break e;case 3:tt=7;break e;case 4:tt=5;break e;case 7:Py(m)?(tt=0,$n=null,Tb(s)):(tt=0,$n=null,xa(t,s,m,7));break;case 5:var w=null;switch(Ue.tag){case 26:w=Ue.memoizedState;case 5:case 27:var T=Ue;if(!w||nw(w)){tt=0,$n=null;var I=T.sibling;if(I!==null)Ue=I;else{var V=T.return;V!==null?(Ue=V,Yu(V)):Ue=null}break t}}tt=0,$n=null,xa(t,s,m,5);break;case 6:tt=0,$n=null,xa(t,s,m,6);break;case 8:ih(),_t=6;break e;default:throw Error(i(462))}}WA();break}catch(Y){yb(t,Y)}while(!0);return xs=bo=null,K.H=l,K.A=d,et=o,Ue!==null?0:(ct=null,Ve=0,yu(),_t)}function WA(){for(;Ue!==null&&!gs();)wb(Ue)}function wb(t){var s=Wv(t.alternate,t,Ms);t.memoizedProps=t.pendingProps,s===null?Yu(t):Ue=s}function Tb(t){var s=t,o=s.alternate;switch(s.tag){case 15:case 0:s=zv(o,s,s.pendingProps,s.type,void 0,Ve);break;case 11:s=zv(o,s,s.pendingProps,s.type.render,s.ref,Ve);break;case 5:Sm(s);default:Jv(o,s),s=Ue=Sy(s,Ms),s=Wv(o,s,Ms)}t.memoizedProps=t.pendingProps,s===null?Yu(t):Ue=s}function xa(t,s,o,l){xs=bo=null,Sm(s),ba=null,Bl=0;var d=s.return;try{if(MA(t,d,s,o,Ve)){_t=1,zu(t,ur(o,t.current)),Ue=null;return}}catch(m){if(d!==null)throw Ue=d,m;_t=1,zu(t,ur(o,t.current)),Ue=null;return}s.flags&32768?(Ke||l===1?t=!0:Ea||(Ve&536870912)!==0?t=!1:(gi=t=!0,(l===2||l===9||l===3||l===6)&&(l=hr.current,l!==null&&l.tag===13&&(l.flags|=16384))),Sb(s,t)):Yu(s)}function Yu(t){var s=t;do{if((s.flags&32768)!==0){Sb(s,gi);return}t=s.return;var o=qA(s.alternate,s,Ms);if(o!==null){Ue=o;return}if(s=s.sibling,s!==null){Ue=s;return}Ue=s=t}while(s!==null);_t===0&&(_t=5)}function Sb(t,s){do{var o=jA(t.alternate,t);if(o!==null){o.flags&=32767,Ue=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(t=t.sibling,t!==null)){Ue=t;return}Ue=t=o}while(t!==null);_t=6,Ue=null}function Eb(t,s,o,l,d,m,w,T,I){t.cancelPendingCommit=null;do Qu();while(ln!==0);if((et&6)!==0)throw Error(i(327));if(s!==null){if(s===t.current)throw Error(i(177));if(m=s.lanes|s.childLanes,m|=Qp,Xi(t,o,m,w,T,I),t===ct&&(Ue=ct=null,Ve=0),_a=s,bi=t,Aa=o,nh=m,rh=d,mb=l,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,QA(Vr,function(){return xb(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||l){l=K.T,K.T=null,d=le.p,le.p=2,w=et,et|=4;try{BA(t,s,o)}finally{et=w,le.p=d,K.T=l}}ln=1,Cb(),_b(),Ab()}}function Cb(){if(ln===1){ln=0;var t=bi,s=_a,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=K.T,K.T=null;var l=le.p;le.p=2;var d=et;et|=4;try{ob(s,t);var m=bh,w=py(t.containerInfo),T=m.focusedElem,I=m.selectionRange;if(w!==T&&T&&T.ownerDocument&&dy(T.ownerDocument.documentElement,T)){if(I!==null&&$p(T)){var V=I.start,Y=I.end;if(Y===void 0&&(Y=V),"selectionStart"in T)T.selectionStart=V,T.selectionEnd=Math.min(Y,T.value.length);else{var ee=T.ownerDocument||document,H=ee&&ee.defaultView||window;if(H.getSelection){var G=H.getSelection(),Ie=T.textContent.length,Ee=Math.min(I.start,Ie),it=I.end===void 0?Ee:Math.min(I.end,Ie);!G.extend&&Ee>it&&(w=it,it=Ee,Ee=w);var L=uy(T,Ee),P=uy(T,it);if(L&&P&&(G.rangeCount!==1||G.anchorNode!==L.node||G.anchorOffset!==L.offset||G.focusNode!==P.node||G.focusOffset!==P.offset)){var B=ee.createRange();B.setStart(L.node,L.offset),G.removeAllRanges(),Ee>it?(G.addRange(B),G.extend(P.node,P.offset)):(B.setEnd(P.node,P.offset),G.addRange(B))}}}}for(ee=[],G=T;G=G.parentNode;)G.nodeType===1&&ee.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<ee.length;T++){var Z=ee[T];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}cd=!!vh,bh=vh=null}finally{et=d,le.p=l,K.T=o}}t.current=s,ln=2}}function _b(){if(ln===2){ln=0;var t=bi,s=_a,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=K.T,K.T=null;var l=le.p;le.p=2;var d=et;et|=4;try{nb(t,s.alternate,s)}finally{et=d,le.p=l,K.T=o}}ln=3}}function Ab(){if(ln===4||ln===3){ln=0,Xs();var t=bi,s=_a,o=Aa,l=mb;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ln=5:(ln=0,_a=bi=null,Ib(t,t.pendingLanes));var d=t.pendingLanes;if(d===0&&(vi=null),ti(o),s=s.stateNode,$e&&typeof $e.onCommitFiberRoot=="function")try{$e.onCommitFiberRoot(Xe,s,void 0,(s.current.flags&128)===128)}catch{}if(l!==null){s=K.T,d=le.p,le.p=2,K.T=null;try{for(var m=t.onRecoverableError,w=0;w<l.length;w++){var T=l[w];m(T.value,{componentStack:T.stack})}}finally{K.T=s,le.p=d}}(Aa&3)!==0&&Qu(),os(t),d=t.pendingLanes,(o&4194090)!==0&&(d&42)!==0?t===sh?Jl++:(Jl=0,sh=t):Jl=0,Yl(0)}}function Ib(t,s){(t.pooledCacheLanes&=s)===0&&(s=t.pooledCache,s!=null&&(t.pooledCache=null,Rl(s)))}function Qu(t){return Cb(),_b(),Ab(),xb()}function xb(){if(ln!==5)return!1;var t=bi,s=nh;nh=0;var o=ti(Aa),l=K.T,d=le.p;try{le.p=32>o?32:o,K.T=null,o=rh,rh=null;var m=bi,w=Aa;if(ln=0,_a=bi=null,Aa=0,(et&6)!==0)throw Error(i(331));var T=et;if(et|=4,db(m.current),lb(m,m.current,w,o),et=T,Yl(0,!1),$e&&typeof $e.onPostCommitFiberRoot=="function")try{$e.onPostCommitFiberRoot(Xe,m)}catch{}return!0}finally{le.p=d,K.T=l,Ib(t,s)}}function Rb(t,s,o){s=ur(o,s),s=Mm(t.stateNode,s,2),t=ci(t,s,2),t!==null&&(Sn(t,2),os(t))}function lt(t,s,o){if(t.tag===3)Rb(t,t,o);else for(;s!==null;){if(s.tag===3){Rb(s,t,o);break}else if(s.tag===1){var l=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(vi===null||!vi.has(l))){t=ur(o,t),o=Nv(2),l=ci(s,o,2),l!==null&&(Ov(o,l,s,t),Sn(l,2),os(l));break}}s=s.return}}function lh(t,s,o){var l=t.pingCache;if(l===null){l=t.pingCache=new VA;var d=new Set;l.set(s,d)}else d=l.get(s),d===void 0&&(d=new Set,l.set(s,d));d.has(o)||(Xm=!0,d.add(o),t=KA.bind(null,t,s,o),s.then(t,t))}function KA(t,s,o){var l=t.pingCache;l!==null&&l.delete(s),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,ct===t&&(Ve&o)===o&&(_t===4||_t===3&&(Ve&62914560)===Ve&&300>jt()-th?(et&2)===0&&Ia(t,0):Zm|=o,Ca===Ve&&(Ca=0)),os(t)}function kb(t,s){s===0&&(s=Wr()),t=ca(t,s),t!==null&&(Sn(t,s),os(t))}function JA(t){var s=t.memoizedState,o=0;s!==null&&(o=s.retryLane),kb(t,o)}function YA(t,s){var o=0;switch(t.tag){case 13:var l=t.stateNode,d=t.memoizedState;d!==null&&(o=d.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(i(314))}l!==null&&l.delete(s),kb(t,o)}function QA(t,s){return Zn(t,s)}var Xu=null,Ra=null,ch=!1,Zu=!1,uh=!1,Ao=0;function os(t){t!==Ra&&t.next===null&&(Ra===null?Xu=Ra=t:Ra=Ra.next=t),Zu=!0,ch||(ch=!0,ZA())}function Yl(t,s){if(!uh&&Zu){uh=!0;do for(var o=!1,l=Xu;l!==null;){if(t!==0){var d=l.pendingLanes;if(d===0)var m=0;else{var w=l.suspendedLanes,T=l.pingedLanes;m=(1<<31-Bt(42|t)+1)-1,m&=d&~(w&~T),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(o=!0,Ob(l,m))}else m=Ve,m=Gr(l,l===ct?m:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(m&3)===0||_r(l,m)||(o=!0,Ob(l,m));l=l.next}while(o);uh=!1}}function XA(){Db()}function Db(){Zu=ch=!1;var t=0;Ao!==0&&(aI()&&(t=Ao),Ao=0);for(var s=jt(),o=null,l=Xu;l!==null;){var d=l.next,m=Pb(l,s);m===0?(l.next=null,o===null?Xu=d:o.next=d,d===null&&(Ra=o)):(o=l,(t!==0||(m&3)!==0)&&(Zu=!0)),l=d}Yl(t)}function Pb(t,s){for(var o=t.suspendedLanes,l=t.pingedLanes,d=t.expirationTimes,m=t.pendingLanes&-62914561;0<m;){var w=31-Bt(m),T=1<<w,I=d[w];I===-1?((T&o)===0||(T&l)!==0)&&(d[w]=Qi(T,s)):I<=s&&(t.expiredLanes|=T),m&=~T}if(s=ct,o=Ve,o=Gr(t,t===s?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,o===0||t===s&&(tt===2||tt===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&Tn(l),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||_r(t,o)){if(s=o&-o,s===t.callbackPriority)return s;switch(l!==null&&Tn(l),ti(o)){case 2:case 8:o=ys;break;case 32:o=Vr;break;case 268435456:o=Hr;break;default:o=Vr}return l=Nb.bind(null,t),o=Zn(o,l),t.callbackPriority=s,t.callbackNode=o,s}return l!==null&&l!==null&&Tn(l),t.callbackPriority=2,t.callbackNode=null,2}function Nb(t,s){if(ln!==0&&ln!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(Qu()&&t.callbackNode!==o)return null;var l=Ve;return l=Gr(t,t===ct?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(fb(t,l,s),Pb(t,jt()),t.callbackNode!=null&&t.callbackNode===o?Nb.bind(null,t):null)}function Ob(t,s){if(Qu())return null;fb(t,s,!0)}function ZA(){cI(function(){(et&6)!==0?Zn(Fr,XA):Db()})}function dh(){return Ao===0&&(Ao=$r()),Ao}function Ub(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Qo(""+t)}function Mb(t,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,t.id&&o.setAttribute("form",t.id),s.parentNode.insertBefore(o,s),t=new FormData(t),o.parentNode.removeChild(o),t}function eI(t,s,o,l,d){if(s==="submit"&&o&&o.stateNode===d){var m=Ub((d[Et]||null).action),w=l.submitter;w&&(s=(s=w[Et]||null)?Ub(s.formAction):w.getAttribute("formAction"),s!==null&&(m=s,w=null));var T=new Xo("action","action",null,l,d);t.push({event:T,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Ao!==0){var I=w?Mb(d,w):new FormData(d);Dm(o,{pending:!0,data:I,method:d.method,action:m},null,I)}}else typeof m=="function"&&(T.preventDefault(),I=w?Mb(d,w):new FormData(d),Dm(o,{pending:!0,data:I,method:d.method,action:m},m,I))},currentTarget:d}]})}}for(var ph=0;ph<Yp.length;ph++){var mh=Yp[ph],tI=mh.toLowerCase(),nI=mh[0].toUpperCase()+mh.slice(1);kr(tI,"on"+nI)}kr(fy,"onAnimationEnd"),kr(gy,"onAnimationIteration"),kr(yy,"onAnimationStart"),kr("dblclick","onDoubleClick"),kr("focusin","onFocus"),kr("focusout","onBlur"),kr(bA,"onTransitionRun"),kr(wA,"onTransitionStart"),kr(TA,"onTransitionCancel"),kr(vy,"onTransitionEnd"),de("onMouseEnter",["mouseout","mouseover"]),de("onMouseLeave",["mouseout","mouseover"]),de("onPointerEnter",["pointerout","pointerover"]),de("onPointerLeave",["pointerout","pointerover"]),se("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),se("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),se("onBeforeInput",["compositionend","keypress","textInput","paste"]),se("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),se("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),se("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ql));function Lb(t,s){s=(s&4)!==0;for(var o=0;o<t.length;o++){var l=t[o],d=l.event;l=l.listeners;e:{var m=void 0;if(s)for(var w=l.length-1;0<=w;w--){var T=l[w],I=T.instance,V=T.currentTarget;if(T=T.listener,I!==m&&d.isPropagationStopped())break e;m=T,d.currentTarget=V;try{m(d)}catch(Y){Bu(Y)}d.currentTarget=null,m=I}else for(w=0;w<l.length;w++){if(T=l[w],I=T.instance,V=T.currentTarget,T=T.listener,I!==m&&d.isPropagationStopped())break e;m=T,d.currentTarget=V;try{m(d)}catch(Y){Bu(Y)}d.currentTarget=null,m=I}}}}function Me(t,s){var o=s[rr];o===void 0&&(o=s[rr]=new Set);var l=t+"__bubble";o.has(l)||(qb(s,t,2,!1),o.add(l))}function hh(t,s,o){var l=0;s&&(l|=4),qb(o,t,l,s)}var ed="_reactListening"+Math.random().toString(36).slice(2);function fh(t){if(!t[ed]){t[ed]=!0,fe.forEach(function(o){o!=="selectionchange"&&(rI.has(o)||hh(o,!1,t),hh(o,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[ed]||(s[ed]=!0,hh("selectionchange",!1,s))}}function qb(t,s,o,l){switch(lw(s)){case 2:var d=kI;break;case 8:d=DI;break;default:d=Rh}o=d.bind(null,s,o,t),d=void 0,!lr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(d=!0),l?d!==void 0?t.addEventListener(s,o,{capture:!0,passive:d}):t.addEventListener(s,o,!0):d!==void 0?t.addEventListener(s,o,{passive:d}):t.addEventListener(s,o,!1)}function gh(t,s,o,l,d){var m=l;if((s&1)===0&&(s&2)===0&&l!==null)e:for(;;){if(l===null)return;var w=l.tag;if(w===3||w===4){var T=l.stateNode.containerInfo;if(T===d)break;if(w===4)for(w=l.return;w!==null;){var I=w.tag;if((I===3||I===4)&&w.stateNode.containerInfo===d)return;w=w.return}for(;T!==null;){if(w=sr(T),w===null)return;if(I=w.tag,I===5||I===6||I===26||I===27){l=m=w;continue e}T=T.parentNode}}l=l.return}nu(function(){var V=m,Y=ar(o),ee=[];e:{var H=by.get(t);if(H!==void 0){var G=Xo,Ie=t;switch(t){case"keypress":if(Qr(o)===0)break e;case"keydown":case"keyup":G=sa;break;case"focusin":Ie="focus",G=ta;break;case"focusout":Ie="blur",G=ta;break;case"beforeblur":case"afterblur":G=ta;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=cr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Fp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=uu;break;case fy:case gy:case yy:G=na;break;case vy:G=pu;break;case"scroll":case"scrollend":G=ru;break;case"wheel":G=ia;break;case"copy":case"cut":case"paste":G=ra;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=Tl;break;case"toggle":case"beforetoggle":G=hu}var Ee=(s&4)!==0,it=!Ee&&(t==="scroll"||t==="scrollend"),L=Ee?H!==null?H+"Capture":null:H;Ee=[];for(var P=V,B;P!==null;){var Z=P;if(B=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||B===null||L===null||(Z=so(P,L),Z!=null&&Ee.push(Xl(P,Z,B))),it)break;P=P.return}0<Ee.length&&(H=new G(H,Ie,null,o,Y),ee.push({event:H,listeners:Ee}))}}if((s&7)===0){e:{if(H=t==="mouseover"||t==="pointerover",G=t==="mouseout"||t==="pointerout",H&&o!==bs&&(Ie=o.relatedTarget||o.fromElement)&&(sr(Ie)||Ie[yt]))break e;if((G||H)&&(H=Y.window===Y?Y:(H=Y.ownerDocument)?H.defaultView||H.parentWindow:window,G?(Ie=o.relatedTarget||o.toElement,G=V,Ie=Ie?sr(Ie):null,Ie!==null&&(it=c(Ie),Ee=Ie.tag,Ie!==it||Ee!==5&&Ee!==27&&Ee!==6)&&(Ie=null)):(G=null,Ie=V),G!==Ie)){if(Ee=cr,Z="onMouseLeave",L="onMouseEnter",P="mouse",(t==="pointerout"||t==="pointerover")&&(Ee=Tl,Z="onPointerLeave",L="onPointerEnter",P="pointer"),it=G==null?H:Bn(G),B=Ie==null?H:Bn(Ie),H=new Ee(Z,P+"leave",G,o,Y),H.target=it,H.relatedTarget=B,Z=null,sr(Y)===V&&(Ee=new Ee(L,P+"enter",Ie,o,Y),Ee.target=B,Ee.relatedTarget=it,Z=Ee),it=Z,G&&Ie)t:{for(Ee=G,L=Ie,P=0,B=Ee;B;B=ka(B))P++;for(B=0,Z=L;Z;Z=ka(Z))B++;for(;0<P-B;)Ee=ka(Ee),P--;for(;0<B-P;)L=ka(L),B--;for(;P--;){if(Ee===L||L!==null&&Ee===L.alternate)break t;Ee=ka(Ee),L=ka(L)}Ee=null}else Ee=null;G!==null&&jb(ee,H,G,Ee,!1),Ie!==null&&it!==null&&jb(ee,it,Ie,Ee,!0)}}e:{if(H=V?Bn(V):window,G=H.nodeName&&H.nodeName.toLowerCase(),G==="select"||G==="input"&&H.type==="file")var me=sy;else if(Vt(H))if(iy)me=gA;else{me=hA;var Ne=mA}else G=H.nodeName,!G||G.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?V&&hl(V.elementType)&&(me=sy):me=fA;if(me&&(me=me(t,V))){Cs(ee,me,o,Y);break e}Ne&&Ne(t,H,V),t==="focusout"&&V&&H.type==="number"&&V.memoizedProps.value!=null&&si(H,"number",H.value)}switch(Ne=V?Bn(V):window,t){case"focusin":(Vt(Ne)||Ne.contentEditable==="true")&&(oa=Ne,Wp=V,Cl=null);break;case"focusout":Cl=Wp=oa=null;break;case"mousedown":Kp=!0;break;case"contextmenu":case"mouseup":case"dragend":Kp=!1,my(ee,o,Y);break;case"selectionchange":if(vA)break;case"keydown":case"keyup":my(ee,o,Y)}var be;if(es)e:{switch(t){case"compositionstart":var Ce="onCompositionStart";break e;case"compositionend":Ce="onCompositionEnd";break e;case"compositionupdate":Ce="onCompositionUpdate";break e}Ce=void 0}else ze?W(t,o)&&(Ce="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Ce="onCompositionStart");Ce&&(v&&o.locale!=="ko"&&(ze||Ce!=="onCompositionStart"?Ce==="onCompositionEnd"&&ze&&(be=gl()):(Yr=Y,ii="value"in Yr?Yr.value:Yr.textContent,ze=!0)),Ne=td(V,Ce),0<Ne.length&&(Ce=new bl(Ce,t,null,o,Y),ee.push({event:Ce,listeners:Ne}),be?Ce.data=be:(be=oe(o),be!==null&&(Ce.data=be)))),(be=y?Ft(t,o):Fe(t,o))&&(Ce=td(V,"onBeforeInput"),0<Ce.length&&(Ne=new bl("onBeforeInput","beforeinput",null,o,Y),ee.push({event:Ne,listeners:Ce}),Ne.data=be)),eI(ee,t,V,o,Y)}Lb(ee,s)})}function Xl(t,s,o){return{instance:t,listener:s,currentTarget:o}}function td(t,s){for(var o=s+"Capture",l=[];t!==null;){var d=t,m=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||m===null||(d=so(t,o),d!=null&&l.unshift(Xl(t,d,m)),d=so(t,s),d!=null&&l.push(Xl(t,d,m))),t.tag===3)return l;t=t.return}return[]}function ka(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function jb(t,s,o,l,d){for(var m=s._reactName,w=[];o!==null&&o!==l;){var T=o,I=T.alternate,V=T.stateNode;if(T=T.tag,I!==null&&I===l)break;T!==5&&T!==26&&T!==27||V===null||(I=V,d?(V=so(o,m),V!=null&&w.unshift(Xl(o,V,I))):d||(V=so(o,m),V!=null&&w.push(Xl(o,V,I)))),o=o.return}w.length!==0&&t.push({event:s,listeners:w})}var sI=/\r\n?/g,iI=/\u0000|\uFFFD/g;function Bb(t){return(typeof t=="string"?t:""+t).replace(sI,`
`).replace(iI,"")}function zb(t,s){return s=Bb(s),Bb(t)===s}function nd(){}function st(t,s,o,l,d,m){switch(o){case"children":typeof l=="string"?s==="body"||s==="textarea"&&l===""||or(t,l):(typeof l=="number"||typeof l=="bigint")&&s!=="body"&&or(t,""+l);break;case"className":hn(t,"class",l);break;case"tabIndex":hn(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":hn(t,o,l);break;case"style":ml(t,l,m);break;case"data":if(s!=="object"){hn(t,"data",l);break}case"src":case"href":if(l===""&&(s!=="a"||o!=="href")){t.removeAttribute(o);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Qo(""+l),t.setAttribute(o,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(o==="formAction"?(s!=="input"&&st(t,s,"name",d.name,d,null),st(t,s,"formEncType",d.formEncType,d,null),st(t,s,"formMethod",d.formMethod,d,null),st(t,s,"formTarget",d.formTarget,d,null)):(st(t,s,"encType",d.encType,d,null),st(t,s,"method",d.method,d,null),st(t,s,"target",d.target,d,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Qo(""+l),t.setAttribute(o,l);break;case"onClick":l!=null&&(t.onclick=nd);break;case"onScroll":l!=null&&Me("scroll",t);break;case"onScrollEnd":l!=null&&Me("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(o=l.__html,o!=null){if(d.children!=null)throw Error(i(60));t.innerHTML=o}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}o=Qo(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""+l):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":l===!0?t.setAttribute(o,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,l):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(o,l):t.removeAttribute(o);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(o):t.setAttribute(o,l);break;case"popover":Me("beforetoggle",t),Me("toggle",t),Qt(t,"popover",l);break;case"xlinkActuate":xt(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":xt(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":xt(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":xt(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":xt(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":xt(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":xt(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":xt(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":xt(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Qt(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=Bp.get(o)||o,Qt(t,o,l))}}function yh(t,s,o,l,d,m){switch(o){case"style":ml(t,l,m);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(o=l.__html,o!=null){if(d.children!=null)throw Error(i(60));t.innerHTML=o}}break;case"children":typeof l=="string"?or(t,l):(typeof l=="number"||typeof l=="bigint")&&or(t,""+l);break;case"onScroll":l!=null&&Me("scroll",t);break;case"onScrollEnd":l!=null&&Me("scrollend",t);break;case"onClick":l!=null&&(t.onclick=nd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!N.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(d=o.endsWith("Capture"),s=o.slice(2,d?o.length-7:void 0),m=t[Et]||null,m=m!=null?m[o]:null,typeof m=="function"&&t.removeEventListener(s,m,d),typeof l=="function")){typeof m!="function"&&m!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(s,l,d);break e}o in t?t[o]=l:l===!0?t.setAttribute(o,""):Qt(t,o,l)}}}function cn(t,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Me("error",t),Me("load",t);var l=!1,d=!1,m;for(m in o)if(o.hasOwnProperty(m)){var w=o[m];if(w!=null)switch(m){case"src":l=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:st(t,s,m,w,o,null)}}d&&st(t,s,"srcSet",o.srcSet,o,null),l&&st(t,s,"src",o.src,o,null);return;case"input":Me("invalid",t);var T=m=w=d=null,I=null,V=null;for(l in o)if(o.hasOwnProperty(l)){var Y=o[l];if(Y!=null)switch(l){case"name":d=Y;break;case"type":w=Y;break;case"checked":I=Y;break;case"defaultChecked":V=Y;break;case"value":m=Y;break;case"defaultValue":T=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,s));break;default:st(t,s,l,Y,o,null)}}to(t,m,T,I,V,w,d,!1),Yo(t);return;case"select":Me("invalid",t),l=w=m=null;for(d in o)if(o.hasOwnProperty(d)&&(T=o[d],T!=null))switch(d){case"value":m=T;break;case"defaultValue":w=T;break;case"multiple":l=T;default:st(t,s,d,T,o,null)}s=m,o=w,t.multiple=!!l,s!=null?vs(t,!!l,s,!1):o!=null&&vs(t,!!l,o,!0);return;case"textarea":Me("invalid",t),m=d=l=null;for(w in o)if(o.hasOwnProperty(w)&&(T=o[w],T!=null))switch(w){case"value":l=T;break;case"defaultValue":d=T;break;case"children":m=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(i(91));break;default:st(t,s,w,T,o,null)}no(t,l,d,m),Yo(t);return;case"option":for(I in o)if(o.hasOwnProperty(I)&&(l=o[I],l!=null))switch(I){case"selected":t.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:st(t,s,I,l,o,null)}return;case"dialog":Me("beforetoggle",t),Me("toggle",t),Me("cancel",t),Me("close",t);break;case"iframe":case"object":Me("load",t);break;case"video":case"audio":for(l=0;l<Ql.length;l++)Me(Ql[l],t);break;case"image":Me("error",t),Me("load",t);break;case"details":Me("toggle",t);break;case"embed":case"source":case"link":Me("error",t),Me("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in o)if(o.hasOwnProperty(V)&&(l=o[V],l!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:st(t,s,V,l,o,null)}return;default:if(hl(s)){for(Y in o)o.hasOwnProperty(Y)&&(l=o[Y],l!==void 0&&yh(t,s,Y,l,o,void 0));return}}for(T in o)o.hasOwnProperty(T)&&(l=o[T],l!=null&&st(t,s,T,l,o,null))}function oI(t,s,o,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,m=null,w=null,T=null,I=null,V=null,Y=null;for(G in o){var ee=o[G];if(o.hasOwnProperty(G)&&ee!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":I=ee;default:l.hasOwnProperty(G)||st(t,s,G,null,l,ee)}}for(var H in l){var G=l[H];if(ee=o[H],l.hasOwnProperty(H)&&(G!=null||ee!=null))switch(H){case"type":m=G;break;case"name":d=G;break;case"checked":V=G;break;case"defaultChecked":Y=G;break;case"value":w=G;break;case"defaultValue":T=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,s));break;default:G!==ee&&st(t,s,H,G,l,ee)}}zn(t,w,T,I,V,Y,m,d);return;case"select":G=w=T=H=null;for(m in o)if(I=o[m],o.hasOwnProperty(m)&&I!=null)switch(m){case"value":break;case"multiple":G=I;default:l.hasOwnProperty(m)||st(t,s,m,null,l,I)}for(d in l)if(m=l[d],I=o[d],l.hasOwnProperty(d)&&(m!=null||I!=null))switch(d){case"value":H=m;break;case"defaultValue":T=m;break;case"multiple":w=m;default:m!==I&&st(t,s,d,m,l,I)}s=T,o=w,l=G,H!=null?vs(t,!!o,H,!1):!!l!=!!o&&(s!=null?vs(t,!!o,s,!0):vs(t,!!o,o?[]:"",!1));return;case"textarea":G=H=null;for(T in o)if(d=o[T],o.hasOwnProperty(T)&&d!=null&&!l.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:st(t,s,T,null,l,d)}for(w in l)if(d=l[w],m=o[w],l.hasOwnProperty(w)&&(d!=null||m!=null))switch(w){case"value":H=d;break;case"defaultValue":G=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(i(91));break;default:d!==m&&st(t,s,w,d,l,m)}nt(t,H,G);return;case"option":for(var Ie in o)if(H=o[Ie],o.hasOwnProperty(Ie)&&H!=null&&!l.hasOwnProperty(Ie))switch(Ie){case"selected":t.selected=!1;break;default:st(t,s,Ie,null,l,H)}for(I in l)if(H=l[I],G=o[I],l.hasOwnProperty(I)&&H!==G&&(H!=null||G!=null))switch(I){case"selected":t.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:st(t,s,I,H,l,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in o)H=o[Ee],o.hasOwnProperty(Ee)&&H!=null&&!l.hasOwnProperty(Ee)&&st(t,s,Ee,null,l,H);for(V in l)if(H=l[V],G=o[V],l.hasOwnProperty(V)&&H!==G&&(H!=null||G!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(i(137,s));break;default:st(t,s,V,H,l,G)}return;default:if(hl(s)){for(var it in o)H=o[it],o.hasOwnProperty(it)&&H!==void 0&&!l.hasOwnProperty(it)&&yh(t,s,it,void 0,l,H);for(Y in l)H=l[Y],G=o[Y],!l.hasOwnProperty(Y)||H===G||H===void 0&&G===void 0||yh(t,s,Y,H,l,G);return}}for(var L in o)H=o[L],o.hasOwnProperty(L)&&H!=null&&!l.hasOwnProperty(L)&&st(t,s,L,null,l,H);for(ee in l)H=l[ee],G=o[ee],!l.hasOwnProperty(ee)||H===G||H==null&&G==null||st(t,s,ee,H,l,G)}var vh=null,bh=null;function rd(t){return t.nodeType===9?t:t.ownerDocument}function Fb(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Vb(t,s){if(t===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&s==="foreignObject"?0:t}function wh(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Th=null;function aI(){var t=window.event;return t&&t.type==="popstate"?t===Th?!1:(Th=t,!0):(Th=null,!1)}var Hb=typeof setTimeout=="function"?setTimeout:void 0,lI=typeof clearTimeout=="function"?clearTimeout:void 0,Gb=typeof Promise=="function"?Promise:void 0,cI=typeof queueMicrotask=="function"?queueMicrotask:typeof Gb<"u"?function(t){return Gb.resolve(null).then(t).catch(uI)}:Hb;function uI(t){setTimeout(function(){throw t})}function Ti(t){return t==="head"}function $b(t,s){var o=s,l=0,d=0;do{var m=o.nextSibling;if(t.removeChild(o),m&&m.nodeType===8)if(o=m.data,o==="/$"){if(0<l&&8>l){o=l;var w=t.ownerDocument;if(o&1&&Zl(w.documentElement),o&2&&Zl(w.body),o&4)for(o=w.head,Zl(o),w=o.firstChild;w;){var T=w.nextSibling,I=w.nodeName;w[Kr]||I==="SCRIPT"||I==="STYLE"||I==="LINK"&&w.rel.toLowerCase()==="stylesheet"||o.removeChild(w),w=T}}if(d===0){t.removeChild(m),ac(s);return}d--}else o==="$"||o==="$?"||o==="$!"?d++:l=o.charCodeAt(0)-48;else l=0;o=m}while(o);ac(s)}function Sh(t){var s=t.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Sh(o),Jt(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function dI(t,s,o,l){for(;t.nodeType===1;){var d=o;if(t.nodeName.toLowerCase()!==s.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[Kr])switch(s){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(m=t.getAttribute("rel"),m==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(m!==d.rel||t.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(m=t.getAttribute("src"),(m!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&m&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(s==="input"&&t.type==="hidden"){var m=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===m)return t}else return t;if(t=Pr(t.nextSibling),t===null)break}return null}function pI(t,s,o){if(s==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=Pr(t.nextSibling),t===null))return null;return t}function Eh(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function mI(t,s){var o=t.ownerDocument;if(t.data!=="$?"||o.readyState==="complete")s();else{var l=function(){s(),o.removeEventListener("DOMContentLoaded",l)};o.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function Pr(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return t}var Ch=null;function Wb(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(s===0)return t;s--}else o==="/$"&&s++}t=t.previousSibling}return null}function Kb(t,s,o){switch(s=rd(o),t){case"html":if(t=s.documentElement,!t)throw Error(i(452));return t;case"head":if(t=s.head,!t)throw Error(i(453));return t;case"body":if(t=s.body,!t)throw Error(i(454));return t;default:throw Error(i(451))}}function Zl(t){for(var s=t.attributes;s.length;)t.removeAttributeNode(s[0]);Jt(t)}var gr=new Map,Jb=new Set;function sd(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ls=le.d;le.d={f:hI,r:fI,D:gI,C:yI,L:vI,m:bI,X:TI,S:wI,M:SI};function hI(){var t=Ls.f(),s=Ju();return t||s}function fI(t){var s=jn(t);s!==null&&s.tag===5&&s.type==="form"?fv(s):Ls.r(t)}var Da=typeof document>"u"?null:document;function Yb(t,s,o){var l=Da;if(l&&typeof s=="string"&&s){var d=Nt(s);d='link[rel="'+t+'"][href="'+d+'"]',typeof o=="string"&&(d+='[crossorigin="'+o+'"]'),Jb.has(d)||(Jb.add(d),t={rel:t,crossOrigin:o,href:s},l.querySelector(d)===null&&(s=l.createElement("link"),cn(s,"link",t),vt(s),l.head.appendChild(s)))}}function gI(t){Ls.D(t),Yb("dns-prefetch",t,null)}function yI(t,s){Ls.C(t,s),Yb("preconnect",t,s)}function vI(t,s,o){Ls.L(t,s,o);var l=Da;if(l&&t&&s){var d='link[rel="preload"][as="'+Nt(s)+'"]';s==="image"&&o&&o.imageSrcSet?(d+='[imagesrcset="'+Nt(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(d+='[imagesizes="'+Nt(o.imageSizes)+'"]')):d+='[href="'+Nt(t)+'"]';var m=d;switch(s){case"style":m=Pa(t);break;case"script":m=Na(t)}gr.has(m)||(t=b({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:t,as:s},o),gr.set(m,t),l.querySelector(d)!==null||s==="style"&&l.querySelector(ec(m))||s==="script"&&l.querySelector(tc(m))||(s=l.createElement("link"),cn(s,"link",t),vt(s),l.head.appendChild(s)))}}function bI(t,s){Ls.m(t,s);var o=Da;if(o&&t){var l=s&&typeof s.as=="string"?s.as:"script",d='link[rel="modulepreload"][as="'+Nt(l)+'"][href="'+Nt(t)+'"]',m=d;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Na(t)}if(!gr.has(m)&&(t=b({rel:"modulepreload",href:t},s),gr.set(m,t),o.querySelector(d)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(tc(m)))return}l=o.createElement("link"),cn(l,"link",t),vt(l),o.head.appendChild(l)}}}function wI(t,s,o){Ls.S(t,s,o);var l=Da;if(l&&t){var d=Yt(l).hoistableStyles,m=Pa(t);s=s||"default";var w=d.get(m);if(!w){var T={loading:0,preload:null};if(w=l.querySelector(ec(m)))T.loading=5;else{t=b({rel:"stylesheet",href:t,"data-precedence":s},o),(o=gr.get(m))&&_h(t,o);var I=w=l.createElement("link");vt(I),cn(I,"link",t),I._p=new Promise(function(V,Y){I.onload=V,I.onerror=Y}),I.addEventListener("load",function(){T.loading|=1}),I.addEventListener("error",function(){T.loading|=2}),T.loading|=4,id(w,s,l)}w={type:"stylesheet",instance:w,count:1,state:T},d.set(m,w)}}}function TI(t,s){Ls.X(t,s);var o=Da;if(o&&t){var l=Yt(o).hoistableScripts,d=Na(t),m=l.get(d);m||(m=o.querySelector(tc(d)),m||(t=b({src:t,async:!0},s),(s=gr.get(d))&&Ah(t,s),m=o.createElement("script"),vt(m),cn(m,"link",t),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},l.set(d,m))}}function SI(t,s){Ls.M(t,s);var o=Da;if(o&&t){var l=Yt(o).hoistableScripts,d=Na(t),m=l.get(d);m||(m=o.querySelector(tc(d)),m||(t=b({src:t,async:!0,type:"module"},s),(s=gr.get(d))&&Ah(t,s),m=o.createElement("script"),vt(m),cn(m,"link",t),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},l.set(d,m))}}function Qb(t,s,o,l){var d=(d=Se.current)?sd(d):null;if(!d)throw Error(i(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=Pa(o.href),o=Yt(d).hoistableStyles,l=o.get(s),l||(l={type:"style",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=Pa(o.href);var m=Yt(d).hoistableStyles,w=m.get(t);if(w||(d=d.ownerDocument||d,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(t,w),(m=d.querySelector(ec(t)))&&!m._p&&(w.instance=m,w.state.loading=5),gr.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},gr.set(t,o),m||EI(d,t,o,w.state))),s&&l===null)throw Error(i(528,""));return w}if(s&&l!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Na(o),o=Yt(d).hoistableScripts,l=o.get(s),l||(l={type:"script",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,t))}}function Pa(t){return'href="'+Nt(t)+'"'}function ec(t){return'link[rel="stylesheet"]['+t+"]"}function Xb(t){return b({},t,{"data-precedence":t.precedence,precedence:null})}function EI(t,s,o,l){t.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=t.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),cn(s,"link",o),vt(s),t.head.appendChild(s))}function Na(t){return'[src="'+Nt(t)+'"]'}function tc(t){return"script[async]"+t}function Zb(t,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var l=t.querySelector('style[data-href~="'+Nt(o.href)+'"]');if(l)return s.instance=l,vt(l),l;var d=b({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),vt(l),cn(l,"style",d),id(l,o.precedence,t),s.instance=l;case"stylesheet":d=Pa(o.href);var m=t.querySelector(ec(d));if(m)return s.state.loading|=4,s.instance=m,vt(m),m;l=Xb(o),(d=gr.get(d))&&_h(l,d),m=(t.ownerDocument||t).createElement("link"),vt(m);var w=m;return w._p=new Promise(function(T,I){w.onload=T,w.onerror=I}),cn(m,"link",l),s.state.loading|=4,id(m,o.precedence,t),s.instance=m;case"script":return m=Na(o.src),(d=t.querySelector(tc(m)))?(s.instance=d,vt(d),d):(l=o,(d=gr.get(m))&&(l=b({},o),Ah(l,d)),t=t.ownerDocument||t,d=t.createElement("script"),vt(d),cn(d,"link",l),t.head.appendChild(d),s.instance=d);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(l=s.instance,s.state.loading|=4,id(l,o.precedence,t));return s.instance}function id(t,s,o){for(var l=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=l.length?l[l.length-1]:null,m=d,w=0;w<l.length;w++){var T=l[w];if(T.dataset.precedence===s)m=T;else if(m!==d)break}m?m.parentNode.insertBefore(t,m.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(t,s.firstChild))}function _h(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.title==null&&(t.title=s.title)}function Ah(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.integrity==null&&(t.integrity=s.integrity)}var od=null;function ew(t,s,o){if(od===null){var l=new Map,d=od=new Map;d.set(o,l)}else d=od,l=d.get(o),l||(l=new Map,d.set(o,l));if(l.has(t))return l;for(l.set(t,null),o=o.getElementsByTagName(t),d=0;d<o.length;d++){var m=o[d];if(!(m[Kr]||m[St]||t==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var w=m.getAttribute(s)||"";w=t+w;var T=l.get(w);T?T.push(m):l.set(w,[m])}}return l}function tw(t,s,o){t=t.ownerDocument||t,t.head.insertBefore(o,s==="title"?t.querySelector("head > title"):null)}function CI(t,s,o){if(o===1||s.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return t=s.disabled,typeof s.precedence=="string"&&t==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function nw(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var nc=null;function _I(){}function AI(t,s,o){if(nc===null)throw Error(i(475));var l=nc;if(s.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var d=Pa(o.href),m=t.querySelector(ec(d));if(m){t=m._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(l.count++,l=ad.bind(l),t.then(l,l)),s.state.loading|=4,s.instance=m,vt(m);return}m=t.ownerDocument||t,o=Xb(o),(d=gr.get(d))&&_h(o,d),m=m.createElement("link"),vt(m);var w=m;w._p=new Promise(function(T,I){w.onload=T,w.onerror=I}),cn(m,"link",o),s.instance=m}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(s,t),(t=s.state.preload)&&(s.state.loading&3)===0&&(l.count++,s=ad.bind(l),t.addEventListener("load",s),t.addEventListener("error",s))}}function II(){if(nc===null)throw Error(i(475));var t=nc;return t.stylesheets&&t.count===0&&Ih(t,t.stylesheets),0<t.count?function(s){var o=setTimeout(function(){if(t.stylesheets&&Ih(t,t.stylesheets),t.unsuspend){var l=t.unsuspend;t.unsuspend=null,l()}},6e4);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(o)}}:null}function ad(){if(this.count--,this.count===0){if(this.stylesheets)Ih(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var ld=null;function Ih(t,s){t.stylesheets=null,t.unsuspend!==null&&(t.count++,ld=new Map,s.forEach(xI,t),ld=null,ad.call(t))}function xI(t,s){if(!(s.state.loading&4)){var o=ld.get(t);if(o)var l=o.get(null);else{o=new Map,ld.set(t,o);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<d.length;m++){var w=d[m];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(o.set(w.dataset.precedence,w),l=w)}l&&o.set(null,l)}d=s.instance,w=d.getAttribute("data-precedence"),m=o.get(w)||l,m===l&&o.set(null,d),o.set(w,d),this.count++,l=ad.bind(this),d.addEventListener("load",l),d.addEventListener("error",l),m?m.parentNode.insertBefore(d,m.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),s.state.loading|=4}}var rc={$$typeof:ae,Provider:null,Consumer:null,_currentValue:ye,_currentValue2:ye,_threadCount:0};function RI(t,s,o,l,d,m,w,T){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ar(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ar(0),this.hiddenUpdates=Ar(null),this.identifierPrefix=l,this.onUncaughtError=d,this.onCaughtError=m,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=T,this.incompleteTransitions=new Map}function rw(t,s,o,l,d,m,w,T,I,V,Y,ee){return t=new RI(t,s,o,w,T,I,V,ee),s=1,m===!0&&(s|=24),m=Vn(3,null,null,s),t.current=m,m.stateNode=t,s=lm(),s.refCount++,t.pooledCache=s,s.refCount++,m.memoizedState={element:l,isDehydrated:o,cache:s},pm(m),t}function sw(t){return t?(t=ua,t):ua}function iw(t,s,o,l,d,m){d=sw(d),l.context===null?l.context=d:l.pendingContext=d,l=li(s),l.payload={element:o},m=m===void 0?null:m,m!==null&&(l.callback=m),o=ci(t,l,s),o!==null&&(Kn(o,t,s),Nl(o,t,s))}function ow(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<s?o:s}}function xh(t,s){ow(t,s),(t=t.alternate)&&ow(t,s)}function aw(t){if(t.tag===13){var s=ca(t,67108864);s!==null&&Kn(s,t,67108864),xh(t,67108864)}}var cd=!0;function kI(t,s,o,l){var d=K.T;K.T=null;var m=le.p;try{le.p=2,Rh(t,s,o,l)}finally{le.p=m,K.T=d}}function DI(t,s,o,l){var d=K.T;K.T=null;var m=le.p;try{le.p=8,Rh(t,s,o,l)}finally{le.p=m,K.T=d}}function Rh(t,s,o,l){if(cd){var d=kh(l);if(d===null)gh(t,s,l,ud,o),cw(t,l);else if(NI(d,t,s,o,l))l.stopPropagation();else if(cw(t,l),s&4&&-1<PI.indexOf(t)){for(;d!==null;){var m=jn(d);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var w=Kt(m.pendingLanes);if(w!==0){var T=m;for(T.pendingLanes|=2,T.entangledLanes|=2;w;){var I=1<<31-Bt(w);T.entanglements[1]|=I,w&=~I}os(m),(et&6)===0&&(Wu=jt()+500,Yl(0))}}break;case 13:T=ca(m,2),T!==null&&Kn(T,m,2),Ju(),xh(m,2)}if(m=kh(l),m===null&&gh(t,s,l,ud,o),m===d)break;d=m}d!==null&&l.stopPropagation()}else gh(t,s,l,null,o)}}function kh(t){return t=ar(t),Dh(t)}var ud=null;function Dh(t){if(ud=null,t=sr(t),t!==null){var s=c(t);if(s===null)t=null;else{var o=s.tag;if(o===13){if(t=p(s),t!==null)return t;t=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null)}}return ud=t,null}function lw(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zs()){case Fr:return 2;case ys:return 8;case Vr:case cl:return 32;case Hr:return 268435456;default:return 32}default:return 32}}var Ph=!1,Si=null,Ei=null,Ci=null,sc=new Map,ic=new Map,_i=[],PI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cw(t,s){switch(t){case"focusin":case"focusout":Si=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":Ci=null;break;case"pointerover":case"pointerout":sc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":ic.delete(s.pointerId)}}function oc(t,s,o,l,d,m){return t===null||t.nativeEvent!==m?(t={blockedOn:s,domEventName:o,eventSystemFlags:l,nativeEvent:m,targetContainers:[d]},s!==null&&(s=jn(s),s!==null&&aw(s)),t):(t.eventSystemFlags|=l,s=t.targetContainers,d!==null&&s.indexOf(d)===-1&&s.push(d),t)}function NI(t,s,o,l,d){switch(s){case"focusin":return Si=oc(Si,t,s,o,l,d),!0;case"dragenter":return Ei=oc(Ei,t,s,o,l,d),!0;case"mouseover":return Ci=oc(Ci,t,s,o,l,d),!0;case"pointerover":var m=d.pointerId;return sc.set(m,oc(sc.get(m)||null,t,s,o,l,d)),!0;case"gotpointercapture":return m=d.pointerId,ic.set(m,oc(ic.get(m)||null,t,s,o,l,d)),!0}return!1}function uw(t){var s=sr(t.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=p(o),s!==null){t.blockedOn=s,ni(t.priority,function(){if(o.tag===13){var l=Wn();l=En(l);var d=ca(o,l);d!==null&&Kn(d,o,l),xh(o,l)}});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function dd(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var o=kh(t.nativeEvent);if(o===null){o=t.nativeEvent;var l=new o.constructor(o.type,o);bs=l,o.target.dispatchEvent(l),bs=null}else return s=jn(o),s!==null&&aw(s),t.blockedOn=o,!1;s.shift()}return!0}function dw(t,s,o){dd(t)&&o.delete(s)}function OI(){Ph=!1,Si!==null&&dd(Si)&&(Si=null),Ei!==null&&dd(Ei)&&(Ei=null),Ci!==null&&dd(Ci)&&(Ci=null),sc.forEach(dw),ic.forEach(dw)}function pd(t,s){t.blockedOn===s&&(t.blockedOn=null,Ph||(Ph=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,OI)))}var md=null;function pw(t){md!==t&&(md=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){md===t&&(md=null);for(var s=0;s<t.length;s+=3){var o=t[s],l=t[s+1],d=t[s+2];if(typeof l!="function"){if(Dh(l||o)===null)continue;break}var m=jn(o);m!==null&&(t.splice(s,3),s-=3,Dm(m,{pending:!0,data:d,method:o.method,action:l},l,d))}}))}function ac(t){function s(I){return pd(I,t)}Si!==null&&pd(Si,t),Ei!==null&&pd(Ei,t),Ci!==null&&pd(Ci,t),sc.forEach(s),ic.forEach(s);for(var o=0;o<_i.length;o++){var l=_i[o];l.blockedOn===t&&(l.blockedOn=null)}for(;0<_i.length&&(o=_i[0],o.blockedOn===null);)uw(o),o.blockedOn===null&&_i.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(l=0;l<o.length;l+=3){var d=o[l],m=o[l+1],w=d[Et]||null;if(typeof m=="function")w||pw(o);else if(w){var T=null;if(m&&m.hasAttribute("formAction")){if(d=m,w=m[Et]||null)T=w.formAction;else if(Dh(d)!==null)continue}else T=w.action;typeof T=="function"?o[l+1]=T:(o.splice(l,3),l-=3),pw(o)}}}function Nh(t){this._internalRoot=t}hd.prototype.render=Nh.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,l=Wn();iw(o,l,t,s,null,null)},hd.prototype.unmount=Nh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;iw(t.current,2,null,t,null,null),Ju(),s[yt]=null}};function hd(t){this._internalRoot=t}hd.prototype.unstable_scheduleHydration=function(t){if(t){var s=Ir();t={blockedOn:null,target:t,priority:s};for(var o=0;o<_i.length&&s!==0&&s<_i[o].priority;o++);_i.splice(o,0,t),o===0&&uw(t)}};var mw=e.version;if(mw!=="19.1.1")throw Error(i(527,mw,"19.1.1"));le.findDOMNode=function(t){var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(i(188)):(t=Object.keys(t).join(","),Error(i(268,t)));return t=f(s),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var UI={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fd.isDisabled&&fd.supportsFiber)try{Xe=fd.inject(UI),$e=fd}catch{}}return cc.createRoot=function(t,s){if(!a(t))throw Error(i(299));var o=!1,l="",d=Rv,m=kv,w=Dv,T=null;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(l=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(m=s.onCaughtError),s.onRecoverableError!==void 0&&(w=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(T=s.unstable_transitionCallbacks)),s=rw(t,1,!1,null,null,o,l,d,m,w,T,null),t[yt]=s.current,fh(t),new Nh(s)},cc.hydrateRoot=function(t,s,o){if(!a(t))throw Error(i(299));var l=!1,d="",m=Rv,w=kv,T=Dv,I=null,V=null;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(m=o.onUncaughtError),o.onCaughtError!==void 0&&(w=o.onCaughtError),o.onRecoverableError!==void 0&&(T=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(I=o.unstable_transitionCallbacks),o.formState!==void 0&&(V=o.formState)),s=rw(t,1,!0,s,o??null,l,d,m,w,T,I,V),s.context=sw(null),o=s.current,l=Wn(),l=En(l),d=li(l),d.callback=null,ci(o,d,l),o=l,s.current.lanes=o,Sn(s,o),os(s),t[yt]=s.current,fh(t),new hd(s)},cc.version="19.1.1",cc}var Ew;function $I(){if(Ew)return Mh.exports;Ew=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Mh.exports=GI(),Mh.exports}var WI=$I();const KI=Hf(WI);/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Cw="popstate";function JI(r={}){function e(i,a){let{pathname:c,search:p,hash:h}=i.location;return pf("",{pathname:c,search:p,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(i,a){return typeof a=="string"?a:Rc(a)}return QI(e,n,null,r)}function gt(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Mr(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function YI(){return Math.random().toString(36).substring(2,10)}function _w(r,e){return{usr:r.state,key:r.key,idx:e}}function pf(r,e,n=null,i){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?Qa(e):e,state:n,key:e&&e.key||i||YI()}}function Rc({pathname:r="/",search:e="",hash:n=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(r+=n.charAt(0)==="#"?n:"#"+n),r}function Qa(r){let e={};if(r){let n=r.indexOf("#");n>=0&&(e.hash=r.substring(n),r=r.substring(0,n));let i=r.indexOf("?");i>=0&&(e.search=r.substring(i),r=r.substring(0,i)),r&&(e.pathname=r)}return e}function QI(r,e,n,i={}){let{window:a=document.defaultView,v5Compat:c=!1}=i,p=a.history,h="POP",f=null,g=b();g==null&&(g=0,p.replaceState({...p.state,idx:g},""));function b(){return(p.state||{idx:null}).idx}function E(){h="POP";let $=b(),ie=$==null?null:$-g;g=$,f&&f({action:h,location:Q.location,delta:ie})}function C($,ie){h="PUSH";let re=pf(Q.location,$,ie);g=b()+1;let ae=_w(re,g),ve=Q.createHref(re);try{p.pushState(ae,"",ve)}catch(he){if(he instanceof DOMException&&he.name==="DataCloneError")throw he;a.location.assign(ve)}c&&f&&f({action:h,location:Q.location,delta:1})}function M($,ie){h="REPLACE";let re=pf(Q.location,$,ie);g=b();let ae=_w(re,g),ve=Q.createHref(re);p.replaceState(ae,"",ve),c&&f&&f({action:h,location:Q.location,delta:0})}function z($){return XI($)}let Q={get action(){return h},get location(){return r(a,p)},listen($){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(Cw,E),f=$,()=>{a.removeEventListener(Cw,E),f=null}},createHref($){return e(a,$)},createURL:z,encodeLocation($){let ie=z($);return{pathname:ie.pathname,search:ie.search,hash:ie.hash}},push:C,replace:M,go($){return p.go($)}};return Q}function XI(r,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),gt(n,"No window.location.(origin|href) available to create URL");let i=typeof r=="string"?r:Rc(r);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function RS(r,e,n="/"){return ZI(r,e,n,!1)}function ZI(r,e,n,i){let a=typeof e=="string"?Qa(e):e,c=$s(a.pathname||"/",n);if(c==null)return null;let p=kS(r);e0(p);let h=null;for(let f=0;h==null&&f<p.length;++f){let g=d0(c);h=c0(p[f],g,i)}return h}function kS(r,e=[],n=[],i="",a=!1){let c=(p,h,f=a,g)=>{let b={relativePath:g===void 0?p.path||"":g,caseSensitive:p.caseSensitive===!0,childrenIndex:h,route:p};if(b.relativePath.startsWith("/")){if(!b.relativePath.startsWith(i)&&f)return;gt(b.relativePath.startsWith(i),`Absolute route path "${b.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),b.relativePath=b.relativePath.slice(i.length)}let E=Vs([i,b.relativePath]),C=n.concat(b);p.children&&p.children.length>0&&(gt(p.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${E}".`),kS(p.children,e,C,E,f)),!(p.path==null&&!p.index)&&e.push({path:E,score:a0(E,p.index),routesMeta:C})};return r.forEach((p,h)=>{if(p.path===""||!p.path?.includes("?"))c(p,h);else for(let f of DS(p.path))c(p,h,!0,f)}),e}function DS(r){let e=r.split("/");if(e.length===0)return[];let[n,...i]=e,a=n.endsWith("?"),c=n.replace(/\?$/,"");if(i.length===0)return a?[c,""]:[c];let p=DS(i.join("/")),h=[];return h.push(...p.map(f=>f===""?c:[c,f].join("/"))),a&&h.push(...p),h.map(f=>r.startsWith("/")&&f===""?"/":f)}function e0(r){r.sort((e,n)=>e.score!==n.score?n.score-e.score:l0(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var t0=/^:[\w-]+$/,n0=3,r0=2,s0=1,i0=10,o0=-2,Aw=r=>r==="*";function a0(r,e){let n=r.split("/"),i=n.length;return n.some(Aw)&&(i+=o0),e&&(i+=r0),n.filter(a=>!Aw(a)).reduce((a,c)=>a+(t0.test(c)?n0:c===""?s0:i0),i)}function l0(r,e){return r.length===e.length&&r.slice(0,-1).every((i,a)=>i===e[a])?r[r.length-1]-e[e.length-1]:0}function c0(r,e,n=!1){let{routesMeta:i}=r,a={},c="/",p=[];for(let h=0;h<i.length;++h){let f=i[h],g=h===i.length-1,b=c==="/"?e:e.slice(c.length)||"/",E=qd({path:f.relativePath,caseSensitive:f.caseSensitive,end:g},b),C=f.route;if(!E&&g&&n&&!i[i.length-1].route.index&&(E=qd({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},b)),!E)return null;Object.assign(a,E.params),p.push({params:a,pathname:Vs([c,E.pathname]),pathnameBase:f0(Vs([c,E.pathnameBase])),route:C}),E.pathnameBase!=="/"&&(c=Vs([c,E.pathnameBase]))}return p}function qd(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[n,i]=u0(r.path,r.caseSensitive,r.end),a=e.match(n);if(!a)return null;let c=a[0],p=c.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:i.reduce((g,{paramName:b,isOptional:E},C)=>{if(b==="*"){let z=h[C]||"";p=c.slice(0,c.length-z.length).replace(/(.)\/+$/,"$1")}const M=h[C];return E&&!M?g[b]=void 0:g[b]=(M||"").replace(/%2F/g,"/"),g},{}),pathname:c,pathnameBase:p,pattern:r}}function u0(r,e=!1,n=!0){Mr(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let i=[],a="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(p,h,f)=>(i.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return r.endsWith("*")?(i.push({paramName:"*"}),a+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":r!==""&&r!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function d0(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mr(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function $s(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=r.charAt(n);return i&&i!=="/"?null:r.slice(n)||"/"}function p0(r,e="/"){let{pathname:n,search:i="",hash:a=""}=typeof r=="string"?Qa(r):r;return{pathname:n?n.startsWith("/")?n:m0(n,e):e,search:g0(i),hash:y0(a)}}function m0(r,e){let n=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Bh(r,e,n,i){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function h0(r){return r.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function $f(r){let e=h0(r);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function Wf(r,e,n,i=!1){let a;typeof r=="string"?a=Qa(r):(a={...r},gt(!a.pathname||!a.pathname.includes("?"),Bh("?","pathname","search",a)),gt(!a.pathname||!a.pathname.includes("#"),Bh("#","pathname","hash",a)),gt(!a.search||!a.search.includes("#"),Bh("#","search","hash",a)));let c=r===""||a.pathname==="",p=c?"/":a.pathname,h;if(p==null)h=n;else{let E=e.length-1;if(!i&&p.startsWith("..")){let C=p.split("/");for(;C[0]==="..";)C.shift(),E-=1;a.pathname=C.join("/")}h=E>=0?e[E]:"/"}let f=p0(a,h),g=p&&p!=="/"&&p.endsWith("/"),b=(c||p===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(g||b)&&(f.pathname+="/"),f}var Vs=r=>r.join("/").replace(/\/\/+/g,"/"),f0=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),g0=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,y0=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function v0(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var PS=["POST","PUT","PATCH","DELETE"];new Set(PS);var b0=["GET",...PS];new Set(b0);var Xa=F.createContext(null);Xa.displayName="DataRouter";var op=F.createContext(null);op.displayName="DataRouterState";F.createContext(!1);var NS=F.createContext({isTransitioning:!1});NS.displayName="ViewTransition";var w0=F.createContext(new Map);w0.displayName="Fetchers";var T0=F.createContext(null);T0.displayName="Await";var Br=F.createContext(null);Br.displayName="Navigation";var Bc=F.createContext(null);Bc.displayName="Location";var fs=F.createContext({outlet:null,matches:[],isDataRoute:!1});fs.displayName="Route";var Kf=F.createContext(null);Kf.displayName="RouteError";function S0(r,{relative:e}={}){gt(Za(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=F.useContext(Br),{hash:a,pathname:c,search:p}=zc(r,{relative:e}),h=c;return n!=="/"&&(h=c==="/"?n:Vs([n,c])),i.createHref({pathname:h,search:p,hash:a})}function Za(){return F.useContext(Bc)!=null}function Fi(){return gt(Za(),"useLocation() may be used only in the context of a <Router> component."),F.useContext(Bc).location}var OS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function US(r){F.useContext(Br).static||F.useLayoutEffect(r)}function MS(){let{isDataRoute:r}=F.useContext(fs);return r?U0():E0()}function E0(){gt(Za(),"useNavigate() may be used only in the context of a <Router> component.");let r=F.useContext(Xa),{basename:e,navigator:n}=F.useContext(Br),{matches:i}=F.useContext(fs),{pathname:a}=Fi(),c=JSON.stringify($f(i)),p=F.useRef(!1);return US(()=>{p.current=!0}),F.useCallback((f,g={})=>{if(Mr(p.current,OS),!p.current)return;if(typeof f=="number"){n.go(f);return}let b=Wf(f,JSON.parse(c),a,g.relative==="path");r==null&&e!=="/"&&(b.pathname=b.pathname==="/"?e:Vs([e,b.pathname])),(g.replace?n.replace:n.push)(b,g.state,g)},[e,n,c,a,r])}F.createContext(null);function zc(r,{relative:e}={}){let{matches:n}=F.useContext(fs),{pathname:i}=Fi(),a=JSON.stringify($f(n));return F.useMemo(()=>Wf(r,JSON.parse(a),i,e==="path"),[r,a,i,e])}function C0(r,e){return LS(r,e)}function LS(r,e,n,i,a){gt(Za(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=F.useContext(Br),{matches:p}=F.useContext(fs),h=p[p.length-1],f=h?h.params:{},g=h?h.pathname:"/",b=h?h.pathnameBase:"/",E=h&&h.route;{let re=E&&E.path||"";qS(g,!E||re.endsWith("*")||re.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${g}" (under <Route path="${re}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${re}"> to <Route path="${re==="/"?"*":`${re}/*`}">.`)}let C=Fi(),M;if(e){let re=typeof e=="string"?Qa(e):e;gt(b==="/"||re.pathname?.startsWith(b),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${b}" but pathname "${re.pathname}" was given in the \`location\` prop.`),M=re}else M=C;let z=M.pathname||"/",Q=z;if(b!=="/"){let re=b.replace(/^\//,"").split("/");Q="/"+z.replace(/^\//,"").split("/").slice(re.length).join("/")}let $=RS(r,{pathname:Q});Mr(E||$!=null,`No routes matched location "${M.pathname}${M.search}${M.hash}" `),Mr($==null||$[$.length-1].route.element!==void 0||$[$.length-1].route.Component!==void 0||$[$.length-1].route.lazy!==void 0,`Matched leaf route at location "${M.pathname}${M.search}${M.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ie=R0($&&$.map(re=>Object.assign({},re,{params:Object.assign({},f,re.params),pathname:Vs([b,c.encodeLocation?c.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?b:Vs([b,c.encodeLocation?c.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),p,n,i,a);return e&&ie?F.createElement(Bc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...M},navigationType:"POP"}},ie):ie}function _0(){let r=O0(),e=v0(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),n=r instanceof Error?r.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},p=null;return console.error("Error handled by React Router default ErrorBoundary:",r),p=F.createElement(F.Fragment,null,F.createElement("p",null,"💿 Hey developer 👋"),F.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",F.createElement("code",{style:c},"ErrorBoundary")," or"," ",F.createElement("code",{style:c},"errorElement")," prop on your route.")),F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},e),n?F.createElement("pre",{style:a},n):null,p)}var A0=F.createElement(_0,null),I0=class extends F.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){this.props.unstable_onError?this.props.unstable_onError(r,e):console.error("React Router caught the following error during render",r)}render(){return this.state.error!==void 0?F.createElement(fs.Provider,{value:this.props.routeContext},F.createElement(Kf.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function x0({routeContext:r,match:e,children:n}){let i=F.useContext(Xa);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),F.createElement(fs.Provider,{value:r},n)}function R0(r,e=[],n=null,i=null,a=null){if(r==null){if(!n)return null;if(n.errors)r=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)r=n.matches;else return null}let c=r,p=n?.errors;if(p!=null){let g=c.findIndex(b=>b.route.id&&p?.[b.route.id]!==void 0);gt(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(p).join(",")}`),c=c.slice(0,Math.min(c.length,g+1))}let h=!1,f=-1;if(n)for(let g=0;g<c.length;g++){let b=c[g];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(f=g),b.route.id){let{loaderData:E,errors:C}=n,M=b.route.loader&&!E.hasOwnProperty(b.route.id)&&(!C||C[b.route.id]===void 0);if(b.route.lazy||M){h=!0,f>=0?c=c.slice(0,f+1):c=[c[0]];break}}}return c.reduceRight((g,b,E)=>{let C,M=!1,z=null,Q=null;n&&(C=p&&b.route.id?p[b.route.id]:void 0,z=b.route.errorElement||A0,h&&(f<0&&E===0?(qS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),M=!0,Q=null):f===E&&(M=!0,Q=b.route.hydrateFallbackElement||null)));let $=e.concat(c.slice(0,E+1)),ie=()=>{let re;return C?re=z:M?re=Q:b.route.Component?re=F.createElement(b.route.Component,null):b.route.element?re=b.route.element:re=g,F.createElement(x0,{match:b,routeContext:{outlet:g,matches:$,isDataRoute:n!=null},children:re})};return n&&(b.route.ErrorBoundary||b.route.errorElement||E===0)?F.createElement(I0,{location:n.location,revalidation:n.revalidation,component:z,error:C,children:ie(),routeContext:{outlet:null,matches:$,isDataRoute:!0},unstable_onError:i}):ie()},null)}function Jf(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function k0(r){let e=F.useContext(Xa);return gt(e,Jf(r)),e}function D0(r){let e=F.useContext(op);return gt(e,Jf(r)),e}function P0(r){let e=F.useContext(fs);return gt(e,Jf(r)),e}function Yf(r){let e=P0(r),n=e.matches[e.matches.length-1];return gt(n.route.id,`${r} can only be used on routes that contain a unique "id"`),n.route.id}function N0(){return Yf("useRouteId")}function O0(){let r=F.useContext(Kf),e=D0("useRouteError"),n=Yf("useRouteError");return r!==void 0?r:e.errors?.[n]}function U0(){let{router:r}=k0("useNavigate"),e=Yf("useNavigate"),n=F.useRef(!1);return US(()=>{n.current=!0}),F.useCallback(async(a,c={})=>{Mr(n.current,OS),n.current&&(typeof a=="number"?r.navigate(a):await r.navigate(a,{fromRouteId:e,...c}))},[r,e])}var Iw={};function qS(r,e,n){!e&&!Iw[r]&&(Iw[r]=!0,Mr(!1,n))}F.memo(M0);function M0({routes:r,future:e,state:n,unstable_onError:i}){return LS(r,void 0,n,i,e)}function Oa({to:r,replace:e,state:n,relative:i}){gt(Za(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=F.useContext(Br);Mr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=F.useContext(fs),{pathname:p}=Fi(),h=MS(),f=Wf(r,$f(c),p,i==="path"),g=JSON.stringify(f);return F.useEffect(()=>{h(JSON.parse(g),{replace:e,state:n,relative:i})},[h,g,i,e,n]),null}function Io(r){gt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function L0({basename:r="/",children:e=null,location:n,navigationType:i="POP",navigator:a,static:c=!1}){gt(!Za(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let p=r.replace(/^\/*/,"/"),h=F.useMemo(()=>({basename:p,navigator:a,static:c,future:{}}),[p,a,c]);typeof n=="string"&&(n=Qa(n));let{pathname:f="/",search:g="",hash:b="",state:E=null,key:C="default"}=n,M=F.useMemo(()=>{let z=$s(f,p);return z==null?null:{location:{pathname:z,search:g,hash:b,state:E,key:C},navigationType:i}},[p,f,g,b,E,C,i]);return Mr(M!=null,`<Router basename="${p}"> is not able to match the URL "${f}${g}${b}" because it does not start with the basename, so the <Router> won't render anything.`),M==null?null:F.createElement(Br.Provider,{value:h},F.createElement(Bc.Provider,{children:e,value:M}))}function q0({children:r,location:e}){return C0(mf(r),e)}function mf(r,e=[]){let n=[];return F.Children.forEach(r,(i,a)=>{if(!F.isValidElement(i))return;let c=[...e,a];if(i.type===F.Fragment){n.push.apply(n,mf(i.props.children,c));return}gt(i.type===Io,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),gt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let p={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(p.children=mf(i.props.children,c)),n.push(p)}),n}var _d="get",Ad="application/x-www-form-urlencoded";function ap(r){return r!=null&&typeof r.tagName=="string"}function j0(r){return ap(r)&&r.tagName.toLowerCase()==="button"}function B0(r){return ap(r)&&r.tagName.toLowerCase()==="form"}function z0(r){return ap(r)&&r.tagName.toLowerCase()==="input"}function F0(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function V0(r,e){return r.button===0&&(!e||e==="_self")&&!F0(r)}var gd=null;function H0(){if(gd===null)try{new FormData(document.createElement("form"),0),gd=!1}catch{gd=!0}return gd}var G0=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function zh(r){return r!=null&&!G0.has(r)?(Mr(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ad}"`),null):r}function $0(r,e){let n,i,a,c,p;if(B0(r)){let h=r.getAttribute("action");i=h?$s(h,e):null,n=r.getAttribute("method")||_d,a=zh(r.getAttribute("enctype"))||Ad,c=new FormData(r)}else if(j0(r)||z0(r)&&(r.type==="submit"||r.type==="image")){let h=r.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=r.getAttribute("formaction")||h.getAttribute("action");if(i=f?$s(f,e):null,n=r.getAttribute("formmethod")||h.getAttribute("method")||_d,a=zh(r.getAttribute("formenctype"))||zh(h.getAttribute("enctype"))||Ad,c=new FormData(h,r),!H0()){let{name:g,type:b,value:E}=r;if(b==="image"){let C=g?`${g}.`:"";c.append(`${C}x`,"0"),c.append(`${C}y`,"0")}else g&&c.append(g,E)}}else{if(ap(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=_d,i=null,a=Ad,p=r}return c&&a==="text/plain"&&(p=c,c=void 0),{action:i,method:n.toLowerCase(),encType:a,formData:c,body:p}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qf(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function W0(r,e,n){let i=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return i.pathname==="/"?i.pathname=`_root.${n}`:e&&$s(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function K0(r,e){if(r.id in e)return e[r.id];try{let n=await import(r.module);return e[r.id]=n,n}catch(n){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function J0(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function Y0(r,e,n){let i=await Promise.all(r.map(async a=>{let c=e.routes[a.route.id];if(c){let p=await K0(c,n);return p.links?p.links():[]}return[]}));return ex(i.flat(1).filter(J0).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function xw(r,e,n,i,a,c){let p=(f,g)=>n[g]?f.route.id!==n[g].route.id:!0,h=(f,g)=>n[g].pathname!==f.pathname||n[g].route.path?.endsWith("*")&&n[g].params["*"]!==f.params["*"];return c==="assets"?e.filter((f,g)=>p(f,g)||h(f,g)):c==="data"?e.filter((f,g)=>{let b=i.routes[f.route.id];if(!b||!b.hasLoader)return!1;if(p(f,g)||h(f,g))return!0;if(f.route.shouldRevalidate){let E=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(r,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof E=="boolean")return E}return!0}):[]}function Q0(r,e,{includeHydrateFallback:n}={}){return X0(r.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let c=[a.module];return a.clientActionModule&&(c=c.concat(a.clientActionModule)),a.clientLoaderModule&&(c=c.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(c=c.concat(a.hydrateFallbackModule)),a.imports&&(c=c.concat(a.imports)),c}).flat(1))}function X0(r){return[...new Set(r)]}function Z0(r){let e={},n=Object.keys(r).sort();for(let i of n)e[i]=r[i];return e}function ex(r,e){let n=new Set;return new Set(e),r.reduce((i,a)=>{let c=JSON.stringify(Z0(a));return n.has(c)||(n.add(c),i.push({key:c,link:a})),i},[])}function jS(){let r=F.useContext(Xa);return Qf(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function tx(){let r=F.useContext(op);return Qf(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var Xf=F.createContext(void 0);Xf.displayName="FrameworkContext";function BS(){let r=F.useContext(Xf);return Qf(r,"You must render this element inside a <HydratedRouter> element"),r}function nx(r,e){let n=F.useContext(Xf),[i,a]=F.useState(!1),[c,p]=F.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:g,onMouseLeave:b,onTouchStart:E}=e,C=F.useRef(null);F.useEffect(()=>{if(r==="render"&&p(!0),r==="viewport"){let Q=ie=>{ie.forEach(re=>{p(re.isIntersecting)})},$=new IntersectionObserver(Q,{threshold:.5});return C.current&&$.observe(C.current),()=>{$.disconnect()}}},[r]),F.useEffect(()=>{if(i){let Q=setTimeout(()=>{p(!0)},100);return()=>{clearTimeout(Q)}}},[i]);let M=()=>{a(!0)},z=()=>{a(!1),p(!1)};return n?r!=="intent"?[c,C,{}]:[c,C,{onFocus:uc(h,M),onBlur:uc(f,z),onMouseEnter:uc(g,M),onMouseLeave:uc(b,z),onTouchStart:uc(E,M)}]:[!1,C,{}]}function uc(r,e){return n=>{r&&r(n),n.defaultPrevented||e(n)}}function rx({page:r,...e}){let{router:n}=jS(),i=F.useMemo(()=>RS(n.routes,r,n.basename),[n.routes,r,n.basename]);return i?F.createElement(ix,{page:r,matches:i,...e}):null}function sx(r){let{manifest:e,routeModules:n}=BS(),[i,a]=F.useState([]);return F.useEffect(()=>{let c=!1;return Y0(r,e,n).then(p=>{c||a(p)}),()=>{c=!0}},[r,e,n]),i}function ix({page:r,matches:e,...n}){let i=Fi(),{manifest:a,routeModules:c}=BS(),{basename:p}=jS(),{loaderData:h,matches:f}=tx(),g=F.useMemo(()=>xw(r,e,f,a,i,"data"),[r,e,f,a,i]),b=F.useMemo(()=>xw(r,e,f,a,i,"assets"),[r,e,f,a,i]),E=F.useMemo(()=>{if(r===i.pathname+i.search+i.hash)return[];let z=new Set,Q=!1;if(e.forEach(ie=>{let re=a.routes[ie.route.id];!re||!re.hasLoader||(!g.some(ae=>ae.route.id===ie.route.id)&&ie.route.id in h&&c[ie.route.id]?.shouldRevalidate||re.hasClientLoader?Q=!0:z.add(ie.route.id))}),z.size===0)return[];let $=W0(r,p,"data");return Q&&z.size>0&&$.searchParams.set("_routes",e.filter(ie=>z.has(ie.route.id)).map(ie=>ie.route.id).join(",")),[$.pathname+$.search]},[p,h,i,a,g,e,r,c]),C=F.useMemo(()=>Q0(b,a),[b,a]),M=sx(b);return F.createElement(F.Fragment,null,E.map(z=>F.createElement("link",{key:z,rel:"prefetch",as:"fetch",href:z,...n})),C.map(z=>F.createElement("link",{key:z,rel:"modulepreload",href:z,...n})),M.map(({key:z,link:Q})=>F.createElement("link",{key:z,nonce:n.nonce,...Q})))}function ox(...r){return e=>{r.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var zS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{zS&&(window.__reactRouterVersion="7.8.2")}catch{}function ax({basename:r,children:e,window:n}){let i=F.useRef();i.current==null&&(i.current=JI({window:n,v5Compat:!0}));let a=i.current,[c,p]=F.useState({action:a.action,location:a.location}),h=F.useCallback(f=>{F.startTransition(()=>p(f))},[p]);return F.useLayoutEffect(()=>a.listen(h),[a,h]),F.createElement(L0,{basename:r,children:e,location:c.location,navigationType:c.action,navigator:a})}var FS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ro=F.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:a,reloadDocument:c,replace:p,state:h,target:f,to:g,preventScrollReset:b,viewTransition:E,...C},M){let{basename:z}=F.useContext(Br),Q=typeof g=="string"&&FS.test(g),$,ie=!1;if(typeof g=="string"&&Q&&($=g,zS))try{let A=new URL(window.location.href),O=g.startsWith("//")?new URL(A.protocol+g):new URL(g),D=$s(O.pathname,z);O.origin===A.origin&&D!=null?g=D+O.search+O.hash:ie=!0}catch{Mr(!1,`<Link to="${g}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let re=S0(g,{relative:a}),[ae,ve,he]=nx(i,C),De=dx(g,{replace:p,state:h,target:f,preventScrollReset:b,relative:a,viewTransition:E});function U(A){e&&e(A),A.defaultPrevented||De(A)}let _=F.createElement("a",{...C,...he,href:$||re,onClick:ie||c?e:U,ref:ox(M,ve),target:f,"data-discover":!Q&&n==="render"?"true":void 0});return ae&&!Q?F.createElement(F.Fragment,null,_,F.createElement(rx,{page:re})):_});Ro.displayName="Link";var lx=F.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:a=!1,style:c,to:p,viewTransition:h,children:f,...g},b){let E=zc(p,{relative:g.relative}),C=Fi(),M=F.useContext(op),{navigator:z,basename:Q}=F.useContext(Br),$=M!=null&&gx(E)&&h===!0,ie=z.encodeLocation?z.encodeLocation(E).pathname:E.pathname,re=C.pathname,ae=M&&M.navigation&&M.navigation.location?M.navigation.location.pathname:null;n||(re=re.toLowerCase(),ae=ae?ae.toLowerCase():null,ie=ie.toLowerCase()),ae&&Q&&(ae=$s(ae,Q)||ae);const ve=ie!=="/"&&ie.endsWith("/")?ie.length-1:ie.length;let he=re===ie||!a&&re.startsWith(ie)&&re.charAt(ve)==="/",De=ae!=null&&(ae===ie||!a&&ae.startsWith(ie)&&ae.charAt(ie.length)==="/"),U={isActive:he,isPending:De,isTransitioning:$},_=he?e:void 0,A;typeof i=="function"?A=i(U):A=[i,he?"active":null,De?"pending":null,$?"transitioning":null].filter(Boolean).join(" ");let O=typeof c=="function"?c(U):c;return F.createElement(Ro,{...g,"aria-current":_,className:A,ref:b,style:O,to:p,viewTransition:h},typeof f=="function"?f(U):f)});lx.displayName="NavLink";var cx=F.forwardRef(({discover:r="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:a,state:c,method:p=_d,action:h,onSubmit:f,relative:g,preventScrollReset:b,viewTransition:E,...C},M)=>{let z=hx(),Q=fx(h,{relative:g}),$=p.toLowerCase()==="get"?"get":"post",ie=typeof h=="string"&&FS.test(h),re=ae=>{if(f&&f(ae),ae.defaultPrevented)return;ae.preventDefault();let ve=ae.nativeEvent.submitter,he=ve?.getAttribute("formmethod")||p;z(ve||ae.currentTarget,{fetcherKey:e,method:he,navigate:n,replace:a,state:c,relative:g,preventScrollReset:b,viewTransition:E})};return F.createElement("form",{ref:M,method:$,action:Q,onSubmit:i?f:re,...C,"data-discover":!ie&&r==="render"?"true":void 0})});cx.displayName="Form";function ux(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VS(r){let e=F.useContext(Xa);return gt(e,ux(r)),e}function dx(r,{target:e,replace:n,state:i,preventScrollReset:a,relative:c,viewTransition:p}={}){let h=MS(),f=Fi(),g=zc(r,{relative:c});return F.useCallback(b=>{if(V0(b,e)){b.preventDefault();let E=n!==void 0?n:Rc(f)===Rc(g);h(r,{replace:E,state:i,preventScrollReset:a,relative:c,viewTransition:p})}},[f,h,g,n,i,e,r,a,c,p])}var px=0,mx=()=>`__${String(++px)}__`;function hx(){let{router:r}=VS("useSubmit"),{basename:e}=F.useContext(Br),n=N0();return F.useCallback(async(i,a={})=>{let{action:c,method:p,encType:h,formData:f,body:g}=$0(i,e);if(a.navigate===!1){let b=a.fetcherKey||mx();await r.fetch(b,n,a.action||c,{preventScrollReset:a.preventScrollReset,formData:f,body:g,formMethod:a.method||p,formEncType:a.encType||h,flushSync:a.flushSync})}else await r.navigate(a.action||c,{preventScrollReset:a.preventScrollReset,formData:f,body:g,formMethod:a.method||p,formEncType:a.encType||h,replace:a.replace,state:a.state,fromRouteId:n,flushSync:a.flushSync,viewTransition:a.viewTransition})},[r,e,n])}function fx(r,{relative:e}={}){let{basename:n}=F.useContext(Br),i=F.useContext(fs);gt(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),c={...zc(r||".",{relative:e})},p=Fi();if(r==null){c.search=p.search;let h=new URLSearchParams(c.search),f=h.getAll("index");if(f.some(b=>b==="")){h.delete("index"),f.filter(E=>E).forEach(E=>h.append("index",E));let b=h.toString();c.search=b?`?${b}`:""}}return(!r||r===".")&&a.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(c.pathname=c.pathname==="/"?n:Vs([n,c.pathname])),Rc(c)}function gx(r,{relative:e}={}){let n=F.useContext(NS);gt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=VS("useViewTransitionState"),a=zc(r,{relative:e});if(!n.isTransitioning)return!1;let c=$s(n.currentLocation.pathname,i)||n.currentLocation.pathname,p=$s(n.nextLocation.pathname,i)||n.nextLocation.pathname;return qd(a.pathname,p)!=null||qd(a.pathname,c)!=null}const yx=()=>{};var Rw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HS=function(r){const e=[];let n=0;for(let i=0;i<r.length;i++){let a=r.charCodeAt(i);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++i)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},vx=function(r){const e=[];let n=0,i=0;for(;n<r.length;){const a=r[n++];if(a<128)e[i++]=String.fromCharCode(a);else if(a>191&&a<224){const c=r[n++];e[i++]=String.fromCharCode((a&31)<<6|c&63)}else if(a>239&&a<365){const c=r[n++],p=r[n++],h=r[n++],f=((a&7)<<18|(c&63)<<12|(p&63)<<6|h&63)-65536;e[i++]=String.fromCharCode(55296+(f>>10)),e[i++]=String.fromCharCode(56320+(f&1023))}else{const c=r[n++],p=r[n++];e[i++]=String.fromCharCode((a&15)<<12|(c&63)<<6|p&63)}}return e.join("")},GS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let a=0;a<r.length;a+=3){const c=r[a],p=a+1<r.length,h=p?r[a+1]:0,f=a+2<r.length,g=f?r[a+2]:0,b=c>>2,E=(c&3)<<4|h>>4;let C=(h&15)<<2|g>>6,M=g&63;f||(M=64,p||(C=64)),i.push(n[b],n[E],n[C],n[M])}return i.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(HS(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):vx(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let a=0;a<r.length;){const c=n[r.charAt(a++)],h=a<r.length?n[r.charAt(a)]:0;++a;const g=a<r.length?n[r.charAt(a)]:64;++a;const E=a<r.length?n[r.charAt(a)]:64;if(++a,c==null||h==null||g==null||E==null)throw new bx;const C=c<<2|h>>4;if(i.push(C),g!==64){const M=h<<4&240|g>>2;if(i.push(M),E!==64){const z=g<<6&192|E;i.push(z)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class bx extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wx=function(r){const e=HS(r);return GS.encodeByteArray(e,!0)},jd=function(r){return wx(r).replace(/\./g,"")},$S=function(r){try{return GS.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx=()=>Tx().__FIREBASE_DEFAULTS__,Ex=()=>{if(typeof process>"u"||typeof Rw>"u")return;const r=Rw.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Cx=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&$S(r[1]);return e&&JSON.parse(e)},lp=()=>{try{return yx()||Sx()||Ex()||Cx()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},WS=r=>lp()?.emulatorHosts?.[r],_x=r=>{const e=WS(r);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},KS=()=>lp()?.config,JS=r=>lp()?.[`_${r}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function el(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function YS(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ix(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",a=r.iat||0,c=r.sub||r.user_id;if(!c)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p={iss:`https://securetoken.google.com/${i}`,aud:i,iat:a,exp:a+3600,auth_time:a,sub:c,user_id:c,firebase:{sign_in_provider:"custom",identities:{}},...r};return[jd(JSON.stringify(n)),jd(JSON.stringify(p)),""].join(".")}const Sc={};function xx(){const r={prod:[],emulator:[]};for(const e of Object.keys(Sc))Sc[e]?r.emulator.push(e):r.prod.push(e);return r}function Rx(r){let e=document.getElementById(r),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),n=!0),{created:n,element:e}}let kw=!1;function QS(r,e){if(typeof window>"u"||typeof document>"u"||!el(window.location.host)||Sc[r]===e||Sc[r]||kw)return;Sc[r]=e;function n(C){return`__firebase__banner__${C}`}const i="__firebase__banner",c=xx().prod.length>0;function p(){const C=document.getElementById(i);C&&C.remove()}function h(C){C.style.display="flex",C.style.background="#7faaf0",C.style.position="fixed",C.style.bottom="5px",C.style.left="5px",C.style.padding=".5em",C.style.borderRadius="5px",C.style.alignItems="center"}function f(C,M){C.setAttribute("width","24"),C.setAttribute("id",M),C.setAttribute("height","24"),C.setAttribute("viewBox","0 0 24 24"),C.setAttribute("fill","none"),C.style.marginLeft="-6px"}function g(){const C=document.createElement("span");return C.style.cursor="pointer",C.style.marginLeft="16px",C.style.fontSize="24px",C.innerHTML=" &times;",C.onclick=()=>{kw=!0,p()},C}function b(C,M){C.setAttribute("id",M),C.innerText="Learn more",C.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",C.setAttribute("target","__blank"),C.style.paddingLeft="5px",C.style.textDecoration="underline"}function E(){const C=Rx(i),M=n("text"),z=document.getElementById(M)||document.createElement("span"),Q=n("learnmore"),$=document.getElementById(Q)||document.createElement("a"),ie=n("preprendIcon"),re=document.getElementById(ie)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(C.created){const ae=C.element;h(ae),b($,Q);const ve=g();f(re,ie),ae.append(re,z,$,ve),document.body.appendChild(ae)}c?(z.innerText="Preview backend disconnected.",re.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(re.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,z.innerText="Preview backend running in this workspace."),z.setAttribute("id",M)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kx(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wn())}function Dx(){const r=lp()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Px(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function XS(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Nx(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ox(){const r=wn();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Ux(){return!Dx()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ZS(){try{return typeof indexedDB=="object"}catch{return!1}}function eE(){return new Promise((r,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(i);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(i),r(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}function Mx(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx="FirebaseError";class zr extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Lx,Object.setPrototypeOf(this,zr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bo.prototype.create)}}class Bo{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},a=`${this.service}/${e}`,c=this.errors[e],p=c?qx(c,i):"Error",h=`${this.serviceName}: ${p} (${a}).`;return new zr(a,h,i)}}function qx(r,e){return r.replace(jx,(n,i)=>{const a=e[i];return a!=null?String(a):`<${i}?>`})}const jx=/\{\$([^}]+)}/g;function Bx(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function Ws(r,e){if(r===e)return!0;const n=Object.keys(r),i=Object.keys(e);for(const a of n){if(!i.includes(a))return!1;const c=r[a],p=e[a];if(Dw(c)&&Dw(p)){if(!Ws(c,p))return!1}else if(c!==p)return!1}for(const a of i)if(!n.includes(a))return!1;return!0}function Dw(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fc(r){const e=[];for(const[n,i]of Object.entries(r))Array.isArray(i)?i.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function gc(r){const e={};return r.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[a,c]=i.split("=");e[decodeURIComponent(a)]=decodeURIComponent(c)}}),e}function yc(r){const e=r.indexOf("?");if(!e)return"";const n=r.indexOf("#",e);return r.substring(e,n>0?n:void 0)}function zx(r,e){const n=new Fx(r,e);return n.subscribe.bind(n)}class Fx{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,i){let a;if(e===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");Vx(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:i},a.next===void 0&&(a.next=Fh),a.error===void 0&&(a.error=Fh),a.complete===void 0&&(a.complete=Fh);const c=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),c}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Vx(r,e){if(typeof r!="object"||r===null)return!1;for(const n of e)if(n in r&&typeof r[n]=="function")return!0;return!1}function Fh(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hx=1e3,Gx=2,$x=14400*1e3,Wx=.5;function Pw(r,e=Hx,n=Gx){const i=e*Math.pow(n,r),a=Math.round(Wx*i*(Math.random()-.5)*2);return Math.min($x,i+a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(r){return r&&r._delegate?r._delegate:r}class Lr{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new Ax;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&i.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Yx(e))try{this.getOrInitializeService({instanceIdentifier:xo})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const c=this.getOrInitializeService({instanceIdentifier:a});i.resolve(c)}catch{}}}}clearInstance(e=xo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xo){return this.instances.has(e)}getOptions(e=xo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[c,p]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(c);i===h&&p.resolve(a)}return a}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(i)??new Set;a.add(e),this.onInitCallbacks.set(i,a);const c=this.instances.get(i);return c&&e(c,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const a of i)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Jx(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=xo){return this.component?this.component.multipleInstances?e:xo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Jx(r){return r===xo?void 0:r}function Yx(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qx{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Kx(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qe;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(qe||(qe={}));const Xx={debug:qe.DEBUG,verbose:qe.VERBOSE,info:qe.INFO,warn:qe.WARN,error:qe.ERROR,silent:qe.SILENT},Zx=qe.INFO,eR={[qe.DEBUG]:"log",[qe.VERBOSE]:"log",[qe.INFO]:"info",[qe.WARN]:"warn",[qe.ERROR]:"error"},tR=(r,e,...n)=>{if(e<r.logLevel)return;const i=new Date().toISOString(),a=eR[e];if(a)console[a](`[${i}]  ${r.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class cp{constructor(e){this.name=e,this._logLevel=Zx,this._logHandler=tR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in qe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Xx[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,qe.DEBUG,...e),this._logHandler(this,qe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,qe.VERBOSE,...e),this._logHandler(this,qe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,qe.INFO,...e),this._logHandler(this,qe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,qe.WARN,...e),this._logHandler(this,qe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,qe.ERROR,...e),this._logHandler(this,qe.ERROR,...e)}}const nR=(r,e)=>e.some(n=>r instanceof n);let Nw,Ow;function rR(){return Nw||(Nw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sR(){return Ow||(Ow=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tE=new WeakMap,hf=new WeakMap,nE=new WeakMap,Vh=new WeakMap,Zf=new WeakMap;function iR(r){const e=new Promise((n,i)=>{const a=()=>{r.removeEventListener("success",c),r.removeEventListener("error",p)},c=()=>{n(Pi(r.result)),a()},p=()=>{i(r.error),a()};r.addEventListener("success",c),r.addEventListener("error",p)});return e.then(n=>{n instanceof IDBCursor&&tE.set(n,r)}).catch(()=>{}),Zf.set(e,r),e}function oR(r){if(hf.has(r))return;const e=new Promise((n,i)=>{const a=()=>{r.removeEventListener("complete",c),r.removeEventListener("error",p),r.removeEventListener("abort",p)},c=()=>{n(),a()},p=()=>{i(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",c),r.addEventListener("error",p),r.addEventListener("abort",p)});hf.set(r,e)}let ff={get(r,e,n){if(r instanceof IDBTransaction){if(e==="done")return hf.get(r);if(e==="objectStoreNames")return r.objectStoreNames||nE.get(r);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Pi(r[e])},set(r,e,n){return r[e]=n,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function aR(r){ff=r(ff)}function lR(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=r.call(Hh(this),e,...n);return nE.set(i,e.sort?e.sort():[e]),Pi(i)}:sR().includes(r)?function(...e){return r.apply(Hh(this),e),Pi(tE.get(this))}:function(...e){return Pi(r.apply(Hh(this),e))}}function cR(r){return typeof r=="function"?lR(r):(r instanceof IDBTransaction&&oR(r),nR(r,rR())?new Proxy(r,ff):r)}function Pi(r){if(r instanceof IDBRequest)return iR(r);if(Vh.has(r))return Vh.get(r);const e=cR(r);return e!==r&&(Vh.set(r,e),Zf.set(e,r)),e}const Hh=r=>Zf.get(r);function rE(r,e,{blocked:n,upgrade:i,blocking:a,terminated:c}={}){const p=indexedDB.open(r,e),h=Pi(p);return i&&p.addEventListener("upgradeneeded",f=>{i(Pi(p.result),f.oldVersion,f.newVersion,Pi(p.transaction),f)}),n&&p.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),h.then(f=>{c&&f.addEventListener("close",()=>c()),a&&f.addEventListener("versionchange",g=>a(g.oldVersion,g.newVersion,g))}).catch(()=>{}),h}const uR=["get","getKey","getAll","getAllKeys","count"],dR=["put","add","delete","clear"],Gh=new Map;function Uw(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Gh.get(e))return Gh.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,a=dR.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(a||uR.includes(n)))return;const c=async function(p,...h){const f=this.transaction(p,a?"readwrite":"readonly");let g=f.store;return i&&(g=g.index(h.shift())),(await Promise.all([g[n](...h),a&&f.done]))[0]};return Gh.set(e,c),c}aR(r=>({...r,get:(e,n,i)=>Uw(e,n)||r.get(e,n,i),has:(e,n)=>!!Uw(e,n)||r.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(mR(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function mR(r){return r.getComponent()?.type==="VERSION"}const gf="@firebase/app",Mw="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks=new cp("@firebase/app"),hR="@firebase/app-compat",fR="@firebase/analytics-compat",gR="@firebase/analytics",yR="@firebase/app-check-compat",vR="@firebase/app-check",bR="@firebase/auth",wR="@firebase/auth-compat",TR="@firebase/database",SR="@firebase/data-connect",ER="@firebase/database-compat",CR="@firebase/functions",_R="@firebase/functions-compat",AR="@firebase/installations",IR="@firebase/installations-compat",xR="@firebase/messaging",RR="@firebase/messaging-compat",kR="@firebase/performance",DR="@firebase/performance-compat",PR="@firebase/remote-config",NR="@firebase/remote-config-compat",OR="@firebase/storage",UR="@firebase/storage-compat",MR="@firebase/firestore",LR="@firebase/ai",qR="@firebase/firestore-compat",jR="firebase",BR="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf="[DEFAULT]",zR={[gf]:"fire-core",[hR]:"fire-core-compat",[gR]:"fire-analytics",[fR]:"fire-analytics-compat",[vR]:"fire-app-check",[yR]:"fire-app-check-compat",[bR]:"fire-auth",[wR]:"fire-auth-compat",[TR]:"fire-rtdb",[SR]:"fire-data-connect",[ER]:"fire-rtdb-compat",[CR]:"fire-fn",[_R]:"fire-fn-compat",[AR]:"fire-iid",[IR]:"fire-iid-compat",[xR]:"fire-fcm",[RR]:"fire-fcm-compat",[kR]:"fire-perf",[DR]:"fire-perf-compat",[PR]:"fire-rc",[NR]:"fire-rc-compat",[OR]:"fire-gcs",[UR]:"fire-gcs-compat",[MR]:"fire-fst",[qR]:"fire-fst-compat",[LR]:"fire-vertex","fire-js":"fire-js",[jR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bd=new Map,FR=new Map,vf=new Map;function Lw(r,e){try{r.container.addComponent(e)}catch(n){Ks.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,n)}}function ms(r){const e=r.name;if(vf.has(e))return Ks.debug(`There were multiple attempts to register component ${e}.`),!1;vf.set(e,r);for(const n of Bd.values())Lw(n,r);for(const n of FR.values())Lw(n,r);return!0}function zo(r,e){const n=r.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),r.container.getProvider(e)}function Jn(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ni=new Bo("app","Firebase",VR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Lr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ni.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=BR;function sE(r,e={}){let n=r;typeof e!="object"&&(e={name:e});const i={name:yf,automaticDataCollectionEnabled:!0,...e},a=i.name;if(typeof a!="string"||!a)throw Ni.create("bad-app-name",{appName:String(a)});if(n||(n=KS()),!n)throw Ni.create("no-options");const c=Bd.get(a);if(c){if(Ws(n,c.options)&&Ws(i,c.config))return c;throw Ni.create("duplicate-app",{appName:a})}const p=new Qx(a);for(const f of vf.values())p.addComponent(f);const h=new HR(n,i,p);return Bd.set(a,h),h}function eg(r=yf){const e=Bd.get(r);if(!e&&r===yf&&KS())return sE();if(!e)throw Ni.create("no-app",{appName:r});return e}function vr(r,e,n){let i=zR[r]??r;n&&(i+=`-${n}`);const a=i.match(/\s|\//),c=e.match(/\s|\//);if(a||c){const p=[`Unable to register library "${i}" with version "${e}":`];a&&p.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&c&&p.push("and"),c&&p.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ks.warn(p.join(" "));return}ms(new Lr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GR="firebase-heartbeat-database",$R=1,kc="firebase-heartbeat-store";let $h=null;function iE(){return $h||($h=rE(GR,$R,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(kc)}catch(n){console.warn(n)}}}}).catch(r=>{throw Ni.create("idb-open",{originalErrorMessage:r.message})})),$h}async function WR(r){try{const n=(await iE()).transaction(kc),i=await n.objectStore(kc).get(oE(r));return await n.done,i}catch(e){if(e instanceof zr)Ks.warn(e.message);else{const n=Ni.create("idb-get",{originalErrorMessage:e?.message});Ks.warn(n.message)}}}async function qw(r,e){try{const i=(await iE()).transaction(kc,"readwrite");await i.objectStore(kc).put(e,oE(r)),await i.done}catch(n){if(n instanceof zr)Ks.warn(n.message);else{const i=Ni.create("idb-set",{originalErrorMessage:n?.message});Ks.warn(i.message)}}}function oE(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR=1024,JR=30;class YR{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new XR(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=jw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>JR){const a=ZR(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ks.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=jw(),{heartbeatsToSend:n,unsentEntries:i}=QR(this._heartbeatsCache.heartbeats),a=jd(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return Ks.warn(e),""}}}function jw(){return new Date().toISOString().substring(0,10)}function QR(r,e=KR){const n=[];let i=r.slice();for(const a of r){const c=n.find(p=>p.agent===a.agent);if(c){if(c.dates.push(a.date),Bw(n)>e){c.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),Bw(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class XR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ZS()?eE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await WR(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return qw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return qw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Bw(r){return jd(JSON.stringify({version:2,heartbeats:r})).length}function ZR(r){if(r.length===0)return-1;let e=0,n=r[0].date;for(let i=1;i<r.length;i++)r[i].date<n&&(n=r[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ek(r){ms(new Lr("platform-logger",e=>new pR(e),"PRIVATE")),ms(new Lr("heartbeat",e=>new YR(e),"PRIVATE")),vr(gf,Mw,r),vr(gf,Mw,"esm2020"),vr("fire-js","")}ek("");function aE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tk=aE,lE=new Bo("auth","Firebase",aE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zd=new cp("@firebase/auth");function nk(r,...e){zd.logLevel<=qe.WARN&&zd.warn(`Auth (${tl}): ${r}`,...e)}function Id(r,...e){zd.logLevel<=qe.ERROR&&zd.error(`Auth (${tl}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(r,...e){throw ng(r,...e)}function Ur(r,...e){return ng(r,...e)}function tg(r,e,n){const i={...tk(),[e]:n};return new Bo("auth","Firebase",i).create(e,{appName:r.name})}function Hs(r){return tg(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rk(r,e,n){const i=n;if(!(e instanceof i))throw i.name!==e.constructor.name&&wr(r,"argument-error"),tg(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ng(r,...e){if(typeof r!="string"){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=r.name),r._errorFactory.create(n,...i)}return lE.create(r,...e)}function _e(r,e,...n){if(!r)throw ng(e,...n)}function zs(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Id(e),new Error(e)}function Js(r,e){r||zs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(){return typeof self<"u"&&self.location?.href||""}function sk(){return zw()==="http:"||zw()==="https:"}function zw(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ik(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sk()||XS()||"connection"in navigator)?navigator.onLine:!0}function ok(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(e,n){this.shortDelay=e,this.longDelay=n,Js(n>e,"Short delay should be less than long delay!"),this.isMobile=kx()||Nx()}get(){return ik()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(r,e){Js(r.emulator,"Emulator should always be set here");const{url:n}=r.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{static initialize(e,n,i){this.fetchImpl=e,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ck=new Vc(3e4,6e4);function Vi(r,e){return r.tenantId&&!e.tenantId?{...e,tenantId:r.tenantId}:e}async function Hi(r,e,n,i,a={}){return uE(r,a,async()=>{let c={},p={};i&&(e==="GET"?p=i:c={body:JSON.stringify(i)});const h=Fc({key:r.config.apiKey,...p}).slice(1),f=await r._getAdditionalHeaders();f["Content-Type"]="application/json",r.languageCode&&(f["X-Firebase-Locale"]=r.languageCode);const g={method:e,headers:f,...c};return Px()||(g.referrerPolicy="no-referrer"),r.emulatorConfig&&el(r.emulatorConfig.host)&&(g.credentials="include"),cE.fetch()(await dE(r,r.config.apiHost,n,h),g)})}async function uE(r,e,n){r._canInitEmulator=!1;const i={...ak,...e};try{const a=new dk(r),c=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const p=await c.json();if("needConfirmation"in p)throw yd(r,"account-exists-with-different-credential",p);if(c.ok&&!("errorMessage"in p))return p;{const h=c.ok?p.errorMessage:p.error.message,[f,g]=h.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw yd(r,"credential-already-in-use",p);if(f==="EMAIL_EXISTS")throw yd(r,"email-already-in-use",p);if(f==="USER_DISABLED")throw yd(r,"user-disabled",p);const b=i[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw tg(r,b,g);wr(r,b)}}catch(a){if(a instanceof zr)throw a;wr(r,"network-request-failed",{message:String(a)})}}async function Hc(r,e,n,i,a={}){const c=await Hi(r,e,n,i,a);return"mfaPendingCredential"in c&&wr(r,"multi-factor-auth-required",{_serverResponse:c}),c}async function dE(r,e,n,i){const a=`${e}${n}?${i}`,c=r,p=c.config.emulator?rg(r.config,a):`${r.config.apiScheme}://${a}`;return lk.includes(n)&&(await c._persistenceManagerAvailable,c._getPersistenceType()==="COOKIE")?c._getPersistence()._getFinalTarget(p).toString():p}function uk(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(Ur(this.auth,"network-request-failed")),ck.get())})}}function yd(r,e,n){const i={appName:r.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const a=Ur(r,e,i);return a.customData._tokenResponse=n,a}function Fw(r){return r!==void 0&&r.enterprise!==void 0}class pk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return uk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function mk(r,e){return Hi(r,"GET","/v2/recaptchaConfig",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hk(r,e){return Hi(r,"POST","/v1/accounts:delete",e)}async function Fd(r,e){return Hi(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fk(r,e=!1){const n=Wt(r),i=await n.getIdToken(e),a=sg(i);_e(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const c=typeof a.firebase=="object"?a.firebase:void 0,p=c?.sign_in_provider;return{claims:a,token:i,authTime:Ec(Wh(a.auth_time)),issuedAtTime:Ec(Wh(a.iat)),expirationTime:Ec(Wh(a.exp)),signInProvider:p||null,signInSecondFactor:c?.sign_in_second_factor||null}}function Wh(r){return Number(r)*1e3}function sg(r){const[e,n,i]=r.split(".");if(e===void 0||n===void 0||i===void 0)return Id("JWT malformed, contained fewer than 3 sections"),null;try{const a=$S(n);return a?JSON.parse(a):(Id("Failed to decode base64 JWT payload"),null)}catch(a){return Id("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Vw(r){const e=sg(r);return _e(e,"internal-error"),_e(typeof e.exp<"u","internal-error"),_e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dc(r,e,n=!1){if(n)return e;try{return await e}catch(i){throw i instanceof zr&&gk(i)&&r.auth.currentUser===r&&await r.auth.signOut(),i}}function gk({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ec(this.lastLoginAt),this.creationTime=Ec(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vd(r){const e=r.auth,n=await r.getIdToken(),i=await Dc(r,Fd(e,{idToken:n}));_e(i?.users.length,e,"internal-error");const a=i.users[0];r._notifyReloadListener(a);const c=a.providerUserInfo?.length?pE(a.providerUserInfo):[],p=bk(r.providerData,c),h=r.isAnonymous,f=!(r.email&&a.passwordHash)&&!p?.length,g=h?f:!1,b={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:p,metadata:new wf(a.createdAt,a.lastLoginAt),isAnonymous:g};Object.assign(r,b)}async function vk(r){const e=Wt(r);await Vd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bk(r,e){return[...r.filter(i=>!e.some(a=>a.providerId===i.providerId)),...e]}function pE(r){return r.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wk(r,e){const n=await uE(r,{},async()=>{const i=Fc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:c}=r.config,p=await dE(r,a,"/v1/token",`key=${c}`),h=await r._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:h,body:i};return r.emulatorConfig&&el(r.emulatorConfig.host)&&(f.credentials="include"),cE.fetch()(p,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Tk(r,e){return Hi(r,"POST","/v2/accounts:revokeToken",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_e(e.idToken,"internal-error"),_e(typeof e.idToken<"u","internal-error"),_e(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Vw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){_e(e.length!==0,"internal-error");const n=Vw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(_e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:i,refreshToken:a,expiresIn:c}=await wk(e,n);this.updateTokensAndExpiration(i,a,Number(c))}updateTokensAndExpiration(e,n,i){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,n){const{refreshToken:i,accessToken:a,expirationTime:c}=n,p=new ja;return i&&(_e(typeof i=="string","internal-error",{appName:e}),p.refreshToken=i),a&&(_e(typeof a=="string","internal-error",{appName:e}),p.accessToken=a),c&&(_e(typeof c=="number","internal-error",{appName:e}),p.expirationTime=c),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ja,this.toJSON())}_performRefresh(){return zs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(r,e){_e(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Or{constructor({uid:e,auth:n,stsTokenManager:i,...a}){this.providerId="firebase",this.proactiveRefresh=new yk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new wf(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Dc(this,this.stsTokenManager.getToken(this.auth,e));return _e(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return fk(this,e)}reload(){return vk(this)}_assign(e){this!==e&&(_e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Or({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){_e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),n&&await Vd(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jn(this.auth.app))return Promise.reject(Hs(this.auth));const e=await this.getIdToken();return await Dc(this,hk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const i=n.displayName??void 0,a=n.email??void 0,c=n.phoneNumber??void 0,p=n.photoURL??void 0,h=n.tenantId??void 0,f=n._redirectEventId??void 0,g=n.createdAt??void 0,b=n.lastLoginAt??void 0,{uid:E,emailVerified:C,isAnonymous:M,providerData:z,stsTokenManager:Q}=n;_e(E&&Q,e,"internal-error");const $=ja.fromJSON(this.name,Q);_e(typeof E=="string",e,"internal-error"),Ii(i,e.name),Ii(a,e.name),_e(typeof C=="boolean",e,"internal-error"),_e(typeof M=="boolean",e,"internal-error"),Ii(c,e.name),Ii(p,e.name),Ii(h,e.name),Ii(f,e.name),Ii(g,e.name),Ii(b,e.name);const ie=new Or({uid:E,auth:e,email:a,emailVerified:C,displayName:i,isAnonymous:M,photoURL:p,phoneNumber:c,tenantId:h,stsTokenManager:$,createdAt:g,lastLoginAt:b});return z&&Array.isArray(z)&&(ie.providerData=z.map(re=>({...re}))),f&&(ie._redirectEventId=f),ie}static async _fromIdTokenResponse(e,n,i=!1){const a=new ja;a.updateFromServerResponse(n);const c=new Or({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:i});return await Vd(c),c}static async _fromGetAccountInfoResponse(e,n,i){const a=n.users[0];_e(a.localId!==void 0,"internal-error");const c=a.providerUserInfo!==void 0?pE(a.providerUserInfo):[],p=!(a.email&&a.passwordHash)&&!c?.length,h=new ja;h.updateFromIdToken(i);const f=new Or({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:p}),g={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new wf(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!c?.length};return Object.assign(f,g),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=new Map;function Fs(r){Js(r instanceof Function,"Expected a class definition");let e=Hw.get(r);return e?(Js(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,Hw.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}mE.type="NONE";const Gw=mE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xd(r,e,n){return`firebase:${r}:${e}:${n}`}class Ba{constructor(e,n,i){this.persistence=e,this.auth=n,this.userKey=i;const{config:a,name:c}=this.auth;this.fullUserKey=xd(this.userKey,a.apiKey,c),this.fullPersistenceKey=xd("persistence",a.apiKey,c),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Fd(this.auth,{idToken:e}).catch(()=>{});return n?Or._fromGetAccountInfoResponse(this.auth,n,e):null}return Or._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,i="authUser"){if(!n.length)return new Ba(Fs(Gw),e,i);const a=(await Promise.all(n.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let c=a[0]||Fs(Gw);const p=xd(i,e.config.apiKey,e.name);let h=null;for(const g of n)try{const b=await g._get(p);if(b){let E;if(typeof b=="string"){const C=await Fd(e,{idToken:b}).catch(()=>{});if(!C)break;E=await Or._fromGetAccountInfoResponse(e,C,b)}else E=Or._fromJSON(e,b);g!==c&&(h=E),c=g;break}}catch{}const f=a.filter(g=>g._shouldAllowMigration);return!c._shouldAllowMigration||!f.length?new Ba(c,e,i):(c=f[0],h&&await c._set(p,h.toJSON()),await Promise.all(n.map(async g=>{if(g!==c)try{await g._remove(p)}catch{}})),new Ba(c,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $w(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(bE(e))return"Blackberry";if(wE(e))return"Webos";if(fE(e))return"Safari";if((e.includes("chrome/")||gE(e))&&!e.includes("edge/"))return"Chrome";if(vE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=r.match(n);if(i?.length===2)return i[1]}return"Other"}function hE(r=wn()){return/firefox\//i.test(r)}function fE(r=wn()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gE(r=wn()){return/crios\//i.test(r)}function yE(r=wn()){return/iemobile/i.test(r)}function vE(r=wn()){return/android/i.test(r)}function bE(r=wn()){return/blackberry/i.test(r)}function wE(r=wn()){return/webos/i.test(r)}function ig(r=wn()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function Sk(r=wn()){return ig(r)&&!!window.navigator?.standalone}function Ek(){return Ox()&&document.documentMode===10}function TE(r=wn()){return ig(r)||vE(r)||wE(r)||bE(r)||/windows phone/i.test(r)||yE(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(r,e=[]){let n;switch(r){case"Browser":n=$w(wn());break;case"Worker":n=`${$w(wn())}-${r}`;break;default:n=r}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${tl}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const i=c=>new Promise((p,h)=>{try{const f=e(c);p(f)}catch(f){h(f)}});i.onAbort=n,this.queue.push(i);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const i of this.queue)await i(e),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _k(r,e={}){return Hi(r,"GET","/v2/passwordPolicy",Vi(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak=6;class Ik{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??Ak,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const i=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=e.length>=i),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let a=0;a<e.length;a++)i=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,n,i,a,c){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e,n,i,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ww(this),this.idTokenSubscription=new Ww(this),this.beforeStateQueue=new Ck(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=lE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(c=>this._resolvePersistenceManagerAvailable=c)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Fs(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ba.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Fd(this,{idToken:e}),i=await Or._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Jn(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(p=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(p,p))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=this.redirectUser?._redirectEventId,p=i?._redirectEventId,h=await this.tryRedirectSignIn(e);(!c||c===p)&&h?.user&&(i=h.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(c){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return _e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Vd(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ok()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Jn(this.app))return Promise.reject(Hs(this));const n=e?Wt(e):null;return n&&_e(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&_e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Jn(this.app)?Promise.reject(Hs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Jn(this.app)?Promise.reject(Hs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Fs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _k(this),n=new Ik(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Bo("auth","Firebase",e())}onAuthStateChanged(e,n,i){return this.registerStateListener(this.authStateSubscription,e,n,i)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,i){return this.registerStateListener(this.idTokenSubscription,e,n,i)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await Tk(this,i)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const i=await this.getOrInitRedirectPersistenceManager(n);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Fs(e)||this._popupRedirectResolver;_e(n,this,"argument-error"),this.redirectPersistenceManager=await Ba.create(this,[Fs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,i,a){if(this._deleted)return()=>{};const c=typeof n=="function"?n:n.next.bind(n);let p=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(_e(h,this,"internal-error"),h.then(()=>{p||c(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,i,a);return()=>{p=!0,f()}}else{const f=e.addObserver(n);return()=>{p=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=SE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){if(Jn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&nk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Gi(r){return Wt(r)}class Ww{constructor(e){this.auth=e,this.observer=null,this.addObserver=zx(n=>this.observer=n)}get next(){return _e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Rk(r){up=r}function EE(r){return up.loadJS(r)}function kk(){return up.recaptchaEnterpriseScript}function Dk(){return up.gapiScript}function Pk(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class Nk{constructor(){this.enterprise=new Ok}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Ok{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Uk="recaptcha-enterprise",CE="NO_RECAPTCHA";class Mk{constructor(e){this.type=Uk,this.auth=Gi(e)}async verify(e="verify",n=!1){async function i(c){if(!n){if(c.tenantId==null&&c._agentRecaptchaConfig!=null)return c._agentRecaptchaConfig.siteKey;if(c.tenantId!=null&&c._tenantRecaptchaConfigs[c.tenantId]!==void 0)return c._tenantRecaptchaConfigs[c.tenantId].siteKey}return new Promise(async(p,h)=>{mk(c,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(f=>{if(f.recaptchaKey===void 0)h(new Error("recaptcha Enterprise site key undefined"));else{const g=new pk(f);return c.tenantId==null?c._agentRecaptchaConfig=g:c._tenantRecaptchaConfigs[c.tenantId]=g,p(g.siteKey)}}).catch(f=>{h(f)})})}function a(c,p,h){const f=window.grecaptcha;Fw(f)?f.enterprise.ready(()=>{f.enterprise.execute(c,{action:e}).then(g=>{p(g)}).catch(()=>{p(CE)})}):h(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Nk().execute("siteKey",{action:"verify"}):new Promise((c,p)=>{i(this.auth).then(h=>{if(!n&&Fw(window.grecaptcha))a(h,c,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let f=kk();f.length!==0&&(f+=h),EE(f).then(()=>{a(h,c,p)}).catch(g=>{p(g)})}}).catch(h=>{p(h)})})}}async function Kw(r,e,n,i=!1,a=!1){const c=new Mk(r);let p;if(a)p=CE;else try{p=await c.verify(n)}catch{p=await c.verify(n,!0)}const h={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in h){const f=h.phoneEnrollmentInfo.phoneNumber,g=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:g,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){const f=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return i?Object.assign(h,{captchaResp:p}):Object.assign(h,{captchaResponse:p}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function Tf(r,e,n,i,a){if(r._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const c=await Kw(r,e,n,n==="getOobCode");return i(r,c)}else return i(r,e).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const p=await Kw(r,e,n,n==="getOobCode");return i(r,p)}else return Promise.reject(c)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(r,e){const n=zo(r,"auth");if(n.isInitialized()){const a=n.getImmediate(),c=n.getOptions();if(Ws(c,e??{}))return a;wr(a,"already-initialized")}return n.initialize({options:e})}function qk(r,e){const n=e?.persistence||[],i=(Array.isArray(n)?n:[n]).map(Fs);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(i,e?.popupRedirectResolver)}function jk(r,e,n){const i=Gi(r);_e(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const a=!1,c=_E(e),{host:p,port:h}=Bk(e),f=h===null?"":`:${h}`,g={url:`${c}//${p}${f}/`},b=Object.freeze({host:p,port:h,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!i._canInitEmulator){_e(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),_e(Ws(g,i.config.emulator)&&Ws(b,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=g,i.emulatorConfig=b,i.settings.appVerificationDisabledForTesting=!0,el(p)?(YS(`${c}//${p}${f}`),QS("Auth",!0)):zk()}function _E(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function Bk(r){const e=_E(r),n=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(i);if(a){const c=a[1];return{host:c,port:Jw(i.substr(c.length+1))}}else{const[c,p]=i.split(":");return{host:c,port:Jw(p)}}}function Jw(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function zk(){function r(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return zs("not implemented")}_getIdTokenResponse(e){return zs("not implemented")}_linkToIdToken(e,n){return zs("not implemented")}_getReauthenticationResolver(e){return zs("not implemented")}}async function Fk(r,e){return Hi(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(r,e){return Hc(r,"POST","/v1/accounts:signInWithPassword",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hk(r,e){return Hc(r,"POST","/v1/accounts:signInWithEmailLink",Vi(r,e))}async function Gk(r,e){return Hc(r,"POST","/v1/accounts:signInWithEmailLink",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends og{constructor(e,n,i,a=null){super("password",i),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new Pc(e,n,"password")}static _fromEmailAndCode(e,n,i=null){return new Pc(e,n,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tf(e,n,"signInWithPassword",Vk);case"emailLink":return Hk(e,{email:this._email,oobCode:this._password});default:wr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const i={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tf(e,i,"signUpPassword",Fk);case"emailLink":return Gk(e,{idToken:n,email:this._email,oobCode:this._password});default:wr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function za(r,e){return Hc(r,"POST","/v1/accounts:signInWithIdp",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k="http://localhost";class Oo extends og{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Oo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):wr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:a,...c}=n;if(!i||!a)return null;const p=new Oo(i,a);return p.idToken=c.idToken||void 0,p.accessToken=c.accessToken||void 0,p.secret=c.secret,p.nonce=c.nonce,p.pendingToken=c.pendingToken||null,p}_getIdTokenResponse(e){const n=this.buildRequest();return za(e,n)}_linkToIdToken(e,n){const i=this.buildRequest();return i.idToken=n,za(e,i)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,za(e,n)}buildRequest(){const e={requestUri:$k,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Fc(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wk(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Kk(r){const e=gc(yc(r)).link,n=e?gc(yc(e)).deep_link_id:null,i=gc(yc(r)).deep_link_id;return(i?gc(yc(i)).link:null)||i||n||e||r}class ag{constructor(e){const n=gc(yc(e)),i=n.apiKey??null,a=n.oobCode??null,c=Wk(n.mode??null);_e(i&&a&&c,"argument-error"),this.apiKey=i,this.operation=c,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Kk(e);try{return new ag(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(){this.providerId=nl.PROVIDER_ID}static credential(e,n){return Pc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const i=ag.parseLink(n);return _e(i,"argument-error"),Pc._fromEmailAndCode(e,i.code,i.tenantId)}}nl.PROVIDER_ID="password";nl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";nl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc extends lg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi extends Gc{constructor(){super("facebook.com")}static credential(e){return Oo._fromParams({providerId:xi.PROVIDER_ID,signInMethod:xi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xi.credentialFromTaggedObject(e)}static credentialFromError(e){return xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xi.credential(e.oauthAccessToken)}catch{return null}}}xi.FACEBOOK_SIGN_IN_METHOD="facebook.com";xi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs extends Gc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Oo._fromParams({providerId:Bs.PROVIDER_ID,signInMethod:Bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Bs.credentialFromTaggedObject(e)}static credentialFromError(e){return Bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:i}=e;if(!n&&!i)return null;try{return Bs.credential(n,i)}catch{return null}}}Bs.GOOGLE_SIGN_IN_METHOD="google.com";Bs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri extends Gc{constructor(){super("github.com")}static credential(e){return Oo._fromParams({providerId:Ri.PROVIDER_ID,signInMethod:Ri.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ri.credentialFromTaggedObject(e)}static credentialFromError(e){return Ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ri.credential(e.oauthAccessToken)}catch{return null}}}Ri.GITHUB_SIGN_IN_METHOD="github.com";Ri.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki extends Gc{constructor(){super("twitter.com")}static credential(e,n){return Oo._fromParams({providerId:ki.PROVIDER_ID,signInMethod:ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ki.credentialFromTaggedObject(e)}static credentialFromError(e){return ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=e;if(!n||!i)return null;try{return ki.credential(n,i)}catch{return null}}}ki.TWITTER_SIGN_IN_METHOD="twitter.com";ki.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jk(r,e){return Hc(r,"POST","/v1/accounts:signUp",Vi(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,i,a=!1){const c=await Or._fromIdTokenResponse(e,i,a),p=Yw(i);return new Uo({user:c,providerId:p,_tokenResponse:i,operationType:n})}static async _forOperation(e,n,i){await e._updateTokensIfNecessary(i,!0);const a=Yw(i);return new Uo({user:e,providerId:a,_tokenResponse:i,operationType:n})}}function Yw(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd extends zr{constructor(e,n,i,a){super(n.code,n.message),this.operationType=i,this.user=a,Object.setPrototypeOf(this,Hd.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,n,i,a){return new Hd(e,n,i,a)}}function AE(r,e,n,i){return(e==="reauthenticate"?n._getReauthenticationResolver(r):n._getIdTokenResponse(r)).catch(c=>{throw c.code==="auth/multi-factor-auth-required"?Hd._fromErrorAndOperation(r,c,e,i):c})}async function Yk(r,e,n=!1){const i=await Dc(r,e._linkToIdToken(r.auth,await r.getIdToken()),n);return Uo._forOperation(r,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qk(r,e,n=!1){const{auth:i}=r;if(Jn(i.app))return Promise.reject(Hs(i));const a="reauthenticate";try{const c=await Dc(r,AE(i,a,e,r),n);_e(c.idToken,i,"internal-error");const p=sg(c.idToken);_e(p,i,"internal-error");const{sub:h}=p;return _e(r.uid===h,i,"user-mismatch"),Uo._forOperation(r,a,c)}catch(c){throw c?.code==="auth/user-not-found"&&wr(i,"user-mismatch"),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IE(r,e,n=!1){if(Jn(r.app))return Promise.reject(Hs(r));const i="signIn",a=await AE(r,i,e),c=await Uo._fromIdTokenResponse(r,i,a);return n||await r._updateCurrentUser(c.user),c}async function Xk(r,e){return IE(Gi(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xE(r){const e=Gi(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Zk(r,e,n){if(Jn(r.app))return Promise.reject(Hs(r));const i=Gi(r),p=await Tf(i,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Jk).catch(f=>{throw f.code==="auth/password-does-not-meet-requirements"&&xE(r),f}),h=await Uo._fromIdTokenResponse(i,"signIn",p);return await i._updateCurrentUser(h.user),h}function eD(r,e,n){return Jn(r.app)?Promise.reject(Hs(r)):Xk(Wt(r),nl.credential(e,n)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&xE(r),i})}function tD(r,e,n,i){return Wt(r).onIdTokenChanged(e,n,i)}function nD(r,e,n){return Wt(r).beforeAuthStateChanged(e,n)}function rD(r,e,n,i){return Wt(r).onAuthStateChanged(e,n,i)}const Gd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Gd,"1"),this.storage.removeItem(Gd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD=1e3,iD=10;class kE extends RE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=TE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const i=this.storage.getItem(n),a=this.localCache[n];i!==a&&e(n,a,i)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((p,h,f)=>{this.notifyListeners(p,f)});return}const i=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const p=this.storage.getItem(i);!n&&this.localCache[i]===p||this.notifyListeners(i,p)},c=this.storage.getItem(i);Ek()&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,iD):a()}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:i}),!0)})},sD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}kE.type="LOCAL";const oD=kE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE extends RE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}DE.type="SESSION";const PE=DE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const i=new dp(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:i,eventType:a,data:c}=n.data,p=this.handlersMap[a];if(!p?.size)return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:a});const h=Array.from(p).map(async g=>g(n.origin,c)),f=await aD(h);n.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}dp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(r="",e=10){let n="";for(let i=0;i<e;i++)n+=Math.floor(Math.random()*10);return r+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,i=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,p;return new Promise((h,f)=>{const g=cg("",20);a.port1.start();const b=setTimeout(()=>{f(new Error("unsupported_event"))},i);p={messageChannel:a,onMessage(E){const C=E;if(C.data.eventId===g)switch(C.data.status){case"ack":clearTimeout(b),c=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),h(C.data.response);break;default:clearTimeout(b),clearTimeout(c),f(new Error("invalid_response"));break}}},this.handlers.add(p),a.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:g,data:n},[a.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(){return window}function cD(r){ls().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NE(){return typeof ls().WorkerGlobalScope<"u"&&typeof ls().importScripts=="function"}async function uD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dD(){return navigator?.serviceWorker?.controller||null}function pD(){return NE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="firebaseLocalStorageDb",mD=1,$d="firebaseLocalStorage",UE="fbase_key";class $c{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function pp(r,e){return r.transaction([$d],e?"readwrite":"readonly").objectStore($d)}function hD(){const r=indexedDB.deleteDatabase(OE);return new $c(r).toPromise()}function Sf(){const r=indexedDB.open(OE,mD);return new Promise((e,n)=>{r.addEventListener("error",()=>{n(r.error)}),r.addEventListener("upgradeneeded",()=>{const i=r.result;try{i.createObjectStore($d,{keyPath:UE})}catch(a){n(a)}}),r.addEventListener("success",async()=>{const i=r.result;i.objectStoreNames.contains($d)?e(i):(i.close(),await hD(),e(await Sf()))})})}async function Qw(r,e,n){const i=pp(r,!0).put({[UE]:e,value:n});return new $c(i).toPromise()}async function fD(r,e){const n=pp(r,!1).get(e),i=await new $c(n).toPromise();return i===void 0?null:i.value}function Xw(r,e){const n=pp(r,!0).delete(e);return new $c(n).toPromise()}const gD=800,yD=3;class ME{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Sf(),this.db)}async _withRetries(e){let n=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(n++>yD)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return NE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=dp._getInstance(pD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await uD(),!this.activeServiceWorker)return;this.sender=new lD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Sf();return await Qw(e,Gd,"1"),await Xw(e,Gd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(i=>Qw(i,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(i=>fD(i,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Xw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const c=pp(a,!1).getAll();return new $c(c).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],i=new Set;if(e.length!==0)for(const{fbase_key:a,value:c}of e)i.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(c)&&(this.notifyListeners(a,c),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!i.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ME.type="LOCAL";const vD=ME;new Vc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(r,e){return e?Fs(e):(_e(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug extends og{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return za(e,this._buildIdpRequest())}_linkToIdToken(e,n){return za(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return za(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function bD(r){return IE(r.auth,new ug(r),r.bypassAuthState)}function wD(r){const{auth:e,user:n}=r;return _e(n,e,"internal-error"),Qk(n,new ug(r),r.bypassAuthState)}async function TD(r){const{auth:e,user:n}=r;return _e(n,e,"internal-error"),Yk(n,new ug(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(e,n,i,a,c=!1){this.auth=e,this.resolver=i,this.user=a,this.bypassAuthState=c,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:i,postBody:a,tenantId:c,error:p,type:h}=e;if(p){this.reject(p);return}const f={auth:this.auth,requestUri:n,sessionId:i,tenantId:c||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(f))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bD;case"linkViaPopup":case"linkViaRedirect":return TD;case"reauthViaPopup":case"reauthViaRedirect":return wD;default:wr(this.auth,"internal-error")}}resolve(e){Js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=new Vc(2e3,1e4);async function ED(r,e,n){if(Jn(r.app))return Promise.reject(Ur(r,"operation-not-supported-in-this-environment"));const i=Gi(r);rk(r,e,lg);const a=LE(i,n);return new ko(i,"signInViaPopup",e,a).executeNotNull()}class ko extends qE{constructor(e,n,i,a,c){super(e,n,a,c),this.provider=i,this.authWindow=null,this.pollId=null,ko.currentPopupAction&&ko.currentPopupAction.cancel(),ko.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _e(e,this.auth,"internal-error"),e}async onExecution(){Js(this.filter.length===1,"Popup operations only handle one event");const e=cg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ur(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ur(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ko.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ur(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,SD.get())};e()}}ko.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD="pendingRedirect",Rd=new Map;class _D extends qE{constructor(e,n,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,i),this.eventId=null}async execute(){let e=Rd.get(this.auth._key());if(!e){try{const i=await AD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(n){e=()=>Promise.reject(n)}Rd.set(this.auth._key(),e)}return this.bypassAuthState||Rd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function AD(r,e){const n=RD(e),i=xD(r);if(!await i._isAvailable())return!1;const a=await i._get(n)==="true";return await i._remove(n),a}function ID(r,e){Rd.set(r._key(),e)}function xD(r){return Fs(r._redirectPersistence)}function RD(r){return xd(CD,r.config.apiKey,r.name)}async function kD(r,e,n=!1){if(Jn(r.app))return Promise.reject(Hs(r));const i=Gi(r),a=LE(i,e),p=await new _D(i,a,n).execute();return p&&!n&&(delete p.user._redirectEventId,await i._persistUserIfCurrent(p.user),await i._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD=600*1e3;class PD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(n=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ND(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!jE(e)){const i=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ur(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const i=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DD&&this.cachedEventUids.clear(),this.cachedEventUids.has(Zw(e))}saveEventToCache(e){this.cachedEventUids.add(Zw(e)),this.lastProcessedEventTime=Date.now()}}function Zw(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function jE({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function ND(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jE(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OD(r,e={}){return Hi(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,MD=/^https?/;async function LD(r){if(r.config.emulator)return;const{authorizedDomains:e}=await OD(r);for(const n of e)try{if(qD(n))return}catch{}wr(r,"unauthorized-domain")}function qD(r){const e=bf(),{protocol:n,hostname:i}=new URL(e);if(r.startsWith("chrome-extension://")){const p=new URL(r);return p.hostname===""&&i===""?n==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&p.hostname===i}if(!MD.test(n))return!1;if(UD.test(r))return i===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jD=new Vc(3e4,6e4);function eT(){const r=ls().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let n=0;n<r.CP.length;n++)r.CP[n]=null}}function BD(r){return new Promise((e,n)=>{function i(){eT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eT(),n(Ur(r,"network-request-failed"))},timeout:jD.get()})}if(ls().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ls().gapi?.load)i();else{const a=Pk("iframefcb");return ls()[a]=()=>{gapi.load?i():n(Ur(r,"network-request-failed"))},EE(`${Dk()}?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw kd=null,e})}let kd=null;function zD(r){return kd=kd||BD(r),kd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=new Vc(5e3,15e3),VD="__/auth/iframe",HD="emulator/auth/iframe",GD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$D=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function WD(r){const e=r.config;_e(e.authDomain,r,"auth-domain-config-required");const n=e.emulator?rg(e,HD):`https://${r.config.authDomain}/${VD}`,i={apiKey:e.apiKey,appName:r.name,v:tl},a=$D.get(r.config.apiHost);a&&(i.eid=a);const c=r._getFrameworks();return c.length&&(i.fw=c.join(",")),`${n}?${Fc(i).slice(1)}`}async function KD(r){const e=await zD(r),n=ls().gapi;return _e(n,r,"internal-error"),e.open({where:document.body,url:WD(r),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GD,dontclear:!0},i=>new Promise(async(a,c)=>{await i.restyle({setHideOnLeave:!1});const p=Ur(r,"network-request-failed"),h=ls().setTimeout(()=>{c(p)},FD.get());function f(){ls().clearTimeout(h),a(i)}i.ping(f).then(f,()=>{c(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YD=500,QD=600,XD="_blank",ZD="http://localhost";class tT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eP(r,e,n,i=YD,a=QD){const c=Math.max((window.screen.availHeight-a)/2,0).toString(),p=Math.max((window.screen.availWidth-i)/2,0).toString();let h="";const f={...JD,width:i.toString(),height:a.toString(),top:c,left:p},g=wn().toLowerCase();n&&(h=gE(g)?XD:n),hE(g)&&(e=e||ZD,f.scrollbars="yes");const b=Object.entries(f).reduce((C,[M,z])=>`${C}${M}=${z},`,"");if(Sk(g)&&h!=="_self")return tP(e||"",h),new tT(null);const E=window.open(e||"",h,b);_e(E,r,"popup-blocked");try{E.focus()}catch{}return new tT(E)}function tP(r,e){const n=document.createElement("a");n.href=r,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP="__/auth/handler",rP="emulator/auth/handler",sP=encodeURIComponent("fac");async function nT(r,e,n,i,a,c){_e(r.config.authDomain,r,"auth-domain-config-required"),_e(r.config.apiKey,r,"invalid-api-key");const p={apiKey:r.config.apiKey,appName:r.name,authType:n,redirectUrl:i,v:tl,eventId:a};if(e instanceof lg){e.setDefaultLanguage(r.languageCode),p.providerId=e.providerId||"",Bx(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[b,E]of Object.entries({}))p[b]=E}if(e instanceof Gc){const b=e.getScopes().filter(E=>E!=="");b.length>0&&(p.scopes=b.join(","))}r.tenantId&&(p.tid=r.tenantId);const h=p;for(const b of Object.keys(h))h[b]===void 0&&delete h[b];const f=await r._getAppCheckToken(),g=f?`#${sP}=${encodeURIComponent(f)}`:"";return`${iP(r)}?${Fc(h).slice(1)}${g}`}function iP({config:r}){return r.emulator?rg(r,rP):`https://${r.authDomain}/${nP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh="webStorageSupport";class oP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=PE,this._completeRedirectFn=kD,this._overrideRedirectResult=ID}async _openPopup(e,n,i,a){Js(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const c=await nT(e,n,i,bf(),a);return eP(e,c,cg())}async _openRedirect(e,n,i,a){await this._originValidation(e);const c=await nT(e,n,i,bf(),a);return cD(c),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:c}=this.eventManagers[n];return a?Promise.resolve(a):(Js(c,"If manager is not set, promise should be"),c)}const i=this.initAndGetManager(e);return this.eventManagers[n]={promise:i},i.catch(()=>{delete this.eventManagers[n]}),i}async initAndGetManager(e){const n=await KD(e),i=new PD(e);return n.register("authEvent",a=>(_e(a?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=n,i}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Kh,{type:Kh},a=>{const c=a?.[0]?.[Kh];c!==void 0&&n(!!c),wr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=LD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return TE()||fE()||ig()}}const aP=oP;var rT="@firebase/auth",sT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){_e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function uP(r){ms(new Lr("auth",(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),c=e.getProvider("app-check-internal"),{apiKey:p,authDomain:h}=i.options;_e(p&&!p.includes(":"),"invalid-api-key",{appName:i.name});const f={apiKey:p,authDomain:h,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:SE(r)},g=new xk(i,a,c,f);return qk(g,n),g},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,i)=>{e.getProvider("auth-internal").initialize()})),ms(new Lr("auth-internal",e=>{const n=Gi(e.getProvider("auth").getImmediate());return(i=>new lP(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),vr(rT,sT,cP(r)),vr(rT,sT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=300,pP=JS("authIdTokenMaxAge")||dP;let iT=null;const mP=r=>async e=>{const n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>pP)return;const a=n?.token;iT!==a&&(iT=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function dg(r=eg()){const e=zo(r,"auth");if(e.isInitialized())return e.getImmediate();const n=Lk(r,{popupRedirectResolver:aP,persistence:[vD,oD,PE]}),i=JS("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const c=new URL(i,location.origin);if(location.origin===c.origin){const p=mP(c.toString());nD(n,p,()=>p(n.currentUser)),tD(n,h=>p(h))}}const a=WS("auth");return a&&jk(n,`http://${a}`),n}function hP(){return document.getElementsByTagName("head")?.[0]??document}Rk({loadJS(r){return new Promise((e,n)=>{const i=document.createElement("script");i.setAttribute("src",r),i.onload=e,i.onerror=a=>{const c=Ur("internal-error");c.customData=a,n(c)},i.type="text/javascript",i.charset="UTF-8",hP().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});uP("Browser");var fP="firebase",gP="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vr(fP,gP,"app");var oT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Oi,BE;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(U,_){function A(){}A.prototype=_.prototype,U.D=_.prototype,U.prototype=new A,U.prototype.constructor=U,U.C=function(O,D,q){for(var x=Array(arguments.length-2),At=2;At<arguments.length;At++)x[At-2]=arguments[At];return _.prototype[D].apply(O,x)}}function n(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,n),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(U,_,A){A||(A=0);var O=Array(16);if(typeof _=="string")for(var D=0;16>D;++D)O[D]=_.charCodeAt(A++)|_.charCodeAt(A++)<<8|_.charCodeAt(A++)<<16|_.charCodeAt(A++)<<24;else for(D=0;16>D;++D)O[D]=_[A++]|_[A++]<<8|_[A++]<<16|_[A++]<<24;_=U.g[0],A=U.g[1],D=U.g[2];var q=U.g[3],x=_+(q^A&(D^q))+O[0]+3614090360&4294967295;_=A+(x<<7&4294967295|x>>>25),x=q+(D^_&(A^D))+O[1]+3905402710&4294967295,q=_+(x<<12&4294967295|x>>>20),x=D+(A^q&(_^A))+O[2]+606105819&4294967295,D=q+(x<<17&4294967295|x>>>15),x=A+(_^D&(q^_))+O[3]+3250441966&4294967295,A=D+(x<<22&4294967295|x>>>10),x=_+(q^A&(D^q))+O[4]+4118548399&4294967295,_=A+(x<<7&4294967295|x>>>25),x=q+(D^_&(A^D))+O[5]+1200080426&4294967295,q=_+(x<<12&4294967295|x>>>20),x=D+(A^q&(_^A))+O[6]+2821735955&4294967295,D=q+(x<<17&4294967295|x>>>15),x=A+(_^D&(q^_))+O[7]+4249261313&4294967295,A=D+(x<<22&4294967295|x>>>10),x=_+(q^A&(D^q))+O[8]+1770035416&4294967295,_=A+(x<<7&4294967295|x>>>25),x=q+(D^_&(A^D))+O[9]+2336552879&4294967295,q=_+(x<<12&4294967295|x>>>20),x=D+(A^q&(_^A))+O[10]+4294925233&4294967295,D=q+(x<<17&4294967295|x>>>15),x=A+(_^D&(q^_))+O[11]+2304563134&4294967295,A=D+(x<<22&4294967295|x>>>10),x=_+(q^A&(D^q))+O[12]+1804603682&4294967295,_=A+(x<<7&4294967295|x>>>25),x=q+(D^_&(A^D))+O[13]+4254626195&4294967295,q=_+(x<<12&4294967295|x>>>20),x=D+(A^q&(_^A))+O[14]+2792965006&4294967295,D=q+(x<<17&4294967295|x>>>15),x=A+(_^D&(q^_))+O[15]+1236535329&4294967295,A=D+(x<<22&4294967295|x>>>10),x=_+(D^q&(A^D))+O[1]+4129170786&4294967295,_=A+(x<<5&4294967295|x>>>27),x=q+(A^D&(_^A))+O[6]+3225465664&4294967295,q=_+(x<<9&4294967295|x>>>23),x=D+(_^A&(q^_))+O[11]+643717713&4294967295,D=q+(x<<14&4294967295|x>>>18),x=A+(q^_&(D^q))+O[0]+3921069994&4294967295,A=D+(x<<20&4294967295|x>>>12),x=_+(D^q&(A^D))+O[5]+3593408605&4294967295,_=A+(x<<5&4294967295|x>>>27),x=q+(A^D&(_^A))+O[10]+38016083&4294967295,q=_+(x<<9&4294967295|x>>>23),x=D+(_^A&(q^_))+O[15]+3634488961&4294967295,D=q+(x<<14&4294967295|x>>>18),x=A+(q^_&(D^q))+O[4]+3889429448&4294967295,A=D+(x<<20&4294967295|x>>>12),x=_+(D^q&(A^D))+O[9]+568446438&4294967295,_=A+(x<<5&4294967295|x>>>27),x=q+(A^D&(_^A))+O[14]+3275163606&4294967295,q=_+(x<<9&4294967295|x>>>23),x=D+(_^A&(q^_))+O[3]+4107603335&4294967295,D=q+(x<<14&4294967295|x>>>18),x=A+(q^_&(D^q))+O[8]+1163531501&4294967295,A=D+(x<<20&4294967295|x>>>12),x=_+(D^q&(A^D))+O[13]+2850285829&4294967295,_=A+(x<<5&4294967295|x>>>27),x=q+(A^D&(_^A))+O[2]+4243563512&4294967295,q=_+(x<<9&4294967295|x>>>23),x=D+(_^A&(q^_))+O[7]+1735328473&4294967295,D=q+(x<<14&4294967295|x>>>18),x=A+(q^_&(D^q))+O[12]+2368359562&4294967295,A=D+(x<<20&4294967295|x>>>12),x=_+(A^D^q)+O[5]+4294588738&4294967295,_=A+(x<<4&4294967295|x>>>28),x=q+(_^A^D)+O[8]+2272392833&4294967295,q=_+(x<<11&4294967295|x>>>21),x=D+(q^_^A)+O[11]+1839030562&4294967295,D=q+(x<<16&4294967295|x>>>16),x=A+(D^q^_)+O[14]+4259657740&4294967295,A=D+(x<<23&4294967295|x>>>9),x=_+(A^D^q)+O[1]+2763975236&4294967295,_=A+(x<<4&4294967295|x>>>28),x=q+(_^A^D)+O[4]+1272893353&4294967295,q=_+(x<<11&4294967295|x>>>21),x=D+(q^_^A)+O[7]+4139469664&4294967295,D=q+(x<<16&4294967295|x>>>16),x=A+(D^q^_)+O[10]+3200236656&4294967295,A=D+(x<<23&4294967295|x>>>9),x=_+(A^D^q)+O[13]+681279174&4294967295,_=A+(x<<4&4294967295|x>>>28),x=q+(_^A^D)+O[0]+3936430074&4294967295,q=_+(x<<11&4294967295|x>>>21),x=D+(q^_^A)+O[3]+3572445317&4294967295,D=q+(x<<16&4294967295|x>>>16),x=A+(D^q^_)+O[6]+76029189&4294967295,A=D+(x<<23&4294967295|x>>>9),x=_+(A^D^q)+O[9]+3654602809&4294967295,_=A+(x<<4&4294967295|x>>>28),x=q+(_^A^D)+O[12]+3873151461&4294967295,q=_+(x<<11&4294967295|x>>>21),x=D+(q^_^A)+O[15]+530742520&4294967295,D=q+(x<<16&4294967295|x>>>16),x=A+(D^q^_)+O[2]+3299628645&4294967295,A=D+(x<<23&4294967295|x>>>9),x=_+(D^(A|~q))+O[0]+4096336452&4294967295,_=A+(x<<6&4294967295|x>>>26),x=q+(A^(_|~D))+O[7]+1126891415&4294967295,q=_+(x<<10&4294967295|x>>>22),x=D+(_^(q|~A))+O[14]+2878612391&4294967295,D=q+(x<<15&4294967295|x>>>17),x=A+(q^(D|~_))+O[5]+4237533241&4294967295,A=D+(x<<21&4294967295|x>>>11),x=_+(D^(A|~q))+O[12]+1700485571&4294967295,_=A+(x<<6&4294967295|x>>>26),x=q+(A^(_|~D))+O[3]+2399980690&4294967295,q=_+(x<<10&4294967295|x>>>22),x=D+(_^(q|~A))+O[10]+4293915773&4294967295,D=q+(x<<15&4294967295|x>>>17),x=A+(q^(D|~_))+O[1]+2240044497&4294967295,A=D+(x<<21&4294967295|x>>>11),x=_+(D^(A|~q))+O[8]+1873313359&4294967295,_=A+(x<<6&4294967295|x>>>26),x=q+(A^(_|~D))+O[15]+4264355552&4294967295,q=_+(x<<10&4294967295|x>>>22),x=D+(_^(q|~A))+O[6]+2734768916&4294967295,D=q+(x<<15&4294967295|x>>>17),x=A+(q^(D|~_))+O[13]+1309151649&4294967295,A=D+(x<<21&4294967295|x>>>11),x=_+(D^(A|~q))+O[4]+4149444226&4294967295,_=A+(x<<6&4294967295|x>>>26),x=q+(A^(_|~D))+O[11]+3174756917&4294967295,q=_+(x<<10&4294967295|x>>>22),x=D+(_^(q|~A))+O[2]+718787259&4294967295,D=q+(x<<15&4294967295|x>>>17),x=A+(q^(D|~_))+O[9]+3951481745&4294967295,U.g[0]=U.g[0]+_&4294967295,U.g[1]=U.g[1]+(D+(x<<21&4294967295|x>>>11))&4294967295,U.g[2]=U.g[2]+D&4294967295,U.g[3]=U.g[3]+q&4294967295}i.prototype.u=function(U,_){_===void 0&&(_=U.length);for(var A=_-this.blockSize,O=this.B,D=this.h,q=0;q<_;){if(D==0)for(;q<=A;)a(this,U,q),q+=this.blockSize;if(typeof U=="string"){for(;q<_;)if(O[D++]=U.charCodeAt(q++),D==this.blockSize){a(this,O),D=0;break}}else for(;q<_;)if(O[D++]=U[q++],D==this.blockSize){a(this,O),D=0;break}}this.h=D,this.o+=_},i.prototype.v=function(){var U=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);U[0]=128;for(var _=1;_<U.length-8;++_)U[_]=0;var A=8*this.o;for(_=U.length-8;_<U.length;++_)U[_]=A&255,A/=256;for(this.u(U),U=Array(16),_=A=0;4>_;++_)for(var O=0;32>O;O+=8)U[A++]=this.g[_]>>>O&255;return U};function c(U,_){var A=h;return Object.prototype.hasOwnProperty.call(A,U)?A[U]:A[U]=_(U)}function p(U,_){this.h=_;for(var A=[],O=!0,D=U.length-1;0<=D;D--){var q=U[D]|0;O&&q==_||(A[D]=q,O=!1)}this.g=A}var h={};function f(U){return-128<=U&&128>U?c(U,function(_){return new p([_|0],0>_?-1:0)}):new p([U|0],0>U?-1:0)}function g(U){if(isNaN(U)||!isFinite(U))return E;if(0>U)return $(g(-U));for(var _=[],A=1,O=0;U>=A;O++)_[O]=U/A|0,A*=4294967296;return new p(_,0)}function b(U,_){if(U.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(U.charAt(0)=="-")return $(b(U.substring(1),_));if(0<=U.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=g(Math.pow(_,8)),O=E,D=0;D<U.length;D+=8){var q=Math.min(8,U.length-D),x=parseInt(U.substring(D,D+q),_);8>q?(q=g(Math.pow(_,q)),O=O.j(q).add(g(x))):(O=O.j(A),O=O.add(g(x)))}return O}var E=f(0),C=f(1),M=f(16777216);r=p.prototype,r.m=function(){if(Q(this))return-$(this).m();for(var U=0,_=1,A=0;A<this.g.length;A++){var O=this.i(A);U+=(0<=O?O:4294967296+O)*_,_*=4294967296}return U},r.toString=function(U){if(U=U||10,2>U||36<U)throw Error("radix out of range: "+U);if(z(this))return"0";if(Q(this))return"-"+$(this).toString(U);for(var _=g(Math.pow(U,6)),A=this,O="";;){var D=ve(A,_).g;A=ie(A,D.j(_));var q=((0<A.g.length?A.g[0]:A.h)>>>0).toString(U);if(A=D,z(A))return q+O;for(;6>q.length;)q="0"+q;O=q+O}},r.i=function(U){return 0>U?0:U<this.g.length?this.g[U]:this.h};function z(U){if(U.h!=0)return!1;for(var _=0;_<U.g.length;_++)if(U.g[_]!=0)return!1;return!0}function Q(U){return U.h==-1}r.l=function(U){return U=ie(this,U),Q(U)?-1:z(U)?0:1};function $(U){for(var _=U.g.length,A=[],O=0;O<_;O++)A[O]=~U.g[O];return new p(A,~U.h).add(C)}r.abs=function(){return Q(this)?$(this):this},r.add=function(U){for(var _=Math.max(this.g.length,U.g.length),A=[],O=0,D=0;D<=_;D++){var q=O+(this.i(D)&65535)+(U.i(D)&65535),x=(q>>>16)+(this.i(D)>>>16)+(U.i(D)>>>16);O=x>>>16,q&=65535,x&=65535,A[D]=x<<16|q}return new p(A,A[A.length-1]&-2147483648?-1:0)};function ie(U,_){return U.add($(_))}r.j=function(U){if(z(this)||z(U))return E;if(Q(this))return Q(U)?$(this).j($(U)):$($(this).j(U));if(Q(U))return $(this.j($(U)));if(0>this.l(M)&&0>U.l(M))return g(this.m()*U.m());for(var _=this.g.length+U.g.length,A=[],O=0;O<2*_;O++)A[O]=0;for(O=0;O<this.g.length;O++)for(var D=0;D<U.g.length;D++){var q=this.i(O)>>>16,x=this.i(O)&65535,At=U.i(D)>>>16,pt=U.i(D)&65535;A[2*O+2*D]+=x*pt,re(A,2*O+2*D),A[2*O+2*D+1]+=q*pt,re(A,2*O+2*D+1),A[2*O+2*D+1]+=x*At,re(A,2*O+2*D+1),A[2*O+2*D+2]+=q*At,re(A,2*O+2*D+2)}for(O=0;O<_;O++)A[O]=A[2*O+1]<<16|A[2*O];for(O=_;O<2*_;O++)A[O]=0;return new p(A,0)};function re(U,_){for(;(U[_]&65535)!=U[_];)U[_+1]+=U[_]>>>16,U[_]&=65535,_++}function ae(U,_){this.g=U,this.h=_}function ve(U,_){if(z(_))throw Error("division by zero");if(z(U))return new ae(E,E);if(Q(U))return _=ve($(U),_),new ae($(_.g),$(_.h));if(Q(_))return _=ve(U,$(_)),new ae($(_.g),_.h);if(30<U.g.length){if(Q(U)||Q(_))throw Error("slowDivide_ only works with positive integers.");for(var A=C,O=_;0>=O.l(U);)A=he(A),O=he(O);var D=De(A,1),q=De(O,1);for(O=De(O,2),A=De(A,2);!z(O);){var x=q.add(O);0>=x.l(U)&&(D=D.add(A),q=x),O=De(O,1),A=De(A,1)}return _=ie(U,D.j(_)),new ae(D,_)}for(D=E;0<=U.l(_);){for(A=Math.max(1,Math.floor(U.m()/_.m())),O=Math.ceil(Math.log(A)/Math.LN2),O=48>=O?1:Math.pow(2,O-48),q=g(A),x=q.j(_);Q(x)||0<x.l(U);)A-=O,q=g(A),x=q.j(_);z(q)&&(q=C),D=D.add(q),U=ie(U,x)}return new ae(D,U)}r.A=function(U){return ve(this,U).h},r.and=function(U){for(var _=Math.max(this.g.length,U.g.length),A=[],O=0;O<_;O++)A[O]=this.i(O)&U.i(O);return new p(A,this.h&U.h)},r.or=function(U){for(var _=Math.max(this.g.length,U.g.length),A=[],O=0;O<_;O++)A[O]=this.i(O)|U.i(O);return new p(A,this.h|U.h)},r.xor=function(U){for(var _=Math.max(this.g.length,U.g.length),A=[],O=0;O<_;O++)A[O]=this.i(O)^U.i(O);return new p(A,this.h^U.h)};function he(U){for(var _=U.g.length+1,A=[],O=0;O<_;O++)A[O]=U.i(O)<<1|U.i(O-1)>>>31;return new p(A,U.h)}function De(U,_){var A=_>>5;_%=32;for(var O=U.g.length-A,D=[],q=0;q<O;q++)D[q]=0<_?U.i(q+A)>>>_|U.i(q+A+1)<<32-_:U.i(q+A);return new p(D,U.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,BE=i,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=g,p.fromString=b,Oi=p}).apply(typeof oT<"u"?oT:typeof self<"u"?self:typeof window<"u"?window:{});var vd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zE,vc,FE,Dd,Ef,VE,HE,GE;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,y,v){return u==Array.prototype||u==Object.prototype||(u[y]=v.value),u};function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof vd=="object"&&vd];for(var y=0;y<u.length;++y){var v=u[y];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var i=n(this);function a(u,y){if(y)e:{var v=i;u=u.split(".");for(var S=0;S<u.length-1;S++){var j=u[S];if(!(j in v))break e;v=v[j]}u=u[u.length-1],S=v[u],y=y(S),y!=S&&y!=null&&e(v,u,{configurable:!0,writable:!0,value:y})}}function c(u,y){u instanceof String&&(u+="");var v=0,S=!1,j={next:function(){if(!S&&v<u.length){var W=v++;return{value:y(W,u[W]),done:!1}}return S=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}a("Array.prototype.values",function(u){return u||function(){return c(this,function(y,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},h=this||self;function f(u){var y=typeof u;return y=y!="object"?y:u?Array.isArray(u)?"array":y:"null",y=="array"||y=="object"&&typeof u.length=="number"}function g(u){var y=typeof u;return y=="object"&&u!=null||y=="function"}function b(u,y,v){return u.call.apply(u.bind,arguments)}function E(u,y,v){if(!u)throw Error();if(2<arguments.length){var S=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,S),u.apply(y,j)}}return function(){return u.apply(y,arguments)}}function C(u,y,v){return C=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?b:E,C.apply(null,arguments)}function M(u,y){var v=Array.prototype.slice.call(arguments,1);return function(){var S=v.slice();return S.push.apply(S,arguments),u.apply(this,S)}}function z(u,y){function v(){}v.prototype=y.prototype,u.aa=y.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(S,j,W){for(var oe=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)oe[ze-2]=arguments[ze];return y.prototype[j].apply(S,oe)}}function Q(u){const y=u.length;if(0<y){const v=Array(y);for(let S=0;S<y;S++)v[S]=u[S];return v}return[]}function $(u,y){for(let v=1;v<arguments.length;v++){const S=arguments[v];if(f(S)){const j=u.length||0,W=S.length||0;u.length=j+W;for(let oe=0;oe<W;oe++)u[j+oe]=S[oe]}else u.push(S)}}class ie{constructor(y,v){this.i=y,this.j=v,this.h=0,this.g=null}get(){let y;return 0<this.h?(this.h--,y=this.g,this.g=y.next,y.next=null):y=this.i(),y}}function re(u){return/^[\s\xa0]*$/.test(u)}function ae(){var u=h.navigator;return u&&(u=u.userAgent)?u:""}function ve(u){return ve[" "](u),u}ve[" "]=function(){};var he=ae().indexOf("Gecko")!=-1&&!(ae().toLowerCase().indexOf("webkit")!=-1&&ae().indexOf("Edge")==-1)&&!(ae().indexOf("Trident")!=-1||ae().indexOf("MSIE")!=-1)&&ae().indexOf("Edge")==-1;function De(u,y,v){for(const S in u)y.call(v,u[S],S,u)}function U(u,y){for(const v in u)y.call(void 0,u[v],v,u)}function _(u){const y={};for(const v in u)y[v]=u[v];return y}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(u,y){let v,S;for(let j=1;j<arguments.length;j++){S=arguments[j];for(v in S)u[v]=S[v];for(let W=0;W<A.length;W++)v=A[W],Object.prototype.hasOwnProperty.call(S,v)&&(u[v]=S[v])}}function D(u){var y=1;u=u.split(":");const v=[];for(;0<y&&u.length;)v.push(u.shift()),y--;return u.length&&v.push(u.join(":")),v}function q(u){h.setTimeout(()=>{throw u},0)}function x(){var u=Ge;let y=null;return u.g&&(y=u.g,u.g=u.g.next,u.g||(u.h=null),y.next=null),y}class At{constructor(){this.h=this.g=null}add(y,v){const S=pt.get();S.set(y,v),this.h?this.h.next=S:this.g=S,this.h=S}}var pt=new ie(()=>new K,u=>u.reset());class K{constructor(){this.next=this.g=this.h=null}set(y,v){this.h=y,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let le,ye=!1,Ge=new At,k=()=>{const u=h.Promise.resolve(void 0);le=()=>{u.then(J)}};var J=()=>{for(var u;u=x();){try{u.h.call(u.g)}catch(v){q(v)}var y=pt;y.j(u),100>y.h&&(y.h++,u.next=y.g,y.g=u)}ye=!1};function ce(){this.s=this.s,this.C=this.C}ce.prototype.s=!1,ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ne(u,y){this.type=u,this.g=this.target=y,this.defaultPrevented=!1}ne.prototype.h=function(){this.defaultPrevented=!0};var we=(function(){if(!h.addEventListener||!Object.defineProperty)return!1;var u=!1,y=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};h.addEventListener("test",v,y),h.removeEventListener("test",v,y)}catch{}return u})();function ge(u,y){if(ne.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,S=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=y,y=u.relatedTarget){if(he){e:{try{ve(y.nodeName);var j=!0;break e}catch{}j=!1}j||(y=null)}}else v=="mouseover"?y=u.fromElement:v=="mouseout"&&(y=u.toElement);this.relatedTarget=y,S?(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Se[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&ge.aa.h.call(this)}}z(ge,ne);var Se={2:"touch",3:"pen",4:"mouse"};ge.prototype.h=function(){ge.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Tt="closure_listenable_"+(1e6*Math.random()|0),Qe=0;function Dn(u,y,v,S,j){this.listener=u,this.proxy=null,this.src=y,this.type=v,this.capture=!!S,this.ha=j,this.key=++Qe,this.da=this.fa=!1}function Sr(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Xn(u){this.src=u,this.g={},this.h=0}Xn.prototype.add=function(u,y,v,S,j){var W=u.toString();u=this.g[W],u||(u=this.g[W]=[],this.h++);var oe=Zn(u,y,S,j);return-1<oe?(y=u[oe],v||(y.fa=!1)):(y=new Dn(y,this.src,W,!!S,j),y.fa=v,u.push(y)),y};function Pn(u,y){var v=y.type;if(v in u.g){var S=u.g[v],j=Array.prototype.indexOf.call(S,y,void 0),W;(W=0<=j)&&Array.prototype.splice.call(S,j,1),W&&(Sr(y),u.g[v].length==0&&(delete u.g[v],u.h--))}}function Zn(u,y,v,S){for(var j=0;j<u.length;++j){var W=u[j];if(!W.da&&W.listener==y&&W.capture==!!v&&W.ha==S)return j}return-1}var Tn="closure_lm_"+(1e6*Math.random()|0),gs={};function Xs(u,y,v,S,j){if(Array.isArray(y)){for(var W=0;W<y.length;W++)Xs(u,y[W],v,S,j);return null}return v=Cr(v),u&&u[Tt]?u.K(y,v,g(S)?!!S.capture:!1,j):jt(u,y,v,!1,S,j)}function jt(u,y,v,S,j,W){if(!y)throw Error("Invalid event type");var oe=g(j)?!!j.capture:!!j,ze=Hr(u);if(ze||(u[Tn]=ze=new Xn(u)),v=ze.add(y,v,S,oe,W),v.proxy)return v;if(S=Zs(),v.proxy=S,S.src=u,S.listener=v,u.addEventListener)we||(j=oe),j===void 0&&(j=!1),u.addEventListener(y.toString(),S,j);else if(u.attachEvent)u.attachEvent(Vr(y.toString()),S);else if(u.addListener&&u.removeListener)u.addListener(S);else throw Error("addEventListener and attachEvent are unavailable.");return v}function Zs(){function u(v){return y.call(u.src,u.listener,v)}const y=cl;return u}function Fr(u,y,v,S,j){if(Array.isArray(y))for(var W=0;W<y.length;W++)Fr(u,y[W],v,S,j);else S=g(S)?!!S.capture:!!S,v=Cr(v),u&&u[Tt]?(u=u.i,y=String(y).toString(),y in u.g&&(W=u.g[y],v=Zn(W,v,S,j),-1<v&&(Sr(W[v]),Array.prototype.splice.call(W,v,1),W.length==0&&(delete u.g[y],u.h--)))):u&&(u=Hr(u))&&(y=u.g[y.toString()],u=-1,y&&(u=Zn(y,v,S,j)),(v=-1<u?y[u]:null)&&ys(v))}function ys(u){if(typeof u!="number"&&u&&!u.da){var y=u.src;if(y&&y[Tt])Pn(y.i,u);else{var v=u.type,S=u.proxy;y.removeEventListener?y.removeEventListener(v,S,u.capture):y.detachEvent?y.detachEvent(Vr(v),S):y.addListener&&y.removeListener&&y.removeListener(S),(v=Hr(y))?(Pn(v,u),v.h==0&&(v.src=null,y[Tn]=null)):Sr(u)}}}function Vr(u){return u in gs?gs[u]:gs[u]="on"+u}function cl(u,y){if(u.da)u=!0;else{y=new ge(y,this);var v=u.listener,S=u.ha||u.src;u.fa&&ys(u),u=v.call(S,y)}return u}function Hr(u){return u=u[Tn],u instanceof Xn?u:null}var Er="__closure_events_fn_"+(1e9*Math.random()>>>0);function Cr(u){return typeof u=="function"?u:(u[Er]||(u[Er]=function(y){return u.handleEvent(y)}),u[Er])}function Xe(){ce.call(this),this.i=new Xn(this),this.M=this,this.F=null}z(Xe,ce),Xe.prototype[Tt]=!0,Xe.prototype.removeEventListener=function(u,y,v,S){Fr(this,u,y,v,S)};function $e(u,y){var v,S=u.F;if(S)for(v=[];S;S=S.F)v.push(S);if(u=u.M,S=y.type||y,typeof y=="string")y=new ne(y,u);else if(y instanceof ne)y.target=y.target||u;else{var j=y;y=new ne(S,u),O(y,j)}if(j=!0,v)for(var W=v.length-1;0<=W;W--){var oe=y.g=v[W];j=mn(oe,S,!0,y)&&j}if(oe=y.g=u,j=mn(oe,S,!0,y)&&j,j=mn(oe,S,!1,y)&&j,v)for(W=0;W<v.length;W++)oe=y.g=v[W],j=mn(oe,S,!1,y)&&j}Xe.prototype.N=function(){if(Xe.aa.N.call(this),this.i){var u=this.i,y;for(y in u.g){for(var v=u.g[y],S=0;S<v.length;S++)Sr(v[S]);delete u.g[y],u.h--}}this.F=null},Xe.prototype.K=function(u,y,v,S){return this.i.add(String(u),y,!1,v,S)},Xe.prototype.L=function(u,y,v,S){return this.i.add(String(u),y,!0,v,S)};function mn(u,y,v,S){if(y=u.i.g[String(y)],!y)return!0;y=y.concat();for(var j=!0,W=0;W<y.length;++W){var oe=y[W];if(oe&&!oe.da&&oe.capture==v){var ze=oe.listener,Ft=oe.ha||oe.src;oe.fa&&Pn(u.i,oe),j=ze.call(Ft,S)!==!1&&j}}return j&&!S.defaultPrevented}function Bt(u,y,v){if(typeof u=="function")v&&(u=C(u,v));else if(u&&typeof u.handleEvent=="function")u=C(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(y)?-1:h.setTimeout(u,y||0)}function ei(u){u.g=Bt(()=>{u.g=null,u.i&&(u.i=!1,ei(u))},u.l);const y=u.h;u.h=null,u.m.apply(null,y)}class Go extends ce{constructor(y,v){super(),this.m=y,this.l=v,this.h=null,this.i=!1,this.g=null}j(y){this.h=arguments,this.g?this.i=!0:ei(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function er(u){ce.call(this),this.h=u,this.g={}}z(er,ce);var tr=[];function sn(u){De(u.g,function(y,v){this.g.hasOwnProperty(v)&&ys(y)},u),u.g={}}er.prototype.N=function(){er.aa.N.call(this),sn(this)},er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Kt=h.JSON.stringify,Gr=h.JSON.parse,_r=class{stringify(u){return h.JSON.stringify(u,void 0)}parse(u){return h.JSON.parse(u,void 0)}};function Qi(){}Qi.prototype.h=null;function $r(u){return u.h||(u.h=u.i())}function Wr(){}var Ar={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Sn(){ne.call(this,"d")}z(Sn,ne);function Xi(){ne.call(this,"c")}z(Xi,ne);var nr={},mt=null;function En(){return mt=mt||new Xe}nr.La="serverreachability";function ti(u){ne.call(this,nr.La,u)}z(ti,ne);function Ir(u){const y=En();$e(y,new ti(y))}nr.STAT_EVENT="statevent";function ni(u,y){ne.call(this,nr.STAT_EVENT,u),this.stat=y}z(ni,ne);function ot(u){const y=En();$e(y,new ni(y,u))}nr.Ma="timingevent";function St(u,y){ne.call(this,nr.Ma,u),this.size=y}z(St,ne);function Et(u,y){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){u()},y)}function yt(){this.g=!0}yt.prototype.xa=function(){this.g=!1};function rr(u,y,v,S,j,W){u.info(function(){if(u.g)if(W)for(var oe="",ze=W.split("&"),Ft=0;Ft<ze.length;Ft++){var Fe=ze[Ft].split("=");if(1<Fe.length){var Zt=Fe[0];Fe=Fe[1];var Vt=Zt.split("_");oe=2<=Vt.length&&Vt[1]=="type"?oe+(Zt+"="+Fe+"&"):oe+(Zt+"=redacted&")}}else oe=null;else oe=W;return"XMLHTTP REQ ("+S+") [attempt "+j+"]: "+y+`
`+v+`
`+oe})}function $o(u,y,v,S,j,W,oe){u.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+j+"]: "+y+`
`+v+`
`+W+" "+oe})}function xr(u,y,v,S){u.info(function(){return"XMLHTTP TEXT ("+y+"): "+Kr(u,v)+(S?" "+S:"")})}function ri(u,y){u.info(function(){return"TIMEOUT: "+y})}yt.prototype.info=function(){};function Kr(u,y){if(!u.g)return y;if(!y)return null;try{var v=JSON.parse(y);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var S=v[u];if(!(2>S.length)){var j=S[1];if(Array.isArray(j)&&!(1>j.length)){var W=j[0];if(W!="noop"&&W!="stop"&&W!="close")for(var oe=1;oe<j.length;oe++)j[oe]=""}}}}return Kt(v)}catch{return y}}var Jt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},jn;function Bn(){}z(Bn,Qi),Bn.prototype.g=function(){return new XMLHttpRequest},Bn.prototype.i=function(){return{}},jn=new Bn;function Yt(u,y,v,S){this.j=u,this.i=y,this.l=v,this.R=S||1,this.U=new er(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new vt}function vt(){this.i=null,this.g="",this.h=!1}var fe={},N={};function se(u,y,v){u.L=1,u.v=no(zn(y)),u.m=v,u.P=!0,de(u,null)}function de(u,y){u.F=Date.now(),at(u),u.A=zn(u.v);var v=u.A,S=u.R;Array.isArray(S)||(S=[String(S)]),fl(v.i,"t",S),u.C=0,v=u.j.J,u.h=new vt,u.g=pu(u.j,v?y:null,!u.m),0<u.O&&(u.M=new Go(C(u.Y,u,u.g),u.O)),y=u.U,v=u.g,S=u.ca;var j="readystatechange";Array.isArray(j)||(j&&(tr[0]=j.toString()),j=tr);for(var W=0;W<j.length;W++){var oe=Xs(v,j[W],S||y.handleEvent,!1,y.h||y);if(!oe)break;y.g[oe.key]=oe}y=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),y["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,y)):(u.u="GET",u.g.ea(u.A,u.u,null,y)),Ir(),rr(u.i,u.u,u.A,u.l,u.R,u.m)}Yt.prototype.ca=function(u){u=u.target;const y=this.M;y&&cr(u)==3?y.j():this.Y(u)},Yt.prototype.Y=function(u){try{if(u==this.g)e:{const Vt=cr(this.g);var y=this.g.Ba();const Cs=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||su(this.g)))){this.J||Vt!=4||y==7||(y==8||0>=Cs?Ir(3):Ir(2)),Qt(this);var v=this.g.Z();this.X=v;t:if(Ze(this)){var S=su(this.g);u="";var j=S.length,W=cr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){xt(this),hn(this);var oe="";break t}this.h.i=new h.TextDecoder}for(y=0;y<j;y++)this.h.h=!0,u+=this.h.i.decode(S[y],{stream:!(W&&y==j-1)});S.length=0,this.h.g+=u,this.C=0,oe=this.h.g}else oe=this.g.oa();if(this.o=v==200,$o(this.i,this.u,this.A,this.l,this.R,Vt,v),this.o){if(this.T&&!this.K){t:{if(this.g){var ze,Ft=this.g;if((ze=Ft.g?Ft.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!re(ze)){var Fe=ze;break t}}Fe=null}if(v=Fe)xr(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ht(this,v);else{this.o=!1,this.s=3,ot(12),xt(this),hn(this);break e}}if(this.P){v=!0;let on;for(;!this.J&&this.C<oe.length;)if(on=It(this,oe),on==N){Vt==4&&(this.s=4,ot(14),v=!1),xr(this.i,this.l,null,"[Incomplete Response]");break}else if(on==fe){this.s=4,ot(15),xr(this.i,this.l,oe,"[Invalid Chunk]"),v=!1;break}else xr(this.i,this.l,on,null),ht(this,on);if(Ze(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||oe.length!=0||this.h.h||(this.s=1,ot(16),v=!1),this.o=this.o&&v,!v)xr(this.i,this.l,oe,"[Invalid Chunked Response]"),xt(this),hn(this);else if(0<oe.length&&!this.W){this.W=!0;var Zt=this.j;Zt.g==this&&Zt.ba&&!Zt.M&&(Zt.j.info("Great, no buffering proxy detected. Bytes received: "+oe.length),uo(Zt),Zt.M=!0,ot(11))}}else xr(this.i,this.l,oe,null),ht(this,oe);Vt==4&&xt(this),this.o&&!this.J&&(Vt==4?cu(this.j,this):(this.o=!1,at(this)))}else Fp(this.g),v==400&&0<oe.indexOf("Unknown SID")?(this.s=3,ot(12)):(this.s=0,ot(13)),xt(this),hn(this)}}}catch{}finally{}};function Ze(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function It(u,y){var v=u.C,S=y.indexOf(`
`,v);return S==-1?N:(v=Number(y.substring(v,S)),isNaN(v)?fe:(S+=1,S+v>y.length?N:(y=y.slice(S,S+v),u.C=S+v,y)))}Yt.prototype.cancel=function(){this.J=!0,xt(this)};function at(u){u.S=Date.now()+u.I,zt(u,u.I)}function zt(u,y){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Et(C(u.ba,u),y)}function Qt(u){u.B&&(h.clearTimeout(u.B),u.B=null)}Yt.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(ri(this.i,this.A),this.L!=2&&(Ir(),ot(17)),xt(this),this.s=2,hn(this)):zt(this,this.S-u)};function hn(u){u.j.G==0||u.J||cu(u.j,u)}function xt(u){Qt(u);var y=u.M;y&&typeof y.ma=="function"&&y.ma(),u.M=null,sn(u.U),u.g&&(y=u.g,u.g=null,y.abort(),y.ma())}function ht(u,y){try{var v=u.j;if(v.G!=0&&(v.g==u||ul(v.h,u))){if(!u.K&&ul(v.h,u)&&v.G==3){try{var S=v.Da.g.parse(y)}catch{S=null}if(Array.isArray(S)&&S.length==3){var j=S;if(j[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)sa(v),na(v);else break e;wl(v),ot(18)}}else v.za=j[1],0<v.za-v.T&&37500>j[2]&&v.F&&v.v==0&&!v.C&&(v.C=Et(C(v.Za,v),6e3));if(1>=Ko(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else Es(v,11)}else if((u.K||v.g==u)&&sa(v),!re(y))for(j=v.Da.g.parse(y),y=0;y<j.length;y++){let Fe=j[y];if(v.T=Fe[0],Fe=Fe[1],v.G==2)if(Fe[0]=="c"){v.K=Fe[1],v.ia=Fe[2];const Zt=Fe[3];Zt!=null&&(v.la=Zt,v.j.info("VER="+v.la));const Vt=Fe[4];Vt!=null&&(v.Aa=Vt,v.j.info("SVER="+v.Aa));const Cs=Fe[5];Cs!=null&&typeof Cs=="number"&&0<Cs&&(S=1.5*Cs,v.L=S,v.j.info("backChannelRequestTimeoutMs_="+S)),S=v;const on=u.g;if(on){const ts=on.g?on.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ts){var W=S.h;W.g||ts.indexOf("spdy")==-1&&ts.indexOf("quic")==-1&&ts.indexOf("h2")==-1||(W.j=W.l,W.g=new Set,W.h&&(Jo(W,W.h),W.h=null))}if(S.D){const Sl=on.g?on.g.getResponseHeader("X-HTTP-Session-Id"):null;Sl&&(S.ya=Sl,nt(S.I,S.D,Sl))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),S=v;var oe=u;if(S.qa=du(S,S.J?S.ia:null,S.W),oe.K){Cn(S.h,oe);var ze=oe,Ft=S.L;Ft&&(ze.I=Ft),ze.B&&(Qt(ze),at(ze)),S.g=oe}else au(S);0<v.i.length&&ra(v)}else Fe[0]!="stop"&&Fe[0]!="close"||Es(v,7);else v.G==3&&(Fe[0]=="stop"||Fe[0]=="close"?Fe[0]=="stop"?Es(v,7):vl(v):Fe[0]!="noop"&&v.l&&v.l.ta(Fe),v.v=0)}}Ir(4)}catch{}}var Zi=class{constructor(u,y){this.g=u,this.map=y}};function ir(u){this.l=u||10,h.PerformanceNavigationTiming?(u=h.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Wo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Ko(u){return u.h?1:u.g?u.g.size:0}function ul(u,y){return u.h?u.h==y:u.g?u.g.has(y):!1}function Jo(u,y){u.g?u.g.add(y):u.h=y}function Cn(u,y){u.h&&u.h==y?u.h=null:u.g&&u.g.has(y)&&u.g.delete(y)}ir.prototype.cancel=function(){if(this.i=dl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function dl(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let y=u.i;for(const v of u.g.values())y=y.concat(v.D);return y}return Q(u.i)}function qp(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(f(u)){for(var y=[],v=u.length,S=0;S<v;S++)y.push(u[S]);return y}y=[],v=0;for(S in u)y[v++]=u[S];return y}function Yo(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||typeof u=="string"){var y=[];u=u.length;for(var v=0;v<u;v++)y.push(v);return y}y=[],v=0;for(const S in u)y[v++]=S;return y}}}function pl(u,y){if(u.forEach&&typeof u.forEach=="function")u.forEach(y,void 0);else if(f(u)||typeof u=="string")Array.prototype.forEach.call(u,y,void 0);else for(var v=Yo(u),S=qp(u),j=S.length,W=0;W<j;W++)y.call(void 0,S[W],v&&v[W],u)}var eo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jp(u,y){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var S=u[v].indexOf("="),j=null;if(0<=S){var W=u[v].substring(0,S);j=u[v].substring(S+1)}else W=u[v];y(W,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function Nt(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Nt){this.h=u.h,to(this,u.j),this.o=u.o,this.g=u.g,si(this,u.s),this.l=u.l;var y=u.i,v=new bs;v.i=y.i,y.g&&(v.g=new Map(y.g),v.h=y.h),vs(this,v),this.m=u.m}else u&&(y=String(u).match(eo))?(this.h=!1,to(this,y[1]||"",!0),this.o=or(y[2]||""),this.g=or(y[3]||"",!0),si(this,y[4]),this.l=or(y[5]||"",!0),vs(this,y[6]||"",!0),this.m=or(y[7]||"")):(this.h=!1,this.i=new bs(null,this.h))}Nt.prototype.toString=function(){var u=[],y=this.j;y&&u.push(ro(y,ml,!0),":");var v=this.g;return(v||y=="file")&&(u.push("//"),(y=this.o)&&u.push(ro(y,ml,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(ro(v,v.charAt(0)=="/"?Bp:hl,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",ro(v,Qo)),u.join("")};function zn(u){return new Nt(u)}function to(u,y,v){u.j=v?or(y,!0):y,u.j&&(u.j=u.j.replace(/:$/,""))}function si(u,y){if(y){if(y=Number(y),isNaN(y)||0>y)throw Error("Bad port number "+y);u.s=y}else u.s=null}function vs(u,y,v){y instanceof bs?(u.i=y,nu(u.i,u.h)):(v||(y=ro(y,zp)),u.i=new bs(y,u.h))}function nt(u,y,v){u.i.set(y,v)}function no(u){return nt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function or(u,y){return u?y?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ro(u,y,v){return typeof u=="string"?(u=encodeURI(u).replace(y,tu),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function tu(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var ml=/[#\/\?@]/g,hl=/[#\?:]/g,Bp=/[#\?]/g,zp=/[#\?@]/g,Qo=/#/g;function bs(u,y){this.h=this.g=null,this.i=u||null,this.j=!!y}function ar(u){u.g||(u.g=new Map,u.h=0,u.i&&jp(u.i,function(y,v){u.add(decodeURIComponent(y.replace(/\+/g," ")),v)}))}r=bs.prototype,r.add=function(u,y){ar(this),this.i=null,u=Jr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(y),this.h+=1,this};function ws(u,y){ar(u),y=Jr(u,y),u.g.has(y)&&(u.i=null,u.h-=u.g.get(y).length,u.g.delete(y))}function Ts(u,y){return ar(u),y=Jr(u,y),u.g.has(y)}r.forEach=function(u,y){ar(this),this.g.forEach(function(v,S){v.forEach(function(j){u.call(y,j,S,this)},this)},this)},r.na=function(){ar(this);const u=Array.from(this.g.values()),y=Array.from(this.g.keys()),v=[];for(let S=0;S<y.length;S++){const j=u[S];for(let W=0;W<j.length;W++)v.push(y[S])}return v},r.V=function(u){ar(this);let y=[];if(typeof u=="string")Ts(this,u)&&(y=y.concat(this.g.get(Jr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)y=y.concat(u[v])}return y},r.set=function(u,y){return ar(this),this.i=null,u=Jr(this,u),Ts(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[y]),this.h+=1,this},r.get=function(u,y){return u?(u=this.V(u),0<u.length?String(u[0]):y):y};function fl(u,y,v){ws(u,y),0<v.length&&(u.i=null,u.g.set(Jr(u,y),Q(v)),u.h+=v.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],y=Array.from(this.g.keys());for(var v=0;v<y.length;v++){var S=y[v];const W=encodeURIComponent(String(S)),oe=this.V(S);for(S=0;S<oe.length;S++){var j=W;oe[S]!==""&&(j+="="+encodeURIComponent(String(oe[S]))),u.push(j)}}return this.i=u.join("&")};function Jr(u,y){return y=String(y),u.j&&(y=y.toLowerCase()),y}function nu(u,y){y&&!u.j&&(ar(u),u.i=null,u.g.forEach(function(v,S){var j=S.toLowerCase();S!=j&&(ws(this,S),fl(this,j,v))},u)),u.j=y}function so(u,y){const v=new yt;if(h.Image){const S=new Image;S.onload=M(lr,v,"TestLoadImage: loaded",!0,y,S),S.onerror=M(lr,v,"TestLoadImage: error",!1,y,S),S.onabort=M(lr,v,"TestLoadImage: abort",!1,y,S),S.ontimeout=M(lr,v,"TestLoadImage: timeout",!1,y,S),h.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=u}else y(!1)}function Rr(u,y){const v=new yt,S=new AbortController,j=setTimeout(()=>{S.abort(),lr(v,"TestPingServer: timeout",!1,y)},1e4);fetch(u,{signal:S.signal}).then(W=>{clearTimeout(j),W.ok?lr(v,"TestPingServer: ok",!0,y):lr(v,"TestPingServer: server error",!1,y)}).catch(()=>{clearTimeout(j),lr(v,"TestPingServer: error",!1,y)})}function lr(u,y,v,S,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),S(v)}catch{}}function io(){this.g=new _r}function Yr(u,y,v){const S=v||"";try{pl(u,function(j,W){let oe=j;g(j)&&(oe=Kt(j)),y.push(S+W+"="+encodeURIComponent(oe))})}catch(j){throw y.push(S+"type="+encodeURIComponent("_badmap")),j}}function ii(u){this.l=u.Ub||null,this.j=u.eb||!1}z(ii,Qi),ii.prototype.g=function(){return new Ss(this.l,this.j)},ii.prototype.i=(function(u){return function(){return u}})({});function Ss(u,y){Xe.call(this),this.D=u,this.o=y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}z(Ss,Xe),r=Ss.prototype,r.open=function(u,y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=y,this.readyState=1,Xr(this)},r.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const y={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(y.body=u),(this.D||h).fetch(new Request(this.A,y)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Qr(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;gl(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function gl(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var y=u.value?u.value:new Uint8Array(0);(y=this.v.decode(y,{stream:!u.done}))&&(this.response=this.responseText+=y)}u.done?Qr(this):Xr(this),this.readyState==3&&gl(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,Qr(this))},r.Qa=function(u){this.g&&(this.response=u,Qr(this))},r.ga=function(){this.g&&Qr(this)};function Qr(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Xr(u)}r.setRequestHeader=function(u,y){this.u.append(u,y)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],y=this.h.entries();for(var v=y.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=y.next();return u.join(`\r
`)};function Xr(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Ss.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function yl(u){let y="";return De(u,function(v,S){y+=S,y+=":",y+=v,y+=`\r
`}),y}function Xt(u,y,v){e:{for(S in v){var S=!1;break e}S=!0}S||(v=yl(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):nt(u,y,v))}function Je(u){Xe.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}z(Je,Xe);var Xo=/^https?$/i,oo=["POST","PUT"];r=Je.prototype,r.Ha=function(u){this.J=u},r.ea=function(u,y,v,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);y=y?y.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():jn.g(),this.v=this.o?$r(this.o):$r(jn),this.g.onreadystatechange=C(this.Ea,this);try{this.B=!0,this.g.open(y,String(u),!0),this.B=!1}catch(W){ru(this,W);return}if(u=v||"",v=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var j in S)v.set(j,S[j]);else if(typeof S.keys=="function"&&typeof S.get=="function")for(const W of S.keys())v.set(W,S.get(W));else throw Error("Unknown input type for opt_headers: "+String(S));S=Array.from(v.keys()).find(W=>W.toLowerCase()=="content-type"),j=h.FormData&&u instanceof h.FormData,!(0<=Array.prototype.indexOf.call(oo,y,void 0))||S||j||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[W,oe]of v)this.g.setRequestHeader(W,oe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ao(this),this.u=!0,this.g.send(u),this.u=!1}catch(W){ru(this,W)}};function ru(u,y){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=y,u.m=5,Zo(u),Zr(u)}function Zo(u){u.A||(u.A=!0,$e(u,"complete"),$e(u,"error"))}r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,$e(this,"complete"),$e(this,"abort"),Zr(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zr(this,!0)),Je.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?ea(this):this.bb())},r.bb=function(){ea(this)};function ea(u){if(u.h&&typeof p<"u"&&(!u.v[1]||cr(u)!=4||u.Z()!=2)){if(u.u&&cr(u)==4)Bt(u.Ea,0,u);else if($e(u,"readystatechange"),cr(u)==4){u.h=!1;try{const oe=u.Z();e:switch(oe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var y=!0;break e;default:y=!1}var v;if(!(v=y)){var S;if(S=oe===0){var j=String(u.D).match(eo)[1]||null;!j&&h.self&&h.self.location&&(j=h.self.location.protocol.slice(0,-1)),S=!Xo.test(j?j.toLowerCase():"")}v=S}if(v)$e(u,"complete"),$e(u,"success");else{u.m=6;try{var W=2<cr(u)?u.g.statusText:""}catch{W=""}u.l=W+" ["+u.Z()+"]",Zo(u)}}finally{Zr(u)}}}}function Zr(u,y){if(u.g){ao(u);const v=u.g,S=u.v[0]?()=>{}:null;u.g=null,u.v=null,y||$e(u,"ready");try{v.onreadystatechange=S}catch{}}}function ao(u){u.I&&(h.clearTimeout(u.I),u.I=null)}r.isActive=function(){return!!this.g};function cr(u){return u.g?u.g.readyState:0}r.Z=function(){try{return 2<cr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var y=this.g.responseText;return u&&y.indexOf(u)==0&&(y=y.substring(u.length)),Gr(y)}};function su(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Fp(u){const y={};u=(u.g&&2<=cr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let S=0;S<u.length;S++){if(re(u[S]))continue;var v=D(u[S]);const j=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const W=y[j]||[];y[j]=W,W.push(v)}U(y,function(S){return S.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function lo(u,y,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||y}function ta(u){this.Aa=0,this.i=[],this.j=new yt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=lo("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=lo("baseRetryDelayMs",5e3,u),this.cb=lo("retryDelaySeedMs",1e4,u),this.Wa=lo("forwardChannelMaxRetries",2,u),this.wa=lo("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new ir(u&&u.concurrentRequestLimit),this.Da=new io,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=ta.prototype,r.la=8,r.G=1,r.connect=function(u,y,v,S){ot(0),this.W=u,this.H=y||{},v&&S!==void 0&&(this.H.OSID=v,this.H.OAID=S),this.F=this.X,this.I=du(this,null,this.W),ra(this)};function vl(u){if(iu(u),u.G==3){var y=u.U++,v=zn(u.I);if(nt(v,"SID",u.K),nt(v,"RID",y),nt(v,"TYPE","terminate"),co(u,v),y=new Yt(u,u.j,y),y.L=2,y.v=no(zn(v)),v=!1,h.navigator&&h.navigator.sendBeacon)try{v=h.navigator.sendBeacon(y.v.toString(),"")}catch{}!v&&h.Image&&(new Image().src=y.v,v=!0),v||(y.g=pu(y.j,null),y.g.ea(y.v)),y.F=Date.now(),at(y)}uu(u)}function na(u){u.g&&(uo(u),u.g.cancel(),u.g=null)}function iu(u){na(u),u.u&&(h.clearTimeout(u.u),u.u=null),sa(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&h.clearTimeout(u.s),u.s=null)}function ra(u){if(!Wo(u.h)&&!u.s){u.s=!0;var y=u.Ga;le||k(),ye||(le(),ye=!0),Ge.add(y,u),u.B=0}}function Vp(u,y){return Ko(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=y.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Et(C(u.Ga,u,y),Tl(u,u.B)),u.B++,!0)}r.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const j=new Yt(this,this.j,u);let W=this.o;if(this.S&&(W?(W=_(W),O(W,this.S)):W=this.S),this.m!==null||this.O||(j.H=W,W=null),this.P)e:{for(var y=0,v=0;v<this.i.length;v++){t:{var S=this.i[v];if("__data__"in S.map&&(S=S.map.__data__,typeof S=="string")){S=S.length;break t}S=void 0}if(S===void 0)break;if(y+=S,4096<y){y=v;break e}if(y===4096||v===this.i.length-1){y=v+1;break e}}y=1e3}else y=1e3;y=ou(this,j,y),v=zn(this.I),nt(v,"RID",u),nt(v,"CVER",22),this.D&&nt(v,"X-HTTP-Session-Id",this.D),co(this,v),W&&(this.O?y="headers="+encodeURIComponent(String(yl(W)))+"&"+y:this.m&&Xt(v,this.m,W)),Jo(this.h,j),this.Ua&&nt(v,"TYPE","init"),this.P?(nt(v,"$req",y),nt(v,"SID","null"),j.T=!0,se(j,v,null)):se(j,v,y),this.G=2}}else this.G==3&&(u?bl(this,u):this.i.length==0||Wo(this.h)||bl(this))};function bl(u,y){var v;y?v=y.l:v=u.U++;const S=zn(u.I);nt(S,"SID",u.K),nt(S,"RID",v),nt(S,"AID",u.T),co(u,S),u.m&&u.o&&Xt(S,u.m,u.o),v=new Yt(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),y&&(u.i=y.D.concat(u.i)),y=ou(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Jo(u.h,v),se(v,S,y)}function co(u,y){u.H&&De(u.H,function(v,S){nt(y,S,v)}),u.l&&pl({},function(v,S){nt(y,S,v)})}function ou(u,y,v){v=Math.min(u.i.length,v);var S=u.l?C(u.l.Na,u.l,u):null;e:{var j=u.i;let W=-1;for(;;){const oe=["count="+v];W==-1?0<v?(W=j[0].g,oe.push("ofs="+W)):W=0:oe.push("ofs="+W);let ze=!0;for(let Ft=0;Ft<v;Ft++){let Fe=j[Ft].g;const Zt=j[Ft].map;if(Fe-=W,0>Fe)W=Math.max(0,j[Ft].g-100),ze=!1;else try{Yr(Zt,oe,"req"+Fe+"_")}catch{S&&S(Zt)}}if(ze){S=oe.join("&");break e}}}return u=u.i.splice(0,v),y.D=u,S}function au(u){if(!u.g&&!u.u){u.Y=1;var y=u.Fa;le||k(),ye||(le(),ye=!0),Ge.add(y,u),u.v=0}}function wl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Et(C(u.Fa,u),Tl(u,u.v)),u.v++,!0)}r.Fa=function(){if(this.u=null,lu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Et(C(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ot(10),na(this),lu(this))};function uo(u){u.A!=null&&(h.clearTimeout(u.A),u.A=null)}function lu(u){u.g=new Yt(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var y=zn(u.qa);nt(y,"RID","rpc"),nt(y,"SID",u.K),nt(y,"AID",u.T),nt(y,"CI",u.F?"0":"1"),!u.F&&u.ja&&nt(y,"TO",u.ja),nt(y,"TYPE","xmlhttp"),co(u,y),u.m&&u.o&&Xt(y,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=no(zn(y)),v.m=null,v.P=!0,de(v,u)}r.Za=function(){this.C!=null&&(this.C=null,na(this),wl(this),ot(19))};function sa(u){u.C!=null&&(h.clearTimeout(u.C),u.C=null)}function cu(u,y){var v=null;if(u.g==y){sa(u),uo(u),u.g=null;var S=2}else if(ul(u.h,y))v=y.D,Cn(u.h,y),S=1;else return;if(u.G!=0){if(y.o)if(S==1){v=y.m?y.m.length:0,y=Date.now()-y.F;var j=u.B;S=En(),$e(S,new St(S,v)),ra(u)}else au(u);else if(j=y.s,j==3||j==0&&0<y.X||!(S==1&&Vp(u,y)||S==2&&wl(u)))switch(v&&0<v.length&&(y=u.h,y.i=y.i.concat(v)),j){case 1:Es(u,5);break;case 4:Es(u,10);break;case 3:Es(u,6);break;default:Es(u,2)}}}function Tl(u,y){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*y}function Es(u,y){if(u.j.info("Error code "+y),y==2){var v=C(u.fb,u),S=u.Xa;const j=!S;S=new Nt(S||"//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||to(S,"https"),no(S),j?so(S.toString(),v):Rr(S.toString(),v)}else ot(2);u.G=0,u.l&&u.l.sa(y),uu(u),iu(u)}r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),ot(2)):(this.j.info("Failed to ping google.com"),ot(1))};function uu(u){if(u.G=0,u.ka=[],u.l){const y=dl(u.h);(y.length!=0||u.i.length!=0)&&($(u.ka,y),$(u.ka,u.i),u.h.i.length=0,Q(u.i),u.i.length=0),u.l.ra()}}function du(u,y,v){var S=v instanceof Nt?zn(v):new Nt(v);if(S.g!="")y&&(S.g=y+"."+S.g),si(S,S.s);else{var j=h.location;S=j.protocol,y=y?y+"."+j.hostname:j.hostname,j=+j.port;var W=new Nt(null);S&&to(W,S),y&&(W.g=y),j&&si(W,j),v&&(W.l=v),S=W}return v=u.D,y=u.ya,v&&y&&nt(S,v,y),nt(S,"VER",u.la),co(u,S),S}function pu(u,y,v){if(y&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return y=u.Ca&&!u.pa?new Je(new ii({eb:v})):new Je(u.pa),y.Ha(u.J),y}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function mu(){}r=mu.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function ia(){}ia.prototype.g=function(u,y){return new _n(u,y)};function _n(u,y){Xe.call(this),this.g=new ta(y),this.l=u,this.h=y&&y.messageUrlParams||null,u=y&&y.messageHeaders||null,y&&y.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=y&&y.initMessageHeaders||null,y&&y.messageContentType&&(u?u["X-WebChannel-Content-Type"]=y.messageContentType:u={"X-WebChannel-Content-Type":y.messageContentType}),y&&y.va&&(u?u["X-WebChannel-Client-Profile"]=y.va:u={"X-WebChannel-Client-Profile":y.va}),this.g.S=u,(u=y&&y.Sb)&&!re(u)&&(this.g.m=u),this.v=y&&y.supportsCrossDomainXhr||!1,this.u=y&&y.sendRawJson||!1,(y=y&&y.httpSessionIdParam)&&!re(y)&&(this.g.D=y,u=this.h,u!==null&&y in u&&(u=this.h,y in u&&delete u[y])),this.j=new es(this)}z(_n,Xe),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){vl(this.g)},_n.prototype.o=function(u){var y=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=Kt(u),u=v);y.i.push(new Zi(y.Ya++,u)),y.G==3&&ra(y)},_n.prototype.N=function(){this.g.l=null,delete this.j,vl(this.g),delete this.g,_n.aa.N.call(this)};function hu(u){Sn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var y=u.__sm__;if(y){e:{for(const v in y){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,y=y!==null&&u in y?y[u]:void 0),this.data=y}else this.data=u}z(hu,Sn);function fu(){Xi.call(this),this.status=1}z(fu,Xi);function es(u){this.g=u}z(es,mu),es.prototype.ua=function(){$e(this.g,"a")},es.prototype.ta=function(u){$e(this.g,new hu(u))},es.prototype.sa=function(u){$e(this.g,new fu)},es.prototype.ra=function(){$e(this.g,"b")},ia.prototype.createWebChannel=ia.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,GE=function(){return new ia},HE=function(){return En()},VE=nr,Ef={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Jt.NO_ERROR=0,Jt.TIMEOUT=8,Jt.HTTP_ERROR=6,Dd=Jt,sr.COMPLETE="complete",FE=sr,Wr.EventType=Ar,Ar.OPEN="a",Ar.CLOSE="b",Ar.ERROR="c",Ar.MESSAGE="d",Xe.prototype.listen=Xe.prototype.K,vc=Wr,Je.prototype.listenOnce=Je.prototype.L,Je.prototype.getLastError=Je.prototype.Ka,Je.prototype.getLastErrorCode=Je.prototype.Ba,Je.prototype.getStatus=Je.prototype.Z,Je.prototype.getResponseJson=Je.prototype.Oa,Je.prototype.getResponseText=Je.prototype.oa,Je.prototype.send=Je.prototype.ea,Je.prototype.setWithCredentials=Je.prototype.Ha,zE=Je}).apply(typeof vd<"u"?vd:typeof self<"u"?self:typeof window<"u"?window:{});const aT="@firebase/firestore",lT="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}vn.UNAUTHENTICATED=new vn(null),vn.GOOGLE_CREDENTIALS=new vn("google-credentials-uid"),vn.FIRST_PARTY=new vn("first-party-uid"),vn.MOCK_USER=new vn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rl="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=new cp("@firebase/firestore");function Ua(){return Mo.logLevel}function pe(r,...e){if(Mo.logLevel<=qe.DEBUG){const n=e.map(pg);Mo.debug(`Firestore (${rl}): ${r}`,...n)}}function Ys(r,...e){if(Mo.logLevel<=qe.ERROR){const n=e.map(pg);Mo.error(`Firestore (${rl}): ${r}`,...n)}}function Ha(r,...e){if(Mo.logLevel<=qe.WARN){const n=e.map(pg);Mo.warn(`Firestore (${rl}): ${r}`,...n)}}function pg(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(n){return JSON.stringify(n)})(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(r,e,n){let i="Unexpected state";typeof e=="string"?i=e:n=e,$E(r,i,n)}function $E(r,e,n){let i=`FIRESTORE (${rl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(n!==void 0)try{i+=" CONTEXT: "+JSON.stringify(n)}catch{i+=" CONTEXT: "+n}throw Ys(i),new Error(i)}function Ye(r,e,n,i){let a="Unexpected state";typeof n=="string"?a=n:i=n,r||$E(e,a,i)}function Re(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ue extends zr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(vn.UNAUTHENTICATED)))}shutdown(){}}class vP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class bP{constructor(e){this.t=e,this.currentUser=vn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ye(this.o===void 0,42304);let i=this.i;const a=f=>this.i!==i?(i=this.i,n(f)):Promise.resolve();let c=new Gs;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new Gs,e.enqueueRetryable((()=>a(this.currentUser)))};const p=()=>{const f=c;e.enqueueRetryable((async()=>{await f.promise,await a(this.currentUser)}))},h=f=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit((f=>h(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new Gs)}}),0),p()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((i=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Ye(typeof i.accessToken=="string",31837,{l:i}),new WE(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ye(e===null||typeof e=="string",2055,{h:e}),new vn(e)}}class wP{constructor(e,n,i){this.P=e,this.T=n,this.I=i,this.type="FirstParty",this.user=vn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class TP{constructor(e,n,i){this.P=e,this.T=n,this.I=i}getToken(){return Promise.resolve(new wP(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(vn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class cT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class SP{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Jn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Ye(this.o===void 0,3512);const i=c=>{c.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${c.error.message}`);const p=c.token!==this.m;return this.m=c.token,pe("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?n(c.token):Promise.resolve()};this.o=c=>{e.enqueueRetryable((()=>i(c)))};const a=c=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=c,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((c=>a(c))),setTimeout((()=>{if(!this.appCheck){const c=this.V.getImmediate({optional:!0});c?a(c):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new cT(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Ye(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new cT(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EP(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let i=0;i<r;i++)n[i]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const a=EP(40);for(let c=0;c<a.length;++c)i.length<20&&a[c]<n&&(i+=e.charAt(a[c]%62))}return i}}function je(r,e){return r<e?-1:r>e?1:0}function Cf(r,e){const n=Math.min(r.length,e.length);for(let i=0;i<n;i++){const a=r.charAt(i),c=e.charAt(i);if(a!==c)return Jh(a)===Jh(c)?je(a,c):Jh(a)?1:-1}return je(r.length,e.length)}const CP=55296,_P=57343;function Jh(r){const e=r.charCodeAt(0);return e>=CP&&e<=_P}function Ga(r,e,n){return r.length===e.length&&r.every(((i,a)=>n(i,e[a])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT="__name__";class as{constructor(e,n,i){n===void 0?n=0:n>e.length&&Ae(637,{offset:n,range:e.length}),i===void 0?i=e.length-n:i>e.length-n&&Ae(1746,{length:i,range:e.length-n}),this.segments=e,this.offset=n,this.len=i}get length(){return this.len}isEqual(e){return as.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof as?e.forEach((i=>{n.push(i)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,i=this.limit();n<i;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const i=Math.min(e.length,n.length);for(let a=0;a<i;a++){const c=as.compareSegments(e.get(a),n.get(a));if(c!==0)return c}return je(e.length,n.length)}static compareSegments(e,n){const i=as.isNumericId(e),a=as.isNumericId(n);return i&&!a?-1:!i&&a?1:i&&a?as.extractNumericId(e).compare(as.extractNumericId(n)):Cf(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Oi.fromString(e.substring(4,e.length-2))}}class ut extends as{construct(e,n,i){return new ut(e,n,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const i of e){if(i.indexOf("//")>=0)throw new ue(X.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);n.push(...i.split("/").filter((a=>a.length>0)))}return new ut(n)}static emptyPath(){return new ut([])}}const AP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dn extends as{construct(e,n,i){return new dn(e,n,i)}static isValidIdentifier(e){return AP.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===uT}static keyField(){return new dn([uT])}static fromServerFormat(e){const n=[];let i="",a=0;const c=()=>{if(i.length===0)throw new ue(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(i),i=""};let p=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new ue(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[a+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new ue(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,a+=2}else h==="`"?(p=!p,a++):h!=="."||p?(i+=h,a++):(c(),a++)}if(c(),p)throw new ue(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new dn(n)}static emptyPath(){return new dn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.path=e}static fromPath(e){return new Te(ut.fromString(e))}static fromName(e){return new Te(ut.fromString(e).popFirst(5))}static empty(){return new Te(ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ut.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new ut(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KE(r,e,n){if(!n)throw new ue(X.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function IP(r,e,n,i){if(e===!0&&i===!0)throw new ue(X.INVALID_ARGUMENT,`${r} and ${n} cannot be used together.`)}function dT(r){if(!Te.isDocumentKey(r))throw new ue(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function pT(r){if(Te.isDocumentKey(r))throw new ue(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function JE(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function mp(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Ae(12329,{type:typeof r})}function qr(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new ue(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=mp(r);throw new ue(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return r}function xP(r,e){if(e<=0)throw new ue(X.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(r,e){const n={typeString:r};return e&&(n.value=e),n}function Wc(r,e){if(!JE(r))throw new ue(X.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in e)if(e[i]){const a=e[i].typeString,c="value"in e[i]?{value:e[i].value}:void 0;if(!(i in r)){n=`JSON missing required field: '${i}'`;break}const p=r[i];if(a&&typeof p!==a){n=`JSON field '${i}' must be a ${a}.`;break}if(c!==void 0&&p!==c.value){n=`Expected '${i}' field to equal '${c.value}'`;break}}if(n)throw new ue(X.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT=-62135596800,hT=1e6;class dt{static now(){return dt.fromMillis(Date.now())}static fromDate(e){return dt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),i=Math.floor((e-1e3*n)*hT);return new dt(n,i)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ue(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ue(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<mT)throw new ue(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ue(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hT}_compareTo(e){return this.seconds===e.seconds?je(this.nanoseconds,e.nanoseconds):je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:dt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Wc(e,dt._jsonSchema))return new dt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-mT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}dt._jsonSchemaVersion="firestore/timestamp/1.0",dt._jsonSchema={type:qt("string",dt._jsonSchemaVersion),seconds:qt("number"),nanoseconds:qt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{static fromTimestamp(e){return new xe(e)}static min(){return new xe(new dt(0,0))}static max(){return new xe(new dt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc=-1;function RP(r,e){const n=r.toTimestamp().seconds,i=r.toTimestamp().nanoseconds+1,a=xe.fromTimestamp(i===1e9?new dt(n+1,0):new dt(n,i));return new Mi(a,Te.empty(),e)}function kP(r){return new Mi(r.readTime,r.key,Nc)}class Mi{constructor(e,n,i){this.readTime=e,this.documentKey=n,this.largestBatchId=i}static min(){return new Mi(xe.min(),Te.empty(),Nc)}static max(){return new Mi(xe.max(),Te.empty(),Nc)}}function DP(r,e){let n=r.readTime.compareTo(e.readTime);return n!==0?n:(n=Te.comparator(r.documentKey,e.documentKey),n!==0?n:je(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sl(r){if(r.code!==X.FAILED_PRECONDITION||r.message!==PP)throw r;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new te(((i,a)=>{this.nextCallback=c=>{this.wrapSuccess(e,c).next(i,a)},this.catchCallback=c=>{this.wrapFailure(n,c).next(i,a)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof te?n:te.resolve(n)}catch(n){return te.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):te.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):te.reject(n)}static resolve(e){return new te(((n,i)=>{n(e)}))}static reject(e){return new te(((n,i)=>{i(e)}))}static waitFor(e){return new te(((n,i)=>{let a=0,c=0,p=!1;e.forEach((h=>{++a,h.next((()=>{++c,p&&c===a&&n()}),(f=>i(f)))})),p=!0,c===a&&n()}))}static or(e){let n=te.resolve(!1);for(const i of e)n=n.next((a=>a?te.resolve(a):i()));return n}static forEach(e,n){const i=[];return e.forEach(((a,c)=>{i.push(n.call(this,a,c))})),this.waitFor(i)}static mapArray(e,n){return new te(((i,a)=>{const c=e.length,p=new Array(c);let h=0;for(let f=0;f<c;f++){const g=f;n(e[g]).next((b=>{p[g]=b,++h,h===c&&i(p)}),(b=>a(b)))}}))}static doWhile(e,n){return new te(((i,a)=>{const c=()=>{e()===!0?n().next((()=>{c()}),a):i()};c()}))}}function OP(r){const e=r.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function il(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>n.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}hp.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg=-1;function fp(r){return r==null}function Wd(r){return r===0&&1/r==-1/0}function UP(r){return typeof r=="number"&&Number.isInteger(r)&&!Wd(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YE="";function MP(r){let e="";for(let n=0;n<r.length;n++)e.length>0&&(e=fT(e)),e=LP(r.get(n),e);return fT(e)}function LP(r,e){let n=e;const i=r.length;for(let a=0;a<i;a++){const c=r.charAt(a);switch(c){case"\0":n+="";break;case YE:n+="";break;default:n+=c}}return n}function fT(r){return r+YE+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gT(r){let e=0;for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&e++;return e}function $i(r,e){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&e(n,r[n])}function QE(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,n){this.comparator=e,this.root=n||un.EMPTY}insert(e,n){return new wt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,un.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return n.value;i<0?n=n.left:i>0&&(n=n.right)}return null}indexOf(e){let n=0,i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return n+i.left.size;a<0?i=i.left:(n+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,i)=>(e(n,i),!1)))}toString(){const e=[];return this.inorderTraversal(((n,i)=>(e.push(`${n}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bd(this.root,e,this.comparator,!1)}getReverseIterator(){return new bd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bd(this.root,e,this.comparator,!0)}}class bd{constructor(e,n,i,a){this.isReverse=a,this.nodeStack=[];let c=1;for(;!e.isEmpty();)if(c=n?i(e.key,n):1,n&&a&&(c*=-1),c<0)e=this.isReverse?e.left:e.right;else{if(c===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class un{constructor(e,n,i,a,c){this.key=e,this.value=n,this.color=i??un.RED,this.left=a??un.EMPTY,this.right=c??un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,i,a,c){return new un(e??this.key,n??this.value,i??this.color,a??this.left,c??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let a=this;const c=i(e,a.key);return a=c<0?a.copy(null,null,null,a.left.insert(e,n,i),null):c===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,i)),a.fixUp()}removeMin(){if(this.left.isEmpty())return un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let i,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return un.EMPTY;i=a.right.min(),a=a.copy(i.key,i.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ae(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ae(27949);return e+(this.isRed()?0:1)}}un.EMPTY=null,un.RED=!0,un.BLACK=!1;un.EMPTY=new class{constructor(){this.size=0}get key(){throw Ae(57766)}get value(){throw Ae(16141)}get color(){throw Ae(16727)}get left(){throw Ae(29726)}get right(){throw Ae(36894)}copy(e,n,i,a,c){return this}insert(e,n,i){return new un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,i)=>(e(n),!1)))}forEachInRange(e,n){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const a=i.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let i;for(i=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new yT(this.data.getIterator())}getIteratorFrom(e){return new yT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((i=>{n=n.add(i)})),n}isEqual(e){if(!(e instanceof $t)||this.size!==e.size)return!1;const n=this.data.getIterator(),i=e.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,c=i.getNext().key;if(this.comparator(a,c)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new $t(this.comparator);return n.data=e,n}}class yT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.fields=e,e.sort(dn.comparator)}static empty(){return new Yn([])}unionWith(e){let n=new $t(dn.comparator);for(const i of this.fields)n=n.add(i);for(const i of e)n=n.add(i);return new Yn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ga(this.fields,e.fields,((n,i)=>n.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(a){try{return atob(a)}catch(c){throw typeof DOMException<"u"&&c instanceof DOMException?new XE("Invalid base64 string: "+c):c}})(e);return new pn(n)}static fromUint8Array(e){const n=(function(a){let c="";for(let p=0;p<a.length;++p)c+=String.fromCharCode(a[p]);return c})(e);return new pn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const i=new Uint8Array(n.length);for(let a=0;a<n.length;a++)i[a]=n.charCodeAt(a);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pn.EMPTY_BYTE_STRING=new pn("");const qP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Li(r){if(Ye(!!r,39018),typeof r=="string"){let e=0;const n=qP.exec(r);if(Ye(!!n,46558,{timestamp:r}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}const i=new Date(r);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Dt(r.seconds),nanos:Dt(r.nanos)}}function Dt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function qi(r){return typeof r=="string"?pn.fromBase64String(r):pn.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE="server_timestamp",eC="__type__",tC="__previous_value__",nC="__local_write_time__";function fg(r){return(r?.mapValue?.fields||{})[eC]?.stringValue===ZE}function gp(r){const e=r.mapValue.fields[tC];return fg(e)?gp(e):e}function Oc(r){const e=Li(r.mapValue.fields[nC].timestampValue);return new dt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e,n,i,a,c,p,h,f,g,b){this.databaseId=e,this.appId=n,this.persistenceKey=i,this.host=a,this.ssl=c,this.forceLongPolling=p,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=g,this.isUsingEmulator=b}}const Kd="(default)";class Uc{constructor(e,n){this.projectId=e,this.database=n||Kd}static empty(){return new Uc("","")}get isDefaultDatabase(){return this.database===Kd}isEqual(e){return e instanceof Uc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC="__type__",BP="__max__",wd={mapValue:{}},sC="__vector__",Jd="value";function ji(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?fg(r)?4:FP(r)?9007199254740991:zP(r)?10:11:Ae(28295,{value:r})}function hs(r,e){if(r===e)return!0;const n=ji(r);if(n!==ji(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Oc(r).isEqual(Oc(e));case 3:return(function(a,c){if(typeof a.timestampValue=="string"&&typeof c.timestampValue=="string"&&a.timestampValue.length===c.timestampValue.length)return a.timestampValue===c.timestampValue;const p=Li(a.timestampValue),h=Li(c.timestampValue);return p.seconds===h.seconds&&p.nanos===h.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(a,c){return qi(a.bytesValue).isEqual(qi(c.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(a,c){return Dt(a.geoPointValue.latitude)===Dt(c.geoPointValue.latitude)&&Dt(a.geoPointValue.longitude)===Dt(c.geoPointValue.longitude)})(r,e);case 2:return(function(a,c){if("integerValue"in a&&"integerValue"in c)return Dt(a.integerValue)===Dt(c.integerValue);if("doubleValue"in a&&"doubleValue"in c){const p=Dt(a.doubleValue),h=Dt(c.doubleValue);return p===h?Wd(p)===Wd(h):isNaN(p)&&isNaN(h)}return!1})(r,e);case 9:return Ga(r.arrayValue.values||[],e.arrayValue.values||[],hs);case 10:case 11:return(function(a,c){const p=a.mapValue.fields||{},h=c.mapValue.fields||{};if(gT(p)!==gT(h))return!1;for(const f in p)if(p.hasOwnProperty(f)&&(h[f]===void 0||!hs(p[f],h[f])))return!1;return!0})(r,e);default:return Ae(52216,{left:r})}}function Mc(r,e){return(r.values||[]).find((n=>hs(n,e)))!==void 0}function $a(r,e){if(r===e)return 0;const n=ji(r),i=ji(e);if(n!==i)return je(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return je(r.booleanValue,e.booleanValue);case 2:return(function(c,p){const h=Dt(c.integerValue||c.doubleValue),f=Dt(p.integerValue||p.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1})(r,e);case 3:return vT(r.timestampValue,e.timestampValue);case 4:return vT(Oc(r),Oc(e));case 5:return Cf(r.stringValue,e.stringValue);case 6:return(function(c,p){const h=qi(c),f=qi(p);return h.compareTo(f)})(r.bytesValue,e.bytesValue);case 7:return(function(c,p){const h=c.split("/"),f=p.split("/");for(let g=0;g<h.length&&g<f.length;g++){const b=je(h[g],f[g]);if(b!==0)return b}return je(h.length,f.length)})(r.referenceValue,e.referenceValue);case 8:return(function(c,p){const h=je(Dt(c.latitude),Dt(p.latitude));return h!==0?h:je(Dt(c.longitude),Dt(p.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return bT(r.arrayValue,e.arrayValue);case 10:return(function(c,p){const h=c.fields||{},f=p.fields||{},g=h[Jd]?.arrayValue,b=f[Jd]?.arrayValue,E=je(g?.values?.length||0,b?.values?.length||0);return E!==0?E:bT(g,b)})(r.mapValue,e.mapValue);case 11:return(function(c,p){if(c===wd.mapValue&&p===wd.mapValue)return 0;if(c===wd.mapValue)return 1;if(p===wd.mapValue)return-1;const h=c.fields||{},f=Object.keys(h),g=p.fields||{},b=Object.keys(g);f.sort(),b.sort();for(let E=0;E<f.length&&E<b.length;++E){const C=Cf(f[E],b[E]);if(C!==0)return C;const M=$a(h[f[E]],g[b[E]]);if(M!==0)return M}return je(f.length,b.length)})(r.mapValue,e.mapValue);default:throw Ae(23264,{he:n})}}function vT(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return je(r,e);const n=Li(r),i=Li(e),a=je(n.seconds,i.seconds);return a!==0?a:je(n.nanos,i.nanos)}function bT(r,e){const n=r.values||[],i=e.values||[];for(let a=0;a<n.length&&a<i.length;++a){const c=$a(n[a],i[a]);if(c)return c}return je(n.length,i.length)}function Wa(r){return _f(r)}function _f(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(n){const i=Li(n);return`time(${i.seconds},${i.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(n){return qi(n).toBase64()})(r.bytesValue):"referenceValue"in r?(function(n){return Te.fromName(n).toString()})(r.referenceValue):"geoPointValue"in r?(function(n){return`geo(${n.latitude},${n.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(n){let i="[",a=!0;for(const c of n.values||[])a?a=!1:i+=",",i+=_f(c);return i+"]"})(r.arrayValue):"mapValue"in r?(function(n){const i=Object.keys(n.fields||{}).sort();let a="{",c=!0;for(const p of i)c?c=!1:a+=",",a+=`${p}:${_f(n.fields[p])}`;return a+"}"})(r.mapValue):Ae(61005,{value:r})}function Pd(r){switch(ji(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=gp(r);return e?16+Pd(e):16;case 5:return 2*r.stringValue.length;case 6:return qi(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((a,c)=>a+Pd(c)),0)})(r.arrayValue);case 10:case 11:return(function(i){let a=0;return $i(i.fields,((c,p)=>{a+=c.length+Pd(p)})),a})(r.mapValue);default:throw Ae(13486,{value:r})}}function wT(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Af(r){return!!r&&"integerValue"in r}function gg(r){return!!r&&"arrayValue"in r}function TT(r){return!!r&&"nullValue"in r}function ST(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Nd(r){return!!r&&"mapValue"in r}function zP(r){return(r?.mapValue?.fields||{})[rC]?.stringValue===sC}function Cc(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return $i(r.mapValue.fields,((n,i)=>e.mapValue.fields[n]=Cc(i))),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(r.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Cc(r.arrayValue.values[n]);return e}return{...r}}function FP(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===BP}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.value=e}static empty(){return new Ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let i=0;i<e.length-1;++i)if(n=(n.mapValue.fields||{})[e.get(i)],!Nd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Cc(n)}setAll(e){let n=dn.emptyPath(),i={},a=[];e.forEach(((p,h)=>{if(!n.isImmediateParentOf(h)){const f=this.getFieldsMap(n);this.applyChanges(f,i,a),i={},a=[],n=h.popLast()}p?i[h.lastSegment()]=Cc(p):a.push(h.lastSegment())}));const c=this.getFieldsMap(n);this.applyChanges(c,i,a)}delete(e){const n=this.field(e.popLast());Nd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return hs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let i=0;i<e.length;++i){let a=n.mapValue.fields[e.get(i)];Nd(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[e.get(i)]=a),n=a}return n.mapValue.fields}applyChanges(e,n,i){$i(n,((a,c)=>e[a]=c));for(const a of i)delete e[a]}clone(){return new Ln(Cc(this.value))}}function iC(r){const e=[];return $i(r.fields,((n,i)=>{const a=new dn([n]);if(Nd(i)){const c=iC(i.mapValue).fields;if(c.length===0)e.push(a);else for(const p of c)e.push(a.child(p))}else e.push(a)})),new Yn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e,n,i,a,c,p,h){this.key=e,this.documentType=n,this.version=i,this.readTime=a,this.createTime=c,this.data=p,this.documentState=h}static newInvalidDocument(e){return new bn(e,0,xe.min(),xe.min(),xe.min(),Ln.empty(),0)}static newFoundDocument(e,n,i,a){return new bn(e,1,n,xe.min(),i,a,0)}static newNoDocument(e,n){return new bn(e,2,n,xe.min(),xe.min(),Ln.empty(),0)}static newUnknownDocument(e,n){return new bn(e,3,n,xe.min(),xe.min(),Ln.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(xe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof bn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new bn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,n){this.position=e,this.inclusive=n}}function ET(r,e,n){let i=0;for(let a=0;a<r.position.length;a++){const c=e[a],p=r.position[a];if(c.field.isKeyField()?i=Te.comparator(Te.fromName(p.referenceValue),n.key):i=$a(p,n.data.field(c.field)),c.dir==="desc"&&(i*=-1),i!==0)break}return i}function CT(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let n=0;n<r.position.length;n++)if(!hs(r.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,n="asc"){this.field=e,this.dir=n}}function VP(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{}class Lt extends oC{constructor(e,n,i){super(),this.field=e,this.op=n,this.value=i}static create(e,n,i){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,i):new GP(e,n,i):n==="array-contains"?new KP(e,i):n==="in"?new JP(e,i):n==="not-in"?new YP(e,i):n==="array-contains-any"?new QP(e,i):new Lt(e,n,i)}static createKeyFieldInFilter(e,n,i){return n==="in"?new $P(e,i):new WP(e,i)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison($a(n,this.value)):n!==null&&ji(this.value)===ji(n)&&this.matchesComparison($a(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class jr extends oC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new jr(e,n)}matches(e){return aC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function aC(r){return r.op==="and"}function lC(r){return HP(r)&&aC(r)}function HP(r){for(const e of r.filters)if(e instanceof jr)return!1;return!0}function If(r){if(r instanceof Lt)return r.field.canonicalString()+r.op.toString()+Wa(r.value);if(lC(r))return r.filters.map((e=>If(e))).join(",");{const e=r.filters.map((n=>If(n))).join(",");return`${r.op}(${e})`}}function cC(r,e){return r instanceof Lt?(function(i,a){return a instanceof Lt&&i.op===a.op&&i.field.isEqual(a.field)&&hs(i.value,a.value)})(r,e):r instanceof jr?(function(i,a){return a instanceof jr&&i.op===a.op&&i.filters.length===a.filters.length?i.filters.reduce(((c,p,h)=>c&&cC(p,a.filters[h])),!0):!1})(r,e):void Ae(19439)}function uC(r){return r instanceof Lt?(function(n){return`${n.field.canonicalString()} ${n.op} ${Wa(n.value)}`})(r):r instanceof jr?(function(n){return n.op.toString()+" {"+n.getFilters().map(uC).join(" ,")+"}"})(r):"Filter"}class GP extends Lt{constructor(e,n,i){super(e,n,i),this.key=Te.fromName(i.referenceValue)}matches(e){const n=Te.comparator(e.key,this.key);return this.matchesComparison(n)}}class $P extends Lt{constructor(e,n){super(e,"in",n),this.keys=dC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class WP extends Lt{constructor(e,n){super(e,"not-in",n),this.keys=dC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function dC(r,e){return(e.arrayValue?.values||[]).map((n=>Te.fromName(n.referenceValue)))}class KP extends Lt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return gg(n)&&Mc(n.arrayValue,this.value)}}class JP extends Lt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Mc(this.value.arrayValue,n)}}class YP extends Lt{constructor(e,n){super(e,"not-in",n)}matches(e){if(Mc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Mc(this.value.arrayValue,n)}}class QP extends Lt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!gg(n)||!n.arrayValue.values)&&n.arrayValue.values.some((i=>Mc(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e,n=null,i=[],a=[],c=null,p=null,h=null){this.path=e,this.collectionGroup=n,this.orderBy=i,this.filters=a,this.limit=c,this.startAt=p,this.endAt=h,this.Te=null}}function _T(r,e=null,n=[],i=[],a=null,c=null,p=null){return new XP(r,e,n,i,a,c,p)}function yg(r){const e=Re(r);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((i=>If(i))).join(","),n+="|ob:",n+=e.orderBy.map((i=>(function(c){return c.field.canonicalString()+c.dir})(i))).join(","),fp(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((i=>Wa(i))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((i=>Wa(i))).join(",")),e.Te=n}return e.Te}function vg(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<r.orderBy.length;n++)if(!VP(r.orderBy[n],e.orderBy[n]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let n=0;n<r.filters.length;n++)if(!cC(r.filters[n],e.filters[n]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!CT(r.startAt,e.startAt)&&CT(r.endAt,e.endAt)}function xf(r){return Te.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(e,n=null,i=[],a=[],c=null,p="F",h=null,f=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=i,this.filters=a,this.limit=c,this.limitType=p,this.startAt=h,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ZP(r,e,n,i,a,c,p,h){return new ol(r,e,n,i,a,c,p,h)}function bg(r){return new ol(r)}function AT(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function pC(r){return r.collectionGroup!==null}function _c(r){const e=Re(r);if(e.Ie===null){e.Ie=[];const n=new Set;for(const c of e.explicitOrderBy)e.Ie.push(c),n.add(c.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let h=new $t(dn.comparator);return p.filters.forEach((f=>{f.getFlattenedFilters().forEach((g=>{g.isInequality()&&(h=h.add(g.field))}))})),h})(e).forEach((c=>{n.has(c.canonicalString())||c.isKeyField()||e.Ie.push(new Lc(c,i))})),n.has(dn.keyField().canonicalString())||e.Ie.push(new Lc(dn.keyField(),i))}return e.Ie}function cs(r){const e=Re(r);return e.Ee||(e.Ee=eN(e,_c(r))),e.Ee}function eN(r,e){if(r.limitType==="F")return _T(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map((a=>{const c=a.dir==="desc"?"asc":"desc";return new Lc(a.field,c)}));const n=r.endAt?new Yd(r.endAt.position,r.endAt.inclusive):null,i=r.startAt?new Yd(r.startAt.position,r.startAt.inclusive):null;return _T(r.path,r.collectionGroup,e,r.filters,r.limit,n,i)}}function Rf(r,e){const n=r.filters.concat([e]);return new ol(r.path,r.collectionGroup,r.explicitOrderBy.slice(),n,r.limit,r.limitType,r.startAt,r.endAt)}function Qd(r,e,n){return new ol(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,n,r.startAt,r.endAt)}function yp(r,e){return vg(cs(r),cs(e))&&r.limitType===e.limitType}function mC(r){return`${yg(cs(r))}|lt:${r.limitType}`}function Ma(r){return`Query(target=${(function(n){let i=n.path.canonicalString();return n.collectionGroup!==null&&(i+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(i+=`, filters: [${n.filters.map((a=>uC(a))).join(", ")}]`),fp(n.limit)||(i+=", limit: "+n.limit),n.orderBy.length>0&&(i+=`, orderBy: [${n.orderBy.map((a=>(function(p){return`${p.field.canonicalString()} (${p.dir})`})(a))).join(", ")}]`),n.startAt&&(i+=", startAt: ",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map((a=>Wa(a))).join(",")),n.endAt&&(i+=", endAt: ",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map((a=>Wa(a))).join(",")),`Target(${i})`})(cs(r))}; limitType=${r.limitType})`}function vp(r,e){return e.isFoundDocument()&&(function(i,a){const c=a.key.path;return i.collectionGroup!==null?a.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(c):Te.isDocumentKey(i.path)?i.path.isEqual(c):i.path.isImmediateParentOf(c)})(r,e)&&(function(i,a){for(const c of _c(i))if(!c.field.isKeyField()&&a.data.field(c.field)===null)return!1;return!0})(r,e)&&(function(i,a){for(const c of i.filters)if(!c.matches(a))return!1;return!0})(r,e)&&(function(i,a){return!(i.startAt&&!(function(p,h,f){const g=ET(p,h,f);return p.inclusive?g<=0:g<0})(i.startAt,_c(i),a)||i.endAt&&!(function(p,h,f){const g=ET(p,h,f);return p.inclusive?g>=0:g>0})(i.endAt,_c(i),a))})(r,e)}function tN(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function hC(r){return(e,n)=>{let i=!1;for(const a of _c(r)){const c=nN(a,e,n);if(c!==0)return c;i=i||a.field.isKeyField()}return 0}}function nN(r,e,n){const i=r.field.isKeyField()?Te.comparator(e.key,n.key):(function(c,p,h){const f=p.data.field(c),g=h.data.field(c);return f!==null&&g!==null?$a(f,g):Ae(42886)})(r.field,e,n);switch(r.dir){case"asc":return i;case"desc":return-1*i;default:return Ae(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i!==void 0){for(const[a,c]of i)if(this.equalsFn(a,e))return c}}has(e){return this.get(e)!==void 0}set(e,n){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return this.inner[i]=[[e,n]],void this.innerSize++;for(let c=0;c<a.length;c++)if(this.equalsFn(a[c][0],e))return void(a[c]=[e,n]);a.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return!1;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return i.length===1?delete this.inner[n]:i.splice(a,1),this.innerSize--,!0;return!1}forEach(e){$i(this.inner,((n,i)=>{for(const[a,c]of i)e(a,c)}))}isEmpty(){return QE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rN=new wt(Te.comparator);function Qs(){return rN}const fC=new wt(Te.comparator);function bc(...r){let e=fC;for(const n of r)e=e.insert(n.key,n);return e}function gC(r){let e=fC;return r.forEach(((n,i)=>e=e.insert(n,i.overlayedDocument))),e}function Do(){return Ac()}function yC(){return Ac()}function Ac(){return new Fo((r=>r.toString()),((r,e)=>r.isEqual(e)))}const sN=new wt(Te.comparator),iN=new $t(Te.comparator);function Be(...r){let e=iN;for(const n of r)e=e.add(n);return e}const oN=new $t(je);function aN(){return oN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wd(e)?"-0":e}}function vC(r){return{integerValue:""+r}}function lN(r,e){return UP(e)?vC(e):wg(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this._=void 0}}function cN(r,e,n){return r instanceof qc?(function(a,c){const p={fields:{[eC]:{stringValue:ZE},[nC]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return c&&fg(c)&&(c=gp(c)),c&&(p.fields[tC]=c),{mapValue:p}})(n,e):r instanceof Ka?wC(r,e):r instanceof jc?TC(r,e):(function(a,c){const p=bC(a,c),h=IT(p)+IT(a.Ae);return Af(p)&&Af(a.Ae)?vC(h):wg(a.serializer,h)})(r,e)}function uN(r,e,n){return r instanceof Ka?wC(r,e):r instanceof jc?TC(r,e):n}function bC(r,e){return r instanceof Xd?(function(i){return Af(i)||(function(c){return!!c&&"doubleValue"in c})(i)})(e)?e:{integerValue:0}:null}class qc extends bp{}class Ka extends bp{constructor(e){super(),this.elements=e}}function wC(r,e){const n=SC(e);for(const i of r.elements)n.some((a=>hs(a,i)))||n.push(i);return{arrayValue:{values:n}}}class jc extends bp{constructor(e){super(),this.elements=e}}function TC(r,e){let n=SC(e);for(const i of r.elements)n=n.filter((a=>!hs(a,i)));return{arrayValue:{values:n}}}class Xd extends bp{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function IT(r){return Dt(r.integerValue||r.doubleValue)}function SC(r){return gg(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EC{constructor(e,n){this.field=e,this.transform=n}}function dN(r,e){return r.field.isEqual(e.field)&&(function(i,a){return i instanceof Ka&&a instanceof Ka||i instanceof jc&&a instanceof jc?Ga(i.elements,a.elements,hs):i instanceof Xd&&a instanceof Xd?hs(i.Ae,a.Ae):i instanceof qc&&a instanceof qc})(r.transform,e.transform)}class pN{constructor(e,n){this.version=e,this.transformResults=n}}class br{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new br}static exists(e){return new br(void 0,e)}static updateTime(e){return new br(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Od(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class wp{}function CC(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Tg(r.key,br.none()):new Kc(r.key,r.data,br.none());{const n=r.data,i=Ln.empty();let a=new $t(dn.comparator);for(let c of e.fields)if(!a.has(c)){let p=n.field(c);p===null&&c.length>1&&(c=c.popLast(),p=n.field(c)),p===null?i.delete(c):i.set(c,p),a=a.add(c)}return new Wi(r.key,i,new Yn(a.toArray()),br.none())}}function mN(r,e,n){r instanceof Kc?(function(a,c,p){const h=a.value.clone(),f=RT(a.fieldTransforms,c,p.transformResults);h.setAll(f),c.convertToFoundDocument(p.version,h).setHasCommittedMutations()})(r,e,n):r instanceof Wi?(function(a,c,p){if(!Od(a.precondition,c))return void c.convertToUnknownDocument(p.version);const h=RT(a.fieldTransforms,c,p.transformResults),f=c.data;f.setAll(_C(a)),f.setAll(h),c.convertToFoundDocument(p.version,f).setHasCommittedMutations()})(r,e,n):(function(a,c,p){c.convertToNoDocument(p.version).setHasCommittedMutations()})(0,e,n)}function Ic(r,e,n,i){return r instanceof Kc?(function(c,p,h,f){if(!Od(c.precondition,p))return h;const g=c.value.clone(),b=kT(c.fieldTransforms,f,p);return g.setAll(b),p.convertToFoundDocument(p.version,g).setHasLocalMutations(),null})(r,e,n,i):r instanceof Wi?(function(c,p,h,f){if(!Od(c.precondition,p))return h;const g=kT(c.fieldTransforms,f,p),b=p.data;return b.setAll(_C(c)),b.setAll(g),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),h===null?null:h.unionWith(c.fieldMask.fields).unionWith(c.fieldTransforms.map((E=>E.field)))})(r,e,n,i):(function(c,p,h){return Od(c.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):h})(r,e,n)}function hN(r,e){let n=null;for(const i of r.fieldTransforms){const a=e.data.field(i.field),c=bC(i.transform,a||null);c!=null&&(n===null&&(n=Ln.empty()),n.set(i.field,c))}return n||null}function xT(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(i,a){return i===void 0&&a===void 0||!(!i||!a)&&Ga(i,a,((c,p)=>dN(c,p)))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class Kc extends wp{constructor(e,n,i,a=[]){super(),this.key=e,this.value=n,this.precondition=i,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Wi extends wp{constructor(e,n,i,a,c=[]){super(),this.key=e,this.data=n,this.fieldMask=i,this.precondition=a,this.fieldTransforms=c,this.type=1}getFieldMask(){return this.fieldMask}}function _C(r){const e=new Map;return r.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=r.data.field(n);e.set(n,i)}})),e}function RT(r,e,n){const i=new Map;Ye(r.length===n.length,32656,{Re:n.length,Ve:r.length});for(let a=0;a<n.length;a++){const c=r[a],p=c.transform,h=e.data.field(c.field);i.set(c.field,uN(p,h,n[a]))}return i}function kT(r,e,n){const i=new Map;for(const a of r){const c=a.transform,p=n.data.field(a.field);i.set(a.field,cN(c,p,e))}return i}class Tg extends wp{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fN extends wp{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e,n,i,a){this.batchId=e,this.localWriteTime=n,this.baseMutations=i,this.mutations=a}applyToRemoteDocument(e,n){const i=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const c=this.mutations[a];c.key.isEqual(e.key)&&mN(c,e,i[a])}}applyToLocalView(e,n){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(n=Ic(i,e,n,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(n=Ic(i,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const i=yC();return this.mutations.forEach((a=>{const c=e.get(a.key),p=c.overlayedDocument;let h=this.applyToLocalView(p,c.mutatedFields);h=n.has(a.key)?null:h;const f=CC(p,h);f!==null&&i.set(a.key,f),p.isValidDocument()||p.convertToNoDocument(xe.min())})),i}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),Be())}isEqual(e){return this.batchId===e.batchId&&Ga(this.mutations,e.mutations,((n,i)=>xT(n,i)))&&Ga(this.baseMutations,e.baseMutations,((n,i)=>xT(n,i)))}}class Sg{constructor(e,n,i,a){this.batch=e,this.commitVersion=n,this.mutationResults=i,this.docVersions=a}static from(e,n,i){Ye(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let a=(function(){return sN})();const c=e.mutations;for(let p=0;p<c.length;p++)a=a.insert(c[p].key,i[p].version);return new Sg(e,n,i,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mt,He;function bN(r){switch(r){case X.OK:return Ae(64938);case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0;default:return Ae(15467,{code:r})}}function AC(r){if(r===void 0)return Ys("GRPC error has no .code"),X.UNKNOWN;switch(r){case Mt.OK:return X.OK;case Mt.CANCELLED:return X.CANCELLED;case Mt.UNKNOWN:return X.UNKNOWN;case Mt.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case Mt.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case Mt.INTERNAL:return X.INTERNAL;case Mt.UNAVAILABLE:return X.UNAVAILABLE;case Mt.UNAUTHENTICATED:return X.UNAUTHENTICATED;case Mt.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case Mt.NOT_FOUND:return X.NOT_FOUND;case Mt.ALREADY_EXISTS:return X.ALREADY_EXISTS;case Mt.PERMISSION_DENIED:return X.PERMISSION_DENIED;case Mt.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case Mt.ABORTED:return X.ABORTED;case Mt.OUT_OF_RANGE:return X.OUT_OF_RANGE;case Mt.UNIMPLEMENTED:return X.UNIMPLEMENTED;case Mt.DATA_LOSS:return X.DATA_LOSS;default:return Ae(39323,{code:r})}}(He=Mt||(Mt={}))[He.OK=0]="OK",He[He.CANCELLED=1]="CANCELLED",He[He.UNKNOWN=2]="UNKNOWN",He[He.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",He[He.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",He[He.NOT_FOUND=5]="NOT_FOUND",He[He.ALREADY_EXISTS=6]="ALREADY_EXISTS",He[He.PERMISSION_DENIED=7]="PERMISSION_DENIED",He[He.UNAUTHENTICATED=16]="UNAUTHENTICATED",He[He.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",He[He.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",He[He.ABORTED=10]="ABORTED",He[He.OUT_OF_RANGE=11]="OUT_OF_RANGE",He[He.UNIMPLEMENTED=12]="UNIMPLEMENTED",He[He.INTERNAL=13]="INTERNAL",He[He.UNAVAILABLE=14]="UNAVAILABLE",He[He.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TN=new Oi([4294967295,4294967295],0);function DT(r){const e=wN().encode(r),n=new BE;return n.update(e),new Uint8Array(n.digest())}function PT(r){const e=new DataView(r.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),a=e.getUint32(8,!0),c=e.getUint32(12,!0);return[new Oi([n,i],0),new Oi([a,c],0)]}class Eg{constructor(e,n,i){if(this.bitmap=e,this.padding=n,this.hashCount=i,n<0||n>=8)throw new wc(`Invalid padding: ${n}`);if(i<0)throw new wc(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new wc(`Invalid hash count: ${i}`);if(e.length===0&&n!==0)throw new wc(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Oi.fromNumber(this.ge)}ye(e,n,i){let a=e.add(n.multiply(Oi.fromNumber(i)));return a.compare(TN)===1&&(a=new Oi([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=DT(e),[i,a]=PT(n);for(let c=0;c<this.hashCount;c++){const p=this.ye(i,a,c);if(!this.we(p))return!1}return!0}static create(e,n,i){const a=e%8==0?0:8-e%8,c=new Uint8Array(Math.ceil(e/8)),p=new Eg(c,a,n);return i.forEach((h=>p.insert(h))),p}insert(e){if(this.ge===0)return;const n=DT(e),[i,a]=PT(n);for(let c=0;c<this.hashCount;c++){const p=this.ye(i,a,c);this.Se(p)}}Se(e){const n=Math.floor(e/8),i=e%8;this.bitmap[n]|=1<<i}}class wc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e,n,i,a,c){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=i,this.documentUpdates=a,this.resolvedLimboDocuments=c}static createSynthesizedRemoteEventForCurrentChange(e,n,i){const a=new Map;return a.set(e,Jc.createSynthesizedTargetChangeForCurrentChange(e,n,i)),new Tp(xe.min(),a,new wt(je),Qs(),Be())}}class Jc{constructor(e,n,i,a,c){this.resumeToken=e,this.current=n,this.addedDocuments=i,this.modifiedDocuments=a,this.removedDocuments=c}static createSynthesizedTargetChangeForCurrentChange(e,n,i){return new Jc(i,n,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,n,i,a){this.be=e,this.removedTargetIds=n,this.key=i,this.De=a}}class IC{constructor(e,n){this.targetId=e,this.Ce=n}}class xC{constructor(e,n,i=pn.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=n,this.resumeToken=i,this.cause=a}}class NT{constructor(){this.ve=0,this.Fe=OT(),this.Me=pn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Be(),n=Be(),i=Be();return this.Fe.forEach(((a,c)=>{switch(c){case 0:e=e.add(a);break;case 2:n=n.add(a);break;case 1:i=i.add(a);break;default:Ae(38017,{changeType:c})}})),new Jc(this.Me,this.xe,e,n,i)}qe(){this.Oe=!1,this.Fe=OT()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ye(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class SN{constructor(e){this.Ge=e,this.ze=new Map,this.je=Qs(),this.Je=Td(),this.He=Td(),this.Ye=new wt(je)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const i=this.nt(n);switch(e.state){case 0:this.rt(n)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),i.Le(e.resumeToken));break;default:Ae(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((i,a)=>{this.rt(a)&&n(a)}))}st(e){const n=e.targetId,i=e.Ce.count,a=this.ot(n);if(a){const c=a.target;if(xf(c))if(i===0){const p=new Te(c.path);this.et(n,p,bn.newNoDocument(p,xe.min()))}else Ye(i===1,20013,{expectedCount:i});else{const p=this._t(n);if(p!==i){const h=this.ut(e),f=h?this.ct(h,e,p):1;if(f!==0){this.it(n);const g=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,g)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:i="",padding:a=0},hashCount:c=0}=n;let p,h;try{p=qi(i).toUint8Array()}catch(f){if(f instanceof XE)return Ha("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new Eg(p,a,c)}catch(f){return Ha(f instanceof wc?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return h.ge===0?null:h}ct(e,n,i){return n.Ce.count===i-this.Pt(e,n.targetId)?0:2}Pt(e,n){const i=this.Ge.getRemoteKeysForTarget(n);let a=0;return i.forEach((c=>{const p=this.Ge.ht(),h=`projects/${p.projectId}/databases/${p.database}/documents/${c.path.canonicalString()}`;e.mightContain(h)||(this.et(n,c,null),a++)})),a}Tt(e){const n=new Map;this.ze.forEach(((c,p)=>{const h=this.ot(p);if(h){if(c.current&&xf(h.target)){const f=new Te(h.target.path);this.It(f).has(p)||this.Et(p,f)||this.et(p,f,bn.newNoDocument(f,e))}c.Be&&(n.set(p,c.ke()),c.qe())}}));let i=Be();this.He.forEach(((c,p)=>{let h=!0;p.forEachWhile((f=>{const g=this.ot(f);return!g||g.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(i=i.add(c))})),this.je.forEach(((c,p)=>p.setReadTime(e)));const a=new Tp(e,n,this.Ye,this.je,i);return this.je=Qs(),this.Je=Td(),this.He=Td(),this.Ye=new wt(je),a}Xe(e,n){if(!this.rt(e))return;const i=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,i),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,i){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),i&&(this.je=this.je.insert(n,i))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new NT,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new $t(je),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new $t(je),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||pe("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new NT),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Td(){return new wt(Te.comparator)}function OT(){return new wt(Te.comparator)}const EN={asc:"ASCENDING",desc:"DESCENDING"},CN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_N={and:"AND",or:"OR"};class AN{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function kf(r,e){return r.useProto3Json||fp(e)?e:{value:e}}function Zd(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function RC(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function IN(r,e){return Zd(r,e.toTimestamp())}function us(r){return Ye(!!r,49232),xe.fromTimestamp((function(n){const i=Li(n);return new dt(i.seconds,i.nanos)})(r))}function Cg(r,e){return Df(r,e).canonicalString()}function Df(r,e){const n=(function(a){return new ut(["projects",a.projectId,"databases",a.database])})(r).child("documents");return e===void 0?n:n.child(e)}function kC(r){const e=ut.fromString(r);return Ye(UC(e),10190,{key:e.toString()}),e}function Pf(r,e){return Cg(r.databaseId,e.path)}function Yh(r,e){const n=kC(e);if(n.get(1)!==r.databaseId.projectId)throw new ue(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+r.databaseId.projectId);if(n.get(3)!==r.databaseId.database)throw new ue(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+r.databaseId.database);return new Te(PC(n))}function DC(r,e){return Cg(r.databaseId,e)}function xN(r){const e=kC(r);return e.length===4?ut.emptyPath():PC(e)}function Nf(r){return new ut(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function PC(r){return Ye(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function UT(r,e,n){return{name:Pf(r,e),fields:n.value.mapValue.fields}}function RN(r,e){let n;if("targetChange"in e){e.targetChange;const i=(function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:Ae(39313,{state:g})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],c=(function(g,b){return g.useProto3Json?(Ye(b===void 0||typeof b=="string",58123),pn.fromBase64String(b||"")):(Ye(b===void 0||b instanceof Buffer||b instanceof Uint8Array,16193),pn.fromUint8Array(b||new Uint8Array))})(r,e.targetChange.resumeToken),p=e.targetChange.cause,h=p&&(function(g){const b=g.code===void 0?X.UNKNOWN:AC(g.code);return new ue(b,g.message||"")})(p);n=new xC(i,a,c,h||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const a=Yh(r,i.document.name),c=us(i.document.updateTime),p=i.document.createTime?us(i.document.createTime):xe.min(),h=new Ln({mapValue:{fields:i.document.fields}}),f=bn.newFoundDocument(a,c,p,h),g=i.targetIds||[],b=i.removedTargetIds||[];n=new Ud(g,b,f.key,f)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const a=Yh(r,i.document),c=i.readTime?us(i.readTime):xe.min(),p=bn.newNoDocument(a,c),h=i.removedTargetIds||[];n=new Ud([],h,p.key,p)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const a=Yh(r,i.document),c=i.removedTargetIds||[];n=new Ud([],c,a,null)}else{if(!("filter"in e))return Ae(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:a=0,unchangedNames:c}=i,p=new vN(a,c),h=i.targetId;n=new IC(h,p)}}return n}function kN(r,e){let n;if(e instanceof Kc)n={update:UT(r,e.key,e.value)};else if(e instanceof Tg)n={delete:Pf(r,e.key)};else if(e instanceof Wi)n={update:UT(r,e.key,e.data),updateMask:jN(e.fieldMask)};else{if(!(e instanceof fN))return Ae(16599,{Vt:e.type});n={verify:Pf(r,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((i=>(function(c,p){const h=p.transform;if(h instanceof qc)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Ka)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof jc)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Xd)return{fieldPath:p.field.canonicalString(),increment:h.Ae};throw Ae(20930,{transform:p.transform})})(0,i)))),e.precondition.isNone||(n.currentDocument=(function(a,c){return c.updateTime!==void 0?{updateTime:IN(a,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:Ae(27497)})(r,e.precondition)),n}function DN(r,e){return r&&r.length>0?(Ye(e!==void 0,14353),r.map((n=>(function(a,c){let p=a.updateTime?us(a.updateTime):us(c);return p.isEqual(xe.min())&&(p=us(c)),new pN(p,a.transformResults||[])})(n,e)))):[]}function PN(r,e){return{documents:[DC(r,e.path)]}}function NN(r,e){const n={structuredQuery:{}},i=e.path;let a;e.collectionGroup!==null?(a=i,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=DC(r,a);const c=(function(g){if(g.length!==0)return OC(jr.create(g,"and"))})(e.filters);c&&(n.structuredQuery.where=c);const p=(function(g){if(g.length!==0)return g.map((b=>(function(C){return{field:La(C.field),direction:MN(C.dir)}})(b)))})(e.orderBy);p&&(n.structuredQuery.orderBy=p);const h=kf(r,e.limit);return h!==null&&(n.structuredQuery.limit=h),e.startAt&&(n.structuredQuery.startAt=(function(g){return{before:g.inclusive,values:g.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(g){return{before:!g.inclusive,values:g.position}})(e.endAt)),{ft:n,parent:a}}function ON(r){let e=xN(r.parent);const n=r.structuredQuery,i=n.from?n.from.length:0;let a=null;if(i>0){Ye(i===1,65062);const b=n.from[0];b.allDescendants?a=b.collectionId:e=e.child(b.collectionId)}let c=[];n.where&&(c=(function(E){const C=NC(E);return C instanceof jr&&lC(C)?C.getFilters():[C]})(n.where));let p=[];n.orderBy&&(p=(function(E){return E.map((C=>(function(z){return new Lc(qa(z.field),(function($){switch($){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(z.direction))})(C)))})(n.orderBy));let h=null;n.limit&&(h=(function(E){let C;return C=typeof E=="object"?E.value:E,fp(C)?null:C})(n.limit));let f=null;n.startAt&&(f=(function(E){const C=!!E.before,M=E.values||[];return new Yd(M,C)})(n.startAt));let g=null;return n.endAt&&(g=(function(E){const C=!E.before,M=E.values||[];return new Yd(M,C)})(n.endAt)),ZP(e,a,p,c,h,"F",f,g)}function UN(r,e){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ae(28987,{purpose:a})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function NC(r){return r.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const i=qa(n.unaryFilter.field);return Lt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const a=qa(n.unaryFilter.field);return Lt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const c=qa(n.unaryFilter.field);return Lt.create(c,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=qa(n.unaryFilter.field);return Lt.create(p,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ae(61313);default:return Ae(60726)}})(r):r.fieldFilter!==void 0?(function(n){return Lt.create(qa(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ae(58110);default:return Ae(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(n){return jr.create(n.compositeFilter.filters.map((i=>NC(i))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ae(1026)}})(n.compositeFilter.op))})(r):Ae(30097,{filter:r})}function MN(r){return EN[r]}function LN(r){return CN[r]}function qN(r){return _N[r]}function La(r){return{fieldPath:r.canonicalString()}}function qa(r){return dn.fromServerFormat(r.fieldPath)}function OC(r){return r instanceof Lt?(function(n){if(n.op==="=="){if(ST(n.value))return{unaryFilter:{field:La(n.field),op:"IS_NAN"}};if(TT(n.value))return{unaryFilter:{field:La(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(ST(n.value))return{unaryFilter:{field:La(n.field),op:"IS_NOT_NAN"}};if(TT(n.value))return{unaryFilter:{field:La(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:La(n.field),op:LN(n.op),value:n.value}}})(r):r instanceof jr?(function(n){const i=n.getFilters().map((a=>OC(a)));return i.length===1?i[0]:{compositeFilter:{op:qN(n.op),filters:i}}})(r):Ae(54877,{filter:r})}function jN(r){const e=[];return r.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function UC(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,n,i,a,c=xe.min(),p=xe.min(),h=pn.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=n,this.purpose=i,this.sequenceNumber=a,this.snapshotVersion=c,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new Di(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Di(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e){this.yt=e}}function zN(r){const e=ON({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Qd(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{constructor(){this.Cn=new VN}addToCollectionParentIndex(e,n){return this.Cn.add(n),te.resolve()}getCollectionParents(e,n){return te.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return te.resolve()}deleteFieldIndex(e,n){return te.resolve()}deleteAllFieldIndexes(e){return te.resolve()}createTargetIndexes(e,n){return te.resolve()}getDocumentsMatchingTarget(e,n){return te.resolve(null)}getIndexType(e,n){return te.resolve(0)}getFieldIndexes(e,n){return te.resolve([])}getNextCollectionGroupToUpdate(e){return te.resolve(null)}getMinOffset(e,n){return te.resolve(Mi.min())}getMinOffsetFromCollectionGroup(e,n){return te.resolve(Mi.min())}updateCollectionGroup(e,n,i){return te.resolve()}updateIndexEntries(e,n){return te.resolve()}}class VN{constructor(){this.index={}}add(e){const n=e.lastSegment(),i=e.popLast(),a=this.index[n]||new $t(ut.comparator),c=!a.has(i);return this.index[n]=a.add(i),c}has(e){const n=e.lastSegment(),i=e.popLast(),a=this.index[n];return a&&a.has(i)}getEntries(e){return(this.index[e]||new $t(ut.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},MC=41943040;class Mn{static withCacheSize(e){return new Mn(e,Mn.DEFAULT_COLLECTION_PERCENTILE,Mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Mn.DEFAULT_COLLECTION_PERCENTILE=10,Mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mn.DEFAULT=new Mn(MC,Mn.DEFAULT_COLLECTION_PERCENTILE,Mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mn.DISABLED=new Mn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ja(0)}static cr(){return new Ja(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT="LruGarbageCollector",HN=1048576;function qT([r,e],[n,i]){const a=je(r,n);return a===0?je(e,i):a}class GN{constructor(e){this.Ir=e,this.buffer=new $t(qT),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const i=this.buffer.last();qT(n,i)<0&&(this.buffer=this.buffer.delete(i).add(n))}}get maxValue(){return this.buffer.last()[0]}}class $N{constructor(e,n,i){this.garbageCollector=e,this.asyncQueue=n,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){pe(LT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){il(n)?pe(LT,"Ignoring IndexedDB error during garbage collection: ",n):await sl(n)}await this.Vr(3e5)}))}}class WN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((i=>Math.floor(n/100*i)))}nthSequenceNumber(e,n){if(n===0)return te.resolve(hp.ce);const i=new GN(n);return this.mr.forEachTarget(e,(a=>i.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>i.Ar(a))))).next((()=>i.maxValue))}removeTargets(e,n,i){return this.mr.removeTargets(e,n,i)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),te.resolve(MT)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),MT):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let i,a,c,p,h,f,g;const b=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),a=this.params.maximumSequenceNumbersToCollect):a=E,p=Date.now(),this.nthSequenceNumber(e,a)))).next((E=>(i=E,h=Date.now(),this.removeTargets(e,i,n)))).next((E=>(c=E,f=Date.now(),this.removeOrphanedDocuments(e,i)))).next((E=>(g=Date.now(),Ua()<=qe.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-b}ms
	Determined least recently used ${a} in `+(h-p)+`ms
	Removed ${c} targets in `+(f-h)+`ms
	Removed ${E} documents in `+(g-f)+`ms
Total Duration: ${g-b}ms`),te.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:c,documentsRemoved:E}))))}}function KN(r,e){return new WN(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(){this.changes=new Fo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,bn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const i=this.changes.get(n);return i!==void 0?te.resolve(i):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(e,n,i,a){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=i,this.indexManager=a}getDocument(e,n){let i=null;return this.documentOverlayCache.getOverlay(e,n).next((a=>(i=a,this.remoteDocumentCache.getEntry(e,n)))).next((a=>(i!==null&&Ic(i.mutation,a,Yn.empty(),dt.now()),a)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((i=>this.getLocalViewOfDocuments(e,i,Be()).next((()=>i))))}getLocalViewOfDocuments(e,n,i=Be()){const a=Do();return this.populateOverlays(e,a,n).next((()=>this.computeViews(e,n,a,i).next((c=>{let p=bc();return c.forEach(((h,f)=>{p=p.insert(h,f.overlayedDocument)})),p}))))}getOverlayedDocuments(e,n){const i=Do();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,Be())))}populateOverlays(e,n,i){const a=[];return i.forEach((c=>{n.has(c)||a.push(c)})),this.documentOverlayCache.getOverlays(e,a).next((c=>{c.forEach(((p,h)=>{n.set(p,h)}))}))}computeViews(e,n,i,a){let c=Qs();const p=Ac(),h=(function(){return Ac()})();return n.forEach(((f,g)=>{const b=i.get(g.key);a.has(g.key)&&(b===void 0||b.mutation instanceof Wi)?c=c.insert(g.key,g):b!==void 0?(p.set(g.key,b.mutation.getFieldMask()),Ic(b.mutation,g,b.mutation.getFieldMask(),dt.now())):p.set(g.key,Yn.empty())})),this.recalculateAndSaveOverlays(e,c).next((f=>(f.forEach(((g,b)=>p.set(g,b))),n.forEach(((g,b)=>h.set(g,new YN(b,p.get(g)??null)))),h)))}recalculateAndSaveOverlays(e,n){const i=Ac();let a=new wt(((p,h)=>p-h)),c=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((p=>{for(const h of p)h.keys().forEach((f=>{const g=n.get(f);if(g===null)return;let b=i.get(f)||Yn.empty();b=h.applyToLocalView(g,b),i.set(f,b);const E=(a.get(h.batchId)||Be()).add(f);a=a.insert(h.batchId,E)}))})).next((()=>{const p=[],h=a.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),g=f.key,b=f.value,E=yC();b.forEach((C=>{if(!c.has(C)){const M=CC(n.get(C),i.get(C));M!==null&&E.set(C,M),c=c.add(C)}})),p.push(this.documentOverlayCache.saveOverlays(e,g,E))}return te.waitFor(p)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,n,i,a){return(function(p){return Te.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):pC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,i,a):this.getDocumentsMatchingCollectionQuery(e,n,i,a)}getNextDocuments(e,n,i,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,i,a).next((c=>{const p=a-c.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,i.largestBatchId,a-c.size):te.resolve(Do());let h=Nc,f=c;return p.next((g=>te.forEach(g,((b,E)=>(h<E.largestBatchId&&(h=E.largestBatchId),c.get(b)?te.resolve():this.remoteDocumentCache.getEntry(e,b).next((C=>{f=f.insert(b,C)}))))).next((()=>this.populateOverlays(e,g,c))).next((()=>this.computeViews(e,f,g,Be()))).next((b=>({batchId:h,changes:gC(b)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Te(n)).next((i=>{let a=bc();return i.isFoundDocument()&&(a=a.insert(i.key,i)),a}))}getDocumentsMatchingCollectionGroupQuery(e,n,i,a){const c=n.collectionGroup;let p=bc();return this.indexManager.getCollectionParents(e,c).next((h=>te.forEach(h,(f=>{const g=(function(E,C){return new ol(C,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(n,f.child(c));return this.getDocumentsMatchingCollectionQuery(e,g,i,a).next((b=>{b.forEach(((E,C)=>{p=p.insert(E,C)}))}))})).next((()=>p))))}getDocumentsMatchingCollectionQuery(e,n,i,a){let c;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,i.largestBatchId).next((p=>(c=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,i,c,a)))).next((p=>{c.forEach(((f,g)=>{const b=g.getKey();p.get(b)===null&&(p=p.insert(b,bn.newInvalidDocument(b)))}));let h=bc();return p.forEach(((f,g)=>{const b=c.get(f);b!==void 0&&Ic(b.mutation,g,Yn.empty(),dt.now()),vp(n,g)&&(h=h.insert(f,g))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return te.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:us(a.createTime)}})(n)),te.resolve()}getNamedQuery(e,n){return te.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:zN(a.bundledQuery),readTime:us(a.readTime)}})(n)),te.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(){this.overlays=new wt(Te.comparator),this.qr=new Map}getOverlay(e,n){return te.resolve(this.overlays.get(n))}getOverlays(e,n){const i=Do();return te.forEach(n,(a=>this.getOverlay(e,a).next((c=>{c!==null&&i.set(a,c)})))).next((()=>i))}saveOverlays(e,n,i){return i.forEach(((a,c)=>{this.St(e,n,c)})),te.resolve()}removeOverlaysForBatchId(e,n,i){const a=this.qr.get(i);return a!==void 0&&(a.forEach((c=>this.overlays=this.overlays.remove(c))),this.qr.delete(i)),te.resolve()}getOverlaysForCollection(e,n,i){const a=Do(),c=n.length+1,p=new Te(n.child("")),h=this.overlays.getIteratorFrom(p);for(;h.hasNext();){const f=h.getNext().value,g=f.getKey();if(!n.isPrefixOf(g.path))break;g.path.length===c&&f.largestBatchId>i&&a.set(f.getKey(),f)}return te.resolve(a)}getOverlaysForCollectionGroup(e,n,i,a){let c=new wt(((g,b)=>g-b));const p=this.overlays.getIterator();for(;p.hasNext();){const g=p.getNext().value;if(g.getKey().getCollectionGroup()===n&&g.largestBatchId>i){let b=c.get(g.largestBatchId);b===null&&(b=Do(),c=c.insert(g.largestBatchId,b)),b.set(g.getKey(),g)}}const h=Do(),f=c.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((g,b)=>h.set(g,b))),!(h.size()>=a)););return te.resolve(h)}St(e,n,i){const a=this.overlays.get(i.key);if(a!==null){const p=this.qr.get(a.largestBatchId).delete(i.key);this.qr.set(a.largestBatchId,p)}this.overlays=this.overlays.insert(i.key,new yN(n,i));let c=this.qr.get(n);c===void 0&&(c=Be(),this.qr.set(n,c)),this.qr.set(n,c.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(){this.sessionToken=pn.EMPTY_BYTE_STRING}getSessionToken(e){return te.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,te.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(){this.Qr=new $t(rn.$r),this.Ur=new $t(rn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const i=new rn(e,n);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,n){e.forEach((i=>this.addReference(i,n)))}removeReference(e,n){this.Gr(new rn(e,n))}zr(e,n){e.forEach((i=>this.removeReference(i,n)))}jr(e){const n=new Te(new ut([])),i=new rn(n,e),a=new rn(n,e+1),c=[];return this.Ur.forEachInRange([i,a],(p=>{this.Gr(p),c.push(p.key)})),c}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Te(new ut([])),i=new rn(n,e),a=new rn(n,e+1);let c=Be();return this.Ur.forEachInRange([i,a],(p=>{c=c.add(p.key)})),c}containsKey(e){const n=new rn(e,0),i=this.Qr.firstAfterOrEqual(n);return i!==null&&e.isEqual(i.key)}}class rn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Te.comparator(e.key,n.key)||je(e.Yr,n.Yr)}static Kr(e,n){return je(e.Yr,n.Yr)||Te.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new $t(rn.$r)}checkEmpty(e){return te.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,i,a){const c=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new gN(c,n,i,a);this.mutationQueue.push(p);for(const h of a)this.Zr=this.Zr.add(new rn(h.key,c)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return te.resolve(p)}lookupMutationBatch(e,n){return te.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const i=n+1,a=this.ei(i),c=a<0?0:a;return te.resolve(this.mutationQueue.length>c?this.mutationQueue[c]:null)}getHighestUnacknowledgedBatchId(){return te.resolve(this.mutationQueue.length===0?hg:this.tr-1)}getAllMutationBatches(e){return te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const i=new rn(n,0),a=new rn(n,Number.POSITIVE_INFINITY),c=[];return this.Zr.forEachInRange([i,a],(p=>{const h=this.Xr(p.Yr);c.push(h)})),te.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(e,n){let i=new $t(je);return n.forEach((a=>{const c=new rn(a,0),p=new rn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([c,p],(h=>{i=i.add(h.Yr)}))})),te.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,n){const i=n.path,a=i.length+1;let c=i;Te.isDocumentKey(c)||(c=c.child(""));const p=new rn(new Te(c),0);let h=new $t(je);return this.Zr.forEachWhile((f=>{const g=f.key.path;return!!i.isPrefixOf(g)&&(g.length===a&&(h=h.add(f.Yr)),!0)}),p),te.resolve(this.ti(h))}ti(e){const n=[];return e.forEach((i=>{const a=this.Xr(i);a!==null&&n.push(a)})),n}removeMutationBatch(e,n){Ye(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return te.forEach(n.mutations,(a=>{const c=new rn(a.key,n.batchId);return i=i.delete(c),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=i}))}ir(e){}containsKey(e,n){const i=new rn(n,0),a=this.Zr.firstAfterOrEqual(i);return te.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,te.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e){this.ri=e,this.docs=(function(){return new wt(Te.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const i=n.key,a=this.docs.get(i),c=a?a.size:0,p=this.ri(n);return this.docs=this.docs.insert(i,{document:n.mutableCopy(),size:p}),this.size+=p-c,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const i=this.docs.get(n);return te.resolve(i?i.document.mutableCopy():bn.newInvalidDocument(n))}getEntries(e,n){let i=Qs();return n.forEach((a=>{const c=this.docs.get(a);i=i.insert(a,c?c.document.mutableCopy():bn.newInvalidDocument(a))})),te.resolve(i)}getDocumentsMatchingQuery(e,n,i,a){let c=Qs();const p=n.path,h=new Te(p.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:g,value:{document:b}}=f.getNext();if(!p.isPrefixOf(g.path))break;g.path.length>p.length+1||DP(kP(b),i)<=0||(a.has(b.key)||vp(n,b))&&(c=c.insert(b.key,b.mutableCopy()))}return te.resolve(c)}getAllFromCollectionGroup(e,n,i,a){Ae(9500)}ii(e,n){return te.forEach(this.docs,(i=>n(i)))}newChangeBuffer(e){return new r1(this)}getSize(e){return te.resolve(this.size)}}class r1 extends JN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((i,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(i)})),te.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(e){this.persistence=e,this.si=new Fo((n=>yg(n)),vg),this.lastRemoteSnapshotVersion=xe.min(),this.highestTargetId=0,this.oi=0,this._i=new _g,this.targetCount=0,this.ai=Ja.ur()}forEachTarget(e,n){return this.si.forEach(((i,a)=>n(a))),te.resolve()}getLastRemoteSnapshotVersion(e){return te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return te.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),te.resolve(this.highestTargetId)}setTargetsMetadata(e,n,i){return i&&(this.lastRemoteSnapshotVersion=i),n>this.oi&&(this.oi=n),te.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ja(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,te.resolve()}updateTargetData(e,n){return this.Pr(n),te.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,te.resolve()}removeTargets(e,n,i){let a=0;const c=[];return this.si.forEach(((p,h)=>{h.sequenceNumber<=n&&i.get(h.targetId)===null&&(this.si.delete(p),c.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),te.waitFor(c).next((()=>a))}getTargetCount(e){return te.resolve(this.targetCount)}getTargetData(e,n){const i=this.si.get(n)||null;return te.resolve(i)}addMatchingKeys(e,n,i){return this._i.Wr(n,i),te.resolve()}removeMatchingKeys(e,n,i){this._i.zr(n,i);const a=this.persistence.referenceDelegate,c=[];return a&&n.forEach((p=>{c.push(a.markPotentiallyOrphaned(e,p))})),te.waitFor(c)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),te.resolve()}getMatchingKeysForTargetId(e,n){const i=this._i.Hr(n);return te.resolve(i)}containsKey(e,n){return te.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e,n){this.ui={},this.overlays={},this.ci=new hp(0),this.li=!1,this.li=!0,this.hi=new e1,this.referenceDelegate=e(this),this.Pi=new s1(this),this.indexManager=new FN,this.remoteDocumentCache=(function(a){return new n1(a)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new BN(n),this.Ii=new XN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new ZN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let i=this.ui[e.toKey()];return i||(i=new t1(n,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,i){pe("MemoryPersistence","Starting transaction:",e);const a=new i1(this.ci.next());return this.referenceDelegate.Ei(),i(a).next((c=>this.referenceDelegate.di(a).next((()=>c)))).toPromise().then((c=>(a.raiseOnCommittedEvent(),c)))}Ai(e,n){return te.or(Object.values(this.ui).map((i=>()=>i.containsKey(e,n))))}}class i1 extends NP{constructor(e){super(),this.currentSequenceNumber=e}}class Ag{constructor(e){this.persistence=e,this.Ri=new _g,this.Vi=null}static mi(e){return new Ag(e)}get fi(){if(this.Vi)return this.Vi;throw Ae(60996)}addReference(e,n,i){return this.Ri.addReference(i,n),this.fi.delete(i.toString()),te.resolve()}removeReference(e,n,i){return this.Ri.removeReference(i,n),this.fi.add(i.toString()),te.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),te.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,n.targetId).next((a=>{a.forEach((c=>this.fi.add(c.toString())))})).next((()=>i.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return te.forEach(this.fi,(i=>{const a=Te.fromPath(i);return this.gi(e,a).next((c=>{c||n.removeEntry(a,xe.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((i=>{i?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return te.or([()=>te.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class ep{constructor(e,n){this.persistence=e,this.pi=new Fo((i=>MP(i.path)),((i,a)=>i.isEqual(a))),this.garbageCollector=KN(this,n)}static mi(e,n){return new ep(e,n)}Ei(){}di(e){return te.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>n.next((a=>i+a))))}wr(e){let n=0;return this.pr(e,(i=>{n++})).next((()=>n))}pr(e,n){return te.forEach(this.pi,((i,a)=>this.br(e,i,a).next((c=>c?te.resolve():n(a)))))}removeTargets(e,n,i){return this.persistence.getTargetCache().removeTargets(e,n,i)}removeOrphanedDocuments(e,n){let i=0;const a=this.persistence.getRemoteDocumentCache(),c=a.newChangeBuffer();return a.ii(e,(p=>this.br(e,p,n).next((h=>{h||(i++,c.removeEntry(p,xe.min()))})))).next((()=>c.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),te.resolve()}removeTarget(e,n){const i=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,n,i){return this.pi.set(i,e.currentSequenceNumber),te.resolve()}removeReference(e,n,i){return this.pi.set(i,e.currentSequenceNumber),te.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),te.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Pd(e.data.value)),n}br(e,n,i){return te.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const a=this.pi.get(n);return te.resolve(a!==void 0&&a>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e,n,i,a){this.targetId=e,this.fromCache=n,this.Es=i,this.ds=a}static As(e,n){let i=Be(),a=Be();for(const c of n.docChanges)switch(c.type){case 0:i=i.add(c.doc.key);break;case 1:a=a.add(c.doc.key)}return new Ig(e,n.fromCache,i,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o1{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Ux()?8:OP(wn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,i,a){const c={result:null};return this.ys(e,n).next((p=>{c.result=p})).next((()=>{if(!c.result)return this.ws(e,n,a,i).next((p=>{c.result=p}))})).next((()=>{if(c.result)return;const p=new o1;return this.Ss(e,n,p).next((h=>{if(c.result=h,this.Vs)return this.bs(e,n,p,h.size)}))})).next((()=>c.result))}bs(e,n,i,a){return i.documentReadCount<this.fs?(Ua()<=qe.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",Ma(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),te.resolve()):(Ua()<=qe.DEBUG&&pe("QueryEngine","Query:",Ma(n),"scans",i.documentReadCount,"local documents and returns",a,"documents as results."),i.documentReadCount>this.gs*a?(Ua()<=qe.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",Ma(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cs(n))):te.resolve())}ys(e,n){if(AT(n))return te.resolve(null);let i=cs(n);return this.indexManager.getIndexType(e,i).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=Qd(n,null,"F"),i=cs(n)),this.indexManager.getDocumentsMatchingTarget(e,i).next((c=>{const p=Be(...c);return this.ps.getDocuments(e,p).next((h=>this.indexManager.getMinOffset(e,i).next((f=>{const g=this.Ds(n,h);return this.Cs(n,g,p,f.readTime)?this.ys(e,Qd(n,null,"F")):this.vs(e,g,n,f)}))))})))))}ws(e,n,i,a){return AT(n)||a.isEqual(xe.min())?te.resolve(null):this.ps.getDocuments(e,i).next((c=>{const p=this.Ds(n,c);return this.Cs(n,p,i,a)?te.resolve(null):(Ua()<=qe.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Ma(n)),this.vs(e,p,n,RP(a,Nc)).next((h=>h)))}))}Ds(e,n){let i=new $t(hC(e));return n.forEach(((a,c)=>{vp(e,c)&&(i=i.add(c))})),i}Cs(e,n,i,a){if(e.limit===null)return!1;if(i.size!==n.size)return!0;const c=e.limitType==="F"?n.last():n.first();return!!c&&(c.hasPendingWrites||c.version.compareTo(a)>0)}Ss(e,n,i){return Ua()<=qe.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",Ma(n)),this.ps.getDocumentsMatchingQuery(e,n,Mi.min(),i)}vs(e,n,i,a){return this.ps.getDocumentsMatchingQuery(e,i,a).next((c=>(n.forEach((p=>{c=c.insert(p.key,p)})),c)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xg="LocalStore",l1=3e8;class c1{constructor(e,n,i,a){this.persistence=e,this.Fs=n,this.serializer=a,this.Ms=new wt(je),this.xs=new Fo((c=>yg(c)),vg),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new QN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function u1(r,e,n,i){return new c1(r,e,n,i)}async function qC(r,e){const n=Re(r);return await n.persistence.runTransaction("Handle user change","readonly",(i=>{let a;return n.mutationQueue.getAllMutationBatches(i).next((c=>(a=c,n.Bs(e),n.mutationQueue.getAllMutationBatches(i)))).next((c=>{const p=[],h=[];let f=Be();for(const g of a){p.push(g.batchId);for(const b of g.mutations)f=f.add(b.key)}for(const g of c){h.push(g.batchId);for(const b of g.mutations)f=f.add(b.key)}return n.localDocuments.getDocuments(i,f).next((g=>({Ls:g,removedBatchIds:p,addedBatchIds:h})))}))}))}function d1(r,e){const n=Re(r);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const a=e.batch.keys(),c=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,f,g,b){const E=g.batch,C=E.keys();let M=te.resolve();return C.forEach((z=>{M=M.next((()=>b.getEntry(f,z))).next((Q=>{const $=g.docVersions.get(z);Ye($!==null,48541),Q.version.compareTo($)<0&&(E.applyToRemoteDocument(Q,g),Q.isValidDocument()&&(Q.setReadTime(g.commitVersion),b.addEntry(Q)))}))})),M.next((()=>h.mutationQueue.removeMutationBatch(f,E)))})(n,i,e,c).next((()=>c.apply(i))).next((()=>n.mutationQueue.performConsistencyCheck(i))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(i,a,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(h){let f=Be();for(let g=0;g<h.mutationResults.length;++g)h.mutationResults[g].transformResults.length>0&&(f=f.add(h.batch.mutations[g].key));return f})(e)))).next((()=>n.localDocuments.getDocuments(i,a)))}))}function jC(r){const e=Re(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function p1(r,e){const n=Re(r),i=e.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(c=>{const p=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const h=[];e.targetChanges.forEach(((b,E)=>{const C=a.get(E);if(!C)return;h.push(n.Pi.removeMatchingKeys(c,b.removedDocuments,E).next((()=>n.Pi.addMatchingKeys(c,b.addedDocuments,E))));let M=C.withSequenceNumber(c.currentSequenceNumber);e.targetMismatches.get(E)!==null?M=M.withResumeToken(pn.EMPTY_BYTE_STRING,xe.min()).withLastLimboFreeSnapshotVersion(xe.min()):b.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(b.resumeToken,i)),a=a.insert(E,M),(function(Q,$,ie){return Q.resumeToken.approximateByteSize()===0||$.snapshotVersion.toMicroseconds()-Q.snapshotVersion.toMicroseconds()>=l1?!0:ie.addedDocuments.size+ie.modifiedDocuments.size+ie.removedDocuments.size>0})(C,M,b)&&h.push(n.Pi.updateTargetData(c,M))}));let f=Qs(),g=Be();if(e.documentUpdates.forEach((b=>{e.resolvedLimboDocuments.has(b)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(c,b))})),h.push(m1(c,p,e.documentUpdates).next((b=>{f=b.ks,g=b.qs}))),!i.isEqual(xe.min())){const b=n.Pi.getLastRemoteSnapshotVersion(c).next((E=>n.Pi.setTargetsMetadata(c,c.currentSequenceNumber,i)));h.push(b)}return te.waitFor(h).next((()=>p.apply(c))).next((()=>n.localDocuments.getLocalViewOfDocuments(c,f,g))).next((()=>f))})).then((c=>(n.Ms=a,c)))}function m1(r,e,n){let i=Be(),a=Be();return n.forEach((c=>i=i.add(c))),e.getEntries(r,i).next((c=>{let p=Qs();return n.forEach(((h,f)=>{const g=c.get(h);f.isFoundDocument()!==g.isFoundDocument()&&(a=a.add(h)),f.isNoDocument()&&f.version.isEqual(xe.min())?(e.removeEntry(h,f.readTime),p=p.insert(h,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||f.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(f),p=p.insert(h,f)):pe(xg,"Ignoring outdated watch update for ",h,". Current version:",g.version," Watch version:",f.version)})),{ks:p,qs:a}}))}function h1(r,e){const n=Re(r);return n.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=hg),n.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function f1(r,e){const n=Re(r);return n.persistence.runTransaction("Allocate target","readwrite",(i=>{let a;return n.Pi.getTargetData(i,e).next((c=>c?(a=c,te.resolve(a)):n.Pi.allocateTargetId(i).next((p=>(a=new Di(e,p,"TargetPurposeListen",i.currentSequenceNumber),n.Pi.addTargetData(i,a).next((()=>a)))))))})).then((i=>{const a=n.Ms.get(i.targetId);return(a===null||i.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(i.targetId,i),n.xs.set(e,i.targetId)),i}))}async function Of(r,e,n){const i=Re(r),a=i.Ms.get(e),c=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",c,(p=>i.persistence.referenceDelegate.removeTarget(p,a)))}catch(p){if(!il(p))throw p;pe(xg,`Failed to update sequence numbers for target ${e}: ${p}`)}i.Ms=i.Ms.remove(e),i.xs.delete(a.target)}function jT(r,e,n){const i=Re(r);let a=xe.min(),c=Be();return i.persistence.runTransaction("Execute query","readwrite",(p=>(function(f,g,b){const E=Re(f),C=E.xs.get(b);return C!==void 0?te.resolve(E.Ms.get(C)):E.Pi.getTargetData(g,b)})(i,p,cs(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(p,h.targetId).next((f=>{c=f}))})).next((()=>i.Fs.getDocumentsMatchingQuery(p,e,n?a:xe.min(),n?c:Be()))).next((h=>(g1(i,tN(e),h),{documents:h,Qs:c})))))}function g1(r,e,n){let i=r.Os.get(e)||xe.min();n.forEach(((a,c)=>{c.readTime.compareTo(i)>0&&(i=c.readTime)})),r.Os.set(e,i)}class BT{constructor(){this.activeTargetIds=aN()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class y1{constructor(){this.Mo=new BT,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,i){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,i){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new BT,Promise.resolve()}handleUserChange(e,n,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zT="ConnectivityMonitor";class FT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){pe(zT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){pe(zT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sd=null;function Uf(){return Sd===null?Sd=(function(){return 268435456+Math.round(2147483648*Math.random())})():Sd++,"0x"+Sd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh="RestConnection",b1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class w1{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${i}/databases/${a}`,this.Wo=this.databaseId.database===Kd?`project_id=${i}`:`project_id=${i}&database_id=${a}`}Go(e,n,i,a,c){const p=Uf(),h=this.zo(e,n.toUriEncodedString());pe(Qh,`Sending RPC '${e}' ${p}:`,h,i);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,a,c);const{host:g}=new URL(h),b=el(g);return this.Jo(e,h,f,i,b).then((E=>(pe(Qh,`Received RPC '${e}' ${p}: `,E),E)),(E=>{throw Ha(Qh,`RPC '${e}' ${p} failed with error: `,E,"url: ",h,"request:",i),E}))}Ho(e,n,i,a,c,p){return this.Go(e,n,i,a,c)}jo(e,n,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+rl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,c)=>e[c]=a)),i&&i.headers.forEach(((a,c)=>e[c]=a))}zo(e,n){const i=b1[e];return`${this.Uo}/v1/${n}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn="WebChannelConnection";class S1 extends w1{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,i,a,c){const p=Uf();return new Promise(((h,f)=>{const g=new zE;g.setWithCredentials(!0),g.listenOnce(FE.COMPLETE,(()=>{try{switch(g.getLastErrorCode()){case Dd.NO_ERROR:const E=g.getResponseJson();pe(yn,`XHR for RPC '${e}' ${p} received:`,JSON.stringify(E)),h(E);break;case Dd.TIMEOUT:pe(yn,`RPC '${e}' ${p} timed out`),f(new ue(X.DEADLINE_EXCEEDED,"Request time out"));break;case Dd.HTTP_ERROR:const C=g.getStatus();if(pe(yn,`RPC '${e}' ${p} failed with status:`,C,"response text:",g.getResponseText()),C>0){let M=g.getResponseJson();Array.isArray(M)&&(M=M[0]);const z=M?.error;if(z&&z.status&&z.message){const Q=(function(ie){const re=ie.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(re)>=0?re:X.UNKNOWN})(z.status);f(new ue(Q,z.message))}else f(new ue(X.UNKNOWN,"Server responded with status "+g.getStatus()))}else f(new ue(X.UNAVAILABLE,"Connection failed."));break;default:Ae(9055,{l_:e,streamId:p,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{pe(yn,`RPC '${e}' ${p} completed.`)}}));const b=JSON.stringify(a);pe(yn,`RPC '${e}' ${p} sending request:`,a),g.send(n,"POST",b,i,15)}))}T_(e,n,i){const a=Uf(),c=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=GE(),h=HE(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,n,i),f.encodeInitMessageHeaders=!0;const b=c.join("");pe(yn,`Creating RPC '${e}' stream ${a}: ${b}`,f);const E=p.createWebChannel(b,f);this.I_(E);let C=!1,M=!1;const z=new T1({Yo:$=>{M?pe(yn,`Not sending because RPC '${e}' stream ${a} is closed:`,$):(C||(pe(yn,`Opening RPC '${e}' stream ${a} transport.`),E.open(),C=!0),pe(yn,`RPC '${e}' stream ${a} sending:`,$),E.send($))},Zo:()=>E.close()}),Q=($,ie,re)=>{$.listen(ie,(ae=>{try{re(ae)}catch(ve){setTimeout((()=>{throw ve}),0)}}))};return Q(E,vc.EventType.OPEN,(()=>{M||(pe(yn,`RPC '${e}' stream ${a} transport opened.`),z.o_())})),Q(E,vc.EventType.CLOSE,(()=>{M||(M=!0,pe(yn,`RPC '${e}' stream ${a} transport closed`),z.a_(),this.E_(E))})),Q(E,vc.EventType.ERROR,($=>{M||(M=!0,Ha(yn,`RPC '${e}' stream ${a} transport errored. Name:`,$.name,"Message:",$.message),z.a_(new ue(X.UNAVAILABLE,"The operation could not be completed")))})),Q(E,vc.EventType.MESSAGE,($=>{if(!M){const ie=$.data[0];Ye(!!ie,16349);const re=ie,ae=re?.error||re[0]?.error;if(ae){pe(yn,`RPC '${e}' stream ${a} received error:`,ae);const ve=ae.status;let he=(function(_){const A=Mt[_];if(A!==void 0)return AC(A)})(ve),De=ae.message;he===void 0&&(he=X.INTERNAL,De="Unknown error status: "+ve+" with message "+ae.message),M=!0,z.a_(new ue(he,De)),E.close()}else pe(yn,`RPC '${e}' stream ${a} received:`,ie),z.u_(ie)}})),Q(h,VE.STAT_EVENT,($=>{$.stat===Ef.PROXY?pe(yn,`RPC '${e}' stream ${a} detected buffering proxy`):$.stat===Ef.NOPROXY&&pe(yn,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{z.__()}),0),z}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Xh(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(r){return new AN(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e,n,i=1e3,a=1.5,c=6e4){this.Mi=e,this.timerId=n,this.d_=i,this.A_=a,this.R_=c,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-i);a>0&&pe("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VT="PersistentStream";class zC{constructor(e,n,i,a,c,p,h,f){this.Mi=e,this.S_=i,this.b_=a,this.connection=c,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new BC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===X.RESOURCE_EXHAUSTED?(Ys(n.toString()),Ys("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,a])=>{this.D_===n&&this.G_(i,a)}),(i=>{e((()=>{const a=new ue(X.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(a)}))}))}G_(e,n){const i=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{i((()=>this.z_(a)))})),this.stream.onMessage((a=>{i((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return pe(VT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(pe(VT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class E1 extends zC{constructor(e,n,i,a,c,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,i,a,p),this.serializer=c}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=RN(this.serializer,e),i=(function(c){if(!("targetChange"in c))return xe.min();const p=c.targetChange;return p.targetIds&&p.targetIds.length?xe.min():p.readTime?us(p.readTime):xe.min()})(e);return this.listener.H_(n,i)}Y_(e){const n={};n.database=Nf(this.serializer),n.addTarget=(function(c,p){let h;const f=p.target;if(h=xf(f)?{documents:PN(c,f)}:{query:NN(c,f).ft},h.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){h.resumeToken=RC(c,p.resumeToken);const g=kf(c,p.expectedCount);g!==null&&(h.expectedCount=g)}else if(p.snapshotVersion.compareTo(xe.min())>0){h.readTime=Zd(c,p.snapshotVersion.toTimestamp());const g=kf(c,p.expectedCount);g!==null&&(h.expectedCount=g)}return h})(this.serializer,e);const i=UN(this.serializer,e);i&&(n.labels=i),this.q_(n)}Z_(e){const n={};n.database=Nf(this.serializer),n.removeTarget=e,this.q_(n)}}class C1 extends zC{constructor(e,n,i,a,c,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,i,a,p),this.serializer=c}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Ye(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ye(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ye(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=DN(e.writeResults,e.commitTime),i=us(e.commitTime);return this.listener.na(i,n)}ra(){const e={};e.database=Nf(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((i=>kN(this.serializer,i)))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{}class A1 extends _1{constructor(e,n,i,a){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=i,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new ue(X.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,p])=>this.connection.Go(e,Df(n,i),a,c,p))).catch((c=>{throw c.name==="FirebaseError"?(c.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new ue(X.UNKNOWN,c.toString())}))}Ho(e,n,i,a,c){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([p,h])=>this.connection.Ho(e,Df(n,i),a,p,h,c))).catch((p=>{throw p.name==="FirebaseError"?(p.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new ue(X.UNKNOWN,p.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class I1{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ys(n),this.aa=!1):pe("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo="RemoteStore";class x1{constructor(e,n,i,a,c){this.localStore=e,this.datastore=n,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=c,this.Aa.Oo((p=>{i.enqueueAndForget((async()=>{Vo(this)&&(pe(Lo,"Restarting streams for network reachability change."),await(async function(f){const g=Re(f);g.Ea.add(4),await Yc(g),g.Ra.set("Unknown"),g.Ea.delete(4),await Ep(g)})(this))}))})),this.Ra=new I1(i,a)}}async function Ep(r){if(Vo(r))for(const e of r.da)await e(!0)}async function Yc(r){for(const e of r.da)await e(!1)}function FC(r,e){const n=Re(r);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Pg(n)?Dg(n):al(n).O_()&&kg(n,e))}function Rg(r,e){const n=Re(r),i=al(n);n.Ia.delete(e),i.O_()&&VC(n,e),n.Ia.size===0&&(i.O_()?i.L_():Vo(n)&&n.Ra.set("Unknown"))}function kg(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(xe.min())>0){const n=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}al(r).Y_(e)}function VC(r,e){r.Va.Ue(e),al(r).Z_(e)}function Dg(r){r.Va=new SN({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),al(r).start(),r.Ra.ua()}function Pg(r){return Vo(r)&&!al(r).x_()&&r.Ia.size>0}function Vo(r){return Re(r).Ea.size===0}function HC(r){r.Va=void 0}async function R1(r){r.Ra.set("Online")}async function k1(r){r.Ia.forEach(((e,n)=>{kg(r,e)}))}async function D1(r,e){HC(r),Pg(r)?(r.Ra.ha(e),Dg(r)):r.Ra.set("Unknown")}async function P1(r,e,n){if(r.Ra.set("Online"),e instanceof xC&&e.state===2&&e.cause)try{await(async function(a,c){const p=c.cause;for(const h of c.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,p),a.Ia.delete(h),a.Va.removeTarget(h))})(r,e)}catch(i){pe(Lo,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await tp(r,i)}else if(e instanceof Ud?r.Va.Ze(e):e instanceof IC?r.Va.st(e):r.Va.tt(e),!n.isEqual(xe.min()))try{const i=await jC(r.localStore);n.compareTo(i)>=0&&await(function(c,p){const h=c.Va.Tt(p);return h.targetChanges.forEach(((f,g)=>{if(f.resumeToken.approximateByteSize()>0){const b=c.Ia.get(g);b&&c.Ia.set(g,b.withResumeToken(f.resumeToken,p))}})),h.targetMismatches.forEach(((f,g)=>{const b=c.Ia.get(f);if(!b)return;c.Ia.set(f,b.withResumeToken(pn.EMPTY_BYTE_STRING,b.snapshotVersion)),VC(c,f);const E=new Di(b.target,f,g,b.sequenceNumber);kg(c,E)})),c.remoteSyncer.applyRemoteEvent(h)})(r,n)}catch(i){pe(Lo,"Failed to raise snapshot:",i),await tp(r,i)}}async function tp(r,e,n){if(!il(e))throw e;r.Ea.add(1),await Yc(r),r.Ra.set("Offline"),n||(n=()=>jC(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{pe(Lo,"Retrying IndexedDB access"),await n(),r.Ea.delete(1),await Ep(r)}))}function GC(r,e){return e().catch((n=>tp(r,n,e)))}async function Cp(r){const e=Re(r),n=Bi(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:hg;for(;N1(e);)try{const a=await h1(e.localStore,i);if(a===null){e.Ta.length===0&&n.L_();break}i=a.batchId,O1(e,a)}catch(a){await tp(e,a)}$C(e)&&WC(e)}function N1(r){return Vo(r)&&r.Ta.length<10}function O1(r,e){r.Ta.push(e);const n=Bi(r);n.O_()&&n.X_&&n.ea(e.mutations)}function $C(r){return Vo(r)&&!Bi(r).x_()&&r.Ta.length>0}function WC(r){Bi(r).start()}async function U1(r){Bi(r).ra()}async function M1(r){const e=Bi(r);for(const n of r.Ta)e.ea(n.mutations)}async function L1(r,e,n){const i=r.Ta.shift(),a=Sg.from(i,e,n);await GC(r,(()=>r.remoteSyncer.applySuccessfulWrite(a))),await Cp(r)}async function q1(r,e){e&&Bi(r).X_&&await(async function(i,a){if((function(p){return bN(p)&&p!==X.ABORTED})(a.code)){const c=i.Ta.shift();Bi(i).B_(),await GC(i,(()=>i.remoteSyncer.rejectFailedWrite(c.batchId,a))),await Cp(i)}})(r,e),$C(r)&&WC(r)}async function HT(r,e){const n=Re(r);n.asyncQueue.verifyOperationInProgress(),pe(Lo,"RemoteStore received new credentials");const i=Vo(n);n.Ea.add(3),await Yc(n),i&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Ep(n)}async function j1(r,e){const n=Re(r);e?(n.Ea.delete(2),await Ep(n)):e||(n.Ea.add(2),await Yc(n),n.Ra.set("Unknown"))}function al(r){return r.ma||(r.ma=(function(n,i,a){const c=Re(n);return c.sa(),new E1(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,a)})(r.datastore,r.asyncQueue,{Xo:R1.bind(null,r),t_:k1.bind(null,r),r_:D1.bind(null,r),H_:P1.bind(null,r)}),r.da.push((async e=>{e?(r.ma.B_(),Pg(r)?Dg(r):r.Ra.set("Unknown")):(await r.ma.stop(),HC(r))}))),r.ma}function Bi(r){return r.fa||(r.fa=(function(n,i,a){const c=Re(n);return c.sa(),new C1(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,a)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:U1.bind(null,r),r_:q1.bind(null,r),ta:M1.bind(null,r),na:L1.bind(null,r)}),r.da.push((async e=>{e?(r.fa.B_(),await Cp(r)):(await r.fa.stop(),r.Ta.length>0&&(pe(Lo,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,n,i,a,c){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=i,this.op=a,this.removalCallback=c,this.deferred=new Gs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((p=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,i,a,c){const p=Date.now()+i,h=new Ng(e,n,p,a,c);return h.start(i),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ue(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Og(r,e){if(Ys("AsyncQueue",`${e}: ${r}`),il(r))return new ue(X.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{static emptySet(e){return new Fa(e.comparator)}constructor(e){this.comparator=e?(n,i)=>e(n,i)||Te.comparator(n.key,i.key):(n,i)=>Te.comparator(n.key,i.key),this.keyedMap=bc(),this.sortedSet=new wt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,i)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Fa)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,c=i.getNext().key;if(!a.isEqual(c))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const i=new Fa;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=n,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(){this.ga=new wt(Te.comparator)}track(e){const n=e.doc.key,i=this.ga.get(n);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(n,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(n,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(n):e.type===1&&i.type===2?this.ga=this.ga.insert(n,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ae(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,i)=>{e.push(i)})),e}}class Ya{constructor(e,n,i,a,c,p,h,f,g){this.query=e,this.docs=n,this.oldDocs=i,this.docChanges=a,this.mutatedKeys=c,this.fromCache=p,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=g}static fromInitialDocuments(e,n,i,a,c){const p=[];return n.forEach((h=>{p.push({type:0,doc:h})})),new Ya(e,n,Fa.emptySet(n),p,i,a,!0,!1,c)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yp(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,i=e.docChanges;if(n.length!==i.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==i[a].type||!n[a].doc.isEqual(i[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class z1{constructor(){this.queries=$T(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,i){const a=Re(n),c=a.queries;a.queries=$T(),c.forEach(((p,h)=>{for(const f of h.Sa)f.onError(i)}))})(this,new ue(X.ABORTED,"Firestore shutting down"))}}function $T(){return new Fo((r=>mC(r)),yp)}async function KC(r,e){const n=Re(r);let i=3;const a=e.query;let c=n.queries.get(a);c?!c.ba()&&e.Da()&&(i=2):(c=new B1,i=e.Da()?0:1);try{switch(i){case 0:c.wa=await n.onListen(a,!0);break;case 1:c.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(p){const h=Og(p,`Initialization of query '${Ma(e.query)}' failed`);return void e.onError(h)}n.queries.set(a,c),c.Sa.push(e),e.va(n.onlineState),c.wa&&e.Fa(c.wa)&&Ug(n)}async function JC(r,e){const n=Re(r),i=e.query;let a=3;const c=n.queries.get(i);if(c){const p=c.Sa.indexOf(e);p>=0&&(c.Sa.splice(p,1),c.Sa.length===0?a=e.Da()?0:1:!c.ba()&&e.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function F1(r,e){const n=Re(r);let i=!1;for(const a of e){const c=a.query,p=n.queries.get(c);if(p){for(const h of p.Sa)h.Fa(a)&&(i=!0);p.wa=a}}i&&Ug(n)}function V1(r,e,n){const i=Re(r),a=i.queries.get(e);if(a)for(const c of a.Sa)c.onError(n);i.queries.delete(e)}function Ug(r){r.Ca.forEach((e=>{e.next()}))}var Mf,WT;(WT=Mf||(Mf={})).Ma="default",WT.Cache="cache";class YC{constructor(e,n,i){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const a of e.docChanges)a.type!==3&&i.push(a);e=new Ya(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const i=n!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ya.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Mf.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e){this.key=e}}class XC{constructor(e){this.key=e}}class H1{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Be(),this.mutatedKeys=Be(),this.eu=hC(e),this.tu=new Fa(this.eu)}get nu(){return this.Ya}ru(e,n){const i=n?n.iu:new GT,a=n?n.tu:this.tu;let c=n?n.mutatedKeys:this.mutatedKeys,p=a,h=!1;const f=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,g=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((b,E)=>{const C=a.get(b),M=vp(this.query,E)?E:null,z=!!C&&this.mutatedKeys.has(C.key),Q=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let $=!1;C&&M?C.data.isEqual(M.data)?z!==Q&&(i.track({type:3,doc:M}),$=!0):this.su(C,M)||(i.track({type:2,doc:M}),$=!0,(f&&this.eu(M,f)>0||g&&this.eu(M,g)<0)&&(h=!0)):!C&&M?(i.track({type:0,doc:M}),$=!0):C&&!M&&(i.track({type:1,doc:C}),$=!0,(f||g)&&(h=!0)),$&&(M?(p=p.add(M),c=Q?c.add(b):c.delete(b)):(p=p.delete(b),c=c.delete(b)))})),this.query.limit!==null)for(;p.size>this.query.limit;){const b=this.query.limitType==="F"?p.last():p.first();p=p.delete(b.key),c=c.delete(b.key),i.track({type:1,doc:b})}return{tu:p,iu:i,Cs:h,mutatedKeys:c}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,i,a){const c=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const p=e.iu.ya();p.sort(((b,E)=>(function(M,z){const Q=$=>{switch($){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ae(20277,{Rt:$})}};return Q(M)-Q(z)})(b.type,E.type)||this.eu(b.doc,E.doc))),this.ou(i),a=a??!1;const h=n&&!a?this._u():[],f=this.Xa.size===0&&this.current&&!a?1:0,g=f!==this.Za;return this.Za=f,p.length!==0||g?{snapshot:new Ya(this.query,e.tu,c,p,e.mutatedKeys,f===0,g,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new GT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Be(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const n=[];return e.forEach((i=>{this.Xa.has(i)||n.push(new XC(i))})),this.Xa.forEach((i=>{e.has(i)||n.push(new QC(i))})),n}cu(e){this.Ya=e.Qs,this.Xa=Be();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ya.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Mg="SyncEngine";class G1{constructor(e,n,i){this.query=e,this.targetId=n,this.view=i}}class $1{constructor(e){this.key=e,this.hu=!1}}class W1{constructor(e,n,i,a,c,p){this.localStore=e,this.remoteStore=n,this.eventManager=i,this.sharedClientState=a,this.currentUser=c,this.maxConcurrentLimboResolutions=p,this.Pu={},this.Tu=new Fo((h=>mC(h)),yp),this.Iu=new Map,this.Eu=new Set,this.du=new wt(Te.comparator),this.Au=new Map,this.Ru=new _g,this.Vu={},this.mu=new Map,this.fu=Ja.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function K1(r,e,n=!0){const i=s_(r);let a;const c=i.Tu.get(e);return c?(i.sharedClientState.addLocalQueryTarget(c.targetId),a=c.view.lu()):a=await ZC(i,e,n,!0),a}async function J1(r,e){const n=s_(r);await ZC(n,e,!0,!1)}async function ZC(r,e,n,i){const a=await f1(r.localStore,cs(e)),c=a.targetId,p=r.sharedClientState.addLocalQueryTarget(c,n);let h;return i&&(h=await Y1(r,e,c,p==="current",a.resumeToken)),r.isPrimaryClient&&n&&FC(r.remoteStore,a),h}async function Y1(r,e,n,i,a){r.pu=(E,C,M)=>(async function(Q,$,ie,re){let ae=$.view.ru(ie);ae.Cs&&(ae=await jT(Q.localStore,$.query,!1).then((({documents:U})=>$.view.ru(U,ae))));const ve=re&&re.targetChanges.get($.targetId),he=re&&re.targetMismatches.get($.targetId)!=null,De=$.view.applyChanges(ae,Q.isPrimaryClient,ve,he);return JT(Q,$.targetId,De.au),De.snapshot})(r,E,C,M);const c=await jT(r.localStore,e,!0),p=new H1(e,c.Qs),h=p.ru(c.documents),f=Jc.createSynthesizedTargetChangeForCurrentChange(n,i&&r.onlineState!=="Offline",a),g=p.applyChanges(h,r.isPrimaryClient,f);JT(r,n,g.au);const b=new G1(e,n,p);return r.Tu.set(e,b),r.Iu.has(n)?r.Iu.get(n).push(e):r.Iu.set(n,[e]),g.snapshot}async function Q1(r,e,n){const i=Re(r),a=i.Tu.get(e),c=i.Iu.get(a.targetId);if(c.length>1)return i.Iu.set(a.targetId,c.filter((p=>!yp(p,e)))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(a.targetId),i.sharedClientState.isActiveQueryTarget(a.targetId)||await Of(i.localStore,a.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(a.targetId),n&&Rg(i.remoteStore,a.targetId),Lf(i,a.targetId)})).catch(sl)):(Lf(i,a.targetId),await Of(i.localStore,a.targetId,!0))}async function X1(r,e){const n=Re(r),i=n.Tu.get(e),a=n.Iu.get(i.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Rg(n.remoteStore,i.targetId))}async function Z1(r,e,n){const i=oO(r);try{const a=await(function(p,h){const f=Re(p),g=dt.now(),b=h.reduce(((M,z)=>M.add(z.key)),Be());let E,C;return f.persistence.runTransaction("Locally write mutations","readwrite",(M=>{let z=Qs(),Q=Be();return f.Ns.getEntries(M,b).next(($=>{z=$,z.forEach(((ie,re)=>{re.isValidDocument()||(Q=Q.add(ie))}))})).next((()=>f.localDocuments.getOverlayedDocuments(M,z))).next(($=>{E=$;const ie=[];for(const re of h){const ae=hN(re,E.get(re.key).overlayedDocument);ae!=null&&ie.push(new Wi(re.key,ae,iC(ae.value.mapValue),br.exists(!0)))}return f.mutationQueue.addMutationBatch(M,g,ie,h)})).next(($=>{C=$;const ie=$.applyToLocalDocumentSet(E,Q);return f.documentOverlayCache.saveOverlays(M,$.batchId,ie)}))})).then((()=>({batchId:C.batchId,changes:gC(E)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(a.batchId),(function(p,h,f){let g=p.Vu[p.currentUser.toKey()];g||(g=new wt(je)),g=g.insert(h,f),p.Vu[p.currentUser.toKey()]=g})(i,a.batchId,n),await Qc(i,a.changes),await Cp(i.remoteStore)}catch(a){const c=Og(a,"Failed to persist write");n.reject(c)}}async function e_(r,e){const n=Re(r);try{const i=await p1(n.localStore,e);e.targetChanges.forEach(((a,c)=>{const p=n.Au.get(c);p&&(Ye(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?p.hu=!0:a.modifiedDocuments.size>0?Ye(p.hu,14607):a.removedDocuments.size>0&&(Ye(p.hu,42227),p.hu=!1))})),await Qc(n,i,e)}catch(i){await sl(i)}}function KT(r,e,n){const i=Re(r);if(i.isPrimaryClient&&n===0||!i.isPrimaryClient&&n===1){const a=[];i.Tu.forEach(((c,p)=>{const h=p.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(p,h){const f=Re(p);f.onlineState=h;let g=!1;f.queries.forEach(((b,E)=>{for(const C of E.Sa)C.va(h)&&(g=!0)})),g&&Ug(f)})(i.eventManager,e),a.length&&i.Pu.H_(a),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function eO(r,e,n){const i=Re(r);i.sharedClientState.updateQueryState(e,"rejected",n);const a=i.Au.get(e),c=a&&a.key;if(c){let p=new wt(Te.comparator);p=p.insert(c,bn.newNoDocument(c,xe.min()));const h=Be().add(c),f=new Tp(xe.min(),new Map,new wt(je),p,h);await e_(i,f),i.du=i.du.remove(c),i.Au.delete(e),Lg(i)}else await Of(i.localStore,e,!1).then((()=>Lf(i,e,n))).catch(sl)}async function tO(r,e){const n=Re(r),i=e.batch.batchId;try{const a=await d1(n.localStore,e);n_(n,i,null),t_(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Qc(n,a)}catch(a){await sl(a)}}async function nO(r,e,n){const i=Re(r);try{const a=await(function(p,h){const f=Re(p);return f.persistence.runTransaction("Reject batch","readwrite-primary",(g=>{let b;return f.mutationQueue.lookupMutationBatch(g,h).next((E=>(Ye(E!==null,37113),b=E.keys(),f.mutationQueue.removeMutationBatch(g,E)))).next((()=>f.mutationQueue.performConsistencyCheck(g))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(g,b,h))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,b))).next((()=>f.localDocuments.getDocuments(g,b)))}))})(i.localStore,e);n_(i,e,n),t_(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Qc(i,a)}catch(a){await sl(a)}}function t_(r,e){(r.mu.get(e)||[]).forEach((n=>{n.resolve()})),r.mu.delete(e)}function n_(r,e,n){const i=Re(r);let a=i.Vu[i.currentUser.toKey()];if(a){const c=a.get(e);c&&(n?c.reject(n):c.resolve(),a=a.remove(e)),i.Vu[i.currentUser.toKey()]=a}}function Lf(r,e,n=null){r.sharedClientState.removeLocalQueryTarget(e);for(const i of r.Iu.get(e))r.Tu.delete(i),n&&r.Pu.yu(i,n);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach((i=>{r.Ru.containsKey(i)||r_(r,i)}))}function r_(r,e){r.Eu.delete(e.path.canonicalString());const n=r.du.get(e);n!==null&&(Rg(r.remoteStore,n),r.du=r.du.remove(e),r.Au.delete(n),Lg(r))}function JT(r,e,n){for(const i of n)i instanceof QC?(r.Ru.addReference(i.key,e),rO(r,i)):i instanceof XC?(pe(Mg,"Document no longer in limbo: "+i.key),r.Ru.removeReference(i.key,e),r.Ru.containsKey(i.key)||r_(r,i.key)):Ae(19791,{wu:i})}function rO(r,e){const n=e.key,i=n.path.canonicalString();r.du.get(n)||r.Eu.has(i)||(pe(Mg,"New document in limbo: "+n),r.Eu.add(i),Lg(r))}function Lg(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const n=new Te(ut.fromString(e)),i=r.fu.next();r.Au.set(i,new $1(n)),r.du=r.du.insert(n,i),FC(r.remoteStore,new Di(cs(bg(n.path)),i,"TargetPurposeLimboResolution",hp.ce))}}async function Qc(r,e,n){const i=Re(r),a=[],c=[],p=[];i.Tu.isEmpty()||(i.Tu.forEach(((h,f)=>{p.push(i.pu(f,e,n).then((g=>{if((g||n)&&i.isPrimaryClient){const b=g?!g.fromCache:n?.targetChanges.get(f.targetId)?.current;i.sharedClientState.updateQueryState(f.targetId,b?"current":"not-current")}if(g){a.push(g);const b=Ig.As(f.targetId,g);c.push(b)}})))})),await Promise.all(p),i.Pu.H_(a),await(async function(f,g){const b=Re(f);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>te.forEach(g,(C=>te.forEach(C.Es,(M=>b.persistence.referenceDelegate.addReference(E,C.targetId,M))).next((()=>te.forEach(C.ds,(M=>b.persistence.referenceDelegate.removeReference(E,C.targetId,M)))))))))}catch(E){if(!il(E))throw E;pe(xg,"Failed to update sequence numbers: "+E)}for(const E of g){const C=E.targetId;if(!E.fromCache){const M=b.Ms.get(C),z=M.snapshotVersion,Q=M.withLastLimboFreeSnapshotVersion(z);b.Ms=b.Ms.insert(C,Q)}}})(i.localStore,c))}async function sO(r,e){const n=Re(r);if(!n.currentUser.isEqual(e)){pe(Mg,"User change. New user:",e.toKey());const i=await qC(n.localStore,e);n.currentUser=e,(function(c,p){c.mu.forEach((h=>{h.forEach((f=>{f.reject(new ue(X.CANCELLED,p))}))})),c.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Qc(n,i.Ls)}}function iO(r,e){const n=Re(r),i=n.Au.get(e);if(i&&i.hu)return Be().add(i.key);{let a=Be();const c=n.Iu.get(e);if(!c)return a;for(const p of c){const h=n.Tu.get(p);a=a.unionWith(h.view.nu)}return a}}function s_(r){const e=Re(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=e_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=iO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eO.bind(null,e),e.Pu.H_=F1.bind(null,e.eventManager),e.Pu.yu=V1.bind(null,e.eventManager),e}function oO(r){const e=Re(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nO.bind(null,e),e}class np{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Sp(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return u1(this.persistence,new a1,e.initialUser,this.serializer)}Cu(e){return new LC(Ag.mi,this.serializer)}Du(e){return new y1}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}np.provider={build:()=>new np};class aO extends np{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Ye(this.persistence.referenceDelegate instanceof ep,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new $N(i,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Mn.withCacheSize(this.cacheSizeBytes):Mn.DEFAULT;return new LC((i=>ep.mi(i,n)),this.serializer)}}class qf{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>KT(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=sO.bind(null,this.syncEngine),await j1(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new z1})()}createDatastore(e){const n=Sp(e.databaseInfo.databaseId),i=(function(c){return new S1(c)})(e.databaseInfo);return(function(c,p,h,f){return new A1(c,p,h,f)})(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return(function(i,a,c,p,h){return new x1(i,a,c,p,h)})(this.localStore,this.datastore,e.asyncQueue,(n=>KT(this.syncEngine,n,0)),(function(){return FT.v()?new FT:new v1})())}createSyncEngine(e,n){return(function(a,c,p,h,f,g,b){const E=new W1(a,c,p,h,f,g);return b&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const i=Re(n);pe(Lo,"RemoteStore shutting down."),i.Ea.add(5),await Yc(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}qf.provider={build:()=>new qf};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ys("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zi="FirestoreClient";class lO{constructor(e,n,i,a,c){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=i,this.databaseInfo=a,this.user=vn.UNAUTHENTICATED,this.clientId=mg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=c,this.authCredentials.start(i,(async p=>{pe(zi,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p})),this.appCheckCredentials.start(i,(p=>(pe(zi,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const i=Og(n,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Zh(r,e){r.asyncQueue.verifyOperationInProgress(),pe(zi,"Initializing OfflineComponentProvider");const n=r.configuration;await e.initialize(n);let i=n.initialUser;r.setCredentialChangeListener((async a=>{i.isEqual(a)||(await qC(e.localStore,a),i=a)})),e.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=e}async function YT(r,e){r.asyncQueue.verifyOperationInProgress();const n=await cO(r);pe(zi,"Initializing OnlineComponentProvider"),await e.initialize(n,r.configuration),r.setCredentialChangeListener((i=>HT(e.remoteStore,i))),r.setAppCheckTokenChangeListener(((i,a)=>HT(e.remoteStore,a))),r._onlineComponents=e}async function cO(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){pe(zi,"Using user provided OfflineComponentProvider");try{await Zh(r,r._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(a){return a.name==="FirebaseError"?a.code===X.FAILED_PRECONDITION||a.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;Ha("Error using user provided cache. Falling back to memory cache: "+n),await Zh(r,new np)}}else pe(zi,"Using default OfflineComponentProvider"),await Zh(r,new aO(void 0));return r._offlineComponents}async function o_(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(pe(zi,"Using user provided OnlineComponentProvider"),await YT(r,r._uninitializedComponentsProvider._online)):(pe(zi,"Using default OnlineComponentProvider"),await YT(r,new qf))),r._onlineComponents}function uO(r){return o_(r).then((e=>e.syncEngine))}async function a_(r){const e=await o_(r),n=e.eventManager;return n.onListen=K1.bind(null,e.syncEngine),n.onUnlisten=Q1.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=J1.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=X1.bind(null,e.syncEngine),n}function dO(r,e,n={}){const i=new Gs;return r.asyncQueue.enqueueAndForget((async()=>(function(c,p,h,f,g){const b=new i_({next:C=>{b.Nu(),p.enqueueAndForget((()=>JC(c,E)));const M=C.docs.has(h);!M&&C.fromCache?g.reject(new ue(X.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&C.fromCache&&f&&f.source==="server"?g.reject(new ue(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(C)},error:C=>g.reject(C)}),E=new YC(bg(h.path),b,{includeMetadataChanges:!0,qa:!0});return KC(c,E)})(await a_(r),r.asyncQueue,e,n,i))),i.promise}function pO(r,e,n={}){const i=new Gs;return r.asyncQueue.enqueueAndForget((async()=>(function(c,p,h,f,g){const b=new i_({next:C=>{b.Nu(),p.enqueueAndForget((()=>JC(c,E))),C.fromCache&&f.source==="server"?g.reject(new ue(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(C)},error:C=>g.reject(C)}),E=new YC(h,b,{includeMetadataChanges:!0,qa:!0});return KC(c,E)})(await a_(r),r.asyncQueue,e,n,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l_(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_="firestore.googleapis.com",XT=!0;class ZT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ue(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=c_,this.ssl=XT}else this.host=e.host,this.ssl=e.ssl??XT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=MC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<HN)throw new ue(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}IP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=l_(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,a){return i.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class _p{constructor(e,n,i,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=i,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ZT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ue(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ue(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ZT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new yP;switch(i.type){case"firstParty":return new TP(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new ue(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const i=QT.get(n);i&&(pe("ComponentProvider","Removing Datastore"),QT.delete(n),i.terminate())})(this),Promise.resolve()}}function mO(r,e,n,i={}){r=qr(r,_p);const a=el(e),c=r._getSettings(),p={...c,emulatorOptions:r._getEmulatorOptions()},h=`${e}:${n}`;a&&(YS(`https://${h}`),QS("Firestore",!0)),c.host!==c_&&c.host!==h&&Ha("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...c,host:h,ssl:a,emulatorOptions:i};if(!Ws(f,p)&&(r._setSettings(f),i.mockUserToken)){let g,b;if(typeof i.mockUserToken=="string")g=i.mockUserToken,b=vn.MOCK_USER;else{g=Ix(i.mockUserToken,r._app?.options.projectId);const E=i.mockUserToken.sub||i.mockUserToken.user_id;if(!E)throw new ue(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new vn(E)}r._authCredentials=new vP(new WE(g,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e,n,i){this.converter=n,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Ki(this.firestore,e,this._query)}}class Pt{constructor(e,n,i){this.converter=n,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ui(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pt(this.firestore,e,this._key)}toJSON(){return{type:Pt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,i){if(Wc(n,Pt._jsonSchema))return new Pt(e,i||null,new Te(ut.fromString(n.referencePath)))}}Pt._jsonSchemaVersion="firestore/documentReference/1.0",Pt._jsonSchema={type:qt("string",Pt._jsonSchemaVersion),referencePath:qt("string")};class Ui extends Ki{constructor(e,n,i){super(e,n,bg(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pt(this.firestore,null,new Te(e))}withConverter(e){return new Ui(this.firestore,e,this._path)}}function Ji(r,e,...n){if(r=Wt(r),KE("collection","path",e),r instanceof _p){const i=ut.fromString(e,...n);return pT(i),new Ui(r,null,i)}{if(!(r instanceof Pt||r instanceof Ui))throw new ue(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=r._path.child(ut.fromString(e,...n));return pT(i),new Ui(r.firestore,null,i)}}function Yi(r,e,...n){if(r=Wt(r),arguments.length===1&&(e=mg.newId()),KE("doc","path",e),r instanceof _p){const i=ut.fromString(e,...n);return dT(i),new Pt(r,null,new Te(i))}{if(!(r instanceof Pt||r instanceof Ui))throw new ue(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=r._path.child(ut.fromString(e,...n));return dT(i),new Pt(r.firestore,r instanceof Ui?r.converter:null,new Te(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS="AsyncQueue";class tS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new BC(this,"async_queue_retry"),this._c=()=>{const i=Xh();i&&pe(eS,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const n=Xh();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Xh();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Gs;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!il(e))throw e;pe(eS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,Ys("INTERNAL UNHANDLED ERROR: ",nS(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=n,n}enqueueAfterDelay(e,n,i){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const a=Ng.createAndSchedule(this,e,n,i,(c=>this.hc(c)));return this.tc.push(a),a}uc(){this.nc&&Ae(47125,{Pc:nS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,i)=>n.targetTimeMs-i.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function nS(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}class Ho extends _p{constructor(e,n,i,a){super(e,n,i,a),this.type="firestore",this._queue=new tS,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new tS(e),this._firestoreClient=void 0,await e}}}function hO(r,e){const n=typeof r=="object"?r:eg(),i=typeof r=="string"?r:Kd,a=zo(n,"firestore").getImmediate({identifier:i});if(!a._initialized){const c=_x("firestore");c&&mO(a,...c)}return a}function qg(r){if(r._terminated)throw new ue(X.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||fO(r),r._firestoreClient}function fO(r){const e=r._freezeSettings(),n=(function(a,c,p,h){return new jP(a,c,p,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,l_(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,e);r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new lO(r._authCredentials,r._appCheckCredentials,r._queue,n,r._componentsProvider&&(function(a){const c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}})(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yr(pn.fromBase64String(e))}catch(n){throw new ue(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new yr(pn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Wc(e,yr._jsonSchema))return yr.fromBase64String(e.bytes)}}yr._jsonSchemaVersion="firestore/bytes/1.0",yr._jsonSchema={type:qt("string",yr._jsonSchemaVersion),bytes:qt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ue(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ue(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ue(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return je(this._lat,e._lat)||je(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ds._jsonSchemaVersion}}static fromJSON(e){if(Wc(e,ds._jsonSchema))return new ds(e.latitude,e.longitude)}}ds._jsonSchemaVersion="firestore/geoPoint/1.0",ds._jsonSchema={type:qt("string",ds._jsonSchemaVersion),latitude:qt("number"),longitude:qt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,a){if(i.length!==a.length)return!1;for(let c=0;c<i.length;++c)if(i[c]!==a[c])return!1;return!0})(this._values,e._values)}toJSON(){return{type:ps._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Wc(e,ps._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new ps(e.vectorValues);throw new ue(X.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ps._jsonSchemaVersion="firestore/vectorValue/1.0",ps._jsonSchema={type:qt("string",ps._jsonSchemaVersion),vectorValues:qt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO=/^__.*__$/;class yO{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return this.fieldMask!==null?new Wi(e,this.data,this.fieldMask,n,this.fieldTransforms):new Kc(e,this.data,n,this.fieldTransforms)}}class u_{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return new Wi(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function d_(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ae(40011,{Ac:r})}}class Ip{constructor(e,n,i,a,c,p){this.settings=e,this.databaseId=n,this.serializer=i,this.ignoreUndefinedProperties=a,c===void 0&&this.Rc(),this.fieldTransforms=c||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ip({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),i=this.Vc({path:n,fc:!1});return i.gc(e),i}yc(e){const n=this.path?.child(e),i=this.Vc({path:n,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return rp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(d_(this.Ac)&&gO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class vO{constructor(e,n,i){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=i||Sp(e)}Cc(e,n,i,a=!1){return new Ip({Ac:e,methodName:n,Dc:i,path:dn.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xp(r){const e=r._freezeSettings(),n=Sp(r._databaseId);return new vO(r._databaseId,!!e.ignoreUndefinedProperties,n)}function p_(r,e,n,i,a,c={}){const p=r.Cc(c.merge||c.mergeFields?2:0,e,n,a);zg("Data must be an object, but it was:",p,i);const h=m_(i,p);let f,g;if(c.merge)f=new Yn(p.fieldMask),g=p.fieldTransforms;else if(c.mergeFields){const b=[];for(const E of c.mergeFields){const C=jf(e,E,n);if(!p.contains(C))throw new ue(X.INVALID_ARGUMENT,`Field '${C}' is specified in your field mask but missing from your input data.`);f_(b,C)||b.push(C)}f=new Yn(b),g=p.fieldTransforms.filter((E=>f.covers(E.field)))}else f=null,g=p.fieldTransforms;return new yO(new Ln(h),f,g)}class Rp extends Xc{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Rp}}function bO(r,e,n){return new Ip({Ac:3,Dc:e.settings.Dc,methodName:r._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class jg extends Xc{_toFieldTransform(e){return new EC(e.path,new qc)}isEqual(e){return e instanceof jg}}class Bg extends Xc{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=bO(this,e,!0),i=this.vc.map((c=>ll(c,n))),a=new Ka(i);return new EC(e.path,a)}isEqual(e){return e instanceof Bg&&Ws(this.vc,e.vc)}}function wO(r,e,n,i){const a=r.Cc(1,e,n);zg("Data must be an object, but it was:",a,i);const c=[],p=Ln.empty();$i(i,((f,g)=>{const b=Fg(e,f,n);g=Wt(g);const E=a.yc(b);if(g instanceof Rp)c.push(b);else{const C=ll(g,E);C!=null&&(c.push(b),p.set(b,C))}}));const h=new Yn(c);return new u_(p,h,a.fieldTransforms)}function TO(r,e,n,i,a,c){const p=r.Cc(1,e,n),h=[jf(e,i,n)],f=[a];if(c.length%2!=0)throw new ue(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let C=0;C<c.length;C+=2)h.push(jf(e,c[C])),f.push(c[C+1]);const g=[],b=Ln.empty();for(let C=h.length-1;C>=0;--C)if(!f_(g,h[C])){const M=h[C];let z=f[C];z=Wt(z);const Q=p.yc(M);if(z instanceof Rp)g.push(M);else{const $=ll(z,Q);$!=null&&(g.push(M),b.set(M,$))}}const E=new Yn(g);return new u_(b,E,p.fieldTransforms)}function SO(r,e,n,i=!1){return ll(n,r.Cc(i?4:3,e))}function ll(r,e){if(h_(r=Wt(r)))return zg("Unsupported field value:",e,r),m_(r,e);if(r instanceof Xc)return(function(i,a){if(!d_(a.Ac))throw a.Sc(`${i._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${i._methodName}() is not currently supported inside arrays`);const c=i._toFieldTransform(a);c&&a.fieldTransforms.push(c)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(i,a){const c=[];let p=0;for(const h of i){let f=ll(h,a.wc(p));f==null&&(f={nullValue:"NULL_VALUE"}),c.push(f),p++}return{arrayValue:{values:c}}})(r,e)}return(function(i,a){if((i=Wt(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return lN(a.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const c=dt.fromDate(i);return{timestampValue:Zd(a.serializer,c)}}if(i instanceof dt){const c=new dt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Zd(a.serializer,c)}}if(i instanceof ds)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof yr)return{bytesValue:RC(a.serializer,i._byteString)};if(i instanceof Pt){const c=a.databaseId,p=i.firestore._databaseId;if(!p.isEqual(c))throw a.Sc(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:Cg(i.firestore._databaseId||a.databaseId,i._key.path)}}if(i instanceof ps)return(function(p,h){return{mapValue:{fields:{[rC]:{stringValue:sC},[Jd]:{arrayValue:{values:p.toArray().map((g=>{if(typeof g!="number")throw h.Sc("VectorValues must only contain numeric values.");return wg(h.serializer,g)}))}}}}}})(i,a);throw a.Sc(`Unsupported field value: ${mp(i)}`)})(r,e)}function m_(r,e){const n={};return QE(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$i(r,((i,a)=>{const c=ll(a,e.mc(i));c!=null&&(n[i]=c)})),{mapValue:{fields:n}}}function h_(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof dt||r instanceof ds||r instanceof yr||r instanceof Pt||r instanceof Xc||r instanceof ps)}function zg(r,e,n){if(!h_(n)||!JE(n)){const i=mp(n);throw i==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+i)}}function jf(r,e,n){if((e=Wt(e))instanceof Ap)return e._internalPath;if(typeof e=="string")return Fg(r,e);throw rp("Field path arguments must be of type string or ",r,!1,void 0,n)}const EO=new RegExp("[~\\*/\\[\\]]");function Fg(r,e,n){if(e.search(EO)>=0)throw rp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,n);try{return new Ap(...e.split("."))._internalPath}catch{throw rp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,n)}}function rp(r,e,n,i,a){const c=i&&!i.isEmpty(),p=a!==void 0;let h=`Function ${e}() called with invalid data`;n&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(c||p)&&(f+=" (found",c&&(f+=` in field ${i}`),p&&(f+=` in document ${a}`),f+=")"),new ue(X.INVALID_ARGUMENT,h+r+f)}function f_(r,e){return r.some((n=>n.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e,n,i,a,c){this._firestore=e,this._userDataWriter=n,this._key=i,this._document=a,this._converter=c}get id(){return this._key.path.lastSegment()}get ref(){return new Pt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(kp("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class CO extends g_{data(){return super.data()}}function kp(r,e){return typeof e=="string"?Fg(r,e):e instanceof Ap?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _O(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new ue(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Vg{}class Hg extends Vg{}function Gg(r,e,...n){let i=[];e instanceof Vg&&i.push(e),i=i.concat(n),(function(c){const p=c.filter((f=>f instanceof $g)).length,h=c.filter((f=>f instanceof Dp)).length;if(p>1||p>0&&h>0)throw new ue(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const a of i)r=a._apply(r);return r}class Dp extends Hg{constructor(e,n,i){super(),this._field=e,this._op=n,this._value=i,this.type="where"}static _create(e,n,i){return new Dp(e,n,i)}_apply(e){const n=this._parse(e);return w_(e._query,n),new Ki(e.firestore,e.converter,Rf(e._query,n))}_parse(e){const n=xp(e.firestore);return(function(c,p,h,f,g,b,E){let C;if(g.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new ue(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){sS(E,b);const z=[];for(const Q of E)z.push(rS(f,c,Q));C={arrayValue:{values:z}}}else C=rS(f,c,E)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||sS(E,b),C=SO(h,p,E,b==="in"||b==="not-in");return Lt.create(g,b,C)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function y_(r,e,n){const i=e,a=kp("where",r);return Dp._create(a,i,n)}class $g extends Vg{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new $g(e,n)}_parse(e){const n=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return n.length===1?n[0]:jr.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(a,c){let p=a;const h=c.getFlattenedFilters();for(const f of h)w_(p,f),p=Rf(p,f)})(e._query,n),new Ki(e.firestore,e.converter,Rf(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Wg extends Hg{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Wg(e,n)}_apply(e){const n=(function(a,c,p){if(a.startAt!==null)throw new ue(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new ue(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lc(c,p)})(e._query,this._field,this._direction);return new Ki(e.firestore,e.converter,(function(a,c){const p=a.explicitOrderBy.concat([c]);return new ol(a.path,a.collectionGroup,p,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(e._query,n))}}function v_(r,e="asc"){const n=e,i=kp("orderBy",r);return Wg._create(i,n)}class Kg extends Hg{constructor(e,n,i){super(),this.type=e,this._limit=n,this._limitType=i}static _create(e,n,i){return new Kg(e,n,i)}_apply(e){return new Ki(e.firestore,e.converter,Qd(e._query,this._limit,this._limitType))}}function b_(r){return xP("limit",r),Kg._create("limit",r,"F")}function rS(r,e,n){if(typeof(n=Wt(n))=="string"){if(n==="")throw new ue(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!pC(e)&&n.indexOf("/")!==-1)throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(ut.fromString(n));if(!Te.isDocumentKey(i))throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return wT(r,new Te(i))}if(n instanceof Pt)return wT(r,n._key);throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mp(n)}.`)}function sS(r,e){if(!Array.isArray(r)||r.length===0)throw new ue(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function w_(r,e){const n=(function(a,c){for(const p of a)for(const h of p.getFlattenedFilters())if(c.indexOf(h.op)>=0)return h.op;return null})(r.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new ue(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ue(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class AO{convertValue(e,n="none"){switch(ji(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Dt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(qi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ae(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const i={};return $i(e,((a,c)=>{i[a]=this.convertValue(c,n)})),i}convertVectorValue(e){const n=e.fields?.[Jd].arrayValue?.values?.map((i=>Dt(i.doubleValue)));return new ps(n)}convertGeoPoint(e){return new ds(Dt(e.latitude),Dt(e.longitude))}convertArray(e,n){return(e.values||[]).map((i=>this.convertValue(i,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const i=gp(e);return i==null?null:this.convertValue(i,n);case"estimate":return this.convertTimestamp(Oc(e));default:return null}}convertTimestamp(e){const n=Li(e);return new dt(n.seconds,n.nanos)}convertDocumentKey(e,n){const i=ut.fromString(e);Ye(UC(i),9688,{name:e});const a=new Uc(i.get(1),i.get(3)),c=new Te(i.popFirst(5));return a.isEqual(n)||Ys(`Document ${c} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T_(r,e,n){let i;return i=r?r.toFirestore(e):e,i}class Tc{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class No extends g_{constructor(e,n,i,a,c,p){super(e,n,i,a,p),this._firestore=e,this._firestoreImpl=e,this.metadata=c}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Md(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const i=this._document.data.field(kp("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(X.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=No._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}No._jsonSchemaVersion="firestore/documentSnapshot/1.0",No._jsonSchema={type:qt("string",No._jsonSchemaVersion),bundleSource:qt("string","DocumentSnapshot"),bundleName:qt("string"),bundle:qt("string")};class Md extends No{data(e={}){return super.data(e)}}class Va{constructor(e,n,i,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new Tc(a.hasPendingWrites,a.fromCache),this.query=i}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((i=>{e.call(n,new Md(this._firestore,this._userDataWriter,i.key,i,new Tc(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ue(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,c){if(a._snapshot.oldDocs.isEmpty()){let p=0;return a._snapshot.docChanges.map((h=>{const f=new Md(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Tc(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:f,oldIndex:-1,newIndex:p++}}))}{let p=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>c||h.type!==3)).map((h=>{const f=new Md(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Tc(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let g=-1,b=-1;return h.type!==0&&(g=p.indexOf(h.doc.key),p=p.delete(h.doc.key)),h.type!==1&&(p=p.add(h.doc),b=p.indexOf(h.doc.key)),{type:IO(h.type),doc:f,oldIndex:g,newIndex:b}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(X.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Va._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=mg.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],i=[],a=[];return this.docs.forEach((c=>{c._document!==null&&(n.push(c._document),i.push(this._userDataWriter.convertObjectMap(c._document.data.value.mapValue.fields,"previous")),a.push(c.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function IO(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ae(61501,{type:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pp(r){r=qr(r,Pt);const e=qr(r.firestore,Ho);return dO(qg(e),r._key).then((n=>RO(e,r,n)))}Va._jsonSchemaVersion="firestore/querySnapshot/1.0",Va._jsonSchema={type:qt("string",Va._jsonSchemaVersion),bundleSource:qt("string","QuerySnapshot"),bundleName:qt("string"),bundle:qt("string")};class S_ extends AO{constructor(e){super(),this.firestore=e}convertBytes(e){return new yr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Pt(this.firestore,null,n)}}function Zc(r){r=qr(r,Ki);const e=qr(r.firestore,Ho),n=qg(e),i=new S_(e);return _O(r._query),pO(n,r._query).then((a=>new Va(e,i,r,a)))}function E_(r,e,n){r=qr(r,Pt);const i=qr(r.firestore,Ho),a=T_(r.converter,e);return Np(i,[p_(xp(i),"setDoc",r._key,a,r.converter!==null,n).toMutation(r._key,br.none())])}function Jg(r,e,n,...i){r=qr(r,Pt);const a=qr(r.firestore,Ho),c=xp(a);let p;return p=typeof(e=Wt(e))=="string"||e instanceof Ap?TO(c,"updateDoc",r._key,e,n,i):wO(c,"updateDoc",r._key,e),Np(a,[p.toMutation(r._key,br.exists(!0))])}function xO(r){return Np(qr(r.firestore,Ho),[new Tg(r._key,br.none())])}function Yg(r,e){const n=qr(r.firestore,Ho),i=Yi(r),a=T_(r.converter,e);return Np(n,[p_(xp(r.firestore),"addDoc",i._key,a,r.converter!==null,{}).toMutation(i._key,br.exists(!1))]).then((()=>i))}function Np(r,e){return(function(i,a){const c=new Gs;return i.asyncQueue.enqueueAndForget((async()=>Z1(await uO(i),a,c))),c.promise})(qg(r),e)}function RO(r,e,n){const i=n.docs.get(e._key),a=new S_(r);return new No(r,a,e._key,i,new Tc(n.hasPendingWrites,n.fromCache),e.converter)}function Op(){return new jg("serverTimestamp")}function kO(...r){return new Bg("arrayUnion",r)}(function(e,n=!0){(function(a){rl=a})(tl),ms(new Lr("firestore",((i,{instanceIdentifier:a,options:c})=>{const p=i.getProvider("app").getImmediate(),h=new Ho(new bP(i.getProvider("auth-internal")),new SP(p,i.getProvider("app-check-internal")),(function(g,b){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new ue(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uc(g.options.projectId,b)})(p,a),p);return c={useFetchStreams:n,...c},h._setSettings(c),h}),"PUBLIC").setMultipleInstances(!0)),vr(aT,lT,e),vr(aT,lT,"esm2020")})();const C_="@firebase/installations",Qg="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const __=1e4,A_=`w:${Qg}`,I_="FIS_v2",DO="https://firebaseinstallations.googleapis.com/v1",PO=3600*1e3,NO="installations",OO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},qo=new Bo(NO,OO,UO);function x_(r){return r instanceof zr&&r.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R_({projectId:r}){return`${DO}/projects/${r}/installations`}function k_(r){return{token:r.token,requestStatus:2,expiresIn:LO(r.expiresIn),creationTime:Date.now()}}async function D_(r,e){const i=(await e.json()).error;return qo.create("request-failed",{requestName:r,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function P_({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function MO(r,{refreshToken:e}){const n=P_(r);return n.append("Authorization",qO(e)),n}async function N_(r){const e=await r();return e.status>=500&&e.status<600?r():e}function LO(r){return Number(r.replace("s","000"))}function qO(r){return`${I_} ${r}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jO({appConfig:r,heartbeatServiceProvider:e},{fid:n}){const i=R_(r),a=P_(r),c=e.getImmediate({optional:!0});if(c){const g=await c.getHeartbeatsHeader();g&&a.append("x-firebase-client",g)}const p={fid:n,authVersion:I_,appId:r.appId,sdkVersion:A_},h={method:"POST",headers:a,body:JSON.stringify(p)},f=await N_(()=>fetch(i,h));if(f.ok){const g=await f.json();return{fid:g.fid||n,registrationStatus:2,refreshToken:g.refreshToken,authToken:k_(g.authToken)}}else throw await D_("Create Installation",f)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BO(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zO=/^[cdef][\w-]{21}$/,Bf="";function FO(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;const n=VO(r);return zO.test(n)?n:Bf}catch{return Bf}}function VO(r){return BO(r).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Up(r){return`${r.appName}!${r.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_=new Map;function M_(r,e){const n=Up(r);L_(n,e),HO(n,e)}function L_(r,e){const n=U_.get(r);if(n)for(const i of n)i(e)}function HO(r,e){const n=GO();n&&n.postMessage({key:r,fid:e}),$O()}let Po=null;function GO(){return!Po&&"BroadcastChannel"in self&&(Po=new BroadcastChannel("[Firebase] FID Change"),Po.onmessage=r=>{L_(r.data.key,r.data.fid)}),Po}function $O(){U_.size===0&&Po&&(Po.close(),Po=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO="firebase-installations-database",KO=1,jo="firebase-installations-store";let ef=null;function Xg(){return ef||(ef=rE(WO,KO,{upgrade:(r,e)=>{switch(e){case 0:r.createObjectStore(jo)}}})),ef}async function sp(r,e){const n=Up(r),a=(await Xg()).transaction(jo,"readwrite"),c=a.objectStore(jo),p=await c.get(n);return await c.put(e,n),await a.done,(!p||p.fid!==e.fid)&&M_(r,e.fid),e}async function q_(r){const e=Up(r),i=(await Xg()).transaction(jo,"readwrite");await i.objectStore(jo).delete(e),await i.done}async function Mp(r,e){const n=Up(r),a=(await Xg()).transaction(jo,"readwrite"),c=a.objectStore(jo),p=await c.get(n),h=e(p);return h===void 0?await c.delete(n):await c.put(h,n),await a.done,h&&(!p||p.fid!==h.fid)&&M_(r,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zg(r){let e;const n=await Mp(r.appConfig,i=>{const a=JO(i),c=YO(r,a);return e=c.registrationPromise,c.installationEntry});return n.fid===Bf?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function JO(r){const e=r||{fid:FO(),registrationStatus:0};return j_(e)}function YO(r,e){if(e.registrationStatus===0){if(!navigator.onLine){const a=Promise.reject(qo.create("app-offline"));return{installationEntry:e,registrationPromise:a}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=QO(r,n);return{installationEntry:n,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:XO(r)}:{installationEntry:e}}async function QO(r,e){try{const n=await jO(r,e);return sp(r.appConfig,n)}catch(n){throw x_(n)&&n.customData.serverCode===409?await q_(r.appConfig):await sp(r.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function XO(r){let e=await iS(r.appConfig);for(;e.registrationStatus===1;)await O_(100),e=await iS(r.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:i}=await Zg(r);return i||n}return e}function iS(r){return Mp(r,e=>{if(!e)throw qo.create("installation-not-found");return j_(e)})}function j_(r){return ZO(r)?{fid:r.fid,registrationStatus:0}:r}function ZO(r){return r.registrationStatus===1&&r.registrationTime+__<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eU({appConfig:r,heartbeatServiceProvider:e},n){const i=tU(r,n),a=MO(r,n),c=e.getImmediate({optional:!0});if(c){const g=await c.getHeartbeatsHeader();g&&a.append("x-firebase-client",g)}const p={installation:{sdkVersion:A_,appId:r.appId}},h={method:"POST",headers:a,body:JSON.stringify(p)},f=await N_(()=>fetch(i,h));if(f.ok){const g=await f.json();return k_(g)}else throw await D_("Generate Auth Token",f)}function tU(r,{fid:e}){return`${R_(r)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ey(r,e=!1){let n;const i=await Mp(r.appConfig,c=>{if(!B_(c))throw qo.create("not-registered");const p=c.authToken;if(!e&&sU(p))return c;if(p.requestStatus===1)return n=nU(r,e),c;{if(!navigator.onLine)throw qo.create("app-offline");const h=oU(c);return n=rU(r,h),h}});return n?await n:i.authToken}async function nU(r,e){let n=await oS(r.appConfig);for(;n.authToken.requestStatus===1;)await O_(100),n=await oS(r.appConfig);const i=n.authToken;return i.requestStatus===0?ey(r,e):i}function oS(r){return Mp(r,e=>{if(!B_(e))throw qo.create("not-registered");const n=e.authToken;return aU(n)?{...e,authToken:{requestStatus:0}}:e})}async function rU(r,e){try{const n=await eU(r,e),i={...e,authToken:n};return await sp(r.appConfig,i),n}catch(n){if(x_(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await q_(r.appConfig);else{const i={...e,authToken:{requestStatus:0}};await sp(r.appConfig,i)}throw n}}function B_(r){return r!==void 0&&r.registrationStatus===2}function sU(r){return r.requestStatus===2&&!iU(r)}function iU(r){const e=Date.now();return e<r.creationTime||r.creationTime+r.expiresIn<e+PO}function oU(r){const e={requestStatus:1,requestTime:Date.now()};return{...r,authToken:e}}function aU(r){return r.requestStatus===1&&r.requestTime+__<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lU(r){const e=r,{installationEntry:n,registrationPromise:i}=await Zg(e);return i?i.catch(console.error):ey(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cU(r,e=!1){const n=r;return await uU(n),(await ey(n,e)).token}async function uU(r){const{registrationPromise:e}=await Zg(r);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(r){if(!r||!r.options)throw tf("App Configuration");if(!r.name)throw tf("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!r.options[n])throw tf(n);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function tf(r){return qo.create("missing-app-config-values",{valueName:r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_="installations",pU="installations-internal",mU=r=>{const e=r.getProvider("app").getImmediate(),n=dU(e),i=zo(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},hU=r=>{const e=r.getProvider("app").getImmediate(),n=zo(e,z_).getImmediate();return{getId:()=>lU(n),getToken:a=>cU(n,a)}};function fU(){ms(new Lr(z_,mU,"PUBLIC")),ms(new Lr(pU,hU,"PRIVATE"))}fU();vr(C_,Qg);vr(C_,Qg,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip="analytics",gU="firebase_id",yU="origin",vU=60*1e3,bU="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ty="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=new cp("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wU={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Qn=new Bo("analytics","Analytics",wU);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TU(r){if(!r.startsWith(ty)){const e=Qn.create("invalid-gtag-resource",{gtagURL:r});return qn.warn(e.message),""}return r}function F_(r){return Promise.all(r.map(e=>e.catch(n=>n)))}function SU(r,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(r,e)),n}function EU(r,e){const n=SU("firebase-js-sdk-policy",{createScriptURL:TU}),i=document.createElement("script"),a=`${ty}?l=${r}&id=${e}`;i.src=n?n?.createScriptURL(a):a,i.async=!0,document.head.appendChild(i)}function CU(r){let e=[];return Array.isArray(window[r])?e=window[r]:window[r]=e,e}async function _U(r,e,n,i,a,c){const p=i[a];try{if(p)await e[p];else{const f=(await F_(n)).find(g=>g.measurementId===a);f&&await e[f.appId]}}catch(h){qn.error(h)}r("config",a,c)}async function AU(r,e,n,i,a){try{let c=[];if(a&&a.send_to){let p=a.send_to;Array.isArray(p)||(p=[p]);const h=await F_(n);for(const f of p){const g=h.find(E=>E.measurementId===f),b=g&&e[g.appId];if(b)c.push(b);else{c=[];break}}}c.length===0&&(c=Object.values(e)),await Promise.all(c),r("event",i,a||{})}catch(c){qn.error(c)}}function IU(r,e,n,i){async function a(c,...p){try{if(c==="event"){const[h,f]=p;await AU(r,e,n,h,f)}else if(c==="config"){const[h,f]=p;await _U(r,e,n,i,h,f)}else if(c==="consent"){const[h,f]=p;r("consent",h,f)}else if(c==="get"){const[h,f,g]=p;r("get",h,f,g)}else if(c==="set"){const[h]=p;r("set",h)}else r(c,...p)}catch(h){qn.error(h)}}return a}function xU(r,e,n,i,a){let c=function(...p){window[i].push(arguments)};return window[a]&&typeof window[a]=="function"&&(c=window[a]),window[a]=IU(c,r,e,n),{gtagCore:c,wrappedGtag:window[a]}}function RU(r){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(ty)&&n.src.includes(r))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kU=30,DU=1e3;class PU{constructor(e={},n=DU){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const V_=new PU;function NU(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function OU(r){const{appId:e,apiKey:n}=r,i={method:"GET",headers:NU(n)},a=bU.replace("{app-id}",e),c=await fetch(a,i);if(c.status!==200&&c.status!==304){let p="";try{const h=await c.json();h.error?.message&&(p=h.error.message)}catch{}throw Qn.create("config-fetch-failed",{httpStatus:c.status,responseMessage:p})}return c.json()}async function UU(r,e=V_,n){const{appId:i,apiKey:a,measurementId:c}=r.options;if(!i)throw Qn.create("no-app-id");if(!a){if(c)return{measurementId:c,appId:i};throw Qn.create("no-api-key")}const p=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new qU;return setTimeout(async()=>{h.abort()},vU),H_({appId:i,apiKey:a,measurementId:c},p,h,e)}async function H_(r,{throttleEndTimeMillis:e,backoffCount:n},i,a=V_){const{appId:c,measurementId:p}=r;try{await MU(i,e)}catch(h){if(p)return qn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${p} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:c,measurementId:p};throw h}try{const h=await OU(r);return a.deleteThrottleMetadata(c),h}catch(h){const f=h;if(!LU(f)){if(a.deleteThrottleMetadata(c),p)return qn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${p} provided in the "measurementId" field in the local Firebase config. [${f?.message}]`),{appId:c,measurementId:p};throw h}const g=Number(f?.customData?.httpStatus)===503?Pw(n,a.intervalMillis,kU):Pw(n,a.intervalMillis),b={throttleEndTimeMillis:Date.now()+g,backoffCount:n+1};return a.setThrottleMetadata(c,b),qn.debug(`Calling attemptFetch again in ${g} millis`),H_(r,b,i,a)}}function MU(r,e){return new Promise((n,i)=>{const a=Math.max(e-Date.now(),0),c=setTimeout(n,a);r.addEventListener(()=>{clearTimeout(c),i(Qn.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function LU(r){if(!(r instanceof zr)||!r.customData)return!1;const e=Number(r.customData.httpStatus);return e===429||e===500||e===503||e===504}class qU{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function jU(r,e,n,i,a){if(a&&a.global){r("event",n,i);return}else{const c=await e,p={...i,send_to:c};r("event",n,p)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BU(){if(ZS())try{await eE()}catch(r){return qn.warn(Qn.create("indexeddb-unavailable",{errorInfo:r?.toString()}).message),!1}else return qn.warn(Qn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function zU(r,e,n,i,a,c,p){const h=UU(r);h.then(C=>{n[C.measurementId]=C.appId,r.options.measurementId&&C.measurementId!==r.options.measurementId&&qn.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${C.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(C=>qn.error(C)),e.push(h);const f=BU().then(C=>{if(C)return i.getId()}),[g,b]=await Promise.all([h,f]);RU(c)||EU(c,g.measurementId),a("js",new Date);const E=p?.config??{};return E[yU]="firebase",E.update=!0,b!=null&&(E[gU]=b),a("config",g.measurementId,E),g.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FU{constructor(e){this.app=e}_delete(){return delete xc[this.app.options.appId],Promise.resolve()}}let xc={},aS=[];const lS={};let nf="dataLayer",VU="gtag",cS,G_,uS=!1;function HU(){const r=[];if(XS()&&r.push("This is a browser extension environment."),Mx()||r.push("Cookies are not available."),r.length>0){const e=r.map((i,a)=>`(${a+1}) ${i}`).join(" "),n=Qn.create("invalid-analytics-context",{errorInfo:e});qn.warn(n.message)}}function GU(r,e,n){HU();const i=r.options.appId;if(!i)throw Qn.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)qn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Qn.create("no-api-key");if(xc[i]!=null)throw Qn.create("already-exists",{id:i});if(!uS){CU(nf);const{wrappedGtag:c,gtagCore:p}=xU(xc,aS,lS,nf,VU);G_=c,cS=p,uS=!0}return xc[i]=zU(r,aS,lS,e,cS,nf,n),new FU(r)}function $U(r=eg()){r=Wt(r);const e=zo(r,ip);return e.isInitialized()?e.getImmediate():WU(r)}function WU(r,e={}){const n=zo(r,ip);if(n.isInitialized()){const a=n.getImmediate();if(Ws(e,n.getOptions()))return a;throw Qn.create("already-initialized")}return n.initialize({options:e})}function KU(r,e,n,i){r=Wt(r),jU(G_,xc[r.app.options.appId],e,n,i).catch(a=>qn.error(a))}const dS="@firebase/analytics",pS="0.10.18";function JU(){ms(new Lr(ip,(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),a=e.getProvider("installations-internal").getImmediate();return GU(i,a,n)},"PUBLIC")),ms(new Lr("analytics-internal",r,"PRIVATE")),vr(dS,pS),vr(dS,pS,"esm2020");function r(e){try{const n=e.getProvider(ip).getImmediate();return{logEvent:(i,a,c)=>KU(n,i,a,c)}}catch(n){throw Qn.create("interop-component-reg-failed",{reason:n})}}}JU();const YU={apiKey:"AIzaSyDtFFUFSfT6sOqnxJVrZ3-H3i66Cga2th0",authDomain:"ai-first-developer.firebaseapp.com",projectId:"ai-first-developer",storageBucket:"ai-first-developer.firebasestorage.app",messagingSenderId:"914515554273",appId:"1:914515554273:web:d8b69ab353166c30196ca0",measurementId:"G-SXJPECZJZ3"},ny=sE(YU),ry=dg(ny),xn=hO(ny);$U(ny);const Lp=async(r,e,n={})=>{try{const i={userId:r,activityType:e,metadata:n,timestamp:Op()};await Yg(Ji(xn,"userActivity"),i)}catch(i){console.error("Error logging user activity:",i)}},QU=async r=>{try{const e=Gg(Ji(xn,"userActivity"),y_("userId","==",r),v_("timestamp","desc"),b_(100)),i=(await Zc(e)).docs.map(c=>c.data());return{totalActivities:i.length,lessonCompletions:i.filter(c=>c.activityType==="lesson_completed").length,badgeEarnings:i.filter(c=>c.activityType==="badge_earned").length,recentActivities:i.slice(0,10)}}catch(e){return console.error("Error fetching user progress analytics:",e),{totalActivities:0,lessonCompletions:0,badgeEarnings:0,recentActivities:[]}}},XU=async()=>{try{const r=Gg(Ji(xn,"userActivity"),v_("timestamp","desc"),b_(1e3)),n=(await Zc(r)).docs.map(a=>a.data());return{totalActivities:n.length,uniqueUsers:new Set(n.map(a=>a.userId)).size,lessonCompletions:n.filter(a=>a.activityType==="lesson_completed").length,badgeEarnings:n.filter(a=>a.activityType==="badge_earned").length}}catch(r){return console.error("Error fetching platform analytics:",r),{totalActivities:0,uniqueUsers:0,lessonCompletions:0,badgeEarnings:0}}},ZU=async()=>{try{return{averageSessionDuration:25,pageLoadTime:2.3,errorRate:.05,userRetention:.75}}catch(r){return console.error("Error fetching performance metrics:",r),{averageSessionDuration:0,pageLoadTime:0,errorRate:0,userRetention:0}}},$_=F.createContext(),eu=()=>F.useContext($_),eM=({children:r})=>{const[e,n]=F.useState(null),[i,a]=F.useState(!0);F.useEffect(()=>rD(ry,async h=>{h&&!e&&await Lp(h.uid,"login",{}),n(h),a(!1)}),[e]);const c={currentUser:e};return R.jsx($_.Provider,{value:c,children:!i&&r})},tM=()=>{const{currentUser:r}=eu(),e=async()=>{try{await ry.signOut()}catch(n){console.error("Failed to log out",n)}};return R.jsx("header",{className:"app-header",children:R.jsxs("div",{className:"header-content",children:[R.jsx(Ro,{to:"/",className:"logo",children:R.jsx("h1",{children:"AI Learning Platform"})}),R.jsx("nav",{className:"main-nav",children:r&&R.jsxs(R.Fragment,{children:[R.jsx(Ro,{to:"/",children:"Learn"}),R.jsx(Ro,{to:"/portfolio",children:"Portfolio"}),R.jsx(Ro,{to:"/profile",children:"Profile"}),R.jsx(Ro,{to:"/analytics",children:"Analytics"}),R.jsx("button",{onClick:e,className:"logout-button",children:"Logout"})]})})]})})},nM=()=>{const r={padding:"16px",textAlign:"center",borderTop:"1px solid #e0e0e0",marginTop:"32px"};return R.jsx("footer",{style:r,children:R.jsx("p",{children:"Previous | Next"})})},rM=({children:r})=>{const e={display:"flex",flexDirection:"column",minHeight:"100vh"},n={flex:1,paddingTop:"80px"};return R.jsxs("div",{style:e,children:[R.jsx(tM,{}),R.jsx("main",{style:n,children:r}),R.jsx(nM,{})]})},sM=()=>{const[r,e]=F.useState(""),[n,i]=F.useState(""),[a,c]=F.useState(""),p=dg(),h=new Bs,f=async b=>{if(b.preventDefault(),c(""),!r.trim()){c("Email is required");return}if(!n.trim()){c("Password is required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)){c("Please enter a valid email address");return}if(n.length<6){c("Password must be at least 6 characters long");return}try{await eD(p,r,n)}catch(C){c(C.message)}},g=async()=>{c("");try{await ED(p,h)}catch(b){c(b.message)}};return R.jsxs("div",{className:"login-form-container",children:[R.jsxs("form",{onSubmit:f,className:"login-form",children:[R.jsx("h2",{children:"Login"}),a&&R.jsx("p",{className:"error-message",children:a}),R.jsxs("div",{className:"input-group",children:[R.jsx("input",{type:"email",id:"email",value:r,onChange:b=>e(b.target.value),required:!0,placeholder:" "}),R.jsx("label",{htmlFor:"email",children:"Email"})]}),R.jsxs("div",{className:"input-group",children:[R.jsx("input",{type:"password",id:"password",value:n,onChange:b=>i(b.target.value),required:!0,placeholder:" "}),R.jsx("label",{htmlFor:"password",children:"Password"})]}),R.jsx("button",{type:"submit",className:"login-button",children:"Login"})]}),R.jsx("button",{onClick:g,className:"google-signin-button",children:"Sign in with Google"})]})},iM="progress",oM=r=>{const e=Yi(xn,iM,r);return E_(e,{userId:r,completedModules:[],completedLessons:[],lastAccessed:Op()})},aM=({onSignupSuccess:r})=>{const[e,n]=F.useState(""),[i,a]=F.useState(""),[c,p]=F.useState(""),h=dg(),f=async g=>{g.preventDefault(),p("");try{const E=(await Zk(h,e,i)).user;await oM(E.uid),r&&r()}catch(b){p(b.message)}};return R.jsx("div",{className:"signup-form-container",children:R.jsxs("form",{onSubmit:f,className:"signup-form",children:[R.jsx("h2",{children:"Create Account"}),c&&R.jsx("p",{className:"error-message",children:c}),R.jsxs("div",{className:"input-group",children:[R.jsx("input",{type:"email",id:"signup-email",value:e,onChange:g=>n(g.target.value),required:!0,placeholder:" "}),R.jsx("label",{htmlFor:"signup-email",children:"Email"})]}),R.jsxs("div",{className:"input-group",children:[R.jsx("input",{type:"password",id:"signup-password",value:i,onChange:g=>a(g.target.value),required:!0,placeholder:" "}),R.jsx("label",{htmlFor:"signup-password",children:"Password"})]}),R.jsx("button",{type:"submit",className:"signup-button",children:"Sign Up"})]})})},lM=()=>{const[r,e]=F.useState(!0),n=()=>{e(!r)};return R.jsxs("div",{className:"auth-page",children:[r?R.jsx(sM,{}):R.jsx(aM,{onSignupSuccess:()=>e(!0)}),R.jsx("div",{className:"auth-toggle",children:r?R.jsxs("p",{children:["Don't have an account?"," ",R.jsx("button",{onClick:n,className:"toggle-button",children:"Sign Up"})]}):R.jsxs("p",{children:["Already have an account?"," ",R.jsx("button",{onClick:n,className:"toggle-button",children:"Login"})]})})]})};var rf={exports:{}},sf,mS;function cM(){if(mS)return sf;mS=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return sf=r,sf}var of,hS;function uM(){if(hS)return of;hS=1;var r=cM();function e(){}function n(){}return n.resetWarningCache=e,of=function(){function i(p,h,f,g,b,E){if(E!==r){var C=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw C.name="Invariant Violation",C}}i.isRequired=i;function a(){return i}var c={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:a,element:i,elementType:i,instanceOf:a,node:i,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:n,resetWarningCache:e};return c.PropTypes=c,c},of}var fS;function dM(){return fS||(fS=1,rf.exports=uM()()),rf.exports}var pM=dM();const Oe=Hf(pM),W_="userProgress",mM=async r=>{if(!r)return[];try{const e=Yi(xn,W_,r),n=await Pp(e);return n.exists()?n.data().completedLessons||[]:[]}catch(e){return console.error("Error fetching user progress:",e),[]}},hM=async(r,e)=>{if(!(!r||!e))try{const n=Yi(xn,W_,r);(await Pp(n)).exists()?await Jg(n,{completedLessons:kO(e)}):await E_(n,{completedLessons:[e]}),await Lp(r,"lesson_completed",{lessonId:e})}catch(n){console.error("Error updating user progress:",n)}},fM=async r=>{const e=Yi(xn,"users",r),n=await Pp(e);if(!n.exists()){console.error("User document not found!");return}const i=n.data(),a=new Date;a.setHours(0,0,0,0);let c=null;i.lastActivityDate&&(c=i.lastActivityDate.toDate(),c.setHours(0,0,0,0));let p=i.currentStreak||0;if(c){const f=(a.getTime()-c.getTime())/(1e3*3600*24);f===1?p+=1:f>1&&(p=1)}else p=1;await Jg(e,{currentStreak:p,lastActivityDate:Op()}),p>(i.currentStreak||0)&&await Lp(r,"streak_updated",{newStreak:p})},gS=async(r,e)=>{const n=Ji(xn,`users/${r}/badges`),i=Gg(n,y_("id","==",e.id));(await Zc(i)).empty&&(await Yg(n,{...e,dateAwarded:Op()}),await Lp(r,"badge_earned",{badgeId:e.id,badgeName:e.name}))},gM=async r=>{const e=Yi(xn,"users",r),n=await Pp(e),i=Ji(xn,`users/${r}/badges`),a=n.exists()?{currentStreak:n.data().currentStreak||0,lastActivityDate:n.data().lastActivityDate||null}:{currentStreak:0,lastActivityDate:null},p=(await Zc(i)).docs.map(h=>h.data());return{streak:a,badges:p}},yS=[{id:"html-novice",name:"HTML Novice",description:"Awarded for completing the HTML module.",icon:"🏆"},{id:"css-novice",name:"CSS Novice",description:"Awarded for completing the CSS module.",icon:"🎨"},{id:"js-novice",name:"JavaScript Novice",description:"Awarded for completing the JavaScript module.",icon:"⚡"},{id:"streak-5",name:"5-Day Streak",description:"Awarded for reaching a 5-day learning streak.",icon:"🔥"}],yM={id:"html5",tier:1,name:"HTML5",description:"HTML5 is the latest version of Hypertext Markup Language, the code that describes web pages. It's designed to deliver rich content without the need for additional plugins.",difficulty:"beginner",estimatedHours:10,prerequisites:[],learningObjectives:["Understand the basic structure of an HTML document.","Learn to use common HTML tags for text formatting, links, and images.","Be able to create lists, tables, and forms to organize content.","Understand the purpose and usage of semantic HTML5 elements.","Learn how to embed multimedia like audio and video."],sections:[{id:"html-introduction",title:"Introduction to HTML",content:"Think of HTML as the skeleton of a website. Just like a skeleton gives a body its structure, HTML provides the fundamental structure for every web page. 'Hypertext' refers to the links that connect pages, and 'Markup Language' means you use special tags to tell the browser how to display the content. It’s the very first thing you need to learn in web development.",keyTopics:["What is HTML?","Basic Document Structure","Doctype Declaration"],codeExamples:[{title:"Basic HTML Document",code:`<!DOCTYPE html>
<html>
<head>
  <title>Page Title</title>
</head>
<body>
  <h1>My First Heading</h1>
  <p>My first paragraph.</p>
</body>
</html>`}]},{id:"html-basic-tags",title:"Basic Tags & Text Formatting",content:`Think of HTML tags like giving instructions to a very obedient robot (your web browser). You can't just write a sentence and expect it to know it's a headline. You have to wrap it in 'instruction tags' to give it meaning.

For example, to create a big, important title, you use &lt;h1&gt;. Think of it as telling the robot, 'Make this a top-level headline!' For less important subheadings, you can use &lt;h2&gt;, &lt;h3&gt;, and so on. For any regular paragraph of text, you simply wrap it in &lt;p&gt; tags.

What if you want to make a word stand out? To make text bold and show it's important, you use &lt;strong&gt;. To emphasize a word, you can use &lt;em&gt;, which usually makes it italic. It's like adding tone of voice to your text!`,keyTopics:["Headings (h1-h6)","Paragraphs (p)","Bold (strong)","Italic (em)","Line Breaks (br)"],codeExamples:[{title:"Text Formatting",code:`<h1>Main Heading</h1>
<h2>Sub-heading</h2>
<p>This is a paragraph. <strong>This text is important (bold).</strong> It is different from <em>emphasized (italic) text.</em></p>
<p>You can also<br>add a line break.</p>`}]},{id:"html-links-and-images",title:"Links and Images",content:`What makes the web 'the web'? Links! A link, or hyperlink, lets you connect your page to another. You create one with the &lt;a&gt; (anchor) tag. The 'href' attribute holds the destination URL, like a street address for your link.

To make your page more visual, you use the &lt;img&gt; tag to add pictures. This tag needs two things: a 'src' (source) attribute to tell it where to find the image, and an 'alt' (alternative) attribute. The 'alt' text is super important—it describes the image for visually impaired users and also shows up if the image can't load.`,keyTopics:["Anchor Tag (a)","Image Tag (img)","href attribute","src attribute","alt attribute"],codeExamples:[{title:"Creating a Link and Embedding an Image",code:`<p>Visit our <a href="https://www.example.com" target="_blank">official website</a> in a new tab.</p>
<img src="images/logo.png" alt="The company logo, a blue bird flying.">`}]},{id:"html-lists",title:"Lists",content:"Sometimes you need to organize information into a list. HTML gives you two options. If the order doesn't matter, like a grocery list, you use an unordered list (&lt;ul&gt;) to get bullet points. If the order is crucial, like step-by-step instructions, you use an ordered list (&lt;ol&gt;) to get numbers. Either way, each item in the list gets its own &lt;li&gt; (list item) tag.",keyTopics:["Unordered Lists (ul)","Ordered Lists (ol)","List Items (li)"],codeExamples:[{title:"Unordered and Ordered Lists",code:`<h4>Shopping List</h4>
<ul>
  <li>Milk</li>
  <li>Bread</li>
  <li>Cheese</li>
</ul>

<h4>Instructions</h4>
<ol>
  <li>First, preheat the oven.</li>
  <li>Next, mix the ingredients.</li>
  <li>Finally, bake for 20 minutes.</li>
</ol>`}]},{id:"html-tables",title:"Tables",content:"When you have data that belongs in a grid, like a price list or a schedule, tables are the perfect tool. You start with a &lt;table&gt; tag. Inside, you build the table row by row with &lt;tr&gt; (table row) tags. For the column titles, you use &lt;th&gt; (table header) to make them stand out. For all the regular data cells, you use &lt;td&gt; (table data). A quick warning: only use tables for data, not for laying out your whole page!",keyTopics:["<table>","<tr>","<th>","<td>","Table Headers"],codeExamples:[{title:"Simple Data Table",code:`<table>
  <tr>
    <th>Firstname</th>
    <th>Lastname</th>
    <th>Age</th>
  </tr>
  <tr>
    <td>John</td>
    <td>Doe</td>
    <td>30</td>
  </tr>
  <tr>
    <td>Jane</td>
    <td>Smith</td>
    <td>25</td>
  </tr>
</table>`}]},{id:"html-forms",title:"Forms and User Input",content:"Forms are how you let users talk back to your website—whether it's a search bar, a login page, or a contact form. You start with a &lt;form&gt; tag, which acts as a container. Inside, the &lt;input&gt; tag is your best friend. By changing its 'type' attribute, it can become a text box, a password field, a checkbox, or a radio button. To make your forms accessible, always pair your inputs with a &lt;label&gt; tag. It tells users exactly what information you're asking for.",keyTopics:["<form>","<input>","<textarea>","<label>","<button>","Input Types"],codeExamples:[{title:"Simple Login Form",code:`<form action="/submit-data" method="post">
  <div>
    <label for="username">Username:</label>
    <input type="text" id="username" name="username">
  </div>
  <div>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password">
  </div>
  <button type="submit">Submit</button>
</form>`}]},{id:"html-semantic-elements",title:"Semantic HTML5 Elements",content:`Imagine building a house with only one type of brick for everything—walls, floors, and the roof. It would be a confusing mess! Early websites were often built like that, using a generic &lt;div&gt; tag for everything.

Semantic HTML is like having specialized bricks: &lt;header&gt; for the top of your page, &lt;footer&gt; for the bottom, &lt;nav&gt; for your navigation links, and &lt;main&gt; for your primary content. These tags don't just change how things look; they give *meaning* to your content. This is incredibly helpful for search engines like Google to understand your site and for assistive technologies like screen readers to help visually impaired users navigate. It makes your website smarter and more accessible for everyone.`,keyTopics:["<header>","<footer>","<nav>","<main>","<article>","<section>","<aside>"],codeExamples:[{title:"Semantic Page Layout",code:`<header>
  <h1>My Awesome Blog</h1>
  <nav>
    <a href="/home">Home</a>
    <a href="/about">About</a>
  </nav>
</header>
<main>
  <article>
    <h2>My First Post</h2>
    <p>This is the content of my first blog post.</p>
  </article>
</main>
<footer>
  <p>Copyright &copy; 2025</p>
</footer>`}]},{id:"html-multimedia",title:"Multimedia in HTML",content:"With HTML5, adding media became incredibly simple. You no longer need clunky plugins to play sounds or videos. Just use the &lt;audio&gt; or &lt;video&gt; tag. If you add the 'controls' attribute, the browser will automatically show a play/pause button, a volume slider, and more. You can even provide multiple file formats using the &lt;source&gt; tag, so if a user's browser can't play one type, it has a fallback option.",keyTopics:["<audio>","<video>","controls attribute","source tag"],codeExamples:[{title:"Embedding Audio and Video",code:`<h4>Audio Player</h4>
<audio controls>
  <source src="sound.mp3" type="audio/mpeg">
  <source src="sound.ogg" type="audio/ogg">
  Your browser does not support the audio element.
</audio>

<h4>Video Player</h4>
<video width="320" height="240" controls>
  <source src="movie.mp4" type="video/mp4">
  <source src="movie.webm" type="video/webm">
  Your browser does not support the video tag.
</video>`}]}],aiPrompts:["Explain the difference between block and inline elements in HTML.","How does the 'alt' attribute for images improve accessibility?","Describe a use case for the HTML5 <canvas> element."],resources:[{title:"MDN Web Docs: HTML",url:"https://developer.mozilla.org/en-US/docs/Web/HTML"},{title:"W3Schools HTML Tutorial",url:"https://www.w3schools.com/html/"}],toolsRequired:["A modern web browser (e.g., Chrome, Firefox)","A text editor (e.g., VS Code)"],bestPractices:["Always use semantic tags to define the structure of your content.","Ensure all images have an 'alt' attribute for accessibility.","Validate your HTML to catch errors and ensure cross-browser compatibility."],commonPitfalls:["Forgetting to close tags, which can lead to unexpected layout issues.","Using non-semantic tags like &lt;div&gt; for everything.","Not using the 'label' element for form inputs, which hurts accessibility."],careerRelevance:"HTML is the foundational skill for all web development roles. Mastery of HTML is essential for front-end developers, back-end developers, and full-stack developers."},vM={id:"css3",tier:1,name:"CSS3",description:"CSS (Cascading Style Sheets) is the language we use to style an HTML document. CSS describes how HTML elements should be displayed on screen, paper, or in other media.",difficulty:"beginner",estimatedHours:15,prerequisites:["html5"],learningObjectives:["Understand the role of CSS in web development.","Learn how to apply styles using selectors, properties, and values.","Grasp the fundamentals of the CSS Box Model.","Be able to create flexible layouts using Flexbox.","Understand the basics of creating grid-based layouts with CSS Grid.","Learn the principles of responsive design using media queries."],sections:[{id:"css-introduction",title:"Introduction to CSS",content:"If HTML is the skeleton of your webpage, think of CSS as the clothes, makeup, and hairstyle. It's what gives your website its look and feel. Without CSS, the web would be a very boring place with just black text on a white background. CSS lets you add colors, change fonts, set layouts, and create beautiful designs. The 'Cascading' part is important—it means that styles can be inherited from parent elements, creating a cascade of rules.",keyTopics:["What is CSS?","Inline, Internal, and External CSS","CSS Syntax"],codeExamples:[{title:"Basic CSS Rule",code:`/* This is a CSS comment */
p {
  color: blue; /* Makes all paragraph text blue */
  font-size: 16px; /* Sets the font size to 16 pixels */
}`}]},{id:"css-selectors-and-properties",title:"Selectors and Properties",content:"To style an element, you first need to select it. CSS provides a powerful set of selectors to target elements. You can select elements by their tag name (e.g., &lt;p&gt;), their class (e.g., class='important'), or their unique ID (e.g., id='main-header'). Once you've selected an element, you apply style rules using properties and values, like 'color: red;' or 'background-color: yellow;'. Think of selectors as the 'who' and properties as the 'what you want to do'.",keyTopics:["Element Selectors","Class Selectors","ID Selectors","Common Properties (color, font-size, background)"],codeExamples:[{title:"Using Selectors",code:`/* Element selector */
h1 {
  font-family: Arial, sans-serif;
}

/* Class selector */
.highlight {
  background-color: yellow;
}

/* ID selector */
#login-button {
  border: 1px solid green;
}`}]},{id:"css-box-model",title:"The Box Model",content:"This is one of the most fundamental concepts in CSS. Imagine every single HTML element on your page is inside its own invisible box. The Box Model describes how this box is structured. It consists of four parts, from the inside out: the content itself, padding (the space around the content), a border, and finally the margin (the space outside the border, separating it from other elements). Understanding how to control these four parts is the key to managing space and layout on a webpage.",keyTopics:["Content","Padding","Border","Margin","height & width"],codeExamples:[{title:"Box Model Example",code:`.my-box {
  width: 300px;
  padding: 20px;
  border: 5px solid black;
  margin: 15px;
  background-color: lightgray;
}`}]},{id:"css-flexbox-layout",title:"Flexbox Layout",content:"For a long time, laying out elements in a row or column was surprisingly difficult in CSS. Then came Flexbox! Think of it as a tool that makes arranging items in a container incredibly easy. You just declare a container as a 'flex' container, and its direct children become 'flex items'. You can then easily align them, space them out, and change their order, all with a few simple properties. It's perfect for navigation bars, galleries, or any component where you need to align items horizontally or vertically.",keyTopics:["display: flex","flex-direction","justify-content","align-items","flex-grow"],codeExamples:[{title:"Simple Flexbox Container",code:`.container {
  display: flex;
  justify-content: space-around; /* Spreads items out evenly */
  align-items: center; /* Vertically centers items */
  background-color: #f0f0f0;
  height: 100px;
}

.item {
  background-color: dodgerblue;
  color: white;
  padding: 10px;
}`}]},{id:"css-grid-layout",title:"CSS Grid Layout",content:"If Flexbox is for arranging items in one dimension (a row OR a column), CSS Grid is its powerful big brother, designed for two-dimensional layouts. Imagine your webpage as a piece of graph paper. CSS Grid lets you define columns and rows, creating a grid. You can then place items precisely into any cell (or span them across multiple cells) of that grid. It's the most powerful layout system in CSS and is ideal for creating complex page layouts with headers, sidebars, and footers.",keyTopics:["display: grid","grid-template-columns","grid-template-rows","grid-gap","grid-column & grid-row"],codeExamples:[{title:"Simple Grid Layout",code:`.wrapper {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr; /* Three equal-width columns */
  grid-gap: 10px;
}

.grid-item {
  background-color: #4CAF50;
  color: white;
  padding: 20px;
  text-align: center;
}`}]},{id:"css-responsive-design",title:"Responsive Design & Media Queries",content:"Today, people view websites on everything from tiny phones to massive TVs. Responsive Design is the practice of making your website look good on all of them. The main tool for this is the Media Query. A media query is a special CSS rule that checks for things like the width of the screen. You can tell the browser, 'If the screen is less than 600px wide, apply these special styles'. This allows you to change font sizes, hide elements, or even completely rearrange the layout for mobile devices.",keyTopics:["Mobile-First Approach","Media Queries","Viewport Meta Tag","Fluid Layouts"],codeExamples:[{title:"Simple Media Query",code:`/* Default style for all screens */
.container {
  width: 90%;
  margin: 0 auto;
}

/* Style for screens 768px and wider */
@media (min-width: 768px) {
  .container {
    width: 80%;
  }
}

/* Style for screens 1200px and wider */
@media (min-width: 1200px) {
  .container {
    width: 1140px;
  }
}`}]}],aiPrompts:["Explain the difference between Flexbox and CSS Grid, and when to use each.","What is CSS specificity and how does it work?","How can you center an element both horizontally and vertically inside a container?"],resources:[{title:"MDN Web Docs: CSS",url:"https://developer.mozilla.org/en-US/docs/Web/CSS"},{title:"CSS-Tricks: A Guide to Flexbox",url:"https://css-tricks.com/snippets/css/a-guide-to-flexbox/"},{title:"CSS-Tricks: A Complete Guide to Grid",url:"https://css-tricks.com/snippets/css/complete-guide-grid/"}],toolsRequired:["A modern web browser (e.g., Chrome, Firefox)","A text editor (e.g., VS Code)"],bestPractices:["Use external stylesheets for better organization and reusability.","Use classes for styling and reserve IDs for JavaScript hooks or fragment identifiers.","Adopt a mobile-first approach when writing responsive styles."],commonPitfalls:["Overriding CSS rules with `!important` instead of understanding specificity.","Using pixels for everything, which can make responsive design difficult.","Not understanding the difference between block, inline, and inline-block elements."],careerRelevance:"CSS is a cornerstone technology of the web. Mastery of CSS is non-negotiable for front-end and full-stack developers, and a strong understanding is beneficial for UI/UX designers as well."},bM={id:"javascript",tier:1,name:"JavaScript",description:"JavaScript is the programming language of the Web. It is used to make web pages interactive and dynamic, from simple animations to complex web applications.",difficulty:"beginner",estimatedHours:25,prerequisites:["html5","css3"],learningObjectives:["Understand core programming concepts: variables, data types, and operators.","Learn to control program flow with conditional statements and loops.","Grasp the fundamentals of functions and scope.","Be able to manipulate the HTML DOM to create interactive pages.","Understand the basics of asynchronous JavaScript with Promises and async/await."],sections:[{id:"javascript-language-of-the-web",title:"The Language of the Web",content:"If HTML is the skeleton and CSS is the clothing, then JavaScript is the brain and muscles. It's what makes a webpage come alive! JavaScript allows you to react to user actions, like clicks and keyboard presses, update content on the page without reloading, and perform complex calculations. It's the engine that powers almost every interactive website you use, from social media feeds to online games.",keyTopics:["What is JavaScript?","Client-Side vs. Server-Side (Node.js)","The 'script' tag"],codeExamples:[{title:"Your First JavaScript",code:`// You can write JavaScript directly in your browser's developer console!
console.log('Hello, World!');

// This line will find an HTML element with the id 'greeting' and change its text.
document.getElementById('greeting').textContent = 'Hello from JavaScript!';`}]},{id:"javascript-variables-and-data-types",title:"Variables and Data Types",content:"Imagine you need to store information, like a user's name or the score in a game. You need a container for that data. In JavaScript, these containers are called 'variables'. Variables can hold different types of data, such as numbers (like 10), strings of text (like 'Alice'), booleans (true or false), and more complex types like objects and arrays. Using 'let' and 'const' to declare variables is the modern standard.",keyTopics:["let, const, var","Strings","Numbers","Booleans","Objects","Arrays"],codeExamples:[{title:"Declaring Variables",code:`let score = 0; // A number that can be changed
const playerName = "Gandalf"; // A string that cannot be changed

let isGameOver = false; // A boolean value

const user = { // An object to hold related data
  name: "Frodo",
  level: 5
};

const inventory = ["ring", "sword", "lembas bread"]; // An array (a list) of items`}]},{id:"javascript-functions",title:"Functions: Reusable Blocks of Code",content:"Functions are one of the most important building blocks in programming. Think of them as recipes. You define a recipe (the function) once, and then you can use it over and over again just by calling its name. Functions can take inputs (called 'parameters') and can return an output. This helps you organize your code, avoid repetition, and make your programs much more powerful and manageable.",keyTopics:["Function Declaration","Function Expression","Arrow Functions","Parameters and Arguments","Return values"],codeExamples:[{title:"Defining and Calling a Function",code:`// A simple function declaration
function greet(name) {
  return "Hello, " + name + "!";
}

// Calling the function and storing its output
const greeting = greet("Aragorn");
console.log(greeting); // Outputs: "Hello, Aragorn!"

// An arrow function, a more modern syntax
const add = (a, b) => {
  return a + b;
};

const sum = add(5, 3);
console.log(sum); // Outputs: 8`}]},{id:"javascript-dom-manipulation",title:"DOM Manipulation",content:"The DOM (Document Object Model) is a tree-like representation of your HTML page. JavaScript has the power to change this tree. You can find elements, create new ones, remove old ones, and change their styles or content. This is the magic behind interactive web pages! When you click a 'like' button and the count goes up without the page reloading, that's JavaScript manipulating the DOM.",keyTopics:["What is the DOM?","getElementById","querySelector","createElement","addEventListener"],codeExamples:[{title:"Changing the Page with the DOM",code:`// Find the button element
const myButton = document.getElementById('action-button');

// Add a 'click' event listener
myButton.addEventListener('click', () => {
  // When the button is clicked...
  const title = document.querySelector('h1');
  title.textContent = "You clicked the button!";
  title.style.color = 'purple';
});`}]},{id:"javascript-asynchronous",title:"Asynchronous JavaScript",content:"JavaScript can only do one thing at a time. But what if you need to do something that takes a long time, like fetching data from a server across the internet? You don't want your entire webpage to freeze while you wait! Asynchronous JavaScript is the solution. It lets you start a long-running task, and your code can continue doing other things. When the task is finished, your code is notified. 'Promises' and the 'async/await' syntax are the modern tools for handling this.",keyTopics:["The Event Loop","Callbacks","Promises (.then, .catch)","async/await"],codeExamples:[{title:"Fetching Data with async/await",code:`// This function fetches user data from an API
async function getUser(username) {
  try {
    const response = await fetch(\`https://api.github.com/users/\${username}\`);
    if (!response.ok) {
      throw new Error('User not found!');
    }
    const userData = await response.json();
    console.log(userData.name);
  } catch (error) {
    console.error("Could not fetch user:", error);
  }
}

// Call the async function
getUser('octocat');`}]}],aiPrompts:["Explain the difference between 'let', 'const', and 'var' and when to use each.","What is the difference between '==' and '===' in JavaScript?","Create a simple to-do list application using only vanilla JavaScript and DOM manipulation."],resources:[{title:"MDN Web Docs: JavaScript",url:"https://developer.mozilla.org/en-US/docs/Web/JavaScript"},{title:"JavaScript.info",url:"https://javascript.info/"},{title:"freeCodeCamp: JavaScript Algorithms and Data Structures",url:"https://www.freecodecamp.org/learn/javascript-algorithms-and-data-structures/"}],toolsRequired:["A modern web browser with developer tools","A text editor (e.g., VS Code)"],bestPractices:["Always use 'const' by default and 'let' only when you know a variable needs to be reassigned.","Use strict equality ('===') instead of loose equality ('==') to avoid unexpected type coercion.","Keep your code organized in functions and modules.","Comment your code to explain the 'why', not the 'what'."],commonPitfalls:["Confusing 'undefined' and 'null'.","Not understanding variable scope, leading to unexpected behavior.","Manipulating the DOM too frequently, which can cause performance issues.","Forgetting to handle errors in asynchronous operations."],careerRelevance:"JavaScript is the most popular programming language in the world and a fundamental skill for virtually all web development roles (front-end, back-end, and full-stack). It has also expanded into mobile apps, desktop apps, and IoT."},wM={id:"devtools",tier:1,name:"Browser Dev Tools",description:"The Browser Developer Tools are a set of powerful tools built into modern web browsers, allowing developers to inspect, debug, and profile their web applications.",difficulty:"beginner",estimatedHours:10,prerequisites:["html5","css3","javascript"],learningObjectives:["Learn how to open and navigate the developer tools in major browsers.","Be able to inspect and modify HTML and CSS in real-time using the Elements panel.","Understand how to use the Console to log information and debug JavaScript.","Learn to monitor network requests and responses in the Network tab.","Get a basic understanding of performance profiling with the Performance tab."],sections:[{id:"devtools-swiss-army-knife",title:"Your Web Development Swiss Army Knife",content:"Every modern web browser comes with a powerful secret weapon for developers: the Developer Tools (or DevTools). Think of it as an X-ray machine, a mechanic's garage, and a science lab for your website, all rolled into one. You can open it with a simple keyboard shortcut (usually F12 or Ctrl+Shift+I / Cmd+Opt+I). These tools give you an under-the-hood look at what's happening on a webpage, making it essential for building, debugging, and optimizing.",keyTopics:["What are DevTools?","Opening DevTools","Main Panels Overview"],codeExamples:[{title:"A Quick Peek",code:`// There's no code to write to *use* the DevTools!
// Simply open them on any webpage and start exploring.
// A great first step is to right-click on any element on a page and choose 'Inspect'.
// This will open the DevTools with that specific element highlighted in the Elements panel.`}]},{id:"devtools-elements-panel",title:"The Elements Panel: Your Live HTML & CSS Editor",content:"The Elements panel is like a live, editable version of your website's source code. It shows you the HTML structure as a DOM tree. You can select any element and see all the CSS rules that apply to it, including which ones are being overridden. The best part? You can change things directly in the panel! Want to see how a button looks in a different color? Just change the CSS value and see the result instantly. It's perfect for tweaking styles and diagnosing layout issues.",keyTopics:["Inspecting Elements","The DOM Tree","Viewing and Editing CSS","The Box Model Visualizer"],codeExamples:[{title:"Live CSS Editing",code:`/*
1. Open DevTools and go to the Elements panel.
2. Select an element, like a button or a heading.
3. In the 'Styles' pane on the right, find a CSS property like 'color' or 'background-color'.
4. Click on the value (e.g., 'blue') and type a new one (e.g., 'red').
5. Watch the element change on the page in real-time!
*/`}]},{id:"devtools-console",title:"The Console: Your JavaScript Playground",content:"The Console is your direct line of communication with the JavaScript running on a page. It's an interactive command line where you can type and execute JavaScript code. Developers constantly use `console.log()` in their code to print out the values of variables, helping them understand what's happening at different stages. The console also displays errors and warnings, which are crucial clues for finding and fixing bugs in your scripts.",keyTopics:["Logging with console.log()","Running JavaScript code","Viewing Errors and Warnings","The Console API"],codeExamples:[{title:"Debugging with the Console",code:`function calculateTotal(price, quantity) {
  console.log('Calculating total for price:', price, 'and quantity:', quantity);
  const total = price * quantity;
  console.log('Calculated total is:', total);
  return total;
}

// When you run this, you'll see the log messages in the console,
// helping you trace the function's execution.
const finalPrice = calculateTotal(10, 5);`}]},{id:"devtools-network-tab",title:"The Network Tab: Watching the Wires",content:"A modern webpage rarely consists of a single HTML file. It loads CSS, JavaScript, images, fonts, and often communicates with servers to get data (this is called an API request). The Network tab shows you every single one of these network requests. You can see how long each file took to load, how large it is, and whether the request was successful. It's an indispensable tool for diagnosing slow-loading pages and for debugging communication with a backend server.",keyTopics:["Monitoring Requests","Filtering Requests","Inspecting Request/Response Headers","Checking Status Codes (200, 404, 500)"],codeExamples:[{title:"What to Look For",code:`/*
1. Open DevTools and switch to the Network tab.
2. Refresh the page.
3. You'll see a waterfall chart of all assets loading.
4. Look for any requests that are red - these have failed (e.g., a 404 Not Found error).
5. Click on a request to see detailed information, like its size, how long it took, and the data it returned.
*/`}]}],aiPrompts:["Explain how to use the DevTools to find out why a specific CSS style is not being applied.","What is the difference between the 'Sources' panel and the 'Elements' panel?","How would you use the Network tab to check if an API is returning the correct data?"],resources:[{title:"Chrome DevTools Documentation",url:"https://developer.chrome.com/docs/devtools/"},{title:"Firefox Developer Tools Guide",url:"https://developer.mozilla.org/en-US/docs/Tools"},{title:"A Beginner's Guide to Browser Developer Tools",url:"https://www.freecodecamp.org/news/what-is-browser-developer-tools/"}],toolsRequired:["A modern web browser like Chrome or Firefox"],bestPractices:["Use `console.log()` liberally during development to understand your code's flow, but remove it before deploying to production.","Use the device toolbar to simulate how your site looks on different mobile devices.","Regularly check the Console for errors, even if your site seems to be working.","When debugging CSS, start by inspecting the element in the Elements panel."],commonPitfalls:["Ignoring console errors.","Editing files in the 'Sources' panel and forgetting that the changes are temporary and will be lost on refresh.","Not clearing the cache when debugging network issues, leading to confusion with old files."],careerRelevance:"Proficiency with browser developer tools is not just a nice-to-have; it's a fundamental, non-negotiable skill for every front-end and full-stack developer. It is used every single day to build, debug, and optimize web applications."},TM={id:"json",tier:1,name:"JSON",description:"An introductory guide to JSON, the standard format for data interchange on the web. Learn its syntax, data types, and how to use it in web applications.",difficulty:"beginner",estimatedHours:2,prerequisites:["html5","javascript"],learningObjectives:["Understand what JSON is and why it's important.","Learn the basic syntax and structure of JSON.","Differentiate between JSON data types: strings, numbers, booleans, arrays, and objects.","Understand how to parse JSON in JavaScript.","Learn how to create and serialize JavaScript objects into JSON strings.","Recognize the use of JSON in APIs and configuration files."],sections:[{id:"json-introduction-to-json",title:"Introduction to JSON",content:"JSON, which stands for JavaScript Object Notation, is a lightweight format for storing and transporting data. It's often used when data is sent from a server to a web page. Despite its name, JSON is language-independent, with parsers available for most programming languages.",keyTopics:["Data Interchange","Lightweight Format","Human-Readable"],codeExamples:[]},{id:"json-syntax-and-structure",title:"JSON Syntax and Structure",content:"JSON syntax is derived from JavaScript object notation syntax, but it is a text format only. Data is in name/value pairs, separated by commas. Curly braces hold objects, and square brackets hold arrays.",keyTopics:["Key-Value Pairs","Objects","Arrays"],codeExamples:[{title:"JSON Object Example",code:`{
  "firstName": "John",
  "lastName": "Doe",
  "age": 30,
  "isStudent": false
}`},{title:"JSON Array Example",code:`[
  "apple",
  "banana",
  "orange"
]`}]},{id:"json-data-types",title:"JSON Data Types",content:"JSON supports several fundamental data types that can be combined to create complex data structures.",keyTopics:["String","Number","Boolean","Array","Object","Null"],codeExamples:[{title:"Example of All Data Types",code:`{
  "employeeName": "Jane Smith",
  "employeeId": 12345,
  "isManager": true,
  "departments": ["HR", "Finance", "IT"],
  "contactInfo": {
    "email": "jane.smith@example.com",
    "phone": "555-0102"
  },
  "supervisor": null
}`}]},{id:"json-using-json-in-javascript",title:"Using JSON in JavaScript",content:"JavaScript provides built-in methods to work with JSON. The `JSON.parse()` method converts a JSON string into a JavaScript object, while `JSON.stringify()` converts a JavaScript object into a JSON string. This is essential for sending and receiving data from a server.",keyTopics:["JSON.parse()","JSON.stringify()","Serialization","Deserialization"],codeExamples:[{title:"Parsing a JSON String",code:`const jsonString = '{"name":"Alice","age":25}';
const userObject = JSON.parse(jsonString);

console.log(userObject.name); // Output: Alice`},{title:"Creating a JSON String",code:`const car = {
  make: "Ford",
  model: "Mustang",
  year: 2022
};

const jsonCar = JSON.stringify(car);

console.log(jsonCar);
// Output: {"make":"Ford","model":"Mustang","year":2022}`}]},{id:"json-common-use-cases",title:"Common Use Cases",content:"JSON is ubiquitous in modern web development. Its primary use is for transmitting data between a server and a web application in APIs. It's also widely used for configuration files (like in `package.json`), and for storing structured data in NoSQL databases.",keyTopics:["APIs","Configuration Files","NoSQL Databases"],codeExamples:[]}],aiPrompts:["Explain JSON as if I were a librarian organizing books.","Give me an example of a JSON object representing a recipe.","What is the difference between a JSON object and a JavaScript object?","How do I handle nested objects when parsing JSON in JavaScript?","Write a JSON array of three user objects, each with a name and email."],resources:[{title:"MDN Web Docs: JSON",url:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON"},{title:"JSON.org",url:"https://www.json.org/json-en.html"},{title:"W3Schools JSON Tutorial",url:"https://www.w3schools.com/js/js_json_intro.asp"}],toolsRequired:["Text Editor / IDE","Web Browser"],bestPractices:["Always use double quotes for keys and string values.","Validate your JSON using a linter or online tool to catch syntax errors.","Keep JSON structures as simple as possible while still meeting requirements.","Use consistent naming conventions for keys (e.g., camelCase)."],commonPitfalls:["Using single quotes instead of double quotes.","Forgetting to quote keys.","Adding a trailing comma after the last element in an object or array.","Incorrectly nesting objects and arrays."],careerRelevance:"Understanding JSON is non-negotiable for any web developer. It is the backbone of communication for modern APIs and is used in virtually every web application. Proficiency with JSON is a fundamental skill for frontend, backend, and full-stack roles."},SM={id:"git",tier:1,name:"Git",description:"Learn the fundamentals of Git, the most popular version control system. Understand how to track changes, collaborate with others, and manage your codebase effectively.",difficulty:"beginner",estimatedHours:4,prerequisites:[],learningObjectives:["Understand the purpose of version control and why Git is essential.","Learn how to install and configure Git on your local machine.","Master the basic Git workflow: staging, committing, and pushing changes.","Understand how to work with branches for feature development and bug fixes.","Learn how to collaborate with others using remote repositories on platforms like GitHub.","Be able to resolve common merge conflicts."],sections:[{id:"git-what-is-version-control",title:"What is Version Control?",content:"Version Control is a system that records changes to a file or set of files over time so that you can recall specific versions later. Think of it as a 'save' button for your entire project, allowing you to undo mistakes, see who made changes, and manage different versions of your work. Git is the most widely used modern version control system in the world.",keyTopics:["Version Control System (VCS)","Snapshots","History"],codeExamples:[]},{id:"git-getting-started",title:"Getting Started: Installation and Configuration",content:"Before you can use Git, you need to install it on your computer. Once installed, you should configure your user name and email address. This is important because every Git commit uses this information, and it’s immutably baked into the commits you start creating.",keyTopics:["Installation","Configuration","git config"],codeExamples:[{title:"Configure Your Git Username",code:'git config --global user.name "Your Name"'},{title:"Configure Your Git Email",code:'git config --global user.email "your.email@example.com"'}]},{id:"git-basic-workflow",title:"The Basic Git Workflow",content:"The core of the Git workflow consists of three stages. First, you modify files in your working directory. Second, you stage the files, adding snapshots of them to your staging area. Finally, you commit, which takes the files as they are in the staging area and stores that snapshot permanently to your Git directory.",keyTopics:["Working Directory","Staging Area","Repository","git add","git commit"],codeExamples:[{title:"Initializing a Repository",code:"git init"},{title:"Staging a File",code:"git add <file-name>"},{title:"Committing a Staged File",code:'git commit -m "Your descriptive commit message"'}]},{id:"git-branching-and-merging",title:"Branching and Merging",content:"Branching is a powerful feature in Git that allows you to diverge from the main line of development and continue to do work without messing with that main line. This is perfect for developing new features or fixing bugs. Once your work is complete, you can merge your branch back into the main branch.",keyTopics:["Branching","Merging","git branch","git checkout","git merge"],codeExamples:[{title:"Create a New Branch",code:"git branch <new-branch-name>"},{title:"Switch to the New Branch",code:"git checkout <new-branch-name>"},{title:"Merge a Branch into Your Current Branch",code:"git merge <branch-to-merge>"}]},{id:"git-remote-repositories",title:"Working with Remote Repositories",content:"Remote repositories are versions of your project that are hosted on the internet or network somewhere. Collaborating with others involves managing these remote repositories and pushing and pulling data to and from them when you need to share work. A service like GitHub or GitLab hosts your remote repositories.",keyTopics:["Remote","Push","Pull","Clone","git remote","git push","git pull","git clone"],codeExamples:[{title:"Clone a Remote Repository",code:"git clone <repository-url>"},{title:"Add a Remote Repository",code:"git remote add origin <repository-url>"},{title:"Push Changes to a Remote Repository",code:"git push origin <branch-name>"}]}],aiPrompts:["Explain Git branching like I'm a writer working on different drafts of a story.","What is the difference between `git fetch` and `git pull`?","Give me a good commit message for changing the color of a button.","How do I undo my last commit?","Walk me through the steps to resolve a simple merge conflict."],resources:[{title:"Pro Git Book",url:"https://git-scm.com/book/en/v2"},{title:"GitHub Skills",url:"https://skills.github.com/"},{title:"Learn Git Branching (Interactive Tutorial)",url:"https://learngitbranching.js.org/"}],toolsRequired:["Git CLI","Text Editor / IDE","GitHub/GitLab/Bitbucket Account (Optional)"],bestPractices:["Commit often and write clear, descriptive commit messages.","Use branches for new features and bug fixes to keep the main branch clean.","Pull regularly from the remote repository to stay up-to-date with changes from others.","Use a `.gitignore` file to exclude unnecessary files from version control."],commonPitfalls:["Forgetting to stage files before committing.","Committing large binary files or sensitive data.","Working directly on the main/master branch for new features.","Force pushing (`git push -f`) without understanding the consequences, as it can overwrite history."],careerRelevance:"Git is the industry standard for version control. Proficiency in Git is a mandatory skill for virtually every software development job. It is fundamental for collaboration, code management, and deploying applications. Without Git skills, it is nearly impossible to work on a modern development team."},EM={id:"nodejs",tier:2,name:"Node.js",description:"Node.js is a powerful JavaScript runtime built on Chrome's V8 engine that allows you to run JavaScript on the server-side. It's designed for building scalable network applications and is particularly well-suited for real-time applications, APIs, and microservices.",difficulty:"intermediate",estimatedHours:40,prerequisites:["javascript","json"],learningObjectives:["Understand Node.js fundamentals and event-driven architecture","Master asynchronous programming with callbacks, promises, and async/await","Build RESTful APIs using Express.js framework","Work with file system operations and data persistence","Implement error handling and debugging techniques","Deploy Node.js applications to production environments","Understand package management with npm","Create real-time applications with WebSockets","Implement authentication and security best practices","Optimize Node.js applications for performance and scalability"],sections:[{id:"nodejs-introduction",title:"Introduction to Node.js",content:`Think of Node.js as giving JavaScript superpowers to work outside the browser. Traditionally, JavaScript was confined to web browsers, but Node.js breaks those chains by providing a runtime environment that lets JavaScript run directly on your computer or server.

Imagine you're a chef in a kitchen. In the browser, JavaScript is like a pastry chef who only makes desserts. But with Node.js, JavaScript becomes a master chef who can prepare appetizers, main courses, and even manage the entire restaurant! Node.js uses the same V8 engine that powers Google Chrome, so it's incredibly fast and efficient.

The key innovation of Node.js is its **event-driven, non-blocking I/O model**. Instead of waiting for one task to complete before starting another (like waiting for water to boil before chopping vegetables), Node.js can handle multiple tasks simultaneously, making it perfect for applications that need to handle many concurrent connections.`,keyTopics:["What is Node.js?","JavaScript runtime environment","Event-driven architecture","Non-blocking I/O model","V8 engine","Server-side JavaScript"],practicalExercises:["Install Node.js and verify installation with `node --version`","Create a simple 'Hello World' script and run it","Explore Node.js REPL (Read-Eval-Print Loop) interactive shell","Check available Node.js modules with `node -p 'Object.keys(global)'`"],codeExamples:[{title:"Hello World in Node.js",code:`// hello.js
console.log('Hello, Node.js World!');

// Run with: node hello.js`},{title:"Basic Node.js Information",code:`// info.js
console.log('Node.js Version:', process.version);
console.log('Platform:', process.platform);
console.log('Architecture:', process.arch);
console.log('Current Directory:', process.cwd());

// Run with: node info.js`}]},{id:"nodejs-modules",title:"Modules and npm",content:"Modules in Node.js are like LEGO blocks for your applications. Each module contains specific functionality that you can use in your programs. Think of npm (Node Package Manager) as a massive LEGO store where developers share their creations.\n\nNode.js comes with several built-in modules (called core modules) that provide essential functionality. For example, the `fs` module lets you work with files, the `http` module helps you create web servers, and the `path` module helps you work with file paths.\n\nBut the real power comes from npm packages. With over 1.5 million packages available, you can find solutions for almost any problem. Whether you need to send emails, process images, or connect to databases, there's probably an npm package that can help.\n\nThe `package.json` file is like the blueprint for your Node.js project. It contains metadata about your project, lists all the dependencies, and defines scripts for common tasks like running tests or starting your application.",keyTopics:["CommonJS modules","Built-in core modules","npm package manager","package.json structure","Semantic versioning","Local vs global packages"],practicalExercises:["Initialize a new Node.js project with `npm init`","Install local packages like `lodash` and `express`","Create custom modules and export functions","Use npm scripts to automate common tasks","Check package vulnerabilities with `npm audit`"],codeExamples:[{title:"Creating and Using Custom Modules",code:`// math.js - Custom module
function add(a, b) {
  return a + b;
}

function multiply(a, b) {
  return a * b;
}

module.exports = {
  add,
  multiply
};

// app.js - Using the custom module
const math = require('./math');

console.log('Addition:', math.add(5, 3));
console.log('Multiplication:', math.multiply(5, 3));`},{title:"package.json Example",code:`{
  "name": "my-node-app",
  "version": "1.0.0",
  "description": "A simple Node.js application",
  "main": "app.js",
  "scripts": {
    "start": "node app.js",
    "dev": "nodemon app.js",
    "test": "jest"
  },
  "dependencies": {
    "express": "^4.18.0",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "nodemon": "^2.0.20"
  },
  "author": "Your Name",
  "license": "MIT"
}`}]},{id:"nodejs-async",title:"Asynchronous Programming",content:`Asynchronous programming is the heart and soul of Node.js. It's what makes Node.js so powerful for handling multiple tasks simultaneously. Think of it like a busy restaurant kitchen where chefs don't wait for one dish to finish cooking before starting another.

In traditional synchronous programming, if you make a request to a database or read a file, your program waits (blocks) until that operation completes. But in Node.js, you can start multiple operations and handle their results when they're ready through callbacks, promises, or async/await.

**Callbacks** are functions that get executed when an asynchronous operation completes. They're the foundation of Node.js async programming.

**Promises** provide a cleaner way to handle asynchronous operations. They represent a value that might be available now, or in the future, or never.

**Async/await** is syntactic sugar built on top of promises that makes asynchronous code look and behave like synchronous code, making it much easier to read and maintain.`,keyTopics:["Synchronous vs asynchronous programming","Callback functions","Promise-based programming","Async/await syntax","Error handling in async code","Event loop and concurrency"],practicalExercises:["Convert callback-based code to promises","Use async/await to simplify promise chains","Handle errors in asynchronous operations","Create custom promise-based functions","Understand the Node.js event loop with examples"],codeExamples:[{title:"Callback Example - File Reading",code:`const fs = require('fs');

// Asynchronous file reading with callback
fs.readFile('example.txt', 'utf8', (err, data) => {
  if (err) {
    console.error('Error reading file:', err);
    return;
  }
  console.log('File content:', data);
});

console.log('This runs before the file is read!');`},{title:"Promise Example",code:`const fs = require('fs').promises;

// Promise-based file reading
async function readFileContent() {
  try {
    const data = await fs.readFile('example.txt', 'utf8');
    console.log('File content:', data);
  } catch (error) {
    console.error('Error reading file:', error);
  }
}

readFileContent();
console.log('This runs before the file is read!');`},{title:"Async/Await with Multiple Operations",code:`const fs = require('fs').promises;

async function processFiles() {
  try {
    // Read multiple files concurrently
    const [file1, file2, file3] = await Promise.all([
      fs.readFile('file1.txt', 'utf8'),
      fs.readFile('file2.txt', 'utf8'),
      fs.readFile('file3.txt', 'utf8')
    ]);

    console.log('All files read successfully!');
    console.log('File 1 length:', file1.length);
    console.log('File 2 length:', file2.length);
    console.log('File 3 length:', file3.length);

    // Process the data
    const combined = file1 + file2 + file3;
    await fs.writeFile('combined.txt', combined);
    console.log('Combined file written successfully!');

  } catch (error) {
    console.error('Error processing files:', error);
  }
}

processFiles();`}]},{id:"nodejs-express",title:"Building APIs with Express.js",content:`Express.js is like the friendly neighborhood framework that makes building web applications with Node.js much easier. Think of it as a toolbox that provides all the essential tools you need to build robust web applications and APIs.

Without Express.js, you'd have to manually handle every aspect of HTTP requests and responses using Node.js's built-in \`http\` module. Express.js abstracts away the complexity and provides a clean, intuitive API for:

- **Routing**: Directing requests to the appropriate handlers
- **Middleware**: Processing requests before they reach your route handlers
- **Template Engines**: Rendering dynamic HTML pages
- **Static Files**: Serving CSS, JavaScript, and image files
- **Error Handling**: Centralized error management

Express.js follows the middleware pattern, where requests flow through a series of functions (middleware) that can modify the request, perform authentication, logging, or any other processing before the final response is sent.

RESTful APIs built with Express.js typically handle CRUD operations (Create, Read, Update, Delete) for resources. Each resource has its own URL endpoint and supports different HTTP methods like GET, POST, PUT, and DELETE.`,keyTopics:["Express.js fundamentals","Routing and route parameters","Middleware functions","Request and response objects","RESTful API design","Error handling and validation"],practicalExercises:["Create a basic Express server with multiple routes","Implement CRUD operations for a simple resource","Add middleware for logging and authentication","Handle form data and file uploads","Implement input validation and error handling","Create API documentation with route examples"],codeExamples:[{title:"Basic Express Server",code:`const express = require('express');
const app = express();
const PORT = 3000;

// Middleware to parse JSON
app.use(express.json());

// Basic route
app.get('/', (req, res) => {
  res.json({ message: 'Welcome to our API!' });
});

// Route with parameters
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ userId, name: 'John Doe', email: 'john@example.com' });
});

// POST route
app.post('/users', (req, res) => {
  const { name, email } = req.body;
  // In a real app, you'd save to a database
  res.status(201).json({
    id: Date.now(),
    name,
    email,
    createdAt: new Date()
  });
});

app.listen(PORT, () => {
  console.log(\`Server running on http://localhost:\${PORT}\`);
});`},{title:"Express Middleware Example",code:`const express = require('express');
const app = express();

// Custom logging middleware
app.use((req, res, next) => {
  console.log(\`\${new Date().toISOString()} - \${req.method} \${req.url}\`);
  next(); // Pass control to next middleware
});

// Authentication middleware
const authenticate = (req, res, next) => {
  const token = req.header('Authorization');

  if (!token) {
    return res.status(401).json({ error: 'Access denied' });
  }

  // In a real app, you'd verify the token
  if (token !== 'valid-token') {
    return res.status(401).json({ error: 'Invalid token' });
  }

  next();
};

// Protected route
app.get('/protected', authenticate, (req, res) => {
  res.json({ message: 'You have access to protected content!' });
});

// Error handling middleware (must be last)
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Something went wrong!' });
});

app.listen(3000, () => {
  console.log('Server with middleware running on port 3000');
});`},{title:"RESTful API with CRUD Operations",code:`const express = require('express');
const app = express();

app.use(express.json());

// In-memory "database" for demo purposes
let users = [
  { id: 1, name: 'John Doe', email: 'john@example.com' },
  { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
];

// GET /users - Get all users
app.get('/users', (req, res) => {
  res.json(users);
});

// GET /users/:id - Get single user
app.get('/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));
  if (!user) return res.status(404).json({ error: 'User not found' });
  res.json(user);
});

// POST /users - Create new user
app.post('/users', (req, res) => {
  const { name, email } = req.body;

  if (!name || !email) {
    return res.status(400).json({ error: 'Name and email are required' });
  }

  const newUser = {
    id: users.length + 1,
    name,
    email
  };

  users.push(newUser);
  res.status(201).json(newUser);
});

// PUT /users/:id - Update user
app.put('/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));
  if (!user) return res.status(404).json({ error: 'User not found' });

  const { name, email } = req.body;
  if (name) user.name = name;
  if (email) user.email = email;

  res.json(user);
});

// DELETE /users/:id - Delete user
app.delete('/users/:id', (req, res) => {
  const userIndex = users.findIndex(u => u.id === parseInt(req.params.id));
  if (userIndex === -1) return res.status(404).json({ error: 'User not found' });

  users.splice(userIndex, 1);
  res.json({ message: 'User deleted successfully' });
});

app.listen(3000, () => {
  console.log('RESTful API running on port 3000');
});`}]},{id:"nodejs-filesystem",title:"File System Operations",content:`Working with files is one of the most common tasks in server-side programming. Node.js provides the \`fs\` (File System) module that gives you powerful tools to read, write, update, and delete files. Think of it as your application's personal librarian who can organize, store, and retrieve information from the filing cabinet of your computer's hard drive.

The \`fs\` module offers both synchronous and asynchronous methods. The synchronous methods (ending with 'Sync') block the execution until the operation completes, while the asynchronous methods use callbacks or return promises, allowing your application to continue processing other tasks.

For modern Node.js applications, it's recommended to use the promise-based versions of the fs methods or convert them using \`util.promisify()\`. This makes your code cleaner and easier to work with async/await.

Common file operations include:
- **Reading files**: Getting content from text files, JSON files, or binary data
- **Writing files**: Creating new files or overwriting existing ones
- **Appending data**: Adding content to existing files
- **Directory operations**: Creating, reading, and deleting directories
- **File information**: Checking file size, permissions, modification dates
- **Watching files**: Monitoring files for changes`,keyTopics:["fs module basics","Synchronous vs asynchronous operations","Reading and writing files","Working with directories","File streams for large files","File permissions and metadata"],practicalExercises:["Read and display content from multiple text files","Create a simple file-based data storage system","Implement file upload functionality","Build a directory tree viewer","Create a file watcher that logs changes","Implement backup and restore functionality"],codeExamples:[{title:"Basic File Operations",code:`const fs = require('fs').promises;
const path = require('path');

async function demonstrateFileOperations() {
  const filePath = 'example.txt';
  const content = 'Hello, Node.js File System!\\nThis is a test file.';

  try {
    // Write file
    await fs.writeFile(filePath, content);
    console.log('File written successfully');

    // Read file
    const data = await fs.readFile(filePath, 'utf8');
    console.log('File content:', data);

    // Append to file
    await fs.appendFile(filePath, '\\nAppended content!');
    console.log('Content appended successfully');

    // Check file stats
    const stats = await fs.stat(filePath);
    console.log('File size:', stats.size, 'bytes');
    console.log('Last modified:', stats.mtime);

    // Read updated content
    const updatedData = await fs.readFile(filePath, 'utf8');
    console.log('Updated content:', updatedData);

  } catch (error) {
    console.error('Error:', error);
  }
}

demonstrateFileOperations();`},{title:"Directory Operations",code:`const fs = require('fs').promises;
const path = require('path');

async function manageDirectories() {
  const dirPath = 'my-project';

  try {
    // Create directory
    await fs.mkdir(dirPath);
    console.log('Directory created');

    // Create subdirectory
    await fs.mkdir(path.join(dirPath, 'src'));
    await fs.mkdir(path.join(dirPath, 'tests'));

    // Create files in directories
    await fs.writeFile(path.join(dirPath, 'src', 'app.js'), 'console.log("Hello!");');
    await fs.writeFile(path.join(dirPath, 'tests', 'app.test.js'), 'describe("App", () => {});');

    // List directory contents
    const rootContents = await fs.readdir(dirPath);
    console.log('Root directory:', rootContents);

    const srcContents = await fs.readdir(path.join(dirPath, 'src'));
    console.log('Src directory:', srcContents);

    // Check if path exists
    const exists = await fs.access(dirPath).then(() => true).catch(() => false);
    console.log('Directory exists:', exists);

  } catch (error) {
    console.error('Error:', error);
  }
}

manageDirectories();`},{title:"Working with JSON Files",code:`const fs = require('fs').promises;

class JSONDatabase {
  constructor(filename) {
    this.filename = filename;
  }

  async readData() {
    try {
      const data = await fs.readFile(this.filename, 'utf8');
      return JSON.parse(data);
    } catch (error) {
      // If file doesn't exist, return empty object
      if (error.code === 'ENOENT') {
        return {};
      }
      throw error;
    }
  }

  async writeData(data) {
    const jsonString = JSON.stringify(data, null, 2);
    await fs.writeFile(this.filename, jsonString, 'utf8');
  }

  async get(key) {
    const data = await this.readData();
    return data[key];
  }

  async set(key, value) {
    const data = await this.readData();
    data[key] = value;
    await this.writeData(data);
  }

  async delete(key) {
    const data = await this.readData();
    delete data[key];
    await this.writeData(data);
  }

  async list() {
    return await this.readData();
  }
}

// Usage example
async function demonstrateJSONDatabase() {
  const db = new JSONDatabase('data.json');

  // Store user data
  await db.set('user1', { name: 'John', age: 30, email: 'john@example.com' });
  await db.set('user2', { name: 'Jane', age: 25, email: 'jane@example.com' });

  // Retrieve data
  const user1 = await db.get('user1');
  console.log('User 1:', user1);

  // List all data
  const allData = await db.list();
  console.log('All data:', allData);

  // Update data
  await db.set('user1', { ...user1, age: 31 });
  console.log('Updated user 1:', await db.get('user1'));
}

demonstrateJSONDatabase();`}]},{id:"nodejs-database",title:"Database Integration",content:`Databases are the memory banks of your applications. They store data persistently so you can retrieve it later, even after your application restarts. Node.js works with many different types of databases, from simple file-based storage to complex distributed systems.

For learning purposes and smaller applications, SQLite is an excellent choice because it's file-based (no server required), supports SQL, and is very fast. For larger applications, you might choose PostgreSQL, MySQL, or even NoSQL databases like MongoDB.

When working with databases in Node.js, you'll typically use database drivers or ORMs (Object-Relational Mappers). Drivers provide low-level access to the database, while ORMs provide higher-level abstractions that make it easier to work with data as JavaScript objects.

Key concepts include:
- **Connections**: Establishing and managing database connections
- **Queries**: Reading, writing, updating, and deleting data
- **Transactions**: Grouping multiple operations that must succeed or fail together
- **Migrations**: Managing database schema changes over time
- **Connection pooling**: Reusing database connections for better performance

Security is crucial when working with databases. Always use parameterized queries or prepared statements to prevent SQL injection attacks, and never store sensitive information like passwords in plain text.`,keyTopics:["Database types and selection","SQL vs NoSQL databases","Connection management","CRUD operations","Data validation and sanitization","Database security best practices"],practicalExercises:["Set up SQLite database with user management","Create REST API with database integration","Implement data validation and error handling","Build database migration system","Create database backup and restore functionality","Implement database connection pooling"],codeExamples:[{title:"SQLite Database with User Management",code:`const sqlite3 = require('sqlite3').verbose();

// Create/open database
const db = new sqlite3.Database('users.db');

// Initialize database
db.serialize(() => {
  // Create users table
  db.run(\`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    age INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )\`);

  console.log('Database initialized');
});

// User operations
class UserManager {
  constructor(db) {
    this.db = db;
  }

  // Create user
  createUser(name, email, age) {
    return new Promise((resolve, reject) => {
      const sql = 'INSERT INTO users (name, email, age) VALUES (?, ?, ?)';
      this.db.run(sql, [name, email, age], function(err) {
        if (err) {
          reject(err);
        } else {
          resolve({ id: this.lastID, name, email, age });
        }
      });
    });
  }

  // Get all users
  getAllUsers() {
    return new Promise((resolve, reject) => {
      this.db.all('SELECT * FROM users ORDER BY created_at DESC', (err, rows) => {
        if (err) {
          reject(err);
        } else {
          resolve(rows);
        }
      });
    });
  }

  // Get user by ID
  getUserById(id) {
    return new Promise((resolve, reject) => {
      this.db.get('SELECT * FROM users WHERE id = ?', [id], (err, row) => {
        if (err) {
          reject(err);
        } else {
          resolve(row);
        }
      });
    });
  }

  // Update user
  updateUser(id, updates) {
    return new Promise((resolve, reject) => {
      const fields = [];
      const values = [];

      Object.keys(updates).forEach(key => {
        fields.push(\`\${key} = ?\`);
        values.push(updates[key]);
      });

      values.push(id);

      const sql = \`UPDATE users SET \${fields.join(', ')} WHERE id = ?\`;
      this.db.run(sql, values, function(err) {
        if (err) {
          reject(err);
        } else {
          resolve({ changes: this.changes });
        }
      });
    });
  }

  // Delete user
  deleteUser(id) {
    return new Promise((resolve, reject) => {
      this.db.run('DELETE FROM users WHERE id = ?', [id], function(err) {
        if (err) {
          reject(err);
        } else {
          resolve({ changes: this.changes });
        }
      });
    });
  }
}

// Usage example
async function demonstrateUserManagement() {
  const userManager = new UserManager(db);

  try {
    // Create users
    const user1 = await userManager.createUser('John Doe', 'john@example.com', 30);
    const user2 = await userManager.createUser('Jane Smith', 'jane@example.com', 25);

    console.log('Created users:', user1, user2);

    // Get all users
    const allUsers = await userManager.getAllUsers();
    console.log('All users:', allUsers);

    // Update user
    await userManager.updateUser(user1.id, { age: 31 });
    const updatedUser = await userManager.getUserById(user1.id);
    console.log('Updated user:', updatedUser);

  } catch (error) {
    console.error('Error:', error);
  } finally {
    // Close database connection
    db.close();
  }
}

demonstrateUserManagement();`},{title:"MongoDB Integration with Mongoose",code:`const mongoose = require('mongoose');

// Connect to MongoDB
mongoose.connect('mongodb://localhost:27017/myapp', {
  useNewUrlParser: true,
  useUnifiedTopology: true
});

// Define User schema
const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
    trim: true
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true,
    trim: true
  },
  age: {
    type: Number,
    min: 0,
    max: 120
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// Add instance methods
userSchema.methods.getFullInfo = function() {
  return \`\${this.name} (\${this.age} years old) - \${this.email}\`;
};

// Add static methods
userSchema.statics.findByAgeRange = function(min, max) {
  return this.find({ age: { $gte: min, $lte: max } });
};

// Create User model
const User = mongoose.model('User', userSchema);

// User operations
class UserManager {
  // Create user
  async createUser(name, email, age) {
    const user = new User({ name, email, age });
    return await user.save();
  }

  // Get all users
  async getAllUsers() {
    return await User.find().sort({ createdAt: -1 });
  }

  // Get user by ID
  async getUserById(id) {
    return await User.findById(id);
  }

  // Update user
  async updateUser(id, updates) {
    return await User.findByIdAndUpdate(id, updates, { new: true });
  }

  // Delete user
  async deleteUser(id) {
    return await User.findByIdAndDelete(id);
  }

  // Find users by age range
  async findUsersByAgeRange(min, max) {
    return await User.findByAgeRange(min, max);
  }
}

// Usage example
async function demonstrateMongoDB() {
  const userManager = new UserManager();

  try {
    // Create users
    const user1 = await userManager.createUser('John Doe', 'john@example.com', 30);
    const user2 = await userManager.createUser('Jane Smith', 'jane@example.com', 25);

    console.log('Created users:');
    console.log(user1.getFullInfo());
    console.log(user2.getFullInfo());

    // Get all users
    const allUsers = await userManager.getAllUsers();
    console.log('All users count:', allUsers.length);

    // Find users in age range
    const youngUsers = await userManager.findUsersByAgeRange(20, 35);
    console.log('Users aged 20-35:', youngUsers.length);

    // Update user
    const updatedUser = await userManager.updateUser(user1._id, { age: 31 });
    console.log('Updated user:', updatedUser.getFullInfo());

  } catch (error) {
    console.error('Error:', error);
  } finally {
    // Close database connection
    mongoose.connection.close();
  }
}

demonstrateMongoDB();`}]},{id:"nodejs-security",title:"Security Best Practices",content:`Security in Node.js applications is like locking your front door - it's essential for protecting your application and users from malicious attacks. Node.js applications can be vulnerable to various security threats, but with proper practices, you can build robust and secure applications.

**Input Validation and Sanitization**: Never trust user input. Always validate and sanitize data before processing it. Use libraries like Joi or Yup for validation, and DOMPurify for HTML sanitization.

**Authentication and Authorization**: Implement proper user authentication using secure methods. Use JWT tokens, bcrypt for password hashing, and implement role-based access control (RBAC) for authorization.

**SQL Injection Prevention**: When working with databases, always use parameterized queries or prepared statements. Never concatenate user input directly into SQL queries.

**Cross-Site Scripting (XSS) Protection**: Sanitize user input and use Content Security Policy (CSP) headers. The DOMPurify library is essential for preventing XSS attacks.

**Rate Limiting**: Implement rate limiting to prevent brute force attacks and API abuse. Libraries like express-rate-limit can help.

**Environment Variables**: Never hardcode sensitive information like API keys or database passwords. Use environment variables and libraries like dotenv.

**HTTPS**: Always use HTTPS in production to encrypt data in transit.

**Dependencies**: Regularly update dependencies and use tools like npm audit to check for vulnerabilities.`,keyTopics:["Input validation and sanitization","Authentication and authorization","SQL injection prevention","XSS protection","Rate limiting","Environment variables","HTTPS and SSL/TLS","Dependency security"],practicalExercises:["Implement input validation for user registration","Set up JWT authentication system","Create rate limiting middleware","Configure HTTPS with SSL certificates","Implement password hashing with bcrypt","Set up environment variable management","Create secure API endpoints with validation"],codeExamples:[{title:"Input Validation with Joi",code:`const express = require('express');
const Joi = require('joi');
const app = express();

app.use(express.json());

// Validation schemas
const userSchema = Joi.object({
  name: Joi.string().min(2).max(50).required(),
  email: Joi.string().email().required(),
  age: Joi.number().integer().min(13).max(120),
  password: Joi.string().min(8).pattern(new RegExp('^[a-zA-Z0-9!@#$%^&*]{8,}$')).required()
});

// Middleware for validation
const validateUser = (req, res, next) => {
  const { error } = userSchema.validate(req.body);
  if (error) {
    return res.status(400).json({
      error: 'Validation failed',
      details: error.details.map(detail => detail.message)
    });
  }
  next();
};

// Secure user registration endpoint
app.post('/register', validateUser, async (req, res) => {
  try {
    const { name, email, age, password } = req.body;

    // In a real app, you'd hash the password and save to database
    // const hashedPassword = await bcrypt.hash(password, 12);

    res.status(201).json({
      message: 'User registered successfully',
      user: { name, email, age }
    });
  } catch (error) {
    console.error('Registration error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

app.listen(3000, () => {
  console.log('Secure API running on port 3000');
});`},{title:"JWT Authentication",code:`const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');
const app = express();

app.use(express.json());

// In a real app, this would be in a database
const users = [
  {
    id: 1,
    email: 'user@example.com',
    password: '$2b$10$hashedpasswordhere' // bcrypt hash
  }
];

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

// Generate JWT token
const generateToken = (user) => {
  return jwt.sign(
    { userId: user.id, email: user.email },
    JWT_SECRET,
    { expiresIn: '24h' }
  );
};

// Verify JWT token middleware
const authenticateToken = (req, res, next) => {
  const authHeader = req.header('Authorization');
  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

  if (!token) {
    return res.status(401).json({ error: 'Access token required' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ error: 'Invalid or expired token' });
    }
    req.user = user;
    next();
  });
};

// Login endpoint
app.post('/login', async (req, res) => {
  try {
    const { email, password } = req.body;

    // Find user
    const user = users.find(u => u.email === email);
    if (!user) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.password);
    if (!isValidPassword) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Generate token
    const token = generateToken(user);

    res.json({
      message: 'Login successful',
      token,
      user: { id: user.id, email: user.email }
    });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// Protected route
app.get('/profile', authenticateToken, (req, res) => {
  res.json({
    message: 'Welcome to your profile!',
    user: req.user
  });
});

// Refresh token endpoint
app.post('/refresh', authenticateToken, (req, res) => {
  const user = users.find(u => u.id === req.user.userId);
  if (!user) {
    return res.status(401).json({ error: 'User not found' });
  }

  const newToken = generateToken(user);
  res.json({ token: newToken });
});

app.listen(3000, () => {
  console.log('JWT Authentication API running on port 3000');
});`},{title:"Rate Limiting and Security Headers",code:`const express = require('express');
const rateLimit = require('express-rate-limit');
const helmet = require('helmet');
const cors = require('cors');
const app = express();

// Security middleware
app.use(helmet()); // Sets various HTTP headers for security

// CORS configuration
app.use(cors({
  origin: process.env.NODE_ENV === 'production'
    ? ['https://yourdomain.com']
    : ['http://localhost:3000'],
  credentials: true
}));

app.use(express.json({ limit: '10mb' })); // Limit payload size

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // Limit each IP to 100 requests per windowMs
  message: {
    error: 'Too many requests from this IP, please try again later.'
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Apply rate limiting to all requests
app.use(limiter);

// Stricter rate limiting for authentication endpoints
const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // Limit each IP to 5 login attempts per windowMs
  message: {
    error: 'Too many login attempts, please try again later.'
  }
});

// API routes
app.get('/api/public', (req, res) => {
  res.json({ message: 'This is a public endpoint' });
});

app.post('/api/login', authLimiter, (req, res) => {
  // Login logic here
  res.json({ message: 'Login endpoint with rate limiting' });
});

// Protected routes
app.get('/api/protected', (req, res) => {
  // Authentication middleware would go here
  res.json({ message: 'This is a protected endpoint' });
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

// Error handling middleware
app.use((err, req, res, next) => {
  console.error(err.stack);

  // Don't leak error details in production
  const isDevelopment = process.env.NODE_ENV !== 'production';
  const errorResponse = {
    error: isDevelopment ? err.message : 'Internal server error'
  };

  res.status(500).json(errorResponse);
});

// 404 handler
app.use((req, res) => {
  res.status(404).json({ error: 'Route not found' });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`Secure API server running on port \${PORT}\`);
});`}]},{id:"nodejs-deployment",title:"Deployment and Production",content:`Deploying a Node.js application to production is like moving from your garage workshop to a professional manufacturing facility. You need to ensure your application can handle real-world traffic, recover from failures, and scale as needed.

**Process Managers**: Tools like PM2 help manage your Node.js processes, automatically restart crashed applications, and provide load balancing across multiple CPU cores.

**Environment Configuration**: Use environment variables for configuration that differs between development, staging, and production environments.

**Logging**: Implement proper logging to track application behavior, errors, and performance metrics.

**Monitoring**: Set up monitoring tools to track application health, response times, and resource usage.

**Database Optimization**: Configure connection pooling, implement caching strategies, and optimize database queries.

**Security Hardening**: Implement security headers, use HTTPS, and follow security best practices.

**Backup and Recovery**: Set up automated backups and disaster recovery procedures.

**Scaling**: Implement horizontal scaling with load balancers and consider microservices architecture for large applications.

Popular deployment platforms include:
- **Heroku**: Easy deployment with built-in scaling
- **DigitalOcean**: VPS hosting with full control
- **AWS**: Cloud infrastructure with extensive services
- **Vercel/Netlify**: Serverless deployment for frontend applications
- **Docker**: Containerization for consistent deployment across environments`,keyTopics:["Process management with PM2","Environment configuration","Logging and monitoring","Database optimization","Security hardening","Scaling strategies","Deployment platforms"],practicalExercises:["Set up PM2 process management","Configure environment variables","Implement logging with Winston","Set up monitoring with PM2","Create deployment scripts","Configure HTTPS with SSL certificates","Implement health checks and graceful shutdown"],codeExamples:[{title:"PM2 Process Management",code:`// ecosystem.config.js - PM2 configuration
module.exports = {
  apps: [{
    name: 'my-node-app',
    script: 'app.js',
    instances: 'max', // Use all available CPU cores
    exec_mode: 'cluster', // Cluster mode for load balancing
    env: {
      NODE_ENV: 'development',
      PORT: 3000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true,
    watch: false,
    max_memory_restart: '1G', // Restart if memory usage exceeds 1GB
    restart_delay: 4000,
    autorestart: true,
    min_uptime: '10s'
  }]
};

// package.json scripts
{
  "scripts": {
    "start": "pm2 start ecosystem.config.js --env production",
    "dev": "pm2 start ecosystem.config.js --env development",
    "stop": "pm2 stop ecosystem.config.js",
    "restart": "pm2 restart ecosystem.config.js",
    "delete": "pm2 delete ecosystem.config.js",
    "logs": "pm2 logs",
    "monit": "pm2 monit"
  }
}`},{title:"Environment Configuration",code:`// config.js - Environment-based configuration
require('dotenv').config();

const config = {
  development: {
    port: process.env.PORT || 3000,
    database: {
      host: 'localhost',
      port: 5432,
      database: 'myapp_dev',
      username: process.env.DB_USER || 'postgres',
      password: process.env.DB_PASSWORD || 'password'
    },
    jwt: {
      secret: process.env.JWT_SECRET || 'dev-secret-key',
      expiresIn: '24h'
    },
    logging: {
      level: 'debug',
      file: './logs/dev.log'
    }
  },
  production: {
    port: process.env.PORT || 3000,
    database: {
      host: process.env.DB_HOST,
      port: process.env.DB_PORT || 5432,
      database: process.env.DB_NAME,
      username: process.env.DB_USER,
      password: process.env.DB_PASSWORD
    },
    jwt: {
      secret: process.env.JWT_SECRET,
      expiresIn: '1h'
    },
    logging: {
      level: 'info',
      file: './logs/prod.log'
    }
  }
};

const env = process.env.NODE_ENV || 'development';
module.exports = config[env];`},{title:"Logging with Winston",code:`const winston = require('winston');
const path = require('path');

// Define log levels
const levels = {
  error: 0,
  warn: 1,
  info: 2,
  http: 3,
  debug: 4
};

// Define colors for each level
const colors = {
  error: 'red',
  warn: 'yellow',
  info: 'green',
  http: 'magenta',
  debug: 'blue'
};

winston.addColors(colors);

// Create logs directory if it doesn't exist
const fs = require('fs');
const logsDir = path.join(__dirname, 'logs');
if (!fs.existsSync(logsDir)) {
  fs.mkdirSync(logsDir);
}

// Create winston logger
const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  levels,
  format: winston.format.combine(
    winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'my-node-app' },
  transports: [
    // Write all logs with importance level of \`error\` or less to \`error.log\`
    new winston.transports.File({
      filename: path.join(logsDir, 'error.log'),
      level: 'error'
    }),
    // Write all logs with importance level of \`info\` or less to \`combined.log\`
    new winston.transports.File({
      filename: path.join(logsDir, 'combined.log')
    })
  ]
});

// If we're not in production, log to the console with colors
if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.combine(
      winston.format.colorize({ all: true }),
      winston.format.simple()
    )
  }));
}

// Create a stream for morgan HTTP request logging
logger.stream = {
  write: (message) => {
    logger.http(message.trim());
  }
};

module.exports = logger;

// Usage in your application
const express = require('express');
const morgan = require('morgan');
const app = express();

// HTTP request logging
app.use(morgan('combined', { stream: logger.stream }));

// Application logging
app.get('/', (req, res) => {
  logger.info('Home page accessed', {
    ip: req.ip,
    userAgent: req.get('User-Agent')
  });
  res.send('Hello World!');
});

// Error logging
app.use((err, req, res, next) => {
  logger.error('Unhandled error', {
    error: err.message,
    stack: err.stack,
    url: req.url,
    method: req.method
  });
  res.status(500).send('Internal Server Error');
});

app.listen(3000, () => {
  logger.info('Server started on port 3000');
});`},{title:"Health Checks and Graceful Shutdown",code:`const express = require('express');
const app = express();

// Health check endpoint
app.get('/health', (req, res) => {
  // Check database connectivity, external services, etc.
  const healthCheck = {
    uptime: process.uptime(),
    message: 'OK',
    timestamp: Date.now(),
    services: {
      database: 'connected', // You'd check actual DB connection
      cache: 'connected'     // You'd check actual cache connection
    }
  };

  res.status(200).json(healthCheck);
});

// Readiness check endpoint
app.get('/ready', (req, res) => {
  // Check if app is ready to serve traffic
  // This might include checking dependencies, migrations, etc.
  res.status(200).json({ status: 'ready' });
});

// Metrics endpoint (for monitoring)
app.get('/metrics', (req, res) => {
  const metrics = {
    memory: process.memoryUsage(),
    cpu: process.cpuUsage(),
    uptime: process.uptime(),
    version: process.version
  };
  res.json(metrics);
});

// Graceful shutdown handling
const gracefulShutdown = (signal) => {
  console.log(\`Received \${signal}. Starting graceful shutdown...\`);

  // Stop accepting new connections
  server.close((err) => {
    if (err) {
      console.error('Error during server shutdown:', err);
      process.exit(1);
    }

    console.log('Server closed successfully');

    // Close database connections
    // Close other resources (Redis, message queues, etc.)

    console.log('All connections closed. Exiting...');
    process.exit(0);
  });

  // Force shutdown after 30 seconds
  setTimeout(() => {
    console.error('Forced shutdown after timeout');
    process.exit(1);
  }, 30000);
};

// Listen for termination signals
process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));
process.on('SIGINT', () => gracefulShutdown('SIGINT'));

// Handle uncaught exceptions
process.on('uncaughtException', (err) => {
  console.error('Uncaught Exception:', err);
  gracefulShutdown('uncaughtException');
});

// Handle unhandled promise rejections
process.on('unhandledRejection', (reason, promise) => {
  console.error('Unhandled Rejection at:', promise, 'reason:', reason);
  gracefulShutdown('unhandledRejection');
});

const PORT = process.env.PORT || 3000;
const server = app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}\`);
  console.log('Health check available at: http://localhost:' + PORT + '/health');
  console.log('Readiness check available at: http://localhost:' + PORT + '/ready');
  console.log('Metrics available at: http://localhost:' + PORT + '/metrics');
});`}]}],projects:[{title:"RESTful API with Authentication",description:"Build a complete RESTful API for a task management system with user authentication, CRUD operations, and proper error handling."},{title:"Real-time Chat Application",description:"Create a real-time chat application using WebSockets, with user authentication, chat rooms, and message persistence."},{title:"File Upload and Management System",description:"Develop a file upload service with cloud storage integration, file processing, and secure access controls."},{title:"E-commerce Backend",description:"Build the backend for an e-commerce platform with product management, shopping cart, and payment integration."},{title:"Blog Platform with CMS",description:"Create a full-featured blog platform with content management, user roles, and SEO optimization."}],assessments:[{type:"quiz",questions:[{question:"What is the primary difference between synchronous and asynchronous operations in Node.js?",options:["Synchronous operations are faster than asynchronous operations","Synchronous operations block execution while asynchronous operations don't","Asynchronous operations only work with databases","Synchronous operations use callbacks while asynchronous operations don't"],correctAnswer:"Synchronous operations block execution while asynchronous operations don't"},{question:"Which of the following is NOT a core module in Node.js?",options:["fs","http","express","path"],correctAnswer:"express"},{question:"What does npm stand for?",options:["Node Package Manager","Node Program Module","New Package Manager","Node Project Manager"],correctAnswer:"Node Package Manager"}]},{type:"evaluation",questions:[{question:"Explain the event loop in Node.js and why it's important for performance.",options:[],correctAnswer:""},{question:"Compare and contrast callbacks, promises, and async/await for handling asynchronous operations.",options:[],correctAnswer:""}]}],aiPrompts:["How does the Node.js event loop work?","Explain the difference between require() and import in Node.js","How do I handle errors in asynchronous Node.js code?","What's the best way to structure a large Node.js application?","How do I optimize Node.js application performance?","Explain Node.js streams and when to use them","How do I implement authentication in a Node.js API?","What's the difference between process.nextTick() and setImmediate()?","How do I debug memory leaks in Node.js applications?","Explain the Node.js module system and CommonJS vs ES modules"],resources:[{name:"Node.js Official Documentation",url:"https://nodejs.org/en/docs/"},{name:"Express.js Documentation",url:"https://expressjs.com/"},{name:"npm Documentation",url:"https://docs.npmjs.com/"},{name:"Node.js Best Practices",url:"https://github.com/goldbergyoni/nodebestpractices"},{name:"MDN Web Docs - Node.js",url:"https://developer.mozilla.org/en-US/docs/Learn/Server-side/Node_server_without_framework"},{name:"Node.js API Reference",url:"https://nodejs.org/api/"},{name:"Express.js Guide",url:"https://expressjs.com/en/guide/routing.html"},{name:"Node.js Security Best Practices",url:"https://nodejs.org/en/docs/guides/security/"}],toolsRequired:["Node.js (latest LTS version)","npm or yarn package manager","Code editor (VS Code recommended)","Terminal/command line interface","Git for version control","Database (SQLite for learning, PostgreSQL/MySQL for production)","Postman or similar API testing tool"],bestPractices:["Use async/await instead of callbacks for cleaner code","Always handle errors properly in asynchronous operations","Use environment variables for configuration","Implement proper logging for debugging and monitoring","Use middleware for cross-cutting concerns in Express.js","Validate and sanitize all user inputs","Use connection pooling for database connections","Implement rate limiting to prevent abuse","Use HTTPS in production","Keep dependencies updated and audit for vulnerabilities","Use semantic versioning for your packages","Implement graceful shutdown for your applications","Use PM2 or similar process manager in production","Monitor application performance and memory usage","Write comprehensive tests for your code"],commonPitfalls:["Blocking the event loop with synchronous operations","Not handling errors in asynchronous code","Storing sensitive information in code instead of environment variables","Not using parameterized queries, leading to SQL injection","Forgetting to close database connections","Not implementing proper input validation","Using outdated or vulnerable dependencies","Not implementing rate limiting on API endpoints","Exposing stack traces in production error responses","Not using HTTPS in production","Trying to use Node.js for CPU-intensive tasks","Not implementing proper logging","Using callbacks instead of promises/async-await","Not handling uncaught exceptions properly","Trying to serve static files inefficiently"],careerRelevance:"Node.js is one of the most in-demand backend technologies in the job market. Full-stack JavaScript developers who master Node.js can command high salaries and work on a wide variety of projects, from startups to enterprise applications. Node.js skills are essential for modern web development roles including Backend Developer, Full-Stack Developer, DevOps Engineer, and API Developer. The Node.js ecosystem continues to grow rapidly, with strong community support and extensive job opportunities across industries."},CM={id:"expressjs",tier:2,name:"Express.js",description:"Express.js is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. It simplifies the process of building web servers and APIs by providing an elegant layer over Node.js's HTTP module.",difficulty:"intermediate",estimatedHours:25,prerequisites:["nodejs","javascript"],learningObjectives:["Understand Express.js fundamentals and middleware architecture","Master routing, route parameters, and request handling","Implement custom middleware for authentication and validation","Work with template engines for server-side rendering","Handle file uploads and static file serving","Implement proper error handling and logging","Deploy Express.js applications to production","Create RESTful APIs with proper HTTP methods","Implement security best practices and CORS","Optimize Express.js applications for performance"],sections:[{id:"expressjs-introduction",title:"Introduction to Express.js",content:`Express.js is like the friendly neighborhood framework that makes building web applications with Node.js much easier. Think of it as a toolbox that provides all the essential tools you need to build robust web applications and APIs.

Without Express.js, you'd have to manually handle every aspect of HTTP requests and responses using Node.js's built-in \`http\` module. Express.js abstracts away the complexity and provides a clean, intuitive API for routing, middleware, template engines, and more.

The core philosophy of Express.js is **middleware**. Every request flows through a series of middleware functions that can modify the request, perform authentication, logging, or any other processing before the final response is sent.

Express.js follows the 'convention over configuration' principle, making it easy to get started while remaining flexible enough for complex applications.`,keyTopics:["What is Express.js?","Installation and setup","Basic server creation","Middleware concept","Request-response cycle"],practicalExercises:["Install Express.js using npm","Create a basic Express server","Handle different HTTP methods (GET, POST)","Use middleware to log requests","Serve static files with Express"],codeExamples:[{title:"Basic Express Server",code:`const express = require('express');
const app = express();
const PORT = 3000;

// Basic route
app.get('/', (req, res) => {
  res.send('Hello World!');
});

// Start server
app.listen(PORT, () => {
  console.log(\`Server running on http://localhost:\${PORT}\`);
});`},{title:"Express Server with JSON Response",code:`const express = require('express');
const app = express();

// Middleware to parse JSON
app.use(express.json());

// API endpoint returning JSON
app.get('/api/users', (req, res) => {
  const users = [
    { id: 1, name: 'John Doe', email: 'john@example.com' },
    { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
  ];
  res.json(users);
});

// POST endpoint to create user
app.post('/api/users', (req, res) => {
  const { name, email } = req.body;
  // In a real app, you'd save to database
  const newUser = {
    id: Date.now(),
    name,
    email,
    createdAt: new Date()
  };
  res.status(201).json(newUser);
});

app.listen(3000, () => {
  console.log('API server running on port 3000');
});`}]},{id:"expressjs-routing",title:"Routing and Route Parameters",content:"Routing in Express.js is like a traffic controller directing requests to the appropriate handlers. Routes define how your application responds to different HTTP requests at different endpoints.\n\nExpress.js provides methods that correspond to all HTTP methods: `app.get()`, `app.post()`, `app.put()`, `app.delete()`, etc. Each method takes a path pattern and a callback function that gets executed when the route is matched.\n\nRoute parameters allow you to capture values from the URL. For example, `/users/:id` would match `/users/123` and make `123` available as `req.params.id`.\n\nQuery parameters are another way to pass data in URLs. They're automatically parsed by Express.js and made available in `req.query`.\n\nRoute handlers can be simple functions or chains of middleware functions. You can also organize routes using `express.Router()` for better code organization.",keyTopics:["Basic routing","Route parameters","Query parameters","Route handlers","Router middleware"],practicalExercises:["Create routes for different HTTP methods","Implement route parameters for dynamic URLs","Handle query parameters in routes","Organize routes using express.Router()","Create nested routes for complex APIs"],codeExamples:[{title:"Route Parameters and Query Strings",code:`const express = require('express');
const app = express();

app.use(express.json());

// Route with parameters
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ userId, message: \`Getting user \${userId}\` });
});

// Route with multiple parameters
app.get('/users/:userId/posts/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.json({
    userId,
    postId,
    message: \`Getting post \${postId} by user \${userId}\`
  });
});

// Query parameters
app.get('/search', (req, res) => {
  const { q, limit = 10, sort = 'date' } = req.query;
  res.json({
    query: q,
    limit: parseInt(limit),
    sort,
    message: \`Searching for "\${q}" with limit \${limit}, sorted by \${sort}\`
  });
});

// POST route with body data
app.post('/users', (req, res) => {
  const { name, email, age } = req.body;
  res.json({
    id: Date.now(),
    name,
    email,
    age,
    createdAt: new Date()
  });
});

app.listen(3000, () => {
  console.log('Routing server running on port 3000');
});`},{title:"Organizing Routes with Router",code:`const express = require('express');
const app = express();

// Create router for user routes
const userRouter = express.Router();

// User routes
userRouter.get('/', (req, res) => {
  res.json({ message: 'Get all users' });
});

userRouter.get('/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ userId, message: \`Get user \${userId}\` });
});

userRouter.post('/', (req, res) => {
  const { name, email } = req.body;
  res.json({
    id: Date.now(),
    name,
    email,
    message: 'User created'
  });
});

userRouter.put('/:id', (req, res) => {
  const userId = req.params.id;
  const { name, email } = req.body;
  res.json({
    userId,
    name,
    email,
    message: \`User \${userId} updated\`
  });
});

userRouter.delete('/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ userId, message: \`User \${userId} deleted\` });
});

// Mount router at /api/users
app.use('/api/users', userRouter);

// Product routes
const productRouter = express.Router();

productRouter.get('/', (req, res) => {
  res.json({ message: 'Get all products' });
});

productRouter.get('/:id', (req, res) => {
  const productId = req.params.id;
  res.json({ productId, message: \`Get product \${productId}\` });
});

// Mount router at /api/products
app.use('/api/products', productRouter);

app.listen(3000, () => {
  console.log('Router example running on port 3000');
});`}]},{id:"expressjs-middleware",title:"Middleware Deep Dive",content:`Middleware functions are the heart of Express.js applications. They're like checkpoints that every request passes through on its way to the final route handler. Each middleware function can:

- Execute code
- Modify the request and response objects
- End the request-response cycle
- Call the next middleware function

Express.js comes with built-in middleware, but you can also create custom middleware for specific needs. Common middleware patterns include:

- **Application-level middleware**: Bound to the app object with \`app.use()\`
- **Router-level middleware**: Bound to specific routers
- **Error-handling middleware**: Special middleware for handling errors
- **Built-in middleware**: Like \`express.json()\`, \`express.static()\`
- **Third-party middleware**: Like CORS, helmet, morgan for logging

The key to understanding middleware is the \`next()\` function. Calling \`next()\` passes control to the next middleware in the stack. Not calling \`next()\` ends the request-response cycle.`,keyTopics:["Middleware fundamentals","Custom middleware creation","Built-in middleware","Error handling middleware","Third-party middleware"],practicalExercises:["Create custom logging middleware","Implement authentication middleware","Build request validation middleware","Create error handling middleware","Use third-party middleware (CORS, helmet)","Implement rate limiting middleware"],codeExamples:[{title:"Custom Middleware Examples",code:`const express = require('express');
const app = express();

// Custom logging middleware
const logger = (req, res, next) => {
  const timestamp = new Date().toISOString();
  console.log(\`[\${timestamp}] \${req.method} \${req.url}\`);
  next();
};

// Request timing middleware
const requestTimer = (req, res, next) => {
  req.startTime = Date.now();
  res.on('finish', () => {
    const duration = Date.now() - req.startTime;
    console.log(\`Request took \${duration}ms\`);
  });
  next();
};

// Authentication middleware
const authenticate = (req, res, next) => {
  const authHeader = req.header('Authorization');

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res.status(401).json({ error: 'Authentication required' });
  }

  const token = authHeader.substring(7); // Remove 'Bearer '

  // In a real app, you'd verify the token
  if (token !== 'valid-token') {
    return res.status(401).json({ error: 'Invalid token' });
  }

  req.user = { id: 1, name: 'John Doe' }; // Mock user
  next();
};

// Apply middleware globally
app.use(logger);
app.use(requestTimer);
app.use(express.json());

// Public route
app.get('/public', (req, res) => {
  res.json({ message: 'This is a public endpoint' });
});

// Protected route
app.get('/protected', authenticate, (req, res) => {
  res.json({
    message: 'This is a protected endpoint',
    user: req.user
  });
});

// Middleware with parameters
const requireRole = (role) => {
  return (req, res, next) => {
    if (!req.user) {
      return res.status(401).json({ error: 'Authentication required' });
    }

    if (req.user.role !== role) {
      return res.status(403).json({ error: 'Insufficient permissions' });
    }

    next();
  };
};

app.get('/admin', authenticate, requireRole('admin'), (req, res) => {
  res.json({ message: 'Admin only endpoint' });
});

app.listen(3000, () => {
  console.log('Middleware server running on port 3000');
});`},{title:"Error Handling Middleware",code:`const express = require('express');
const app = express();

app.use(express.json());

// Synchronous error handling
app.get('/sync-error', (req, res) => {
  throw new Error('This is a synchronous error');
});

// Asynchronous error handling
app.get('/async-error', async (req, res, next) => {
  try {
    // Simulate async operation that might fail
    const result = await riskyAsyncOperation();
    res.json({ result });
  } catch (error) {
    // Pass error to error handling middleware
    next(error);
  }
});

// Route that manually calls next with error
app.get('/manual-error', (req, res, next) => {
  const error = new Error('Something went wrong');
  error.statusCode = 400;
  next(error);
});

// 404 handler - must be after all routes
app.use((req, res, next) => {
  const error = new Error(\`Route \${req.originalUrl} not found\`);
  error.statusCode = 404;
  next(error);
});

// Global error handling middleware - must be last
app.use((error, req, res, next) => {
  // Log error
  console.error('Error:', error.message);
  console.error('Stack:', error.stack);

  // Don't leak error details in production
  const isDevelopment = process.env.NODE_ENV !== 'production';

  const errorResponse = {
    error: isDevelopment ? error.message : 'Internal server error',
    statusCode: error.statusCode || 500,
    ...(isDevelopment && { stack: error.stack })
  };

  res.status(error.statusCode || 500).json(errorResponse);
});

// Helper function to simulate risky operation
function riskyAsyncOperation() {
  return new Promise((resolve, reject) => {
    // Simulate random failure
    if (Math.random() > 0.7) {
      reject(new Error('Random failure occurred'));
    } else {
      setTimeout(() => resolve('Success!'), 100);
    }
  });
}

app.listen(3000, () => {
  console.log('Error handling server running on port 3000');
});`}]},{id:"expressjs-templates",title:"Template Engines",content:`Template engines allow you to generate HTML dynamically on the server side. Instead of sending plain JSON responses, you can render complete HTML pages with dynamic content.

Popular template engines for Express.js include:

- **EJS (Embedded JavaScript)**: Uses plain JavaScript in HTML
- **Pug (formerly Jade)**: Uses indentation-based syntax
- **Handlebars**: Uses {{}} syntax for placeholders

Template engines work by:
1. Taking a template file with placeholders
2. Replacing placeholders with actual data
3. Generating final HTML output

Express.js integrates seamlessly with template engines. You configure the engine with \`app.set('view engine', 'ejs')\` and use \`res.render()\` to render templates.

Template engines are particularly useful for:
- Server-side rendering (SSR)
- Email templates
- Admin dashboards
- Traditional web applications

For modern SPAs, you might not need template engines, but they're still valuable for certain use cases.`,keyTopics:["Template engine concepts","EJS syntax and features","Pug template engine","Handlebars templating","Server-side rendering"],practicalExercises:["Set up EJS as the template engine","Create dynamic HTML pages with EJS","Use conditionals and loops in templates","Create reusable template layouts","Render templates with dynamic data","Create partial templates for reusability"],codeExamples:[{title:"EJS Template Engine Setup",code:`const express = require('express');
const app = express();

// Set EJS as template engine
app.set('view engine', 'ejs');
// Set views directory (optional, defaults to ./views)
app.set('views', './views');

// Sample data
const users = [
  { id: 1, name: 'John Doe', email: 'john@example.com', role: 'admin' },
  { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'user' },
  { id: 3, name: 'Bob Johnson', email: 'bob@example.com', role: 'user' }
];

// Route to render users page
app.get('/users', (req, res) => {
  res.render('users', {
    title: 'User Management',
    users: users,
    currentYear: new Date().getFullYear()
  });
});

// Route to render single user
app.get('/users/:id', (req, res) => {
  const userId = parseInt(req.params.id);
  const user = users.find(u => u.id === userId);

  if (!user) {
    return res.status(404).render('error', {
      title: 'User Not Found',
      error: 'User not found',
      statusCode: 404
    });
  }

  res.render('user', {
    title: \`User: \${user.name}\`,
    user: user
  });
});

// Home page
app.get('/', (req, res) => {
  res.render('home', {
    title: 'Welcome',
    message: 'Hello from Express.js with EJS!',
    features: ['Template rendering', 'Dynamic content', 'Reusable layouts']
  });
});

app.listen(3000, () => {
  console.log('Template engine server running on port 3000');
});`},{title:"EJS Template Files",code:`<!-- views/layout.ejs - Main layout template -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">Express App</a>
      <div class="navbar-nav">
        <a class="nav-link" href="/">Home</a>
        <a class="nav-link" href="/users">Users</a>
      </div>
    </div>
  </nav>

  <main class="container mt-4">
    <%- body %>
  </main>

  <footer class="bg-light text-center py-3 mt-5">
    <p>&copy; <%= new Date().getFullYear() %> Express.js Application</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"><\/script>
</body>
</html>

<!-- views/home.ejs - Home page template -->
<% layout('layout') -%>
<div class="row">
  <div class="col-lg-8 mx-auto text-center">
    <h1 class="display-4 mb-4"><%= message %></h1>

    <div class="row">
      <% features.forEach(feature => { %>
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title"><%= feature %></h5>
              <p class="card-text">Learn how to use <%= feature.toLowerCase() %> in your Express applications.</p>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  </div>
</div>

<!-- views/users.ejs - Users list template -->
<% layout('layout') -%>
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2><%= title %></h2>
      <a href="/users/new" class="btn btn-primary">Add New User</a>
    </div>

    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user => { %>
                <tr>
                  <td><%= user.id %></td>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td>
                    <span class="badge bg-<%= user.role === 'admin' ? 'danger' : 'secondary' %>">
                      <%= user.role %>
                    </span>
                  </td>
                  <td>
                    <a href="/users/<%= user.id %>" class="btn btn-sm btn-outline-primary">View</a>
                    <a href="/users/<%= user.id %>/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>`}]},{id:"expressjs-static-files",title:"Static Files and File Uploads",content:`Serving static files like CSS, JavaScript, images, and documents is a common requirement for web applications. Express.js makes this easy with the built-in \`express.static()\` middleware.

Static file serving works by:
1. Configuring a directory to serve static files
2. Express.js automatically serves files from that directory
3. Files are served with appropriate MIME types
4. You can configure multiple static directories

For file uploads, you'll need additional middleware like \`multer\`. File uploads are more complex because they involve:
- Parsing multipart/form-data
- Handling file storage
- Validating file types and sizes
- Managing temporary files

Security considerations for file uploads:
- Validate file types and sizes
- Use secure file names
- Store files outside web root
- Implement proper access controls
- Scan uploaded files for malware

Express.js also supports serving files with custom logic, like authentication checks or dynamic file serving.`,keyTopics:["Static file serving","File upload handling","Multer middleware","File validation","Security considerations"],practicalExercises:["Serve static CSS and JavaScript files","Configure multiple static directories","Implement single file upload","Handle multiple file uploads","Validate uploaded files","Serve protected static files"],codeExamples:[{title:"Static File Serving",code:`const express = require('express');
const path = require('path');
const app = express();

// Serve static files from 'public' directory
app.use(express.static('public'));

// Serve static files from 'assets' directory at '/assets' path
app.use('/assets', express.static('assets'));

// Serve static files from 'uploads' directory with cache control
app.use('/uploads', express.static('uploads', {
  maxAge: '1d', // Cache for 1 day
  etag: true,
  lastModified: true
}));

// Route to serve files with custom logic
app.get('/protected-file/:filename', (req, res) => {
  const filename = req.params.filename;

  // In a real app, you'd check user authentication/authorization
  const isAuthenticated = true; // Mock authentication

  if (!isAuthenticated) {
    return res.status(403).json({ error: 'Access denied' });
  }

  // Serve file with custom headers
  res.set({
    'Content-Type': 'application/octet-stream',
    'Content-Disposition': \`attachment; filename="\${filename}"\`
  });

  res.sendFile(path.join(__dirname, 'protected', filename), (err) => {
    if (err) {
      console.error('File serving error:', err);
      res.status(404).json({ error: 'File not found' });
    }
  });
});

// Route to list available files
app.get('/files', (req, res) => {
  const fs = require('fs').promises;

  fs.readdir('public')
    .then(files => {
      res.json({ files });
    })
    .catch(err => {
      console.error('Directory read error:', err);
      res.status(500).json({ error: 'Unable to list files' });
    });
});

app.listen(3000, () => {
  console.log('Static file server running on port 3000');
  console.log('Static files available at:');
  console.log('- http://localhost:3000/style.css');
  console.log('- http://localhost:3000/script.js');
  console.log('- http://localhost:3000/assets/logo.png');
});`},{title:"File Upload with Multer",code:`const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs').promises;
const app = express();

// Configure multer storage
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    const uploadDir = 'uploads/';

    // Create uploads directory if it doesn't exist
    fs.mkdir(uploadDir, { recursive: true })
      .then(() => cb(null, uploadDir))
      .catch(err => cb(err));
  },
  filename: (req, file, cb) => {
    // Generate unique filename
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
  }
});

// File filter function
const fileFilter = (req, file, cb) => {
  // Allow only certain file types
  const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];

  if (allowedTypes.includes(file.mimetype)) {
    cb(null, true);
  } else {
    cb(new Error('Invalid file type. Only JPEG, PNG, GIF, and PDF files are allowed.'), false);
  }
};

// Configure multer upload
const upload = multer({
  storage: storage,
  fileFilter: fileFilter,
  limits: {
    fileSize: 5 * 1024 * 1024, // 5MB limit
    files: 10 // Maximum 10 files
  }
});

// Single file upload
app.post('/upload/single', upload.single('file'), (req, res) => {
  if (!req.file) {
    return res.status(400).json({ error: 'No file uploaded' });
  }

  res.json({
    message: 'File uploaded successfully',
    file: {
      filename: req.file.filename,
      originalName: req.file.originalname,
      size: req.file.size,
      mimetype: req.file.mimetype,
      path: req.file.path
    }
  });
});

// Multiple files upload
app.post('/upload/multiple', upload.array('files', 5), (req, res) => {
  if (!req.files || req.files.length === 0) {
    return res.status(400).json({ error: 'No files uploaded' });
  }

  const files = req.files.map(file => ({
    filename: file.filename,
    originalName: file.originalname,
    size: file.size,
    mimetype: file.mimetype,
    path: file.path
  }));

  res.json({
    message: \`\${req.files.length} files uploaded successfully\`,
    files: files
  });
});

// Mixed file upload (fields)
const uploadFields = upload.fields([
  { name: 'avatar', maxCount: 1 },
  { name: 'documents', maxCount: 5 }
]);

app.post('/upload/mixed', uploadFields, (req, res) => {
  const response = {
    message: 'Mixed upload successful',
    files: {}
  };

  if (req.files.avatar) {
    response.files.avatar = req.files.avatar[0];
  }

  if (req.files.documents) {
    response.files.documents = req.files.documents;
  }

  res.json(response);
});

// Error handling for multer
app.use((error, req, res, next) => {
  if (error instanceof multer.MulterError) {
    if (error.code === 'LIMIT_FILE_SIZE') {
      return res.status(400).json({ error: 'File too large. Maximum size is 5MB.' });
    }
    if (error.code === 'LIMIT_FILE_COUNT') {
      return res.status(400).json({ error: 'Too many files. Maximum 10 files allowed.' });
    }
  }

  if (error.message.includes('Invalid file type')) {
    return res.status(400).json({ error: error.message });
  }

  next(error);
});

// List uploaded files
app.get('/uploads', async (req, res) => {
  try {
    const files = await fs.readdir('uploads/');
    res.json({ files });
  } catch (error) {
    res.status(500).json({ error: 'Unable to list uploads' });
  }
});

app.listen(3000, () => {
  console.log('File upload server running on port 3000');
  console.log('Upload endpoints:');
  console.log('- POST /upload/single');
  console.log('- POST /upload/multiple');
  console.log('- POST /upload/mixed');
});`}]},{id:"expressjs-security",title:"Security and CORS",content:`Security is crucial for any web application. Express.js applications can be vulnerable to various attacks, but there are proven strategies to protect against them.

**Common Security Threats:**
- Cross-Site Scripting (XSS)
- Cross-Site Request Forgery (CSRF)
- SQL Injection (when using databases)
- Security misconfigurations
- Sensitive data exposure

**Essential Security Middleware:**
- **Helmet**: Sets various HTTP headers for security
- **CORS**: Controls cross-origin resource sharing
- **Rate Limiting**: Prevents brute force attacks
- **Input Validation**: Validates and sanitizes user input
- **Authentication**: Protects sensitive routes

**CORS (Cross-Origin Resource Sharing)** is particularly important for APIs. It controls which domains can access your API. Without proper CORS configuration, browsers will block cross-origin requests.

**Security Best Practices:**
- Use HTTPS in production
- Validate all user input
- Use parameterized queries for databases
- Implement proper authentication and authorization
- Keep dependencies updated
- Use security headers
- Log security events
- Implement rate limiting`,keyTopics:["Security fundamentals","Helmet middleware","CORS configuration","Rate limiting","Input validation","Authentication strategies"],practicalExercises:["Configure Helmet for security headers","Set up CORS for cross-origin requests","Implement rate limiting","Create input validation middleware","Set up JWT authentication","Configure HTTPS for production"],codeExamples:[{title:"Security Middleware Setup",code:`const express = require('express');
const helmet = require('helmet');
const cors = require('cors');
const rateLimit = require('express-rate-limit');
const app = express();

// Security middleware
app.use(helmet()); // Sets security headers

// CORS configuration
const corsOptions = {
  origin: function (origin, callback) {
    // Allow requests from specific origins
    const allowedOrigins = [
      'http://localhost:3000',
      'http://localhost:3001',
      'https://yourdomain.com'
    ];

    // Allow requests with no origin (mobile apps, etc.)
    if (!origin) return callback(null, true);

    if (allowedOrigins.indexOf(origin) !== -1) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true, // Allow cookies and authentication headers
  optionsSuccessStatus: 200 // Some legacy browsers choke on 204
};

app.use(cors(corsOptions));

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // Limit each IP to 100 requests per windowMs
  message: {
    error: 'Too many requests from this IP, please try again later.'
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Apply rate limiting to all requests
app.use(limiter);

// Stricter rate limiting for authentication endpoints
const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // Limit each IP to 5 login attempts per windowMs
  message: {
    error: 'Too many login attempts, please try again later.' }
});

app.use(express.json({ limit: '10mb' })); // Limit payload size

// Input validation middleware
const validateUserInput = (req, res, next) => {
  const { name, email, password } = req.body;

  // Basic validation
  if (!name || typeof name !== 'string' || name.length < 2) {
    return res.status(400).json({ error: 'Name must be at least 2 characters long' });
  }

  if (!email || !email.includes('@')) {
    return res.status(400).json({ error: 'Valid email is required' });
  }

  if (!password || password.length < 6) {
    return res.status(400).json({ error: 'Password must be at least 6 characters long' });
  }

  next();
};

// Routes
app.get('/public', (req, res) => {
  res.json({ message: 'This is a public endpoint' });
});

app.post('/register', authLimiter, validateUserInput, (req, res) => {
  const { name, email, password } = req.body;

  // In a real app, you'd hash the password and save to database
  res.json({
    message: 'User registered successfully',
    user: { name, email }
  });
});

app.post('/login', authLimiter, (req, res) => {
  const { email, password } = req.body;

  // In a real app, you'd verify credentials
  res.json({
    message: 'Login successful',
    token: 'mock-jwt-token'
  });
});

// Protected route example
app.get('/protected', (req, res) => {
  // In a real app, you'd verify JWT token
  const token = req.header('Authorization');

  if (!token) {
    return res.status(401).json({ error: 'Access token required' });
  }

  res.json({ message: 'Access to protected resource granted' });
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
});

app.listen(3000, () => {
  console.log('Secure Express server running on port 3000');
});`},{title:"JWT Authentication Implementation",code:`const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');
const app = express();

// JWT configuration
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';
const JWT_EXPIRES_IN = '24h';

// Middleware to verify JWT
const authenticateToken = (req, res, next) => {
  const authHeader = req.header('Authorization');
  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

  if (!token) {
    return res.status(401).json({ error: 'Access token required' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ error: 'Invalid or expired token' });
    }
    req.user = user;
    next();
  });
};

// In-memory user store (use database in production)
const users = [
  {
    id: 1,
    email: 'admin@example.com',
    password: '$2b$10$hashedpassword', // bcrypt hash for 'password123'
    role: 'admin'
  }
];

app.use(express.json());

// User registration
app.post('/register', async (req, res) => {
  try {
    const { email, password, name } = req.body;

    // Check if user already exists
    const existingUser = users.find(u => u.email === email);
    if (existingUser) {
      return res.status(400).json({ error: 'User already exists' });
    }

    // Hash password
    const saltRounds = 10;
    const hashedPassword = await bcrypt.hash(password, saltRounds);

    // Create new user
    const newUser = {
      id: users.length + 1,
      email,
      password: hashedPassword,
      name,
      role: 'user'
    };

    users.push(newUser);

    // Generate JWT token
    const token = jwt.sign(
      { userId: newUser.id, email: newUser.email, role: newUser.role },
      JWT_SECRET,
      { expiresIn: JWT_EXPIRES_IN }
    );

    res.status(201).json({
      message: 'User registered successfully',
      token,
      user: {
        id: newUser.id,
        email: newUser.email,
        name: newUser.name,
        role: newUser.role
      }
    });
  } catch (error) {
    console.error('Registration error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// User login
app.post('/login', async (req, res) => {
  try {
    const { email, password } = req.body;

    // Find user
    const user = users.find(u => u.email === email);
    if (!user) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Verify password
    const isValidPassword = await bcrypt.hash(password, user.password);
    if (!isValidPassword) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Generate JWT token
    const token = jwt.sign(
      { userId: user.id, email: user.email, role: user.role },
      JWT_SECRET,
      { expiresIn: JWT_EXPIRES_IN }
    );

    res.json({
      message: 'Login successful',
      token,
      user: {
        id: user.id,
        email: user.email,
        name: user.name,
        role: user.role
      }
    });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// Protected route - requires authentication
app.get('/profile', authenticateToken, (req, res) => {
  res.json({
    message: 'Profile data',
    user: req.user
  });
});

// Admin-only route
app.get('/admin', authenticateToken, (req, res) => {
  if (req.user.role !== 'admin') {
    return res.status(403).json({ error: 'Admin access required' });
  }

  res.json({
    message: 'Admin dashboard',
    users: users.map(u => ({ id: u.id, email: u.email, role: u.role }))
  });
});

// Token refresh endpoint
app.post('/refresh', authenticateToken, (req, res) => {
  // Generate new token with same user data
  const newToken = jwt.sign(
    {
      userId: req.user.userId,
      email: req.user.email,
      role: req.user.role
    },
    JWT_SECRET,
    { expiresIn: JWT_EXPIRES_IN }
  );

  res.json({ token: newToken });
});

app.listen(3000, () => {
  console.log('JWT Authentication server running on port 3000');
});`}]},{id:"expressjs-production",title:"Production Deployment",content:`Deploying an Express.js application to production requires careful consideration of performance, reliability, and security. Production environments have different requirements than development.

**Process Management:** Use PM2 or similar tools to manage your Node.js processes. PM2 provides:
- Automatic restarts on crashes
- Load balancing across CPU cores
- Log management
- Memory monitoring
- Zero-downtime reloads

**Environment Configuration:** Never hardcode sensitive information. Use environment variables for:
- Database credentials
- API keys
- JWT secrets
- Port numbers
- Environment-specific settings

**Logging:** Implement proper logging for production:
- Use Winston or similar logging library
- Log different levels (error, warn, info, debug)
- Rotate log files to prevent disk space issues
- Centralize logs for monitoring

**Performance Optimization:**
- Use compression middleware
- Implement caching strategies
- Optimize database queries
- Use CDN for static assets
- Implement connection pooling

**Health Checks:** Implement health check endpoints for load balancers and monitoring systems.`,keyTopics:["Process management with PM2","Environment configuration","Logging strategies","Performance optimization","Health checks","Monitoring and alerting"],practicalExercises:["Set up PM2 for process management","Configure environment variables","Implement Winston logging","Set up health check endpoints","Configure compression and caching","Set up monitoring and alerting"],codeExamples:[{title:"PM2 Configuration",code:`// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'express-app',
    script: 'app.js',
    instances: 'max', // Use all available CPU cores
    exec_mode: 'cluster', // Cluster mode for load balancing
    env: {
      NODE_ENV: 'development',
      PORT: 3000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true,
    watch: false,
    max_memory_restart: '1G', // Restart if memory usage exceeds 1GB
    restart_delay: 4000,
    autorestart: true,
    min_uptime: '10s',
    env_production: {
      NODE_ENV: 'production',
      PORT: process.env.PORT || 3000,
      JWT_SECRET: process.env.JWT_SECRET,
      DATABASE_URL: process.env.DATABASE_URL
    }
  }]
};

// package.json scripts
{
  "scripts": {
    "start": "pm2 start ecosystem.config.js --env production",
    "dev": "pm2 start ecosystem.config.js --env development",
    "stop": "pm2 stop ecosystem.config.js",
    "restart": "pm2 restart ecosystem.config.js",
    "delete": "pm2 delete ecosystem.config.js",
    "logs": "pm2 logs",
    "monit": "pm2 monit"
  }
}`},{title:"Production-Ready Express App",code:`require('dotenv').config();
const express = require('express');
const helmet = require('helmet');
const compression = require('compression');
const cors = require('cors');
const morgan = require('morgan');
const winston = require('winston');

const app = express();
const PORT = process.env.PORT || 3000;

// Winston logger configuration
const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' })
  ]
});

// Add console logging in development
if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}

// Security middleware
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'", "https://fonts.googleapis.com"],
      fontSrc: ["'self'", "https://fonts.gstatic.com"],
      scriptSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
}));

// CORS configuration
app.use(cors({
  origin: process.env.NODE_ENV === 'production'
    ? process.env.ALLOWED_ORIGINS?.split(',') || []
    : ['http://localhost:3000'],
  credentials: true
}));

// Compression middleware
app.use(compression());

// Logging middleware
app.use(morgan('combined', {
  stream: { write: message => logger.info(message.trim()) }
}));

// Body parsing
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Static files with caching
app.use(express.static('public', {
  maxAge: process.env.NODE_ENV === 'production' ? '1d' : 0,
  etag: true
}));

// Request logging middleware
app.use((req, res, next) => {
  const start = Date.now();
  res.on('finish', () => {
    const duration = Date.now() - start;
    logger.info(\`Request: \${req.method} \${req.url} - \${res.statusCode} - \${duration}ms\`);
  });
  next();
});

// API routes
app.get('/api/health', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    environment: process.env.NODE_ENV,
    version: process.env.npm_package_version
  });
});

app.get('/api/users', (req, res) => {
  // In a real app, fetch from database
  res.json({
    users: [
      { id: 1, name: 'John Doe', email: 'john@example.com' }
    ]
  });
});

// Error handling middleware
app.use((err, req, res, next) => {
  logger.error('Unhandled error:', err);

  const isDevelopment = process.env.NODE_ENV !== 'production';

  res.status(err.status || 500).json({
    error: isDevelopment ? err.message : 'Internal server error',
    ...(isDevelopment && { stack: err.stack })
  });
});

// 404 handler
app.use((req, res) => {
  res.status(404).json({ error: 'Route not found' });
});

// Graceful shutdown
const gracefulShutdown = (signal) => {
  logger.info(\`Received \${signal}. Starting graceful shutdown...\`);

  server.close((err) => {
    if (err) {
      logger.error('Error during server shutdown:', err);
      process.exit(1);
    }

    logger.info('Server closed successfully');
    process.exit(0);
  });

  // Force shutdown after 30 seconds
  setTimeout(() => {
    logger.error('Forced shutdown after timeout');
    process.exit(1);
  }, 30000);
};

process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));
process.on('SIGINT', () => gracefulShutdown('SIGINT'));

const server = app.listen(PORT, () => {
  logger.info(\`Express server running on port \${PORT} in \${process.env.NODE_ENV} mode\`);
});`}]}],projects:[{title:"RESTful API with Authentication",description:"Build a complete RESTful API for a blog system with user authentication, CRUD operations for posts and comments, and proper error handling."},{title:"E-commerce Backend",description:"Create the backend for an e-commerce platform with product management, shopping cart, user authentication, and payment integration."},{title:"Real-time Chat Application",description:"Build a real-time chat application using Express.js and WebSockets with user authentication, chat rooms, and message persistence."},{title:"File Management System",description:"Develop a file upload and management system with user authentication, file validation, cloud storage integration, and access controls."},{title:"Task Management API",description:"Create a comprehensive task management API with user authentication, project management, task assignment, and progress tracking."}],assessments:[{type:"quiz",questions:[{question:"What is middleware in Express.js?",options:["A type of database","Functions that have access to request and response objects","A template engine","A package manager"],correctAnswer:"Functions that have access to request and response objects"},{question:"Which method is used to serve static files in Express.js?",options:["app.static()","express.static()","app.use()","app.serve()"],correctAnswer:"express.static()"},{question:"What does CORS stand for?",options:["Cross-Origin Resource Sharing","Central Object Resource System","Client Origin Request Service","Common Object Response Standard"],correctAnswer:"Cross-Origin Resource Sharing"},{question:"Which middleware is commonly used for parsing JSON in Express.js?",options:["express.json()","body-parser","multer","helmet"],correctAnswer:"express.json()"},{question:"What is the purpose of the next() function in Express middleware?",options:["To end the request-response cycle","To pass control to the next middleware function","To send a response to the client","To handle errors"],correctAnswer:"To pass control to the next middleware function"}]},{type:"evaluation",questions:[{question:"Explain the middleware pattern in Express.js and provide an example of how you would implement custom authentication middleware.",options:[],correctAnswer:""},{question:"Compare and contrast different template engines available for Express.js (EJS, Pug, Handlebars) and explain when you would choose each.",options:[],correctAnswer:""},{question:"Describe the security considerations and best practices for deploying an Express.js application to production.",options:[],correctAnswer:""}]}],aiPrompts:["How do I implement authentication middleware in Express.js?","What's the best way to handle file uploads in Express.js?","How do I set up CORS properly in an Express.js API?","Explain the difference between app.use() and app.get() in Express.js","How do I implement rate limiting in Express.js?","What's the best way to structure routes in a large Express.js application?","How do I handle errors properly in Express.js?","Explain Express.js middleware and provide practical examples","How do I serve static files efficiently in Express.js?","What's the difference between PUT and PATCH in REST APIs?"],resources:[{name:"Express.js Official Documentation",url:"https://expressjs.com/"},{name:"Express.js API Reference",url:"https://expressjs.com/en/api.html"},{name:"Express.js Security Best Practices",url:"https://expressjs.com/en/advanced/best-practice-security.html"},{name:"Helmet.js Documentation",url:"https://helmetjs.github.io/"},{name:"CORS Documentation",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"},{name:"JWT.io",url:"https://jwt.io/"},{name:"Winston Logging",url:"https://github.com/winstonjs/winston"},{name:"PM2 Process Manager",url:"https://pm2.keymetrics.io/"}],toolsRequired:["Node.js (latest LTS version)","npm or yarn package manager","Express.js framework","Postman or similar API testing tool","JWT authentication library","Helmet for security headers","Winston for logging","PM2 for process management","Git for version control"],bestPractices:["Use middleware for cross-cutting concerns like authentication and logging","Implement proper error handling with try-catch and error middleware","Validate all user input to prevent security vulnerabilities","Use environment variables for configuration, never hardcode sensitive data","Implement rate limiting to prevent abuse and DoS attacks","Use HTTPS in production and set security headers with Helmet","Structure your application with routers for better organization","Implement proper logging with Winston or similar libraries","Use compression middleware to reduce response sizes","Implement health check endpoints for monitoring","Use PM2 or similar tools for production process management","Handle graceful shutdown properly","Implement proper CORS configuration for API security","Use parameterized queries and input validation to prevent injection attacks","Keep dependencies updated and audit for security vulnerabilities"],commonPitfalls:["Forgetting to call next() in middleware, breaking the request chain","Not handling asynchronous errors properly in middleware","Exposing sensitive information in error responses","Not implementing proper input validation and sanitization","Hardcoding sensitive configuration like API keys and database credentials","Not using HTTPS in production environments","Ignoring CORS configuration, leading to cross-origin request failures","Not implementing rate limiting, making the API vulnerable to abuse","Using outdated or vulnerable dependencies","Not implementing proper logging for debugging and monitoring","Trying to serve static files inefficiently without proper caching","Not handling file upload security properly (validation, storage, access control)","Using synchronous file system operations in production","Not implementing proper session management and security","Ignoring security headers and best practices"],careerRelevance:"Express.js is the most popular Node.js framework and a cornerstone of modern web development. Mastering Express.js opens doors to full-stack JavaScript development roles, API development positions, and backend engineering opportunities. With the rise of microservices and serverless architectures, Express.js skills are highly sought after by employers. Developers proficient in Express.js can command competitive salaries and work on diverse projects ranging from startups to enterprise applications. The framework's extensive ecosystem and community support ensure long-term career viability and continuous learning opportunities."},_M={id:"sqlite",tier:2,name:"SQLite",description:"SQLite is a self-contained, serverless, zero-configuration SQL database engine that stores data in a single file. It's lightweight, fast, and perfect for applications that need reliable data storage without the complexity of a full database server.",difficulty:"intermediate",estimatedHours:20,prerequisites:["nodejs","json"],learningObjectives:["Understand SQLite fundamentals and file-based database concepts","Master database design principles and normalization","Implement CRUD operations with proper SQL syntax","Work with advanced queries including joins and aggregations","Handle database transactions and ACID properties","Optimize SQLite performance with indexing strategies","Implement proper error handling and data validation","Use SQLite in Node.js applications with best practices","Understand SQLite data types and constraints","Perform database maintenance and backup operations"],sections:[{id:"sqlite-introduction",title:"Introduction to SQLite",content:`SQLite is like a digital filing cabinet for your applications. Unlike traditional database servers that run as separate processes, SQLite stores your entire database in a single file on disk. This makes it incredibly simple to use - no server setup, no configuration, no user management.

Imagine you're building an app and need to store user data, settings, or application state. With SQLite, you just create a database file and start storing data immediately. It's perfect for desktop applications, mobile apps, embedded systems, and even web applications that need local data storage.

SQLite is **ACID compliant** (Atomic, Consistent, Isolated, Durable), meaning it guarantees data integrity even in the face of system crashes or power failures. It's also **cross-platform** - a database file created on Windows will work perfectly on macOS or Linux.

The key advantages of SQLite include:
- **Zero configuration**: No setup required
- **Serverless**: No separate database process
- **Transactional**: Full ACID compliance
- **Self-contained**: Single file database
- **Cross-platform**: Works on any operating system`,keyTopics:["What is SQLite?","File-based database concepts","SQLite vs traditional databases","ACID properties","Cross-platform compatibility"],practicalExercises:["Install SQLite and create your first database","Explore SQLite command-line interface","Create tables and insert sample data","Use SQLite browser tools for database exploration","Compare SQLite with other database systems"],codeExamples:[{title:"Creating Your First SQLite Database",code:`const sqlite3 = require('sqlite3').verbose();

// Open (or create) database file
const db = new sqlite3.Database('./mydatabase.db', (err) => {
  if (err) {
    console.error('Error opening database:', err.message);
  } else {
    console.log('Connected to SQLite database');
  }
});

// Create a simple table
db.run(\`
  CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE,
    age INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
\`, (err) => {
  if (err) {
    console.error('Error creating table:', err.message);
  } else {
    console.log('Users table created successfully');
  }
});

// Close the database connection
db.close((err) => {
  if (err) {
    console.error('Error closing database:', err.message);
  } else {
    console.log('Database connection closed');
  }
});`},{title:"SQLite Command Line Basics",code:`-- Open SQLite command line (run in terminal)
sqlite3 mydatabase.db

-- Create a table
CREATE TABLE products (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  price REAL,
  category TEXT,
  in_stock BOOLEAN DEFAULT 1
);

-- Insert sample data
INSERT INTO products (name, price, category) VALUES
  ('Laptop', 999.99, 'Electronics'),
  ('Book', 19.99, 'Education'),
  ('Coffee Mug', 12.99, 'Kitchen');

-- Query data
SELECT * FROM products;
SELECT name, price FROM products WHERE category = 'Electronics';

-- Exit SQLite
.quit`}]},{id:"sqlite-database-design",title:"Database Design and Schema",content:`Database design is like creating the blueprint for your data house. A well-designed database is efficient, scalable, and easy to maintain. The key principles of good database design include:

**Normalization** is the process of organizing data to minimize redundancy and improve data integrity. There are several normal forms (1NF, 2NF, 3NF) that guide this process.

**Primary Keys** uniquely identify each record in a table. They can be:
- **Natural keys**: Based on real-world data (like email addresses)
- **Surrogate keys**: Auto-generated IDs (like INTEGER PRIMARY KEY AUTOINCREMENT)

**Foreign Keys** create relationships between tables. They ensure referential integrity by linking related data across tables.

**Constraints** enforce data integrity:
- **NOT NULL**: Prevents null values
- **UNIQUE**: Ensures unique values
- **CHECK**: Validates data against conditions
- **DEFAULT**: Provides default values

**Indexes** improve query performance by creating fast lookup paths to data. However, they slow down INSERT/UPDATE operations, so use them judiciously.

Remember: Good database design is about finding the right balance between data integrity, performance, and maintainability.`,keyTopics:["Database normalization principles","Primary and foreign keys","Table relationships","Data types and constraints","Indexing strategies"],practicalExercises:["Design a database schema for a blog application","Create normalized tables with proper relationships","Implement primary and foreign key constraints","Add appropriate indexes for query performance","Design a database for an e-commerce application"],codeExamples:[{title:"Blog Database Schema Design",code:`const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./blog.db');

// Create users table
db.serialize(() => {
  // Users table (1NF, 2NF, 3NF compliant)
  db.run(\`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      username TEXT UNIQUE NOT NULL,
      email TEXT UNIQUE NOT NULL,
      password_hash TEXT NOT NULL,
      full_name TEXT,
      bio TEXT,
      avatar_url TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  \`);

  // Categories table
  db.run(\`
    CREATE TABLE IF NOT EXISTS categories (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT UNIQUE NOT NULL,
      slug TEXT UNIQUE NOT NULL,
      description TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  \`);

  // Posts table with foreign key relationships
  db.run(\`
    CREATE TABLE IF NOT EXISTS posts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title TEXT NOT NULL,
      slug TEXT UNIQUE NOT NULL,
      content TEXT NOT NULL,
      excerpt TEXT,
      featured_image TEXT,
      status TEXT DEFAULT 'draft' CHECK (status IN ('draft', 'published', 'archived')),
      author_id INTEGER NOT NULL,
      category_id INTEGER,
      published_at DATETIME,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (author_id) REFERENCES users (id) ON DELETE CASCADE,
      FOREIGN KEY (category_id) REFERENCES categories (id) ON DELETE SET NULL
    )
  \`);

  // Comments table
  db.run(\`
    CREATE TABLE IF NOT EXISTS comments (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      post_id INTEGER NOT NULL,
      author_name TEXT NOT NULL,
      author_email TEXT NOT NULL,
      content TEXT NOT NULL,
      is_approved BOOLEAN DEFAULT 0,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (post_id) REFERENCES posts (id) ON DELETE CASCADE
    )
  \`);

  // Tags table (many-to-many relationship)
  db.run(\`
    CREATE TABLE IF NOT EXISTS tags (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT UNIQUE NOT NULL,
      slug TEXT UNIQUE NOT NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  \`);

  // Post-Tag relationship table
  db.run(\`
    CREATE TABLE IF NOT EXISTS post_tags (
      post_id INTEGER NOT NULL,
      tag_id INTEGER NOT NULL,
      PRIMARY KEY (post_id, tag_id),
      FOREIGN KEY (post_id) REFERENCES posts (id) ON DELETE CASCADE,
      FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE
    )
  \`);

  console.log('Blog database schema created successfully');
});`},{title:"E-commerce Database Design",code:`const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./ecommerce.db');

db.serialize(() => {
  // Customers table
  db.run(\`
    CREATE TABLE IF NOT EXISTS customers (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      email TEXT UNIQUE NOT NULL,
      password_hash TEXT NOT NULL,
      first_name TEXT NOT NULL,
      last_name TEXT NOT NULL,
      phone TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  \`);

  // Products table
  db.run(\`
    CREATE TABLE IF NOT EXISTS products (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT NOT NULL,
      description TEXT,
      price DECIMAL(10,2) NOT NULL CHECK (price > 0),
      sku TEXT UNIQUE NOT NULL,
      stock_quantity INTEGER DEFAULT 0 CHECK (stock_quantity >= 0),
      category_id INTEGER,
      image_url TEXT,
      is_active BOOLEAN DEFAULT 1,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (category_id) REFERENCES categories (id)
    )
  \`);

  // Categories table
  db.run(\`
    CREATE TABLE IF NOT EXISTS categories (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT UNIQUE NOT NULL,
      description TEXT,
      parent_id INTEGER,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (parent_id) REFERENCES categories (id)
    )
  \`);

  // Orders table
  db.run(\`
    CREATE TABLE IF NOT EXISTS orders (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      customer_id INTEGER NOT NULL,
      order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
      total_amount DECIMAL(10,2) NOT NULL,
      status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'shipped', 'delivered', 'cancelled')),
      shipping_address TEXT NOT NULL,
      payment_method TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (customer_id) REFERENCES customers (id)
    )
  \`);

  // Order Items table
  db.run(\`
    CREATE TABLE IF NOT EXISTS order_items (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      order_id INTEGER NOT NULL,
      product_id INTEGER NOT NULL,
      quantity INTEGER NOT NULL CHECK (quantity > 0),
      unit_price DECIMAL(10,2) NOT NULL,
      total_price DECIMAL(10,2) NOT NULL,
      FOREIGN KEY (order_id) REFERENCES orders (id),
      FOREIGN KEY (product_id) REFERENCES products (id)
    )
  \`);

  // Shopping Cart table
  db.run(\`
    CREATE TABLE IF NOT EXISTS cart_items (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      customer_id INTEGER NOT NULL,
      product_id INTEGER NOT NULL,
      quantity INTEGER NOT NULL CHECK (quantity > 0),
      added_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (customer_id) REFERENCES customers (id),
      FOREIGN KEY (product_id) REFERENCES products (id),
      UNIQUE(customer_id, product_id)
    )
  \`);

  console.log('E-commerce database schema created successfully');
});`}]},{id:"sqlite-crud-operations",title:"CRUD Operations",content:"CRUD operations form the backbone of any database application. CRUD stands for Create, Read, Update, and Delete - the four fundamental operations you perform on data.\n\n**Create (INSERT)**: Adding new records to your database\n**Read (SELECT)**: Retrieving data from your database\n**Update (UPDATE)**: Modifying existing records\n**Delete (DELETE)**: Removing records from your database\n\nIn SQLite with Node.js, you use the `db.run()`, `db.get()`, `db.all()`, and `db.each()` methods for different types of operations:\n\n- `db.run()`: For INSERT, UPDATE, DELETE operations that don't return data\n- `db.get()`: For SELECT operations that return a single row\n- `db.all()`: For SELECT operations that return multiple rows\n- `db.each()`: For processing multiple rows one at a time\n\nAlways use parameterized queries to prevent SQL injection attacks. Parameterized queries separate SQL code from data, making your applications more secure.\n\nRemember to handle errors properly and close database connections when you're done with them. Proper resource management prevents memory leaks and ensures your application runs smoothly.",keyTopics:["INSERT operations","SELECT queries with various conditions","UPDATE operations","DELETE operations","Parameterized queries for security"],practicalExercises:["Implement complete CRUD operations for a user management system","Create forms for adding, editing, and deleting records","Implement search and filtering functionality","Add data validation before database operations","Handle database errors gracefully in your application"],codeExamples:[{title:"Complete CRUD Operations Class",code:`const sqlite3 = require('sqlite3').verbose();

class UserManager {
  constructor(dbPath = './users.db') {
    this.db = new sqlite3.Database(dbPath);
    this.initDatabase();
  }

  initDatabase() {
    const sql = \`
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        email TEXT UNIQUE NOT NULL,
        age INTEGER,
        department TEXT,
        salary REAL,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    \`;

    this.db.run(sql, (err) => {
      if (err) {
        console.error('Error creating table:', err.message);
      } else {
        console.log('Users table ready');
      }
    });
  }

  // CREATE - Insert new user
  createUser(userData, callback) {
    const { name, email, age, department, salary } = userData;
    const sql = \`
      INSERT INTO users (name, email, age, department, salary)
      VALUES (?, ?, ?, ?, ?)
    \`;

    this.db.run(sql, [name, email, age, department, salary], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { id: this.lastID, ...userData });
      }
    });
  }

  // READ - Get all users
  getAllUsers(callback) {
    const sql = 'SELECT * FROM users ORDER BY created_at DESC';

    this.db.all(sql, [], (err, rows) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, rows);
      }
    });
  }

  // READ - Get user by ID
  getUserById(id, callback) {
    const sql = 'SELECT * FROM users WHERE id = ?';

    this.db.get(sql, [id], (err, row) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, row);
      }
    });
  }

  // READ - Search users
  searchUsers(searchTerm, callback) {
    const sql = \`
      SELECT * FROM users
      WHERE name LIKE ? OR email LIKE ? OR department LIKE ?
      ORDER BY name
    \`;
    const searchPattern = \`%\${searchTerm}%\`;

    this.db.all(sql, [searchPattern, searchPattern, searchPattern], (err, rows) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, rows);
      }
    });
  }

  // UPDATE - Update user
  updateUser(id, userData, callback) {
    const { name, email, age, department, salary } = userData;
    const sql = \`
      UPDATE users
      SET name = ?, email = ?, age = ?, department = ?, salary = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    \`;

    this.db.run(sql, [name, email, age, department, salary, id], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { changes: this.changes, id });
      }
    });
  }

  // DELETE - Delete user
  deleteUser(id, callback) {
    const sql = 'DELETE FROM users WHERE id = ?';

    this.db.run(sql, [id], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { changes: this.changes, id });
      }
    });
  }

  // Utility method to close database
  close() {
    this.db.close((err) => {
      if (err) {
        console.error('Error closing database:', err.message);
      } else {
        console.log('Database connection closed');
      }
    });
  }
}

// Usage example
const userManager = new UserManager();

// Create a new user
userManager.createUser({
  name: 'John Doe',
  email: 'john@example.com',
  age: 30,
  department: 'Engineering',
  salary: 75000
}, (err, user) => {
  if (err) {
    console.error('Error creating user:', err.message);
  } else {
    console.log('User created:', user);
  }
});

// Get all users
userManager.getAllUsers((err, users) => {
  if (err) {
    console.error('Error getting users:', err.message);
  } else {
    console.log('All users:', users);
  }
});

module.exports = UserManager;`},{title:"Advanced CRUD with Relationships",code:`const sqlite3 = require('sqlite3').verbose();

class BlogManager {
  constructor(dbPath = './blog.db') {
    this.db = new sqlite3.Database(dbPath);
  }

  // Create post with category
  createPost(postData, callback) {
    const { title, content, authorId, categoryId } = postData;

    // First check if category exists
    this.db.get('SELECT id FROM categories WHERE id = ?', [categoryId], (err, category) => {
      if (err) {
        return callback(err, null);
      }

      if (!category) {
        return callback(new Error('Category not found'), null);
      }

      // Create slug from title
      const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');

      const sql = \`
        INSERT INTO posts (title, slug, content, author_id, category_id, status)
        VALUES (?, ?, ?, ?, ?, 'published')
      \`;

      this.db.run(sql, [title, slug, content, authorId, categoryId], function(err) {
        if (err) {
          callback(err, null);
        } else {
          callback(null, { id: this.lastID, title, slug });
        }
      });
    });
  }

  // Get posts with author and category info
  getPostsWithDetails(limit = 10, offset = 0, callback) {
    const sql = \`
      SELECT
        p.id, p.title, p.slug, p.content, p.created_at,
        u.username as author_name,
        c.name as category_name
      FROM posts p
      JOIN users u ON p.author_id = u.id
      LEFT JOIN categories c ON p.category_id = c.id
      WHERE p.status = 'published'
      ORDER BY p.created_at DESC
      LIMIT ? OFFSET ?
    \`;

    this.db.all(sql, [limit, offset], (err, rows) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, rows);
      }
    });
  }

  // Update post with validation
  updatePost(id, postData, callback) {
    const { title, content, categoryId } = postData;

    // Check if post exists
    this.db.get('SELECT id FROM posts WHERE id = ?', [id], (err, post) => {
      if (err) {
        return callback(err, null);
      }

      if (!post) {
        return callback(new Error('Post not found'), null);
      }

      const sql = \`
        UPDATE posts
        SET title = ?, content = ?, category_id = ?, updated_at = CURRENT_TIMESTAMP
        WHERE id = ?
      \`;

      this.db.run(sql, [title, content, categoryId, id], function(err) {
        if (err) {
          callback(err, null);
        } else {
          callback(null, { changes: this.changes, id });
        }
      });
    });
  }

  // Delete post and related comments
  deletePost(id, callback) {
    // Use transaction to ensure data consistency
    const sql = 'DELETE FROM posts WHERE id = ?';

    this.db.run(sql, [id], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { changes: this.changes, id });
      }
    });
  }

  // Get post statistics
  getPostStats(callback) {
    const sql = \`
      SELECT
        COUNT(*) as total_posts,
        COUNT(CASE WHEN status = 'published' THEN 1 END) as published_posts,
        COUNT(DISTINCT author_id) as total_authors,
        COUNT(DISTINCT category_id) as total_categories
      FROM posts
    \`;

    this.db.get(sql, [], (err, stats) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, stats);
      }
    });
  }
}

// Usage example
const blogManager = new BlogManager();

// Create a post
blogManager.createPost({
  title: 'My First Blog Post',
  content: 'This is the content of my first blog post...',
  authorId: 1,
  categoryId: 1
}, (err, post) => {
  if (err) {
    console.error('Error creating post:', err.message);
  } else {
    console.log('Post created:', post);
  }
});

// Get posts with details
blogManager.getPostsWithDetails(5, 0, (err, posts) => {
  if (err) {
    console.error('Error getting posts:', err.message);
  } else {
    console.log('Posts with details:', posts);
  }
});

module.exports = BlogManager;`}]},{id:"sqlite-advanced-queries",title:"Advanced Queries and Joins",content:`Advanced SQL queries allow you to extract meaningful insights from your data. Joins, aggregations, and subqueries are powerful tools that transform simple data into valuable information.

**JOIN Operations** combine data from multiple tables:
- **INNER JOIN**: Returns only matching rows from both tables
- **LEFT JOIN**: Returns all rows from left table and matching rows from right table
- **RIGHT JOIN**: Returns all rows from right table and matching rows from left table
- **FULL OUTER JOIN**: Returns all rows from both tables

**Aggregate Functions** perform calculations on groups of data:
- **COUNT()**: Count rows or non-null values
- **SUM()**: Sum numeric values
- **AVG()**: Calculate average
- **MIN()/MAX()**: Find minimum/maximum values
- **GROUP BY**: Group results by one or more columns
- **HAVING**: Filter grouped results

**Subqueries** are queries within queries:
- **Scalar subqueries**: Return single values
- **Table subqueries**: Return result sets
- **Correlated subqueries**: Reference outer query values

**Common Table Expressions (CTEs)** with WITH clause make complex queries more readable by breaking them into logical parts.

Remember: The key to writing efficient queries is understanding your data relationships and choosing the right JOIN type for your use case.`,keyTopics:["JOIN operations (INNER, LEFT, RIGHT, FULL)","Aggregate functions and GROUP BY","Subqueries and CTEs","Complex WHERE conditions","Query optimization techniques"],practicalExercises:["Write complex JOIN queries for multi-table relationships","Create reports using aggregate functions","Implement search functionality with multiple criteria","Optimize slow queries using EXPLAIN QUERY PLAN","Create complex reports with subqueries and CTEs"],codeExamples:[{title:"Advanced JOIN Queries",code:`const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./analytics.db');

// Create sample tables
db.serialize(() => {
  // Users table
  db.run(\`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY,
      name TEXT NOT NULL,
      email TEXT NOT NULL,
      department TEXT,
      hire_date DATE
    )
  \`);

  // Orders table
  db.run(\`
    CREATE TABLE IF NOT EXISTS orders (
      id INTEGER PRIMARY KEY,
      user_id INTEGER,
      product_name TEXT,
      quantity INTEGER,
      unit_price REAL,
      order_date DATE,
      status TEXT,
      FOREIGN KEY (user_id) REFERENCES users (id)
    )
  \`);

  // Insert sample data
  const users = [
    { name: 'Alice Johnson', email: 'alice@company.com', department: 'Sales', hire_date: '2020-01-15' },
    { name: 'Bob Smith', email: 'bob@company.com', department: 'Engineering', hire_date: '2019-06-01' },
    { name: 'Carol Davis', email: 'carol@company.com', department: 'Sales', hire_date: '2021-03-20' },
    { name: 'David Wilson', email: 'david@company.com', department: 'Engineering', hire_date: '2020-09-10' }
  ];

  const orders = [
    { user_id: 1, product_name: 'Laptop', quantity: 1, unit_price: 1200, order_date: '2023-01-15', status: 'completed' },
    { user_id: 1, product_name: 'Mouse', quantity: 2, unit_price: 25, order_date: '2023-01-15', status: 'completed' },
    { user_id: 2, product_name: 'Monitor', quantity: 1, unit_price: 300, order_date: '2023-02-01', status: 'completed' },
    { user_id: 3, product_name: 'Keyboard', quantity: 1, unit_price: 80, order_date: '2023-02-15', status: 'pending' },
    { user_id: 4, product_name: 'Headphones', quantity: 1, unit_price: 150, order_date: '2023-03-01', status: 'completed' }
  ];

  // Insert users
  const userStmt = db.prepare('INSERT INTO users (name, email, department, hire_date) VALUES (?, ?, ?, ?)');
  users.forEach(user => {
    userStmt.run(user.name, user.email, user.department, user.hire_date);
  });
  userStmt.finalize();

  // Insert orders
  const orderStmt = db.prepare('INSERT INTO orders (user_id, product_name, quantity, unit_price, order_date, status) VALUES (?, ?, ?, ?, ?, ?)');
  orders.forEach(order => {
    orderStmt.run(order.user_id, order.product_name, order.quantity, order.unit_price, order.order_date, order.status);
  });
  orderStmt.finalize();

  console.log('Sample data inserted');
});

// INNER JOIN - Get all orders with user information
function getOrdersWithUsers() {
  const sql = \`
    SELECT
      o.id as order_id,
      o.product_name,
      o.quantity,
      o.unit_price,
      (o.quantity * o.unit_price) as total,
      o.order_date,
      o.status,
      u.name as customer_name,
      u.email,
      u.department
    FROM orders o
    INNER JOIN users u ON o.user_id = u.id
    ORDER BY o.order_date DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Orders with user info:');
      console.table(rows);
    }
  });
}

// LEFT JOIN - Get all users and their order counts
function getUsersWithOrderCounts() {
  const sql = \`
    SELECT
      u.name,
      u.email,
      u.department,
      COUNT(o.id) as total_orders,
      COALESCE(SUM(o.quantity * o.unit_price), 0) as total_spent
    FROM users u
    LEFT JOIN orders o ON u.id = o.user_id AND o.status = 'completed'
    GROUP BY u.id, u.name, u.email, u.department
    ORDER BY total_spent DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Users with order statistics:');
      console.table(rows);
    }
  });
}

// Aggregate query - Sales by department
function getSalesByDepartment() {
  const sql = \`
    SELECT
      u.department,
      COUNT(DISTINCT u.id) as customers,
      COUNT(o.id) as total_orders,
      ROUND(SUM(o.quantity * o.unit_price), 2) as total_revenue,
      ROUND(AVG(o.quantity * o.unit_price), 2) as avg_order_value
    FROM users u
    LEFT JOIN orders o ON u.id = o.user_id AND o.status = 'completed'
    GROUP BY u.department
    HAVING total_orders > 0
    ORDER BY total_revenue DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Sales by department:');
      console.table(rows);
    }
  });
}

// Complex query with subquery - Top customers
function getTopCustomers() {
  const sql = \`
    SELECT
      u.name,
      u.email,
      u.department,
      customer_stats.total_spent,
      customer_stats.order_count
    FROM users u
    INNER JOIN (
      SELECT
        user_id,
        COUNT(*) as order_count,
        SUM(quantity * unit_price) as total_spent
      FROM orders
      WHERE status = 'completed'
      GROUP BY user_id
      HAVING total_spent > 100
    ) customer_stats ON u.id = customer_stats.user_id
    ORDER BY customer_stats.total_spent DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Top customers (spent > $100):');
      console.table(rows);
    }
  });
}

// Run all queries
setTimeout(() => {
  getOrdersWithUsers();
  setTimeout(() => {
    getUsersWithOrderCounts();
    setTimeout(() => {
      getSalesByDepartment();
      setTimeout(() => {
        getTopCustomers();
        db.close();
      }, 100);
    }, 100);
  }, 100);
}, 100);`},{title:"Complex Reports with CTEs",code:`const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./reports.db');

// Create sample sales data
db.serialize(() => {
  db.run(\`
    CREATE TABLE IF NOT EXISTS sales (
      id INTEGER PRIMARY KEY,
      product_id INTEGER,
      customer_id INTEGER,
      salesperson_id INTEGER,
      quantity INTEGER,
      unit_price REAL,
      discount REAL DEFAULT 0,
      sale_date DATE,
      region TEXT
    )
  \`);

  // Insert sample data
  const sales = [
    { product_id: 1, customer_id: 1, salesperson_id: 1, quantity: 10, unit_price: 50, discount: 0.05, sale_date: '2023-01-15', region: 'North' },
    { product_id: 2, customer_id: 2, salesperson_id: 1, quantity: 5, unit_price: 100, discount: 0.1, sale_date: '2023-01-20', region: 'South' },
    { product_id: 1, customer_id: 3, salesperson_id: 2, quantity: 8, unit_price: 50, discount: 0, sale_date: '2023-02-01', region: 'North' },
    { product_id: 3, customer_id: 1, salesperson_id: 2, quantity: 3, unit_price: 200, discount: 0.15, sale_date: '2023-02-10', region: 'East' },
    { product_id: 2, customer_id: 4, salesperson_id: 1, quantity: 12, unit_price: 100, discount: 0.05, sale_date: '2023-02-15', region: 'West' }
  ];

  const stmt = db.prepare(\`
    INSERT INTO sales (product_id, customer_id, salesperson_id, quantity, unit_price, discount, sale_date, region)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?)
  \`);

  sales.forEach(sale => {
    stmt.run(
      sale.product_id, sale.customer_id, sale.salesperson_id,
      sale.quantity, sale.unit_price, sale.discount,
      sale.sale_date, sale.region
    );
  });
  stmt.finalize();

  console.log('Sales data inserted');
});

// Monthly sales report with CTE
function getMonthlySalesReport() {
  const sql = \`
    WITH monthly_sales AS (
      SELECT
        strftime('%Y-%m', sale_date) as month,
        region,
        COUNT(*) as total_orders,
        SUM(quantity) as total_quantity,
        SUM(quantity * unit_price * (1 - discount)) as total_revenue,
        AVG(quantity * unit_price * (1 - discount)) as avg_order_value
      FROM sales
      GROUP BY strftime('%Y-%m', sale_date), region
    ),
    monthly_totals AS (
      SELECT
        month,
        SUM(total_orders) as month_orders,
        SUM(total_revenue) as month_revenue,
        SUM(total_quantity) as month_quantity
      FROM monthly_sales
      GROUP BY month
    )
    SELECT
      ms.month,
      ms.region,
      ms.total_orders,
      ROUND(ms.total_revenue, 2) as region_revenue,
      ROUND(ms.avg_order_value, 2) as avg_order_value,
      ROUND((ms.total_revenue / mt.month_revenue) * 100, 1) as revenue_percentage
    FROM monthly_sales ms
    JOIN monthly_totals mt ON ms.month = mt.month
    ORDER BY ms.month, ms.total_revenue DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Monthly Sales Report:');
      console.table(rows);
    }
  });
}

// Top products analysis
function getTopProductsAnalysis() {
  const sql = \`
    WITH product_performance AS (
      SELECT
        product_id,
        SUM(quantity) as total_quantity,
        SUM(quantity * unit_price * (1 - discount)) as total_revenue,
        COUNT(*) as order_count,
        AVG(discount) as avg_discount,
        MAX(sale_date) as last_sale_date
      FROM sales
      GROUP BY product_id
    ),
    ranked_products AS (
      SELECT
        *,
        ROW_NUMBER() OVER (ORDER BY total_revenue DESC) as revenue_rank,
        ROW_NUMBER() OVER (ORDER BY total_quantity DESC) as quantity_rank
      FROM product_performance
    )
    SELECT
      product_id,
      total_quantity,
      ROUND(total_revenue, 2) as total_revenue,
      order_count,
      ROUND(avg_discount * 100, 1) as avg_discount_percent,
      last_sale_date,
      revenue_rank,
      quantity_rank,
      CASE
        WHEN revenue_rank <= 2 THEN 'Top Performer'
        WHEN revenue_rank <= 4 THEN 'Good Performer'
        ELSE 'Needs Attention'
      END as performance_category
    FROM ranked_products
    ORDER BY total_revenue DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Top Products Analysis:');
      console.table(rows);
    }
  });
}

// Customer lifetime value analysis
function getCustomerLifetimeValue() {
  const sql = \`
    WITH customer_summary AS (
      SELECT
        customer_id,
        COUNT(*) as total_orders,
        SUM(quantity * unit_price * (1 - discount)) as lifetime_value,
        AVG(quantity * unit_price * (1 - discount)) as avg_order_value,
        MIN(sale_date) as first_purchase,
        MAX(sale_date) as last_purchase,
        COUNT(DISTINCT salesperson_id) as unique_salespeople
      FROM sales
      GROUP BY customer_id
    ),
    customer_segments AS (
      SELECT
        *,
        CASE
          WHEN lifetime_value >= 1000 THEN 'High Value'
          WHEN lifetime_value >= 500 THEN 'Medium Value'
          ELSE 'Low Value'
        END as value_segment,
        JULIANDAY(last_purchase) - JULIANDAY(first_purchase) as customer_age_days
      FROM customer_summary
    )
    SELECT
      customer_id,
      total_orders,
      ROUND(lifetime_value, 2) as lifetime_value,
      ROUND(avg_order_value, 2) as avg_order_value,
      first_purchase,
      last_purchase,
      ROUND(customer_age_days, 0) as customer_age_days,
      value_segment,
      CASE
        WHEN customer_age_days > 30 THEN ROUND(lifetime_value / (customer_age_days / 30), 2)
        ELSE lifetime_value
      END as monthly_value
    FROM customer_segments
    ORDER BY lifetime_value DESC
  \`;

  db.all(sql, [], (err, rows) => {
    if (err) {
      console.error('Error:', err.message);
    } else {
      console.log('Customer Lifetime Value Analysis:');
      console.table(rows);
    }
  });
}

// Run all reports
setTimeout(() => {
  getMonthlySalesReport();
  setTimeout(() => {
    getTopProductsAnalysis();
    setTimeout(() => {
      getCustomerLifetimeValue();
      db.close();
    }, 100);
  }, 100);
}, 100);`}]},{id:"sqlite-transactions",title:"Transactions and Data Integrity",content:`Transactions are the cornerstone of data integrity in databases. A transaction is a logical unit of work that either completes entirely or not at all. This ensures your data remains consistent even when things go wrong.

**ACID Properties** define what makes a transaction reliable:
- **Atomicity**: All operations in a transaction succeed or all fail
- **Consistency**: Database remains in a consistent state
- **Isolation**: Transactions don't interfere with each other
- **Durability**: Changes persist even after system failures

**Transaction States**:
- **Active**: Transaction is executing
- **Partially Committed**: All operations completed, waiting for commit
- **Committed**: Transaction successfully completed
- **Failed**: Transaction failed and rolled back
- **Aborted**: Transaction cancelled and rolled back

**SQLite Transaction Commands**:
- \`BEGIN TRANSACTION\`: Start a transaction
- \`COMMIT\`: Save all changes
- \`ROLLBACK\`: Undo all changes
- \`SAVEPOINT\`: Create intermediate rollback points
- \`RELEASE SAVEPOINT\`: Remove a savepoint

**Transaction Types**:
- **Implicit**: Auto-committed for single statements
- **Explicit**: Manually controlled with BEGIN/COMMIT
- **Nested**: Transactions within transactions using savepoints

Always use transactions for operations that modify multiple tables or need to be atomic. This prevents data corruption and ensures your application behaves predictably.`,keyTopics:["ACID properties","Transaction lifecycle","BEGIN, COMMIT, ROLLBACK","Savepoints and nested transactions","Error handling in transactions"],practicalExercises:["Implement bank transfer with transaction safety","Create user registration with multiple table updates","Handle transaction rollbacks on errors","Use savepoints for complex operations","Implement retry logic for failed transactions"],codeExamples:[{title:"Bank Transfer with Transactions",code:`const sqlite3 = require('sqlite3').verbose();

class BankSystem {
  constructor(dbPath = './bank.db') {
    this.db = new sqlite3.Database(dbPath);
    this.initDatabase();
  }

  initDatabase() {
    this.db.serialize(() => {
      // Create accounts table
      this.db.run(\`
        CREATE TABLE IF NOT EXISTS accounts (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          account_number TEXT UNIQUE NOT NULL,
          owner_name TEXT NOT NULL,
          balance REAL DEFAULT 0.0 CHECK (balance >= 0),
          created_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )
      \`);

      // Create transactions table
      this.db.run(\`
        CREATE TABLE IF NOT EXISTS transactions (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          from_account_id INTEGER,
          to_account_id INTEGER,
          amount REAL NOT NULL CHECK (amount > 0),
          description TEXT,
          transaction_date DATETIME DEFAULT CURRENT_TIMESTAMP,
          status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'completed', 'failed')),
          FOREIGN KEY (from_account_id) REFERENCES accounts (id),
          FOREIGN KEY (to_account_id) REFERENCES accounts (id)
        )
      \`);

      console.log('Bank database initialized');
    });
  }

  // Create new account
  createAccount(accountData, callback) {
    const { accountNumber, ownerName, initialBalance = 0 } = accountData;
    const sql = 'INSERT INTO accounts (account_number, owner_name, balance) VALUES (?, ?, ?)';

    this.db.run(sql, [accountNumber, ownerName, initialBalance], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { id: this.lastID, accountNumber, ownerName, balance: initialBalance });
      }
    });
  }

  // Transfer money between accounts (with transaction)
  transferMoney(transferData, callback) {
    const { fromAccountNumber, toAccountNumber, amount, description } = transferData;

    // Start transaction
    this.db.run('BEGIN TRANSACTION', (err) => {
      if (err) {
        return callback(err, null);
      }

      // Get sender account
      this.db.get(
        'SELECT id, balance FROM accounts WHERE account_number = ?',
        [fromAccountNumber],
        (err, fromAccount) => {
          if (err) {
            this.db.run('ROLLBACK');
            return callback(err, null);
          }

          if (!fromAccount) {
            this.db.run('ROLLBACK');
            return callback(new Error('Sender account not found'), null);
          }

          if (fromAccount.balance < amount) {
            this.db.run('ROLLBACK');
            return callback(new Error('Insufficient funds'), null);
          }

          // Get receiver account
          this.db.get(
            'SELECT id, balance FROM accounts WHERE account_number = ?',
            [toAccountNumber],
            (err, toAccount) => {
              if (err) {
                this.db.run('ROLLBACK');
                return callback(err, null);
              }

              if (!toAccount) {
                this.db.run('ROLLBACK');
                return callback(new Error('Receiver account not found'), null);
              }

              // Update sender balance
              this.db.run(
                'UPDATE accounts SET balance = balance - ? WHERE id = ?',
                [amount, fromAccount.id],
                (err) => {
                  if (err) {
                    this.db.run('ROLLBACK');
                    return callback(err, null);
                  }

                  // Update receiver balance
                  this.db.run(
                    'UPDATE accounts SET balance = balance + ? WHERE id = ?',
                    [amount, toAccount.id],
                    (err) => {
                      if (err) {
                        this.db.run('ROLLBACK');
                        return callback(err, null);
                      }

                      // Record transaction
                      this.db.run(
                        \`INSERT INTO transactions (from_account_id, to_account_id, amount, description, status)
                         VALUES (?, ?, ?, ?, 'completed')\`,
                        [fromAccount.id, toAccount.id, amount, description],
                        function(err) {
                          if (err) {
                            this.db.run('ROLLBACK');
                            return callback(err, null);
                          }

                          // Commit transaction
                          this.db.run('COMMIT', (err) => {
                            if (err) {
                              this.db.run('ROLLBACK');
                              return callback(err, null);
                            }

                            callback(null, {
                              transactionId: this.lastID,
                              amount,
                              fromAccount: fromAccountNumber,
                              toAccount: toAccountNumber,
                              description
                            });
                          });
                        }
                      );
                    }
                  );
                }
              );
            }
          );
        }
      );
    });
  }

  // Get account balance
  getAccountBalance(accountNumber, callback) {
    const sql = 'SELECT balance FROM accounts WHERE account_number = ?';

    this.db.get(sql, [accountNumber], (err, row) => {
      if (err) {
        callback(err, null);
      } else if (!row) {
        callback(new Error('Account not found'), null);
      } else {
        callback(null, row.balance);
      }
    });
  }

  // Get transaction history
  getTransactionHistory(accountNumber, callback) {
    const sql = \`
      SELECT
        t.id,
        t.amount,
        t.description,
        t.transaction_date,
        t.status,
        fa.account_number as from_account,
        ta.account_number as to_account
      FROM transactions t
      LEFT JOIN accounts fa ON t.from_account_id = fa.id
      LEFT JOIN accounts ta ON t.to_account_id = ta.id
      WHERE fa.account_number = ? OR ta.account_number = ?
      ORDER BY t.transaction_date DESC
    \`;

    this.db.all(sql, [accountNumber, accountNumber], (err, rows) => {
      if (err) {
        callback(err, null);
      } else {
        callback(null, rows);
      }
    });
  }
}

// Usage example
const bank = new BankSystem();

// Create accounts
bank.createAccount({
  accountNumber: 'ACC001',
  ownerName: 'Alice Johnson',
  initialBalance: 1000
}, (err, account) => {
  if (err) {
    console.error('Error creating account:', err.message);
  } else {
    console.log('Account created:', account);
  }
});

bank.createAccount({
  accountNumber: 'ACC002',
  ownerName: 'Bob Smith',
  initialBalance: 500
}, (err, account) => {
  if (err) {
    console.error('Error creating account:', err.message);
  } else {
    console.log('Account created:', account);
  }
});

// Perform transfer
setTimeout(() => {
  bank.transferMoney({
    fromAccountNumber: 'ACC001',
    toAccountNumber: 'ACC002',
    amount: 200,
    description: 'Payment for services'
  }, (err, result) => {
    if (err) {
      console.error('Transfer failed:', err.message);
    } else {
      console.log('Transfer successful:', result);

      // Check balances
      bank.getAccountBalance('ACC001', (err, balance) => {
        if (!err) console.log('ACC001 balance:', balance);
      });

      bank.getAccountBalance('ACC002', (err, balance) => {
        if (!err) console.log('ACC002 balance:', balance);
      });
    }
  });
}, 100);

module.exports = BankSystem;`},{title:"Advanced Transaction Patterns",code:`const sqlite3 = require('sqlite3').verbose();

class AdvancedTransactionManager {
  constructor(dbPath = './transactions.db') {
    this.db = new sqlite3.Database(dbPath);
  }

  // Nested transactions with savepoints
  performComplexOperation(operationData, callback) {
    const { userId, actions } = operationData;

    this.db.run('BEGIN TRANSACTION', (err) => {
      if (err) {
        return callback(err, null);
      }

      let completedActions = 0;
      const totalActions = actions.length;
      const results = [];

      const processNextAction = () => {
        if (completedActions >= totalActions) {
          // All actions completed successfully
          this.db.run('COMMIT', (err) => {
            if (err) {
              callback(err, null);
            } else {
              callback(null, results);
            }
          });
          return;
        }

        const action = actions[completedActions];
        const savepointName = \`sp_\${completedActions}\`;

        // Create savepoint for this action
        this.db.run(\`SAVEPOINT \${savepointName}\`, (err) => {
          if (err) {
            this.db.run('ROLLBACK');
            return callback(err, null);
          }

          this.executeAction(action, (err, result) => {
            if (err) {
              // Rollback to savepoint
              this.db.run(\`ROLLBACK TO \${savepointName}\`, () => {
                this.db.run('COMMIT'); // Commit what was successful
                callback(new Error(\`Action \${completedActions + 1} failed: \${err.message}\`), results);
              });
              return;
            }

            // Release savepoint (action successful)
            this.db.run(\`RELEASE \${savepointName}\`, (err) => {
              if (err) {
                this.db.run('ROLLBACK');
                return callback(err, null);
              }

              results.push(result);
              completedActions++;
              processNextAction();
            });
          });
        });
      };

      processNextAction();
    });
  }

  executeAction(action, callback) {
    const { type, data } = action;

    switch (type) {
      case 'create_user':
        this.createUser(data, callback);
        break;
      case 'update_balance':
        this.updateBalance(data, callback);
        break;
      case 'create_transaction':
        this.createTransaction(data, callback);
        break;
      default:
        callback(new Error(\`Unknown action type: \${type}\`), null);
    }
  }

  createUser(userData, callback) {
    const sql = 'INSERT INTO users (name, email) VALUES (?, ?)';
    this.db.run(sql, [userData.name, userData.email], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { id: this.lastID, type: 'user_created' });
      }
    });
  }

  updateBalance(balanceData, callback) {
    const sql = 'UPDATE accounts SET balance = balance + ? WHERE id = ?';
    this.db.run(sql, [balanceData.amount, balanceData.accountId], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { changes: this.changes, type: 'balance_updated' });
      }
    });
  }

  createTransaction(txData, callback) {
    const sql = 'INSERT INTO transactions (from_account, to_account, amount) VALUES (?, ?, ?)';
    this.db.run(sql, [txData.from, txData.to, txData.amount], function(err) {
      if (err) {
        callback(err, null);
      } else {
        callback(null, { id: this.lastID, type: 'transaction_created' });
      }
    });
  }

  // Batch processing with transaction
  processBatchOperations(operations, callback) {
    this.db.run('BEGIN TRANSACTION', (err) => {
      if (err) {
        return callback(err, null);
      }

      const results = [];
      let completed = 0;

      operations.forEach((operation, index) => {
        this.db.run(operation.sql, operation.params, function(err) {
          if (err) {
            this.db.run('ROLLBACK');
            return callback(err, null);
          }

          results[index] = { changes: this.changes, lastID: this.lastID };
          completed++;

          if (completed === operations.length) {
            this.db.run('COMMIT', (err) => {
              if (err) {
                callback(err, null);
              } else {
                callback(null, results);
              }
            });
          }
        });
      });
    });
  }

  // Retry mechanism for failed operations
  executeWithRetry(operation, maxRetries = 3, callback) {
    let attempts = 0;

    const attempt = () => {
      attempts++;

      operation((err, result) => {
        if (!err) {
          // Success
          callback(null, result);
        } else if (attempts < maxRetries && this.isRetryableError(err)) {
          // Retry after delay
          setTimeout(attempt, 1000 * attempts);
        } else {
          // Max retries reached or non-retryable error
          callback(err, null);
        }
      });
    };

    attempt();
  }

  isRetryableError(error) {
    // Check if error is due to database lock or temporary issues
    const retryableMessages = [
      'database is locked',
      'database temporarily unavailable',
      'connection timeout'
    ];

    return retryableMessages.some(msg =>
      error.message.toLowerCase().includes(msg)
    );
  }
}

// Usage example
const txManager = new AdvancedTransactionManager();

// Complex operation with savepoints
const complexOperation = {
  userId: 1,
  actions: [
    {
      type: 'create_user',
      data: { name: 'John Doe', email: 'john@example.com' }
    },
    {
      type: 'update_balance',
      data: { accountId: 1, amount: 100 }
    },
    {
      type: 'create_transaction',
      data: { from: 1, to: 2, amount: 50 }
    }
  ]
};

txManager.performComplexOperation(complexOperation, (err, results) => {
  if (err) {
    console.error('Complex operation failed:', err.message);
    console.log('Partial results:', results);
  } else {
    console.log('Complex operation successful:', results);
  }
});

module.exports = AdvancedTransactionManager;`}]},{id:"sqlite-performance-optimization",title:"Performance Optimization and Indexing",content:`Performance optimization is crucial for applications that handle large amounts of data or serve many users. SQLite is fast by default, but proper optimization can make it significantly faster.

**Indexing** is the most important optimization technique:
- **Primary Keys**: Automatically indexed
- **Unique Constraints**: Automatically indexed
- **Foreign Keys**: Should be indexed for performance
- **Manual Indexes**: Created with CREATE INDEX
- **Composite Indexes**: Multiple columns in one index

**Index Types**:
- **B-Tree Indexes**: Default, good for equality and range queries
- **Full-Text Search Indexes**: For text search operations
- **Partial Indexes**: Index only certain rows
- **Expression Indexes**: Index based on expressions

**Query Optimization**:
- **EXPLAIN QUERY PLAN**: Analyze how SQLite executes queries
- **Avoid SELECT *** : Specify only needed columns
- **Use LIMIT**: For pagination and result limiting
- **Proper JOIN Order**: Put most selective conditions first
- **Avoid Functions on Indexed Columns**: Can prevent index usage

**Database Maintenance**:
- **VACUUM**: Reclaims unused space and optimizes database
- **ANALYZE**: Updates query planner statistics
- **REINDEX**: Rebuilds indexes for better performance

**Connection Optimization**:
- **Connection Pooling**: Reuse connections (important for concurrent access)
- **Prepared Statements**: Cache query execution plans
- **Batch Operations**: Group multiple operations together

Remember: The key is finding the right balance between read and write performance based on your application's needs.`,keyTopics:["Database indexing strategies","Query optimization techniques","EXPLAIN QUERY PLAN usage","Connection pooling","Database maintenance"],practicalExercises:["Analyze slow queries using EXPLAIN QUERY PLAN","Create appropriate indexes for different query patterns","Optimize database schema for better performance","Implement connection pooling for concurrent access","Perform database maintenance and optimization"],codeExamples:[{title:"Indexing and Query Optimization",code:`const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./optimized.db');

// Create optimized schema with indexes
db.serialize(() => {
  // Create tables with proper constraints
  db.run(\`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      email TEXT UNIQUE NOT NULL,
      username TEXT UNIQUE NOT NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      last_login DATETIME,
      status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended'))
    )
  \`);

  db.run(\`
    CREATE TABLE IF NOT EXISTS posts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER NOT NULL,
      title TEXT NOT NULL,
      content TEXT,
      category TEXT,
      tags TEXT, -- JSON array of tags
      published BOOLEAN DEFAULT 0,
      view_count INTEGER DEFAULT 0,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (user_id) REFERENCES users (id)
    )
  \`);

  // Create indexes for better performance
  db.run('CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)');
  db.run('CREATE INDEX IF NOT EXISTS idx_users_status ON users(status)');
  db.run('CREATE INDEX IF NOT EXISTS idx_users_last_login ON users(last_login)');

  db.run('CREATE INDEX IF NOT EXISTS idx_posts_user_id ON posts(user_id)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_category ON posts(category)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_published ON posts(published)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_created_at ON posts(created_at)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_view_count ON posts(view_count)');

  // Composite index for common query patterns
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_user_published ON posts(user_id, published)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_category_date ON posts(category, created_at)');

  console.log('Optimized database schema created with indexes');
});

// Optimized query functions
class OptimizedBlogQueries {
  constructor(db) {
    this.db = db;
  }

  // Optimized user lookup by email
  getUserByEmail(email, callback) {
    const sql = 'SELECT * FROM users WHERE email = ?';
    this.db.get(sql, [email], callback);
  }

  // Optimized post listing with pagination
  getPublishedPosts(page = 1, limit = 10, callback) {
    const offset = (page - 1) * limit;
    const sql = \`
      SELECT
        p.id, p.title, p.content, p.category, p.view_count,
        p.created_at, p.updated_at,
        u.username, u.email as author_email
      FROM posts p
      INNER JOIN users u ON p.user_id = u.id
      WHERE p.published = 1
      ORDER BY p.created_at DESC
      LIMIT ? OFFSET ?
    \`;

    this.db.all(sql, [limit, offset], callback);
  }

  // Optimized category filtering
  getPostsByCategory(category, page = 1, limit = 10, callback) {
    const offset = (page - 1) * limit;
    const sql = \`
      SELECT
        p.id, p.title, p.content, p.view_count,
        p.created_at, p.updated_at,
        u.username
      FROM posts p
      INNER JOIN users u ON p.user_id = u.id
      WHERE p.published = 1 AND p.category = ?
      ORDER BY p.created_at DESC
      LIMIT ? OFFSET ?
    \`;

    this.db.all(sql, [category, limit, offset], callback);
  }

  // Optimized search with full-text search
  searchPosts(query, callback) {
    // Create FTS virtual table for full-text search
    this.db.run(\`
      CREATE VIRTUAL TABLE IF NOT EXISTS posts_fts USING fts5(
        title, content, tags,
        content=posts,
        content_rowid=id
      )
    \`, () => {
      // Populate FTS table
      this.db.run(\`
        INSERT OR REPLACE INTO posts_fts(rowid, title, content, tags)
        SELECT id, title, content, tags FROM posts WHERE published = 1
      \`, () => {
        // Perform search
        const sql = \`
          SELECT
            p.id, p.title, p.content, p.category,
            p.created_at, u.username,
            fts.rank as search_rank
          FROM posts_fts fts
          JOIN posts p ON p.id = fts.rowid
          JOIN users u ON p.user_id = u.id
          WHERE fts MATCH ?
          ORDER BY fts.rank
          LIMIT 20
        \`;

        this.db.all(sql, [query], callback);
      });
    });
  }

  // Optimized analytics queries
  getAnalytics(callback) {
    const sql = \`
      SELECT
        COUNT(CASE WHEN published = 1 THEN 1 END) as published_posts,
        COUNT(CASE WHEN published = 0 THEN 1 END) as draft_posts,
        COUNT(DISTINCT user_id) as active_authors,
        SUM(view_count) as total_views,
        AVG(view_count) as avg_views_per_post,
        MAX(created_at) as latest_post_date
      FROM posts
    \`;

    this.db.get(sql, [], callback);
  }

  // Analyze query performance
  analyzeQuery(query, params = [], callback) {
    const explainSql = \`EXPLAIN QUERY PLAN \${query}\`;
    this.db.all(explainSql, params, (err, plan) => {
      if (err) {
        callback(err, null);
      } else {
        console.log('Query Execution Plan:');
        console.table(plan);
        callback(null, plan);
      }
    });
  }
}

// Usage example
const blogQueries = new OptimizedBlogQueries(db);

// Analyze a query's performance
blogQueries.analyzeQuery(
  'SELECT * FROM posts WHERE published = ? AND category = ? ORDER BY created_at DESC',
  [1, 'technology'],
  (err, plan) => {
    if (!err) {
      console.log('Query analysis completed');
    }
  }
);

// Get optimized results
blogQueries.getPublishedPosts(1, 5, (err, posts) => {
  if (err) {
    console.error('Error getting posts:', err.message);
  } else {
    console.log(\`Retrieved \${posts.length} posts efficiently\`);
  }
});

module.exports = OptimizedBlogQueries;`},{title:"Database Maintenance and Monitoring",code:`const sqlite3 = require('sqlite3').verbose();
const fs = require('fs').promises;
const path = require('path');

class DatabaseMaintenance {
  constructor(dbPath) {
    this.dbPath = dbPath;
    this.db = new sqlite3.Database(dbPath);
  }

  // Analyze database performance
  async analyzePerformance() {
    return new Promise((resolve, reject) => {
      const stats = {};

      // Get database file size
      fs.stat(this.dbPath)
        .then(fileStats => {
          stats.fileSize = fileStats.size;
          stats.fileSizeMB = (fileStats.size / (1024 * 1024)).toFixed(2);

          // Get table statistics
          this.db.all(\`
            SELECT
              name,
              sql
            FROM sqlite_master
            WHERE type = 'table'
          \`, [], (err, tables) => {
            if (err) {
              reject(err);
              return;
            }

            stats.tables = tables.length;
            stats.tableNames = tables.map(t => t.name);

            // Get index information
            this.db.all(\`
              SELECT
                name,
                tbl_name,
                sql
              FROM sqlite_master
              WHERE type = 'index' AND name NOT LIKE 'sqlite_%'
            \`, [], (err, indexes) => {
              if (err) {
                reject(err);
                return;
              }

              stats.indexes = indexes.length;
              stats.indexDetails = indexes;

              // Run ANALYZE to update statistics
              this.db.run('ANALYZE', (err) => {
                if (err) {
                  reject(err);
                  return;
                }

                // Get database statistics
                this.db.get(\`
                  SELECT
                    page_count,
                    page_size,
                    freelist_count,
                    auto_vacuum
                  FROM pragma_page_count(),
                       pragma_page_size(),
                       pragma_freelist_count(),
                       pragma_auto_vacuum()
                \`, [], (err, pragmaStats) => {
                  if (err) {
                    reject(err);
                    return;
                  }

                  stats.databaseStats = pragmaStats;
                  stats.totalPages = pragmaStats.page_count;
                  stats.pageSize = pragmaStats.page_size;
                  stats.databaseSize = pragmaStats.page_count * pragmaStats.page_size;
                  stats.databaseSizeMB = ((pragmaStats.page_count * pragmaStats.page_size) / (1024 * 1024)).toFixed(2);
                  stats.freePages = pragmaStats.freelist_count;
                  stats.autoVacuum = pragmaStats.auto_vacuum;

                  resolve(stats);
                });
              });
            });
          });
        })
        .catch(reject);
    });
  }

  // Optimize database with VACUUM
  async vacuumDatabase() {
    return new Promise((resolve, reject) => {
      console.log('Starting VACUUM operation...');

      const startTime = Date.now();

      this.db.run('VACUUM', (err) => {
        if (err) {
          reject(err);
          return;
        }

        const duration = Date.now() - startTime;
        console.log(\`VACUUM completed in \${duration}ms\`);

        resolve({ duration, success: true });
      });
    });
  }

  // Rebuild indexes
  async reindexDatabase() {
    return new Promise((resolve, reject) => {
      console.log('Starting REINDEX operation...');

      this.db.run('REINDEX', (err) => {
        if (err) {
          reject(err);
          return;
        }

        console.log('REINDEX completed');
        resolve({ success: true });
      });
    });
  }

  // Create backup
  async createBackup(backupPath) {
    return new Promise((resolve, reject) => {
      const backupDb = new sqlite3.Database(backupPath);

      // Attach backup database
      this.db.run(\`ATTACH DATABASE '\${backupPath}' AS backup\`, (err) => {
        if (err) {
          reject(err);
          return;
        }

        // Copy all tables
        this.db.run(\`
          SELECT sql FROM sqlite_master
          WHERE type = 'table' AND name NOT LIKE 'sqlite_%'
        \`, [], (err, tables) => {
          if (err) {
            reject(err);
            return;
          }

          // For each table, copy data to backup
          const copyOperations = tables.map(table => {
            return new Promise((resolve, reject) => {
              this.db.run(\`
                INSERT INTO backup.\${table.name} SELECT * FROM main.\${table.name}
              \`, (err) => {
                if (err) {
                  reject(err);
                } else {
                  resolve();
                }
              });
            });
          });

          Promise.all(copyOperations)
            .then(() => {
              // Detach backup database
              this.db.run('DETACH DATABASE backup', (err) => {
                if (err) {
                  reject(err);
                } else {
                  backupDb.close();
                  resolve({ success: true, backupPath });
                }
              });
            })
            .catch(reject);
        });
      });
    });
  }

  // Monitor database performance
  async monitorPerformance(intervalMs = 60000) {
    console.log('Starting database performance monitoring...');

    const monitor = async () => {
      try {
        const stats = await this.analyzePerformance();

        console.log('Performance Stats:');
        console.log(\`- Database Size: \${stats.databaseSizeMB} MB\`);
        console.log(\`- Tables: \${stats.tables}\`);
        console.log(\`- Indexes: \${stats.indexes}\`);
        console.log(\`- Free Pages: \${stats.freePages}\`);

        // Check if optimization is needed
        const fragmentationRatio = stats.freePages / stats.totalPages;
        if (fragmentationRatio > 0.2) {
          console.log('⚠️  High fragmentation detected. Consider running VACUUM.');
        }

      } catch (error) {
        console.error('Monitoring error:', error.message);
      }
    };

    // Initial monitoring
    await monitor();

    // Set up periodic monitoring
    return setInterval(monitor, intervalMs);
  }

  // Optimize database (VACUUM + REINDEX)
  async optimizeDatabase() {
    console.log('Starting database optimization...');

    try {
      await this.vacuumDatabase();
      await this.reindexDatabase();

      const finalStats = await this.analyzePerformance();

      console.log('Database optimization completed!');
      console.log(\`Final size: \${finalStats.databaseSizeMB} MB\`);

      return {
        success: true,
        finalSize: finalStats.databaseSizeMB,
        optimizationTime: Date.now()
      };

    } catch (error) {
      console.error('Optimization failed:', error.message);
      throw error;
    }
  }

  close() {
    this.db.close();
  }
}

// Usage example
async function performMaintenance() {
  const maintenance = new DatabaseMaintenance('./production.db');

  try {
    // Analyze current performance
    console.log('=== Database Analysis ===');
    const stats = await maintenance.analyzePerformance();
    console.log('Current database size:', stats.databaseSizeMB, 'MB');
    console.log('Number of tables:', stats.tables);
    console.log('Number of indexes:', stats.indexes);

    // Create backup before optimization
    console.log('\\n=== Creating Backup ===');
    const backupPath = './backup_' + Date.now() + '.db';
    await maintenance.createBackup(backupPath);
    console.log('Backup created:', backupPath);

    // Optimize database
    console.log('\\n=== Optimizing Database ===');
    const optimizationResult = await maintenance.optimizeDatabase();
    console.log('Optimization completed successfully!');

    // Start monitoring
    console.log('\\n=== Starting Performance Monitoring ===');
    const monitorId = maintenance.monitorPerformance(300000); // Every 5 minutes

    // Stop monitoring after some time (for demo)
    setTimeout(() => {
      clearInterval(monitorId);
      console.log('Monitoring stopped');
      maintenance.close();
    }, 10000);

  } catch (error) {
    console.error('Maintenance failed:', error.message);
    maintenance.close();
  }
}

// Run maintenance if called directly
if (require.main === module) {
  performMaintenance();
}

module.exports = DatabaseMaintenance;`}]}],projects:[{title:"Personal Finance Tracker",description:"Build a comprehensive personal finance application with SQLite database for tracking income, expenses, budgets, and financial goals with advanced reporting."},{title:"Task Management System",description:"Create a full-featured task management application with user authentication, project management, task assignment, time tracking, and progress reporting."},{title:"E-commerce Platform",description:"Develop a complete e-commerce backend with product catalog, shopping cart, order management, user accounts, and payment processing integration."},{title:"Content Management System",description:"Build a flexible CMS with user roles, content creation and editing, media management, SEO optimization, and multi-user collaboration features."},{title:"Analytics Dashboard",description:"Create a business intelligence dashboard with data visualization, custom reports, real-time metrics, and automated alert systems."}],assessments:[{type:"quiz",questions:[{question:"What does ACID stand for in database transactions?",options:["Atomicity, Consistency, Isolation, Durability","Automatic, Consistent, Isolated, Durable","Atomic, Consistent, Independent, Durable","Automatic, Consistent, Isolated, Distributed"],correctAnswer:"Atomicity, Consistency, Isolation, Durability"},{question:"Which SQLite command is used to start a transaction?",options:["START TRANSACTION","BEGIN TRANSACTION","INIT TRANSACTION","OPEN TRANSACTION"],correctAnswer:"BEGIN TRANSACTION"},{question:"What is the purpose of a foreign key in SQLite?",options:["To encrypt data in the database","To create relationships between tables","To automatically generate primary keys","To compress data storage"],correctAnswer:"To create relationships between tables"},{question:"Which command is used to analyze query performance in SQLite?",options:["ANALYZE QUERY","EXPLAIN PLAN","EXPLAIN QUERY PLAN","SHOW PLAN"],correctAnswer:"EXPLAIN QUERY PLAN"},{question:"What is the main benefit of using parameterized queries in SQLite?",options:["Faster execution","Prevention of SQL injection attacks","Automatic indexing","Better compression"],correctAnswer:"Prevention of SQL injection attacks"}]},{type:"evaluation",questions:[{question:"Design a database schema for a library management system including books, authors, borrowers, and loan records. Explain your normalization choices and indexing strategy.",options:[],correctAnswer:""},{question:"Explain the differences between INNER JOIN, LEFT JOIN, and FULL OUTER JOIN with practical examples of when to use each.",options:[],correctAnswer:""},{question:"Describe how you would optimize a slow-running query in SQLite. Include specific techniques for analysis and improvement.",options:[],correctAnswer:""}]}],aiPrompts:["How do I design a normalized database schema in SQLite?","What's the best way to handle database transactions in Node.js?","How do I optimize slow SQLite queries?","Explain the difference between different JOIN types in SQL","How do I implement database migrations in SQLite?","What's the best way to handle concurrent database access?","How do I create effective indexes for my SQLite database?","Explain SQLite data types and their usage","How do I implement full-text search in SQLite?","What's the best way to backup and restore SQLite databases?"],resources:[{name:"SQLite Official Documentation",url:"https://www.sqlite.org/docs.html"},{name:"SQLite Node.js Package",url:"https://github.com/mapbox/node-sqlite3"},{name:"SQLite Browser",url:"https://sqlitebrowser.org/"},{name:"Database Design Principles",url:"https://en.wikipedia.org/wiki/Database_normalization"},{name:"SQL Tutorial",url:"https://www.w3schools.com/sql/"},{name:"SQLite Performance Tuning",url:"https://www.sqlite.org/optimization.html"},{name:"Node.js Database Best Practices",url:"https://nodejs.org/en/docs/guides/anatomy-of-an-http-transaction/"},{name:"Database Transaction Guide",url:"https://en.wikipedia.org/wiki/Database_transaction"}],toolsRequired:["Node.js (latest LTS version)","npm or yarn package manager","SQLite3 package for Node.js","Database browser (DB Browser for SQLite)","Command line interface","Text editor or IDE","Git for version control","Performance monitoring tools"],bestPractices:["Always use parameterized queries to prevent SQL injection","Implement proper error handling for all database operations","Use transactions for operations that modify multiple tables","Create appropriate indexes for frequently queried columns","Normalize your database schema to reduce data redundancy","Use foreign keys to maintain referential integrity","Implement connection pooling for better performance","Regularly backup your database and test restore procedures","Use EXPLAIN QUERY PLAN to analyze and optimize slow queries","Keep database connections open for as short as possible","Use appropriate data types to optimize storage and performance","Implement proper logging for database operations","Use prepared statements for repeated queries","Monitor database performance and optimize when necessary","Test your database operations thoroughly before production deployment"],commonPitfalls:["Not using transactions for multi-table operations","Forgetting to handle database connection errors","Using string concatenation instead of parameterized queries","Not creating indexes on frequently queried columns","Storing sensitive information without proper encryption","Not closing database connections properly","Using SELECT * in production code","Not handling database locks and concurrency issues","Forgetting to validate data before inserting into database","Not implementing proper backup and recovery procedures","Using SQLite for high-concurrency applications without proper design","Not monitoring database performance and growth","Using inappropriate data types for stored values","Not implementing proper error handling for database operations","Forgetting to update indexes when schema changes"],careerRelevance:"SQLite proficiency is highly valued in the software development industry, particularly for applications requiring lightweight, reliable data storage. Developers skilled in SQLite can work on mobile applications, desktop software, embedded systems, and web applications. The database's simplicity combined with powerful features makes it ideal for startups and small to medium-sized projects. Understanding SQLite fundamentals translates well to other database systems and demonstrates knowledge of data persistence, query optimization, and database design principles. With the growing demand for efficient data management solutions, SQLite expertise opens doors to roles in backend development, data engineering, and full-stack development positions across various industries."},AM={id:"rest-apis",tier:2,name:"REST APIs",description:"REST (Representational State Transfer) APIs are the foundation of modern web services. Learn to design, build, and consume RESTful APIs with proper HTTP methods, status codes, authentication, and best practices for scalable web services.",difficulty:"intermediate",estimatedHours:25,prerequisites:["nodejs","expressjs","json"],learningObjectives:["Understand REST architectural principles and constraints","Master HTTP methods (GET, POST, PUT, DELETE, PATCH)","Design RESTful API endpoints with proper resource naming","Implement HTTP status codes and error handling","Work with request/response formats (JSON, XML, form data)","Handle authentication and authorization in APIs","Implement API versioning strategies","Use API documentation tools and standards","Optimize API performance with caching and pagination","Secure APIs with rate limiting and input validation","Test APIs with proper testing frameworks","Handle CORS and cross-origin requests","Implement API monitoring and logging","Work with API clients and SDKs","Design scalable and maintainable API architectures"],sections:[{id:"rest-introduction",title:"Introduction to REST APIs",content:`REST (Representational State Transfer) is an architectural style for designing networked applications. It was first introduced by Roy Fielding in his doctoral dissertation in 2000 and has since become the standard for web APIs.

**What makes an API RESTful?**
REST APIs follow six key constraints:
- **Client-Server Architecture**: Clear separation between client and server
- **Stateless**: Each request contains all information needed to process it
- **Cacheable**: Responses can be cached to improve performance
- **Uniform Interface**: Consistent way to interact with resources
- **Layered System**: Architecture can be composed of layers
- **Code on Demand** (optional): Server can send executable code

**Core Principles**:
- **Resources**: Everything is a resource (users, posts, products)
- **HTTP Methods**: Use standard HTTP methods for operations
- **Stateless Communication**: No client state stored on server
- **Uniform Resource Identifiers**: Each resource has a unique URL

REST APIs are:
- **Scalable**: Easy to scale horizontally
- **Simple**: Uses standard HTTP protocols
- **Flexible**: Can work with any data format
- **Cacheable**: Built-in caching support
- **Independent**: Client and server can evolve separately`,keyTopics:["What is REST?","REST architectural constraints","HTTP methods and their purposes","Resource identification and URIs","Stateless communication"],practicalExercises:["Analyze popular APIs (GitHub, Twitter, Stripe) for REST compliance","Design resource URIs for a blog application","Map CRUD operations to HTTP methods","Create API documentation for a simple service","Test API endpoints using different HTTP clients"],codeExamples:[{title:"Basic REST API Structure",code:`const express = require('express');
const app = express();

// Middleware for parsing JSON
app.use(express.json());

// Sample data store
let users = [
  { id: 1, name: 'John Doe', email: 'john@example.com' },
  { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
];

// GET /users - Retrieve all users
app.get('/users', (req, res) => {
  res.json({
    success: true,
    data: users,
    count: users.length
  });
});

// GET /users/:id - Retrieve single user
app.get('/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));

  if (!user) {
    return res.status(404).json({
      success: false,
      error: 'User not found'
    });
  }

  res.json({
    success: true,
    data: user
  });
});

// POST /users - Create new user
app.post('/users', (req, res) => {
  const { name, email } = req.body;

  // Basic validation
  if (!name || !email) {
    return res.status(400).json({
      success: false,
      error: 'Name and email are required'
    });
  }

  const newUser = {
    id: users.length + 1,
    name,
    email
  };

  users.push(newUser);

  res.status(201).json({
    success: true,
    data: newUser
  });
});

// PUT /users/:id - Update user
app.put('/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));

  if (!user) {
    return res.status(404).json({
      success: false,
      error: 'User not found'
    });
  }

  const { name, email } = req.body;
  user.name = name || user.name;
  user.email = email || user.email;

  res.json({
    success: true,
    data: user
  });
});

// DELETE /users/:id - Delete user
app.delete('/users/:id', (req, res) => {
  const userIndex = users.findIndex(u => u.id === parseInt(req.params.id));

  if (userIndex === -1) {
    return res.status(404).json({
      success: false,
      error: 'User not found'
    });
  }

  users.splice(userIndex, 1);

  res.json({
    success: true,
    message: 'User deleted successfully'
  });
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(\`REST API server running on port \${PORT}\`);
});`},{title:"HTTP Status Codes Reference",code:`// HTTP Status Code Categories:
//
// 1xx - Informational responses
// 2xx - Successful responses
// 3xx - Redirection messages
// 4xx - Client error responses
// 5xx - Server error responses

const statusCodes = {
  // 2xx Success
  200: { code: 200, message: 'OK', description: 'Request succeeded' },
  201: { code: 201, message: 'Created', description: 'Resource created successfully' },
  202: { code: 202, message: 'Accepted', description: 'Request accepted for processing' },
  204: { code: 204, message: 'No Content', description: 'Request succeeded, no content returned' },

  // 3xx Redirection
  301: { code: 301, message: 'Moved Permanently', description: 'Resource moved permanently' },
  302: { code: 302, message: 'Found', description: 'Resource found at different location' },
  304: { code: 304, message: 'Not Modified', description: 'Resource not modified since last request' },

  // 4xx Client Errors
  400: { code: 400, message: 'Bad Request', description: 'Invalid request syntax' },
  401: { code: 401, message: 'Unauthorized', description: 'Authentication required' },
  403: { code: 403, message: 'Forbidden', description: 'Access denied' },
  404: { code: 404, message: 'Not Found', description: 'Resource not found' },
  405: { code: 405, message: 'Method Not Allowed', description: 'HTTP method not allowed' },
  409: { code: 409, message: 'Conflict', description: 'Request conflicts with current state' },
  422: { code: 422, message: 'Unprocessable Entity', description: 'Validation failed' },
  429: { code: 429, message: 'Too Many Requests', description: 'Rate limit exceeded' },

  // 5xx Server Errors
  500: { code: 500, message: 'Internal Server Error', description: 'Unexpected server error' },
  502: { code: 502, message: 'Bad Gateway', description: 'Invalid response from upstream server' },
  503: { code: 503, message: 'Service Unavailable', description: 'Server temporarily unavailable' },
  504: { code: 504, message: 'Gateway Timeout', description: 'Upstream server timeout' }
};

// Helper function to send standardized responses
function sendResponse(res, statusCode, data = null, message = null) {
  const status = statusCodes[statusCode];

  if (!status) {
    return res.status(500).json({
      success: false,
      error: 'Invalid status code'
    });
  }

  const response = {
    success: statusCode >= 200 && statusCode < 300,
    status: statusCode,
    message: message || status.message
  };

  if (data !== null) {
    response.data = data;
  }

  res.status(statusCode).json(response);
}

// Usage examples
app.get('/users/:id', (req, res) => {
  const user = findUser(req.params.id);

  if (!user) {
    return sendResponse(res, 404, null, 'User not found');
  }

  sendResponse(res, 200, user);
});

app.post('/users', (req, res) => {
  const errors = validateUser(req.body);

  if (errors.length > 0) {
    return sendResponse(res, 422, { errors }, 'Validation failed');
  }

  const user = createUser(req.body);
  sendResponse(res, 201, user, 'User created successfully');
});

module.exports = { statusCodes, sendResponse };`}]},{id:"api-design",title:"API Design and Architecture",content:"Good API design is crucial for creating maintainable, scalable, and user-friendly web services. A well-designed API is intuitive, consistent, and follows established conventions.\n\n**Resource Naming Conventions**:\n- Use nouns, not verbs: `/users`, `/products`, not `/getUsers`, `/createProduct`\n- Use plural nouns: `/users` instead of `/user`\n- Use lowercase and hyphens: `/user-profiles` instead of `/userProfiles`\n- Be consistent: If you use `/users/:id/posts`, don't use `/articles/:id/comments`\n\n**HTTP Method Usage**:\n- **GET**: Retrieve resources (safe, idempotent, cacheable)\n- **POST**: Create new resources (not idempotent)\n- **PUT**: Update entire resource (idempotent)\n- **PATCH**: Partial resource update (not idempotent)\n- **DELETE**: Remove resource (idempotent)\n\n**Query Parameters**:\n- **Filtering**: `/users?status=active&department=engineering`\n- **Sorting**: `/users?sort=name&order=asc`\n- **Pagination**: `/users?page=2&limit=10`\n- **Searching**: `/users?q=john&fields=name,email`\n\n**API Versioning**:\n- **URL versioning**: `/v1/users`, `/v2/users`\n- **Header versioning**: `Accept: application/vnd.api.v1+json`\n- **Query parameter**: `/users?version=1`\n- **Content negotiation**: Based on Accept header\n\n**Response Formats**:\n- **JSON**: Most common, lightweight, human-readable\n- **XML**: Legacy systems, verbose but structured\n- **HAL/JSON**: Hypermedia links in JSON responses\n- **JSON:API**: Standardized JSON response format",keyTopics:["RESTful resource naming","HTTP method best practices","API versioning strategies","Query parameter design","Response format standards"],practicalExercises:["Design API endpoints for an e-commerce platform","Implement proper HTTP status codes for different scenarios","Create API documentation following OpenAPI standards","Design pagination and filtering for large datasets","Implement API versioning for backward compatibility"],codeExamples:[{title:"Well-Designed REST API Structure",code:`const express = require('express');
const router = express.Router();

// User routes with proper REST design
// GET /api/v1/users - List all users
router.get('/users', (req, res) => {
  const { page = 1, limit = 10, sort = 'created_at', order = 'desc', q } = req.query;

  // Build query with filters
  let query = {};
  if (q) {
    query = {
      $or: [
        { name: new RegExp(q, 'i') },
        { email: new RegExp(q, 'i') }
      ]
    };
  }

  // Calculate pagination
  const skip = (page - 1) * limit;

  User.find(query)
    .sort({ [sort]: order === 'desc' ? -1 : 1 })
    .limit(limit)
    .skip(skip)
    .then(users => {
      User.countDocuments(query).then(total => {
        res.json({
          success: true,
          data: users,
          pagination: {
            page: parseInt(page),
            limit: parseInt(limit),
            total,
            pages: Math.ceil(total / limit)
          }
        });
      });
    })
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

// GET /api/v1/users/:id - Get single user
router.get('/users/:id', (req, res) => {
  User.findById(req.params.id)
    .then(user => {
      if (!user) {
        return res.status(404).json({ success: false, error: 'User not found' });
      }
      res.json({ success: true, data: user });
    })
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

// POST /api/v1/users - Create user
router.post('/users', (req, res) => {
  const { name, email, password } = req.body;

  // Validation
  if (!name || !email || !password) {
    return res.status(400).json({
      success: false,
      error: 'Name, email, and password are required'
    });
  }

  // Check if user exists
  User.findOne({ email })
    .then(existingUser => {
      if (existingUser) {
        return res.status(409).json({
          success: false,
          error: 'User with this email already exists'
        });
      }

      // Create new user
      const user = new User({ name, email, password: hashPassword(password) });
      return user.save();
    })
    .then(user => {
      // Don't return password in response
      const userResponse = user.toObject();
      delete userResponse.password;

      res.status(201).json({
        success: true,
        data: userResponse,
        message: 'User created successfully'
      });
    })
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

// PUT /api/v1/users/:id - Update entire user
router.put('/users/:id', (req, res) => {
  const { name, email } = req.body;

  User.findByIdAndUpdate(
    req.params.id,
    { name, email, updated_at: new Date() },
    { new: true, runValidators: true }
  )
    .then(user => {
      if (!user) {
        return res.status(404).json({ success: false, error: 'User not found' });
      }
      res.json({ success: true, data: user });
    })
    .catch(err => {
      if (err.name === 'ValidationError') {
        res.status(422).json({ success: false, error: err.message });
      } else {
        res.status(500).json({ success: false, error: err.message });
      }
    });
});

// PATCH /api/v1/users/:id - Partial update
router.patch('/users/:id', (req, res) => {
  const updates = req.body;
  updates.updated_at = new Date();

  User.findByIdAndUpdate(req.params.id, updates, { new: true, runValidators: true })
    .then(user => {
      if (!user) {
        return res.status(404).json({ success: false, error: 'User not found' });
      }
      res.json({ success: true, data: user });
    })
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

// DELETE /api/v1/users/:id - Delete user
router.delete('/users/:id', (req, res) => {
  User.findByIdAndDelete(req.params.id)
    .then(user => {
      if (!user) {
        return res.status(404).json({ success: false, error: 'User not found' });
      }
      res.json({ success: true, message: 'User deleted successfully' });
    })
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

// Nested resources: GET /api/v1/users/:id/posts
router.get('/users/:id/posts', (req, res) => {
  const { page = 1, limit = 10 } = req.query;

  Post.find({ author: req.params.id })
    .populate('author', 'name email')
    .sort({ created_at: -1 })
    .limit(limit)
    .skip((page - 1) * limit)
    .then(posts => res.json({ success: true, data: posts }))
    .catch(err => res.status(500).json({ success: false, error: err.message }));
});

module.exports = router;`},{title:"API Versioning and Content Negotiation",code:`const express = require('express');
const router = express.Router();

// API Versioning middleware
const apiVersioning = (req, res, next) => {
  // Support multiple versioning strategies

  // 1. URL versioning (e.g., /v1/users, /v2/users)
  const urlVersion = req.path.match(/^/v(d+)//);
  if (urlVersion) {
    req.apiVersion = parseInt(urlVersion[1]);
  }

  // 2. Accept header versioning (e.g., application/vnd.api.v2+json)
  const acceptVersion = req.headers.accept?.match(/vnd.api.v(d+)/);
  if (acceptVersion) {
    req.apiVersion = parseInt(acceptVersion[1]);
  }

  // 3. Query parameter versioning (e.g., ?version=2)
  if (req.query.version) {
    req.apiVersion = parseInt(req.query.version);
  }

  // Default to version 1
  req.apiVersion = req.apiVersion || 1;

  next();
};

// Content negotiation middleware
const contentNegotiation = (req, res, next) => {
  const accept = req.headers.accept || 'application/json';

  if (accept.includes('application/xml')) {
    req.responseFormat = 'xml';
  } else if (accept.includes('application/vnd.api+json')) {
    req.responseFormat = 'json-api';
  } else {
    req.responseFormat = 'json';
  }

  next();
};

// Apply middleware
router.use(apiVersioning);
router.use(contentNegotiation);

// Version-specific response formatters
const formatters = {
  json: (data) => JSON.stringify(data),

  xml: (data) => {
    const toXML = (obj, rootName = 'response') => {
      let xml = \`<\${rootName}>\`;
      for (const [key, value] of Object.entries(obj)) {
        if (Array.isArray(value)) {
          xml += \`<\${key}>\${value.map(item =>
            typeof item === 'object' ? toXML(item, 'item') : \`<\${key}>\${item}</\${key}>\`
          ).join('')}</\${key}>\`;
        } else if (typeof value === 'object' && value !== null) {
          xml += toXML(value, key);
        } else {
          xml += \`<\${key}>\${value}</\${key}>\`;
        }
      }
      xml += \`</\${rootName}>\`;
      return xml;
    };
    return toXML(data);
  },

  'json-api': (data) => JSON.stringify({
    data: Array.isArray(data) ? data.map(item => ({ type: 'user', id: item.id, attributes: item })) : { type: 'user', id: data.id, attributes: data }
  })
};

// Version 1 API
const v1Routes = express.Router();

v1Routes.get('/users', (req, res) => {
  // V1 response format
  const users = [
    { id: 1, name: 'John Doe', email: 'john@example.com' },
    { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
  ];

  const response = { success: true, data: users, version: 1 };
  const formatted = formatters[req.responseFormat](response);

  res.set('Content-Type', req.responseFormat === 'xml' ? 'application/xml' : 'application/json');
  res.send(formatted);
});

v1Routes.get('/users/:id', (req, res) => {
  const user = { id: req.params.id, name: 'John Doe', email: 'john@example.com' };
  const response = { success: true, data: user, version: 1 };
  const formatted = formatters[req.responseFormat](response);

  res.set('Content-Type', req.responseFormat === 'xml' ? 'application/xml' : 'application/json');
  res.send(formatted);
});

// Version 2 API with enhanced features
const v2Routes = express.Router();

v2Routes.get('/users', (req, res) => {
  // V2 includes additional fields and features
  const users = [
    {
      id: 1,
      name: 'John Doe',
      email: 'john@example.com',
      avatar: 'https://example.com/avatar1.jpg',
      role: 'admin',
      last_login: '2023-12-01T10:30:00Z',
      preferences: { theme: 'dark', notifications: true }
    },
    {
      id: 2,
      name: 'Jane Smith',
      email: 'jane@example.com',
      avatar: 'https://example.com/avatar2.jpg',
      role: 'user',
      last_login: '2023-11-28T15:45:00Z',
      preferences: { theme: 'light', notifications: false }
    }
  ];

  const response = {
    success: true,
    data: users,
    version: 2,
    meta: {
      count: users.length,
      timestamp: new Date().toISOString()
    }
  };

  const formatted = formatters[req.responseFormat](response);

  res.set('Content-Type', req.responseFormat === 'xml' ? 'application/xml' : 'application/json');
  res.set('X-API-Version', '2');
  res.send(formatted);
});

// Mount versioned routes
router.use('/v1', v1Routes);
router.use('/v2', v2Routes);

// Default route redirects to latest version
router.get('/users', (req, res) => {
  res.redirect('/v2/users');
});

module.exports = router;`}]},{id:"api-authentication",title:"API Authentication and Security",content:`API security is paramount in today's interconnected world. Without proper authentication and authorization, your API becomes vulnerable to attacks and data breaches.

**Authentication Methods**:
- **Basic Authentication**: Username/password encoded in base64
- **API Keys**: Simple token-based authentication
- **JWT (JSON Web Tokens)**: Stateless token-based authentication
- **OAuth 2.0**: Industry-standard authorization framework
- **Session-based**: Traditional server-side sessions

**JWT Structure**:
- **Header**: Algorithm and token type
- **Payload**: User data and claims
- **Signature**: Ensures token integrity

**Security Best Practices**:
- **Use HTTPS**: Encrypt all API communications
- **Validate Input**: Sanitize and validate all user input
- **Rate Limiting**: Prevent abuse with request limits
- **CORS**: Control cross-origin resource sharing
- **API Keys**: Use strong, unique keys for each client
- **Token Expiration**: Implement proper token lifecycle
- **Audit Logging**: Log all API access and errors

**Common Security Threats**:
- **Injection Attacks**: SQL injection, NoSQL injection
- **Cross-Site Scripting (XSS)**: Malicious script injection
- **Cross-Site Request Forgery (CSRF)**: Unauthorized state changes
- **Man-in-the-Middle**: Intercepting communications
- **Brute Force**: Automated password guessing
- **DDoS**: Overwhelming the server with requests`,keyTopics:["Authentication methods (JWT, OAuth, API keys)","Authorization and access control","Input validation and sanitization","Rate limiting and throttling","CORS configuration"],practicalExercises:["Implement JWT authentication for a REST API","Create role-based access control (RBAC)","Set up API rate limiting and throttling","Implement input validation middleware","Configure CORS for cross-origin requests"],codeExamples:[{title:"JWT Authentication Implementation",code:`const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');
const rateLimit = require('express-rate-limit');

const app = express();
app.use(express.json());

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // limit each IP to 100 requests per windowMs
  message: 'Too many requests from this IP, please try again later.'
});

app.use('/api/', limiter);

// JWT configuration
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';
const JWT_EXPIRE = '24h';

// In-memory user store (use database in production)
const users = [
  {
    id: 1,
    email: 'admin@example.com',
    password: '$2a$10$hashedpassword', // bcrypt hash of 'password'
    role: 'admin'
  }
];

// Authentication middleware
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

  if (!token) {
    return res.status(401).json({ success: false, error: 'Access token required' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ success: false, error: 'Invalid or expired token' });
    }
    req.user = user;
    next();
  });
};

// Role-based authorization middleware
const authorizeRoles = (...roles) => {
  return (req, res, next) => {
    if (!req.user) {
      return res.status(401).json({ success: false, error: 'Authentication required' });
    }

    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ success: false, error: 'Insufficient permissions' });
    }

    next();
  };
};

// Input validation middleware
const validateUserInput = (req, res, next) => {
  const { email, password } = req.body;

  if (!email || !password) {
    return res.status(400).json({
      success: false,
      error: 'Email and password are required'
    });
  }

  // Email validation
  const emailRegex = /^[^s@]+@[^s@]+.[^s@]+$/;
  if (!emailRegex.test(email)) {
    return res.status(400).json({
      success: false,
      error: 'Invalid email format'
    });
  }

  // Password strength validation
  if (password.length < 6) {
    return res.status(400).json({
      success: false,
      error: 'Password must be at least 6 characters long'
    });
  }

  next();
};

// Login route
app.post('/api/auth/login', validateUserInput, async (req, res) => {
  try {
    const { email, password } = req.body;

    // Find user
    const user = users.find(u => u.email === email);
    if (!user) {
      return res.status(401).json({
        success: false,
        error: 'Invalid credentials'
      });
    }

    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.password);
    if (!isValidPassword) {
      return res.status(401).json({
        success: false,
        error: 'Invalid credentials'
      });
    }

    // Generate JWT token
    const token = jwt.sign(
      {
        id: user.id,
        email: user.email,
        role: user.role
      },
      JWT_SECRET,
      { expiresIn: JWT_EXPIRE }
    );

    res.json({
      success: true,
      data: {
        token,
        user: {
          id: user.id,
          email: user.email,
          role: user.role
        }
      }
    });

  } catch (error) {
    res.status(500).json({ success: false, error: 'Login failed' });
  }
});

// Register route
app.post('/api/auth/register', validateUserInput, async (req, res) => {
  try {
    const { email, password } = req.body;

    // Check if user exists
    const existingUser = users.find(u => u.email === email);
    if (existingUser) {
      return res.status(409).json({
        success: false,
        error: 'User already exists'
      });
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password, 10);

    // Create user
    const newUser = {
      id: users.length + 1,
      email,
      password: hashedPassword,
      role: 'user'
    };

    users.push(newUser);

    // Generate token
    const token = jwt.sign(
      {
        id: newUser.id,
        email: newUser.email,
        role: newUser.role
      },
      JWT_SECRET,
      { expiresIn: JWT_EXPIRE }
    );

    res.status(201).json({
      success: true,
      data: {
        token,
        user: {
          id: newUser.id,
          email: newUser.email,
          role: newUser.role
        }
      }
    });

  } catch (error) {
    res.status(500).json({ success: false, error: 'Registration failed' });
  }
});

// Protected routes
app.get('/api/users/profile', authenticateToken, (req, res) => {
  res.json({
    success: true,
    data: {
      id: req.user.id,
      email: req.user.email,
      role: req.user.role
    }
  });
});

// Admin-only route
app.get('/api/admin/users', authenticateToken, authorizeRoles('admin'), (req, res) => {
  res.json({
    success: true,
    data: users.map(u => ({ id: u.id, email: u.email, role: u.role }))
  });
});

// Token refresh route
app.post('/api/auth/refresh', authenticateToken, (req, res) => {
  const newToken = jwt.sign(
    {
      id: req.user.id,
      email: req.user.email,
      role: req.user.role
    },
    JWT_SECRET,
    { expiresIn: JWT_EXPIRE }
  );

  res.json({
    success: true,
    data: { token: newToken }
  });
});

// Logout route (client-side token removal)
app.post('/api/auth/logout', authenticateToken, (req, res) => {
  res.json({
    success: true,
    message: 'Logged out successfully'
  });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`Secure API server running on port \${PORT}\`);
});`},{title:"API Security Middleware",code:`const express = require('express');
const helmet = require('helmet');
const cors = require('cors');
const expressRateLimit = require('express-rate-limit');
const slowDown = require('express-slow-down');
const mongoSanitize = require('express-mongo-sanitize');
const xss = require('xss-clean');
const hpp = require('hpp');

const app = express();

// Security middleware configuration
const configureSecurity = (app) => {
  // Helmet - Security headers
  app.use(helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        scriptSrc: ["'self'"],
        imgSrc: ["'self'", "data:", "https:"],
      },
    },
  }));

  // CORS configuration
  const corsOptions = {
    origin: process.env.NODE_ENV === 'production'
      ? ['https://yourdomain.com', 'https://app.yourdomain.com']
      : ['http://localhost:3000', 'http://localhost:3001'],
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'X-API-Key'],
    credentials: true,
    maxAge: 86400 // 24 hours
  };

  app.use(cors(corsOptions));

  // Rate limiting - General API rate limit
  const generalLimiter = expressRateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    message: {
      success: false,
      error: 'Too many requests from this IP, please try again later.',
      retryAfter: '15 minutes'
    },
    standardHeaders: true,
    legacyHeaders: false,
  });

  app.use('/api/', generalLimiter);

  // Stricter rate limiting for auth endpoints
  const authLimiter = expressRateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 5, // limit each IP to 5 auth attempts per windowMs
    message: {
      success: false,
      error: 'Too many authentication attempts, please try again later.',
      retryAfter: '15 minutes'
    },
    skipSuccessfulRequests: true, // Don't count successful logins
  });

  app.use('/api/auth/', authLimiter);

  // Speed limiting - Slow down after multiple requests
  const speedLimiter = slowDown({
    windowMs: 15 * 60 * 1000, // 15 minutes
    delayAfter: 50, // allow 50 requests per 15 minutes without delay
    delayMs: 500, // add 500ms of delay per request after delayAfter
  });

  app.use(speedLimiter);

  // Data sanitization
  app.use(mongoSanitize()); // Prevent NoSQL injection
  app.use(xss()); // Prevent XSS attacks

  // Prevent parameter pollution
  app.use(hpp({
    whitelist: ['sort', 'fields', 'page', 'limit'] // Allow these parameters to be duplicated
  }));

  return app;
};

// Input validation middleware
const validateInput = (schema) => {
  return (req, res, next) => {
    const { error } = schema.validate(req.body);

    if (error) {
      return res.status(400).json({
        success: false,
        error: 'Validation failed',
        details: error.details.map(detail => detail.message)
      });
    }

    next();
  };
};

// API key authentication middleware
const authenticateApiKey = (req, res, next) => {
  const apiKey = req.headers['x-api-key'] || req.query.api_key;

  if (!apiKey) {
    return res.status(401).json({
      success: false,
      error: 'API key required'
    });
  }

  // In production, validate against database
  const validApiKeys = process.env.VALID_API_KEYS?.split(',') || [];

  if (!validApiKeys.includes(apiKey)) {
    return res.status(403).json({
      success: false,
      error: 'Invalid API key'
    });
  }

  req.apiKey = apiKey;
  next();
};

// Request logging middleware
const requestLogger = (req, res, next) => {
  const start = Date.now();

  res.on('finish', () => {
    const duration = Date.now() - start;
    console.log(\`\${new Date().toISOString()} - \${req.method} \${req.originalUrl} - \${res.statusCode} - \${duration}ms\`);
  });

  next();
};

// Error handling middleware
const errorHandler = (err, req, res, next) => {
  console.error(err.stack);

  // Don't leak error details in production
  const isDevelopment = process.env.NODE_ENV === 'development';

  res.status(err.status || 500).json({
    success: false,
    error: isDevelopment ? err.message : 'Internal server error',
    ...(isDevelopment && { stack: err.stack })
  });
};

// 404 handler
const notFoundHandler = (req, res, next) => {
  res.status(404).json({
    success: false,
    error: 'API endpoint not found',
    path: req.originalUrl,
    method: req.method
  });
};

// Health check endpoint
const healthCheck = (req, res) => {
  res.json({
    success: true,
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    environment: process.env.NODE_ENV || 'development'
  });
};

// Apply security configuration
configureSecurity(app);

// Apply other middleware
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));
app.use(requestLogger);

// Health check (no auth required)
app.get('/health', healthCheck);
app.get('/api/health', healthCheck);

// Example protected route with API key
app.get('/api/protected', authenticateApiKey, (req, res) => {
  res.json({
    success: true,
    message: 'Access granted',
    apiKey: req.apiKey.substring(0, 8) + '...' // Don't expose full key
  });
});

// Apply error handlers
app.use(notFoundHandler);
app.use(errorHandler);

module.exports = app;`}]},{id:"api-performance",title:"API Performance and Optimization",content:`API performance directly impacts user experience and system scalability. Slow APIs lead to frustrated users and increased infrastructure costs. Optimizing API performance requires a multi-layered approach.

**Caching Strategies**:
- **Browser Caching**: HTTP headers for static resources
- **CDN Caching**: Global content delivery networks
- **Application Caching**: In-memory caches (Redis, Memcached)
- **Database Caching**: Query result caching
- **API Response Caching**: Cache expensive computations

**Database Optimization**:
- **Connection Pooling**: Reuse database connections
- **Query Optimization**: Use indexes, avoid N+1 queries
- **Pagination**: Limit result sets
- **Read Replicas**: Separate read and write operations
- **Database Sharding**: Distribute data across multiple servers

**Response Optimization**:
- **Compression**: Gzip/Brotli compression
- **Pagination**: Limit response size
- **Field Selection**: Allow clients to specify needed fields
- **HTTP/2**: Multiplexed connections
- **Binary Formats**: Protocol Buffers, MessagePack

**Monitoring and Metrics**:
- **Response Times**: Track API latency
- **Error Rates**: Monitor failure rates
- **Throughput**: Measure requests per second
- **Resource Usage**: CPU, memory, database connections
- **User Metrics**: Track usage patterns

**Load Balancing**:
- **Round Robin**: Distribute requests evenly
- **Least Connections**: Send to least loaded server
- **IP Hash**: Route based on client IP
- **Geographic**: Route to nearest server

**Scaling Strategies**:
- **Horizontal Scaling**: Add more servers
- **Vertical Scaling**: Upgrade server resources
- **Microservices**: Break down monolithic APIs
- **Serverless**: Auto-scaling functions`,keyTopics:["Caching strategies and implementation","Database query optimization","Response compression and optimization","Load balancing and scaling","API monitoring and metrics"],practicalExercises:["Implement Redis caching for API responses","Optimize database queries with proper indexing","Set up API response compression","Implement pagination for large datasets","Create API performance monitoring dashboard"],codeExamples:[{title:"API Caching and Performance Optimization",code:`const express = require('express');
const redis = require('redis');
const compression = require('compression');
const responseTime = require('response-time');

const app = express();

// Redis client for caching
const redisClient = redis.createClient({
  host: process.env.REDIS_HOST || 'localhost',
  port: process.env.REDIS_PORT || 6379,
  password: process.env.REDIS_PASSWORD
});

redisClient.on('error', (err) => console.error('Redis error:', err));

// Middleware setup
app.use(compression()); // Enable gzip compression
app.use(responseTime()); // Track response times

// Cache middleware
const cache = (duration) => {
  return (req, res, next) => {
    const key = \`__\${req.originalUrl}__\${JSON.stringify(req.query)}\`;

    redisClient.get(key, (err, cachedData) => {
      if (err) {
        console.error('Cache error:', err);
        return next();
      }

      if (cachedData) {
        const parsedData = JSON.parse(cachedData);
        res.set('X-Cache', 'HIT');
        return res.json(parsedData);
      }

      // Store original json method
      const originalJson = res.json;
      res.json = function(data) {
        // Cache the response
        redisClient.setex(key, duration, JSON.stringify(data));
        res.set('X-Cache', 'MISS');
        originalJson.call(this, data);
      };

      next();
    });
  };
};

// Database connection pool (simulated)
const dbPool = {
  query: (sql, params, callback) => {
    // Simulate database query with delay
    setTimeout(() => {
      const mockData = [
        { id: 1, name: 'Product A', price: 29.99 },
        { id: 2, name: 'Product B', price: 49.99 },
        { id: 3, name: 'Product C', price: 19.99 }
      ];
      callback(null, mockData);
    }, Math.random() * 100); // Random delay 0-100ms
  }
};

// Optimized product API with caching
app.get('/api/products', cache(300), async (req, res) => {
  try {
    const { page = 1, limit = 10, category, minPrice, maxPrice, sort = 'name', order = 'asc' } = req.query;

    // Build query with filters
    let query = 'SELECT * FROM products WHERE 1=1';
    const params = [];

    if (category) {
      query += ' AND category = ?';
      params.push(category);
    }

    if (minPrice) {
      query += ' AND price >= ?';
      params.push(minPrice);
    }

    if (maxPrice) {
      query += ' AND price <= ?';
      params.push(maxPrice);
    }

    // Add sorting
    const validSortFields = ['name', 'price', 'created_at'];
    const sortField = validSortFields.includes(sort) ? sort : 'name';
    const sortOrder = order.toLowerCase() === 'desc' ? 'DESC' : 'ASC';
    query += \` ORDER BY \${sortField} \${sortOrder}\`;

    // Add pagination
    const offset = (page - 1) * limit;
    query += ' LIMIT ? OFFSET ?';
    params.push(parseInt(limit), offset);

    // Execute query
    dbPool.query(query, params, (err, results) => {
      if (err) {
        return res.status(500).json({ success: false, error: 'Database error' });
      }

      // Get total count for pagination
      const countQuery = 'SELECT COUNT(*) as total FROM products WHERE 1=1';
      const countParams = params.slice(0, -2); // Remove LIMIT and OFFSET

      dbPool.query(countQuery, countParams, (err, countResult) => {
        if (err) {
          return res.status(500).json({ success: false, error: 'Database error' });
        }

        const total = countResult[0].total;
        const totalPages = Math.ceil(total / limit);

        res.json({
          success: true,
          data: results,
          pagination: {
            page: parseInt(page),
            limit: parseInt(limit),
            total,
            totalPages,
            hasNext: page < totalPages,
            hasPrev: page > 1
          },
          meta: {
            queryTime: Date.now(),
            cached: false
          }
        });
      });
    });

  } catch (error) {
    res.status(500).json({ success: false, error: 'Server error' });
  }
});

// Optimized single product endpoint
app.get('/api/products/:id', cache(600), (req, res) => {
  const productId = req.params.id;

  // Validate ID
  if (isNaN(productId)) {
    return res.status(400).json({ success: false, error: 'Invalid product ID' });
  }

  dbPool.query('SELECT * FROM products WHERE id = ?', [productId], (err, results) => {
    if (err) {
      return res.status(500).json({ success: false, error: 'Database error' });
    }

    if (results.length === 0) {
      return res.status(404).json({ success: false, error: 'Product not found' });
    }

    res.json({
      success: true,
      data: results[0]
    });
  });
});

// Search endpoint with debouncing
let searchTimeout;
app.get('/api/products/search', (req, res) => {
  const { q } = req.query;

  if (!q || q.length < 2) {
    return res.json({ success: true, data: [], message: 'Search query too short' });
  }

  // Clear previous timeout
  if (searchTimeout) {
    clearTimeout(searchTimeout);
  }

  // Debounce search requests
  searchTimeout = setTimeout(() => {
    const searchQuery = \`SELECT * FROM products WHERE name LIKE ? OR description LIKE ? LIMIT 20\`;
    const searchParam = \`%\${q}%\`;

    dbPool.query(searchQuery, [searchParam, searchParam], (err, results) => {
      if (err) {
        return res.status(500).json({ success: false, error: 'Search error' });
      }

      res.json({
        success: true,
        data: results,
        query: q
      });
    });
  }, 300); // 300ms debounce
});

// Cache management endpoints
app.post('/api/cache/clear', (req, res) => {
  redisClient.flushall((err, reply) => {
    if (err) {
      return res.status(500).json({ success: false, error: 'Cache clear failed' });
    }

    res.json({
      success: true,
      message: 'Cache cleared successfully',
      keysFlushed: reply
    });
  });
});

// Performance monitoring endpoint
app.get('/api/metrics', (req, res) => {
  // Get Redis stats
  redisClient.info((err, info) => {
    if (err) {
      return res.status(500).json({ success: false, error: 'Metrics error' });
    }

    const metrics = {
      redis: {
        connected_clients: info.match(/connected_clients:(d+)/)?.[1],
        used_memory: info.match(/used_memory:(d+)/)?.[1],
        total_connections_received: info.match(/total_connections_received:(d+)/)?.[1]
      },
      server: {
        uptime: process.uptime(),
        memory: process.memoryUsage(),
        node_version: process.version
      },
      timestamp: new Date().toISOString()
    };

    res.json({ success: true, data: metrics });
  });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`Optimized API server running on port \${PORT}\`);
});`},{title:"API Monitoring and Analytics",code:`const express = require('express');
const promClient = require('prom-client');
const winston = require('winston');
const morgan = require('morgan');

const app = express();

// Prometheus metrics setup
const register = new promClient.Registry();

// Add default metrics (CPU, memory, etc.)
promClient.collectDefaultMetrics({ register });

// Custom metrics
const httpRequestDuration = new promClient.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status_code'],
  buckets: [0.1, 0.5, 1, 2, 5, 10]
});

const httpRequestsTotal = new promClient.Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status_code']
});

const activeConnections = new promClient.Gauge({
  name: 'active_connections',
  help: 'Number of active connections'
});

register.registerMetric(httpRequestDuration);
register.registerMetric(httpRequestsTotal);
register.registerMetric(activeConnections);

// Winston logger setup
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'api-service' },
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});

// Morgan middleware for HTTP request logging
app.use(morgan('combined', {
  stream: { write: (message) => logger.info(message.trim()) }
}));

// Request tracking middleware
app.use((req, res, next) => {
  const start = process.hrtime.bigint();

  // Track active connections
  activeConnections.inc();

  res.on('finish', () => {
    const end = process.hrtime.bigint();
    const duration = Number(end - start) / 1e9; // Convert to seconds

    // Record metrics
    httpRequestDuration
      .labels(req.method, req.route?.path || req.path, res.statusCode.toString())
      .observe(duration);

    httpRequestsTotal
      .labels(req.method, req.route?.path || req.path, res.statusCode.toString())
      .inc();

    // Log slow requests
    if (duration > 1) {
      logger.warn('Slow request detected', {
        method: req.method,
        path: req.path,
        duration,
        statusCode: res.statusCode,
        userAgent: req.get('User-Agent'),
        ip: req.ip
      });
    }

    // Decrease active connections
    activeConnections.dec();
  });

  next();
});

// Error tracking middleware
app.use((err, req, res, next) => {
  logger.error('Unhandled error', {
    error: err.message,
    stack: err.stack,
    method: req.method,
    path: req.path,
    body: req.body,
    query: req.query,
    params: req.params,
    ip: req.ip
  });

  res.status(500).json({
    success: false,
    error: 'Internal server error'
  });
});

// API routes with monitoring
app.get('/api/users', (req, res) => {
  // Simulate API work
  setTimeout(() => {
    res.json({
      success: true,
      data: [
        { id: 1, name: 'John Doe' },
        { id: 2, name: 'Jane Smith' }
      ]
    });
  }, Math.random() * 500); // Random delay
});

app.post('/api/users', (req, res) => {
  const { name, email } = req.body;

  if (!name || !email) {
    logger.warn('Validation failed for user creation', {
      body: req.body,
      ip: req.ip
    });

    return res.status(400).json({
      success: false,
      error: 'Name and email are required'
    });
  }

  // Simulate user creation
  const newUser = { id: Date.now(), name, email };

  logger.info('User created successfully', {
    userId: newUser.id,
    name,
    email,
    ip: req.ip
  });

  res.status(201).json({
    success: true,
    data: newUser
  });
});

// Health check endpoint
app.get('/health', (req, res) => {
  const health = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage(),
    version: process.env.npm_package_version || '1.0.0'
  };

  // Log health check
  logger.debug('Health check requested', { ip: req.ip });

  res.json(health);
});

// Metrics endpoint for Prometheus
app.get('/metrics', async (req, res) => {
  try {
    const metrics = await register.metrics();
    res.set('Content-Type', register.contentType);
    res.end(metrics);
  } catch (error) {
    logger.error('Metrics collection failed', { error: error.message });
    res.status(500).end();
  }
});

// Analytics endpoint
app.get('/api/analytics', (req, res) => {
  // Get metrics summary
  const metrics = register.getMetricsAsJSON();

  const analytics = {
    totalRequests: 0,
    averageResponseTime: 0,
    errorRate: 0,
    topRoutes: [],
    serverHealth: {
      uptime: process.uptime(),
      memoryUsage: process.memoryUsage(),
      activeConnections: activeConnections.hashMap?.['']?.value || 0
    }
  };

  // Calculate analytics from metrics
  metrics.forEach(metric => {
    if (metric.name === 'http_requests_total') {
      metric.values.forEach(value => {
        analytics.totalRequests += value.value;
      });
    }
  });

  res.json({
    success: true,
    data: analytics,
    timestamp: new Date().toISOString()
  });
});

// Graceful shutdown
process.on('SIGTERM', () => {
  logger.info('SIGTERM received, shutting down gracefully');
  process.exit(0);
});

process.on('SIGINT', () => {
  logger.info('SIGINT received, shutting down gracefully');
  process.exit(0);
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  logger.info(\`API monitoring server running on port \${PORT}\`);
});`}]}],projects:[{title:"E-commerce API Platform",description:"Build a complete REST API for an e-commerce platform with user authentication, product management, shopping cart, order processing, and payment integration."},{title:"Social Media API",description:"Create a comprehensive social media REST API with user profiles, posts, comments, likes, following/followers, notifications, and real-time updates."},{title:"Task Management API",description:"Develop a REST API for a task management application with user authentication, project management, task assignment, time tracking, and team collaboration features."},{title:"Weather API Service",description:"Build a weather API service that aggregates data from multiple weather providers, implements caching, rate limiting, and provides both current and forecast data."},{title:"File Storage API",description:"Create a REST API for file storage and management with upload/download capabilities, file versioning, sharing permissions, and cloud storage integration."}],assessments:[{type:"quiz",questions:[{question:"Which HTTP method should be used to retrieve a resource?",options:["POST","GET","PUT","DELETE"],correctAnswer:"GET"},{question:"What does REST stand for?",options:["Representational State Transfer","Remote Execution and Storage Technology","Resource Exchange and Synchronization Tool","Rapid Endpoint Service Technology"],correctAnswer:"Representational State Transfer"},{question:"Which HTTP status code indicates a successful resource creation?",options:["200 OK","201 Created","202 Accepted","204 No Content"],correctAnswer:"201 Created"},{question:"What is the primary purpose of JWT in API authentication?",options:["To encrypt API responses","To provide stateless authentication","To compress API data","To validate API endpoints"],correctAnswer:"To provide stateless authentication"},{question:"Which header is used for API versioning in REST APIs?",options:["X-API-Version","Content-Type","Authorization","Accept"],correctAnswer:"Accept"}]},{type:"evaluation",questions:[{question:"Design a REST API for a blog application including all CRUD operations, proper HTTP status codes, and error handling. Explain your design decisions.",options:[],correctAnswer:""},{question:"Compare and contrast different API authentication methods (API keys, JWT, OAuth). When would you use each method?",options:[],correctAnswer:""},{question:"Explain how you would implement rate limiting and caching in a REST API. What tools and strategies would you use?",options:[],correctAnswer:""}]}],aiPrompts:["How do I design a RESTful API?","What's the best way to implement API authentication?","How do I handle API versioning?","What's the difference between PUT and PATCH?","How do I implement API rate limiting?","How do I document my REST API?","What's the best way to handle API errors?","How do I implement API caching?","How do I secure my REST API?","How do I test REST API endpoints?"],resources:[{name:"REST API Tutorial",url:"https://restfulapi.net/"},{name:"HTTP Status Codes",url:"https://httpstatuses.com/"},{name:"JWT.io",url:"https://jwt.io/"},{name:"OpenAPI Specification",url:"https://swagger.io/specification/"},{name:"Postman API Client",url:"https://www.postman.com/"},{name:"Insomnia REST Client",url:"https://insomnia.rest/"},{name:"Express.js Documentation",url:"https://expressjs.com/"},{name:"API Security Best Practices",url:"https://owasp.org/www-project-api-security/"}],toolsRequired:["Node.js (latest LTS version)","Express.js framework","Postman or Insomnia for testing","JWT library for authentication","Database (MongoDB, PostgreSQL, or SQLite)","Redis for caching (optional)","API documentation tools (Swagger/OpenAPI)","Testing frameworks (Jest, Supertest)","Security tools (Helmet, CORS)","Monitoring tools (Prometheus, Winston)"],bestPractices:["Use proper HTTP methods for CRUD operations","Implement consistent resource naming conventions","Use appropriate HTTP status codes for responses","Implement proper error handling and validation","Use authentication and authorization for protected endpoints","Implement rate limiting to prevent abuse","Use HTTPS for all API communications","Implement proper API versioning strategy","Document your API with OpenAPI/Swagger","Use pagination for large result sets","Implement caching for better performance","Use compression for response data","Validate all input data","Log API requests and errors","Implement proper CORS configuration","Use environment variables for configuration","Test your API endpoints thoroughly","Monitor API performance and usage","Implement graceful error handling","Use consistent response formats"],commonPitfalls:["Using wrong HTTP methods for operations","Not implementing proper authentication","Exposing sensitive data in responses","Not handling errors properly","Missing input validation","Not implementing rate limiting","Using HTTP instead of HTTPS","Breaking changes without versioning","Poor API documentation","Not implementing pagination","Missing caching strategies","Not compressing responses","Inconsistent response formats","Not logging API activity","Improper CORS configuration","Hardcoding configuration values","Inadequate testing","Not monitoring API health","Poor error messages","Inconsistent naming conventions"],careerRelevance:"REST API development is one of the most in-demand skills in modern software development. Almost every web and mobile application requires API integration, making REST API expertise highly valuable. Developers proficient in REST APIs can work as backend developers, API developers, full-stack developers, and integration specialists. The skills translate well across different programming languages and frameworks. With the rise of microservices architecture and API-first development, REST API knowledge is essential for modern development teams. Companies across all industries need developers who can design, build, and maintain scalable APIs that power their digital products and services."},IM={id:"responsive-design",tier:2,name:"Responsive Design",description:"Responsive Design is the practice of creating websites that adapt to different screen sizes and devices. Learn modern CSS techniques including media queries, flexible layouts, and mobile-first design principles to build websites that work beautifully on any device.",difficulty:"intermediate",estimatedHours:18,prerequisites:["html5","css3"],learningObjectives:["Understand responsive design principles and mobile-first approach","Master CSS media queries for different screen sizes","Work with flexible layouts using Flexbox and CSS Grid","Implement responsive typography and spacing","Create responsive images and media","Design mobile navigation patterns","Use CSS frameworks for rapid responsive development","Test and debug responsive designs across devices","Optimize performance for mobile devices","Implement accessibility in responsive designs","Use modern CSS features for responsive layouts","Create responsive data tables and forms","Handle touch interactions and gestures","Implement progressive enhancement strategies","Use CSS custom properties for responsive theming"],sections:[{id:"responsive-introduction",title:"Introduction to Responsive Design",content:`Responsive design is the foundation of modern web development. With the proliferation of devices - from large desktop monitors to small mobile phones - websites must adapt to provide optimal user experiences across all screen sizes.

**Why Responsive Design Matters**:
- **Mobile Traffic**: Over 60% of web traffic comes from mobile devices
- **SEO Benefits**: Google favors mobile-friendly websites
- **User Experience**: Consistent experience across all devices
- **Cost Efficiency**: One codebase for all devices
- **Future-Proof**: Adapts to new devices automatically

**Core Principles**:
- **Fluid Grids**: Layouts that adapt to screen size
- **Flexible Images**: Images that scale appropriately
- **Media Queries**: CSS rules that apply based on device characteristics
- **Mobile-First**: Design for mobile first, then enhance for larger screens

**Key Concepts**:
- **Breakpoints**: Points where layout changes occur
- **Viewport**: The visible area of a web page
- **Responsive Units**: em, rem, vh, vw, vmin, vmax
- **Progressive Enhancement**: Start with basic functionality, add features for capable devices

**Common Breakpoints**:
- **Mobile**: < 768px
- **Tablet**: 768px - 1024px
- **Desktop**: > 1024px
- **Large Desktop**: > 1200px

Remember: Responsive design is not just about making things smaller on mobile - it's about creating the best possible experience for each device type.`,keyTopics:["What is responsive design?","Mobile-first vs desktop-first approach","Viewport meta tag and its importance","Breakpoints and media queries","Responsive units (em, rem, vh, vw)"],practicalExercises:["Analyze popular websites for responsive design patterns","Set up proper viewport meta tags","Create basic responsive layouts with media queries","Test websites on different device sizes","Identify common responsive design anti-patterns"],codeExamples:[{title:"Basic Responsive HTML Structure",code:`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsive Website</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <h1 class="logo">My Responsive Site</h1>
      <nav class="nav">
        <button class="nav-toggle" aria-label="Toggle navigation">
          <span class="hamburger"></span>
        </button>
        <ul class="nav-list">
          <li><a href="#home">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#services">Services</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="main">
    <section class="hero">
      <div class="container">
        <h2>Welcome to Our Website</h2>
        <p>This website works great on all devices!</p>
        <button class="cta-button">Get Started</button>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <div class="feature-grid">
          <div class="feature-card">
            <h3>Feature 1</h3>
            <p>Description of feature 1</p>
          </div>
          <div class="feature-card">
            <h3>Feature 2</h3>
            <p>Description of feature 2</p>
          </div>
          <div class="feature-card">
            <h3>Feature 3</h3>
            <p>Description of feature 3</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2024 My Responsive Site</p>
    </div>
  </footer>
</body>
</html>`},{title:"Basic Responsive CSS with Media Queries",code:`/* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  line-height: 1.6;
  color: #333;
}

/* Container for max-width control */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Header styles */
.header {
  background: #2c3e50;
  color: white;
  padding: 1rem 0;
}

.logo {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

/* Navigation */
.nav {
  position: relative;
}

.nav-list {
  list-style: none;
  display: flex;
  gap: 2rem;
}

.nav-list a {
  color: white;
  text-decoration: none;
  padding: 0.5rem;
  transition: background 0.3s ease;
}

.nav-list a:hover {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
}

/* Mobile navigation toggle */
.nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.5rem;
}

.hamburger {
  display: block;
  width: 25px;
  height: 3px;
  background: white;
  position: relative;
}

.hamburger::before,
.hamburger::after {
  content: '';
  display: block;
  width: 25px;
  height: 3px;
  background: white;
  position: absolute;
}

.hamburger::before {
  top: -8px;
}

.hamburger::after {
  top: 8px;
}

/* Hero section */
.hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4rem 0;
  text-align: center;
}

.hero h2 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
}

.hero p {
  font-size: 1.2rem;
  margin-bottom: 2rem;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.cta-button {
  background: #ff6b6b;
  color: white;
  border: none;
  padding: 1rem 2rem;
  font-size: 1.1rem;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.cta-button:hover {
  background: #ff5252;
}

/* Features section */
.features {
  padding: 4rem 0;
  background: #f8f9fa;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.feature-card {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  text-align: center;
}

.feature-card h3 {
  margin-bottom: 1rem;
  color: #2c3e50;
}

/* Footer */
.footer {
  background: #2c3e50;
  color: white;
  text-align: center;
  padding: 2rem 0;
}

/* ========================================
   MEDIA QUERIES
   ======================================== */

/* Tablet styles */
@media (max-width: 768px) {
  .container {
    padding: 0 15px;
  }

  .hero h2 {
    font-size: 2rem;
  }

  .hero p {
    font-size: 1rem;
  }

  .feature-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .feature-card {
    padding: 1.5rem;
  }
}

/* Mobile styles */
@media (max-width: 480px) {
  .header {
    padding: 0.5rem 0;
  }

  .logo {
    font-size: 1.2rem;
  }

  /* Show mobile navigation */
  .nav-toggle {
    display: block;
  }

  .nav-list {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #2c3e50;
    flex-direction: column;
    gap: 0;
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .nav-list.active {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }

  .nav-list a {
    padding: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .hero {
    padding: 3rem 0;
  }

  .hero h2 {
    font-size: 1.8rem;
  }

  .hero p {
    font-size: 0.9rem;
  }

  .cta-button {
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
  }

  .features {
    padding: 3rem 0;
  }

  .feature-card {
    padding: 1.2rem;
  }

  .footer {
    padding: 1.5rem 0;
  }
}

/* Print styles */
@media print {
  .nav,
  .nav-toggle,
  .cta-button {
    display: none;
  }

  .hero {
    background: white !important;
    color: black !important;
  }

  .feature-card {
    box-shadow: none;
    border: 1px solid #ccc;
  }
}`}]},{id:"flexbox-grid",title:"Flexbox and CSS Grid for Responsive Layouts",content:`Modern CSS layout techniques like Flexbox and CSS Grid have revolutionized responsive design. These powerful tools make it easy to create flexible, responsive layouts that adapt to any screen size.

**Flexbox Fundamentals**:
- **One-dimensional layout**: Perfect for rows or columns
- **Content-based sizing**: Items size themselves based on content
- **Flexible spacing**: Easy distribution of space between items
- **Order control**: Change visual order without changing HTML
- **Alignment control**: Precise control over item alignment

**CSS Grid Essentials**:
- **Two-dimensional layout**: Control both rows and columns
- **Grid areas**: Name sections of your layout
- **Implicit vs explicit grids**: Automatic vs defined grid tracks
- **Grid gaps**: Spacing between grid items
- **Responsive grids**: Change layouts at different breakpoints

**When to Use Flexbox vs Grid**:
- **Flexbox**: Component-level layouts, navigation, card layouts
- **CSS Grid**: Page-level layouts, complex grid systems, magazine layouts
- **Both**: Many layouts benefit from using both together

**Responsive Design Patterns**:
- **Holy Grail Layout**: Header, main content, sidebar, footer
- **Card Grid**: Responsive grid of cards that stack on mobile
- **Navigation Patterns**: Hamburger menu, priority navigation
- **Content Reflow**: Content that reorganizes based on screen size

**Best Practices**:
- **Mobile-first**: Design for small screens first
- **Progressive enhancement**: Add complexity for larger screens
- **Consistent spacing**: Use a spacing scale
- **Semantic HTML**: Use appropriate HTML elements
- **Performance**: Avoid layout thrashing

Remember: Flexbox and Grid are not mutually exclusive - they work great together to create sophisticated responsive layouts.`,keyTopics:["Flexbox properties and usage patterns","CSS Grid fundamentals and syntax","Responsive layout patterns","Mobile-first design approach","Combining Flexbox and Grid"],practicalExercises:["Create responsive navigation with Flexbox","Build complex layouts with CSS Grid","Implement card-based layouts that adapt to screen size","Design responsive forms with proper field grouping","Create responsive image galleries"],codeExamples:[{title:"Responsive Navigation with Flexbox",code:`/* Modern responsive navigation using Flexbox */
.nav-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: #fff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.nav-brand {
  font-size: 1.5rem;
  font-weight: bold;
  color: #333;
  text-decoration: none;
}

.nav-menu {
  display: flex;
  list-style: none;
  gap: 2rem;
  margin: 0;
  padding: 0;
}

.nav-menu li a {
  color: #666;
  text-decoration: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.nav-menu li a:hover,
.nav-menu li a.active {
  color: #007bff;
  background: rgba(0, 123, 255, 0.1);
}

/* Mobile menu button */
.nav-toggle {
  display: none;
  flex-direction: column;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.5rem;
}

.nav-toggle span {
  width: 25px;
  height: 3px;
  background: #333;
  margin: 3px 0;
  transition: 0.3s;
  border-radius: 2px;
}

/* Mobile styles */
@media (max-width: 768px) {
  .nav-container {
    padding: 1rem;
  }

  .nav-menu {
    position: fixed;
    top: 100%;
    left: 0;
    right: 0;
    background: #fff;
    flex-direction: column;
    gap: 0;
    padding: 1rem 0;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .nav-menu.active {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }

  .nav-menu li {
    width: 100%;
    text-align: center;
  }

  .nav-menu li a {
    display: block;
    padding: 1rem;
    border-bottom: 1px solid #eee;
  }

  .nav-toggle {
    display: flex;
  }

  /* Hamburger animation */
  .nav-toggle.active span:nth-child(1) {
    transform: rotate(-45deg) translate(-5px, 6px);
  }

  .nav-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .nav-toggle.active span:nth-child(3) {
    transform: rotate(45deg) translate(-5px, -6px);
  }
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1024px) {
  .nav-container {
    padding: 1rem 1.5rem;
  }

  .nav-menu {
    gap: 1.5rem;
  }

  .nav-menu li a {
    padding: 0.5rem 0.75rem;
  }
}

/* Desktop enhancements */
@media (min-width: 1025px) {
  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .nav-menu li a {
    position: relative;
  }

  .nav-menu li a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: #007bff;
    transition: all 0.3s ease;
    transform: translateX(-50%);
  }

  .nav-menu li a:hover::after,
  .nav-menu li a.active::after {
    width: 100%;
  }
}`},{title:"CSS Grid for Complex Responsive Layouts",code:`/* CSS Grid for responsive magazine-style layout */
.magazine-layout {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: auto;
  gap: 2rem;
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

/* Header area */
.magazine-header {
  grid-column: 1 / -1;
  text-align: center;
  padding: 2rem 0;
  border-bottom: 2px solid #eee;
}

.magazine-title {
  font-size: 3rem;
  margin-bottom: 0.5rem;
  color: #2c3e50;
}

.magazine-subtitle {
  font-size: 1.2rem;
  color: #666;
  max-width: 600px;
  margin: 0 auto;
}

/* Featured article - spans full width on large screens */
.featured-article {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
  background: #f8f9fa;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.featured-content {
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.featured-content h2 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  color: #2c3e50;
}

.featured-content p {
  font-size: 1.1rem;
  line-height: 1.6;
  color: #555;
  margin-bottom: 1.5rem;
}

.featured-image {
  width: 100%;
  height: 300px;
  object-fit: cover;
  border-radius: 8px;
}

/* Article grid */
.articles-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  grid-column: 1 / -1;
}

.article-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.article-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.article-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.article-content {
  padding: 1.5rem;
}

.article-title {
  font-size: 1.25rem;
  margin-bottom: 0.5rem;
  color: #2c3e50;
}

.article-excerpt {
  color: #666;
  line-height: 1.5;
  margin-bottom: 1rem;
}

.article-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.9rem;
  color: #888;
}

.read-more {
  color: #007bff;
  text-decoration: none;
  font-weight: 500;
}

.read-more:hover {
  text-decoration: underline;
}

/* Sidebar */
.sidebar {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

.sidebar-widget {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.widget-title {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: #2c3e50;
  border-bottom: 2px solid #007bff;
  padding-bottom: 0.5rem;
}

/* Responsive breakpoints */
@media (min-width: 768px) {
  .magazine-layout {
    grid-template-columns: 1fr 300px;
    grid-template-areas:
      "header header"
      "featured sidebar"
      "articles sidebar";
  }

  .magazine-header {
    grid-area: header;
  }

  .featured-article {
    grid-area: featured;
  }

  .articles-grid {
    grid-area: articles;
  }

  .sidebar {
    grid-area: sidebar;
    grid-template-columns: 1fr;
  }
}

@media (min-width: 1024px) {
  .magazine-layout {
    grid-template-columns: 1fr 300px;
    grid-template-areas:
      "header header"
      "featured sidebar"
      "articles sidebar";
  }

  .articles-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .sidebar {
    position: sticky;
    top: 2rem;
    height: fit-content;
  }
}

@media (min-width: 1200px) {
  .articles-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Mobile optimizations */
@media (max-width: 767px) {
  .magazine-layout {
    padding: 1rem;
    gap: 1.5rem;
  }

  .magazine-title {
    font-size: 2rem;
  }

  .magazine-subtitle {
    font-size: 1rem;
  }

  .featured-article {
    grid-template-columns: 1fr;
    gap: 1.5rem;
    padding: 1.5rem;
  }

  .featured-content h2 {
    font-size: 2rem;
  }

  .articles-grid {
    grid-template-columns: 1fr;
  }

  .article-card {
    margin-bottom: 1rem;
  }

  .sidebar {
    gap: 1.5rem;
  }

  .sidebar-widget {
    padding: 1.2rem;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .article-card,
  .sidebar-widget,
  .featured-article {
    border: 2px solid #000;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .article-card,
  .nav-menu {
    transition: none;
  }

  .nav-toggle span {
    transition: none;
  }
}`}]},{id:"responsive-images-media",title:"Responsive Images and Media",content:`Images and media are often the heaviest parts of a web page. Responsive images ensure that the right image is delivered to each device, optimizing both performance and user experience.

**Responsive Image Techniques**:
- **Srcset and sizes**: Deliver different images based on screen size
- **Picture element**: Art direction for different layouts
- **CSS background images**: Responsive background images
- **SVG**: Scalable vector graphics for icons and illustrations
- **WebP/AVIF**: Modern image formats with better compression

**Performance Considerations**:
- **Lazy loading**: Load images only when needed
- **Image optimization**: Compress and resize images
- **CDN delivery**: Fast image delivery worldwide
- **Format selection**: Choose best format for each use case
- **Progressive loading**: Show low-quality image first, then high-quality

**Media Queries for Images**:
- **Resolution media queries**: Different images for different pixel densities
- **Width media queries**: Different images for different viewport widths
- **Orientation**: Different images for portrait/landscape
- **Device capabilities**: Different images based on device features

**Video and Audio**:
- **Responsive video**: Videos that adapt to container size
- **Multiple formats**: Provide fallbacks for different browsers
- **Lazy loading**: Load media only when needed
- **Accessibility**: Captions, transcripts, and keyboard controls

**Best Practices**:
- **Always provide alt text**: Accessibility and SEO
- **Use appropriate formats**: WebP for photos, SVG for graphics
- **Optimize file sizes**: Compress without quality loss
- **Test on real devices**: Emulators don't show real performance
- **Monitor Core Web Vitals**: Largest Contentful Paint (LCP) matters

**Modern Image APIs**:
- **Cloudinary**: Image optimization and delivery
- **Imgix**: Real-time image processing
- **Akamai Image Manager**: Enterprise image optimization
- **Vercel Image Optimization**: Next.js built-in optimization

Remember: Images should enhance your content, not slow it down. A good responsive image strategy balances visual quality with performance.`,keyTopics:["Responsive image techniques (srcset, picture element)","Image optimization and performance","Modern image formats (WebP, AVIF)","Lazy loading implementation","Responsive video and audio"],practicalExercises:["Implement responsive images with srcset and sizes","Create art-directed images with the picture element","Optimize images for web delivery","Implement lazy loading for images","Create responsive video players"],codeExamples:[{title:"Responsive Images with Srcset and Sizes",code:`<!-- Basic responsive image -->
<img src="image-800.jpg"
     srcset="image-400.jpg 400w,
             image-800.jpg 800w,
             image-1200.jpg 1200w"
     sizes="(max-width: 400px) 100vw,
            (max-width: 800px) 50vw,
            33vw"
     alt="Responsive image example">

<!-- Art-directed responsive images with picture element -->
<picture>
  <!-- Large screens: landscape crop -->
  <source media="(min-width: 1024px)"
          srcset="hero-landscape-large.jpg 1200w,
                  hero-landscape-medium.jpg 800w"
          sizes="100vw">

  <!-- Medium screens: portrait crop -->
  <source media="(min-width: 768px)"
          srcset="hero-portrait-large.jpg 800w,
                  hero-portrait-medium.jpg 600w"
          sizes="100vw">

  <!-- Small screens: square crop -->
  <img src="hero-square-medium.jpg"
       srcset="hero-square-small.jpg 400w,
               hero-square-medium.jpg 600w"
       sizes="100vw"
       alt="Hero image with art direction">
</picture>

<!-- Modern formats with fallbacks -->
<picture>
  <source srcset="image.avif" type="image/avif">
  <source srcset="image.webp" type="image/webp">
  <img src="image.jpg" alt="Modern image with fallbacks">
</picture>

<!-- CSS for responsive image containers -->
<style>
.responsive-image-container {
  position: relative;
  width: 100%;
  height: 0;
  overflow: hidden;
}

/* Different aspect ratios for different screen sizes */
@media (max-width: 767px) {
  .responsive-image-container {
    padding-bottom: 75%; /* 4:3 aspect ratio */
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  .responsive-image-container {
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }
}

@media (min-width: 1024px) {
  .responsive-image-container {
    padding-bottom: 50%; /* 2:1 aspect ratio */
  }
}

.responsive-image-container img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
</style>

<div class="responsive-image-container">
  <img src="image.jpg"
       srcset="image-small.jpg 400w,
               image-medium.jpg 800w,
               image-large.jpg 1200w"
       sizes="(max-width: 767px) 100vw,
              (max-width: 1023px) 50vw,
              33vw"
       alt="Responsive image with container">
</div>`},{title:"Lazy Loading and Image Optimization",code:`<!-- Native lazy loading (modern browsers) -->
<img src="image.jpg"
     loading="lazy"
     decoding="async"
     alt="Lazy loaded image">

<!-- Progressive image loading with blur placeholder -->
<div class="progressive-image">
  <img src="placeholder.jpg"
       data-src="image.jpg"
       data-srcset="image-small.jpg 400w, image-large.jpg 800w"
       data-sizes="100vw"
       class="blur"
       alt="Progressive image">
  <noscript>
    <img src="image.jpg" alt="Fallback image">
  </noscript>
</div>

<style>
.progressive-image {
  position: relative;
  overflow: hidden;
}

.progressive-image img {
  width: 100%;
  height: auto;
  transition: filter 0.3s ease;
}

.progressive-image img.blur {
  filter: blur(10px);
  transform: scale(1.1);
}

.progressive-image img.loaded {
  filter: blur(0);
  transform: scale(1);
}
</style>

<script>
// Progressive image loading
document.addEventListener('DOMContentLoaded', function() {
  const images = document.querySelectorAll('.progressive-image img');

  const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;

        // Set the actual source
        if (img.dataset.src) {
          img.src = img.dataset.src;
        }

        if (img.dataset.srcset) {
          img.srcset = img.dataset.srcset;
        }

        if (img.dataset.sizes) {
          img.sizes = img.dataset.sizes;
        }

        // Remove blur effect when loaded
        img.addEventListener('load', () => {
          img.classList.remove('blur');
          img.classList.add('loaded');
        });

        // Stop observing this image
        observer.unobserve(img);
      }
    });
  }, {
    rootMargin: '50px 0px', // Start loading 50px before image enters viewport
    threshold: 0.01
  });

  images.forEach(img => imageObserver.observe(img));
});

// Fallback for browsers without Intersection Observer
if (!('IntersectionObserver' in window)) {
  const images = document.querySelectorAll('.progressive-image img');
  images.forEach(img => {
    if (img.dataset.src) {
      img.src = img.dataset.src;
    }
  });
}
<\/script>

<!-- Responsive video with multiple sources -->
<video controls preload="metadata" poster="video-poster.jpg">
  <source src="video.mp4" type="video/mp4">
  <source src="video.webm" type="video/webm">
  <source src="video.ogv" type="video/ogg">
  <!-- Fallback content -->
  <p>Your browser doesn't support HTML5 video.
     <a href="video.mp4">Download the video</a> instead.</p>
</video>

<!-- Responsive video container -->
<style>
.video-container {
  position: relative;
  width: 100%;
  height: 0;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  overflow: hidden;
}

.video-container video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* Adjust aspect ratio for different content types */
.video-container.portrait {
  padding-bottom: 133.33%; /* 3:4 aspect ratio */
}

.video-container.square {
  padding-bottom: 100%; /* 1:1 aspect ratio */
}
</style>

<div class="video-container">
  <video controls>
    <source src="presentation.mp4" type="video/mp4">
    <source src="presentation.webm" type="video/webm">
  </video>
</div>

<!-- Audio with responsive controls -->
<audio controls preload="none">
  <source src="audio.mp3" type="audio/mpeg">
  <source src="audio.ogg" type="audio/ogg">
  <p>Your browser doesn't support HTML5 audio.</p>
</audio>

<!-- Image optimization utilities -->
<script>
// WebP support detection
function supportsWebP() {
  return new Promise(resolve => {
    const webP = new Image();
    webP.onload = webP.onerror = () => {
      resolve(webP.height === 2);
    };
    webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
  });
}

// Dynamic image format selection
async function loadOptimizedImage(imgElement, baseSrc) {
  const supportsWebP = await supportsWebP();

  const extension = supportsWebP ? 'webp' : 'jpg';
  const optimizedSrc = baseSrc.replace(/.(jpg|png)$/i, \`.\${extension}\`);

  imgElement.src = optimizedSrc;
}

// Usage
document.addEventListener('DOMContentLoaded', function() {
  const images = document.querySelectorAll('[data-optimize]');
  images.forEach(img => {
    loadOptimizedImage(img, img.dataset.optimize);
  });
});
<\/script>`}]},{id:"responsive-typography",title:"Responsive Typography and Spacing",content:`Typography is the foundation of good design. Responsive typography ensures that text is readable and visually appealing across all devices and screen sizes.

**Responsive Typography Principles**:
- **Scalable units**: Use em, rem, and viewport units
- **Fluid typography**: Text that scales with screen size
- **Readable line lengths**: 45-75 characters per line
- **Appropriate font sizes**: Consider device capabilities
- **Hierarchy preservation**: Maintain visual hierarchy across devices

**CSS Units for Responsive Design**:
- **rem**: Relative to root font size, scalable
- **em**: Relative to parent font size
- **vh/vw**: Viewport height/width percentages
- **vmin/vmax**: Minimum/maximum viewport dimensions
- **px**: Fixed pixels (avoid for responsive text)

**Typography Scale**:
- **Major third**: 1.25 ratio (good for headings)
- **Perfect fourth**: 1.333 ratio (balanced)
- **Augmented fourth**: 1.414 ratio (harmonic)
- **Golden ratio**: 1.618 ratio (classic)

**Spacing and Layout**:
- **Consistent spacing scale**: Use a ratio-based system
- **Container queries**: Size based on container, not viewport
- **Grid systems**: Consistent spacing and alignment
- **White space**: Don't fear empty space

**Accessibility Considerations**:
- **Minimum font size**: 16px for body text
- **Color contrast**: WCAG guidelines
- **Line height**: 1.4-1.6 for readability
- **Focus indicators**: Visible on all devices

**Performance**:
- **Font loading**: Use font-display for better performance
- **Subset fonts**: Load only needed characters
- **System fonts**: Consider using system fonts for better performance
- **Web fonts**: Optimize loading and caching

Remember: Good typography is invisible. Users should focus on content, not on reading it.`,keyTopics:["Fluid typography with clamp() and viewport units","Responsive spacing systems","Typography scales and ratios","Font loading optimization","Accessibility in typography"],practicalExercises:["Create a responsive typography system","Implement fluid typography with CSS clamp()","Design responsive spacing scales","Optimize font loading performance","Test typography across different devices"],codeExamples:[{title:"Fluid Typography System",code:`/* CSS Custom Properties for Typography Scale */
:root {
  /* Base font size - responsive */
  --font-size-base: clamp(16px, 2.5vw, 20px);

  /* Typography scale using major third ratio (1.25) */
  --font-size-xs: calc(var(--font-size-base) * 0.75);    /* 12px - 15px */
  --font-size-sm: calc(var(--font-size-base) * 0.875);   /* 14px - 17.5px */
  --font-size-md: var(--font-size-base);                 /* 16px - 20px */
  --font-size-lg: calc(var(--font-size-base) * 1.25);    /* 20px - 25px */
  --font-size-xl: calc(var(--font-size-base) * 1.5625);  /* 25px - 31.25px */
  --font-size-2xl: calc(var(--font-size-base) * 1.953125); /* 31.25px - 39px */
  --font-size-3xl: calc(var(--font-size-base) * 2.44140625); /* 39px - 48.8px */
  --font-size-4xl: calc(var(--font-size-base) * 3.0517578125); /* 48.8px - 61px */

  /* Line heights for optimal readability */
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;

  /* Letter spacing */
  --letter-spacing-tight: -0.025em;
  --letter-spacing-normal: 0;
  --letter-spacing-wide: 0.025em;
}

/* Base typography styles */
body {
  font-family: system-ui, -apple-system, sans-serif;
  font-size: var(--font-size-md);
  line-height: var(--line-height-normal);
  color: #333;
  margin: 0;
  padding: 0;
}

/* Heading hierarchy */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: var(--line-height-tight);
  margin: 0 0 1rem 0;
  color: #1a1a1a;
}

h1 { font-size: var(--font-size-4xl); }
h2 { font-size: var(--font-size-3xl); }
h3 { font-size: var(--font-size-2xl); }
h4 { font-size: var(--font-size-xl); }
h5 { font-size: var(--font-size-lg); }
h6 { font-size: var(--font-size-md); }

/* Text elements */
p {
  margin: 0 0 1rem 0;
  max-width: 70ch; /* Optimal reading length */
}

small {
  font-size: var(--font-size-sm);
  color: #666;
}

strong, b {
  font-weight: 600;
}

em, i {
  font-style: italic;
}

/* Links */
a {
  color: #007bff;
  text-decoration: none;
  transition: color 0.2s ease;
}

a:hover, a:focus {
  color: #0056b3;
  text-decoration: underline;
}

/* Lists */
ul, ol {
  margin: 0 0 1rem 0;
  padding-left: 1.5rem;
}

li {
  margin-bottom: 0.5rem;
}

/* Blockquotes */
blockquote {
  margin: 2rem 0;
  padding: 1rem 1.5rem;
  border-left: 4px solid #007bff;
  background: #f8f9fa;
  font-style: italic;
  color: #666;
}

blockquote p {
  margin: 0;
}

/* Code */
code {
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.9em;
  background: #f1f3f4;
  padding: 0.2em 0.4em;
  border-radius: 3px;
}

pre {
  font-family: 'Monaco', 'Menlo', monospace;
  background: #f1f3f4;
  padding: 1rem;
  border-radius: 6px;
  overflow-x: auto;
  margin: 1rem 0;
}

pre code {
  background: none;
  padding: 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  :root {
    --font-size-base: clamp(14px, 4vw, 16px);
  }

  h1 { font-size: var(--font-size-3xl); }
  h2 { font-size: var(--font-size-2xl); }
  h3 { font-size: var(--font-size-xl); }

  p {
    max-width: none; /* Allow full width on mobile */
  }

  blockquote {
    margin: 1.5rem 0;
    padding: 1rem;
  }
}

@media (max-width: 480px) {
  :root {
    --font-size-base: clamp(14px, 4.5vw, 16px);
  }

  h1 { font-size: var(--font-size-2xl); }
  h2 { font-size: var(--font-size-xl); }
  h3 { font-size: var(--font-size-lg); }

  ul, ol {
    padding-left: 1.2rem;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  :root {
    --font-size-base: clamp(18px, 2.5vw, 22px);
  }

  h1, h2, h3, h4, h5, h6 {
    font-weight: 700;
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
  }
}

/* Print styles */
@media print {
  :root {
    --font-size-base: 12pt;
  }

  body {
    font-family: serif;
  }

  a {
    color: black;
    text-decoration: underline;
  }

  a[href^="http"]:after {
    content: " (" attr(href) ")";
  }
}`},{title:"Responsive Spacing and Layout System",code:`/* CSS Custom Properties for Spacing Scale */
:root {
  /* Base spacing unit - responsive */
  --space-unit: clamp(8px, 2vw, 16px);

  /* Spacing scale using 4pt grid system */
  --space-1: calc(var(--space-unit) * 0.25);   /* 2px - 4px */
  --space-2: calc(var(--space-unit) * 0.5);    /* 4px - 8px */
  --space-3: calc(var(--space-unit) * 0.75);   /* 6px - 12px */
  --space-4: var(--space-unit);                /* 8px - 16px */
  --space-5: calc(var(--space-unit) * 1.25);   /* 10px - 20px */
  --space-6: calc(var(--space-unit) * 1.5);    /* 12px - 24px */
  --space-7: calc(var(--space-unit) * 2);      /* 16px - 32px */
  --space-8: calc(var(--space-unit) * 2.5);    /* 20px - 40px */
  --space-9: calc(var(--space-unit) * 3);      /* 24px - 48px */
  --space-10: calc(var(--space-unit) * 4);     /* 32px - 64px */

  /* Layout properties */
  --container-max-width: 1200px;
  --container-padding: var(--space-4);
  --section-padding: var(--space-10);
}

/* Utility classes for spacing */
.m-0 { margin: 0; }
.m-1 { margin: var(--space-1); }
.m-2 { margin: var(--space-2); }
.m-3 { margin: var(--space-3); }
.m-4 { margin: var(--space-4); }
.m-5 { margin: var(--space-5); }
.m-6 { margin: var(--space-6); }
.m-7 { margin: var(--space-7); }
.m-8 { margin: var(--space-8); }
.m-9 { margin: var(--space-9); }
.m-10 { margin: var(--space-10); }

.p-0 { padding: 0; }
.p-1 { padding: var(--space-1); }
.p-2 { padding: var(--space-2); }
.p-3 { padding: var(--space-3); }
.p-4 { padding: var(--space-4); }
.p-5 { padding: var(--space-5); }
.p-6 { padding: var(--space-6); }
.p-7 { padding: var(--space-7); }
.p-8 { padding: var(--space-8); }
.p-9 { padding: var(--space-9); }
.p-10 { padding: var(--space-10); }

/* Directional spacing */
.mt-1 { margin-top: var(--space-1); }
.mt-2 { margin-top: var(--space-2); }
.mt-3 { margin-top: var(--space-3); }
.mt-4 { margin-top: var(--space-4); }
.mt-5 { margin-top: var(--space-5); }

.mb-1 { margin-bottom: var(--space-1); }
.mb-2 { margin-bottom: var(--space-2); }
.mb-3 { margin-bottom: var(--space-3); }
.mb-4 { margin-bottom: var(--space-4); }
.mb-5 { margin-bottom: var(--space-5); }

.py-1 { padding-top: var(--space-1); padding-bottom: var(--space-1); }
.py-2 { padding-top: var(--space-2); padding-bottom: var(--space-2); }
.py-3 { padding-top: var(--space-3); padding-bottom: var(--space-3); }
.py-4 { padding-top: var(--space-4); padding-bottom: var(--space-4); }
.py-5 { padding-top: var(--space-5); padding-bottom: var(--space-5); }

/* Container and layout utilities */
.container {
  max-width: var(--container-max-width);
  margin: 0 auto;
  padding: 0 var(--container-padding);
  width: 100%;
}

.section {
  padding: var(--section-padding) 0;
}

.grid {
  display: grid;
  gap: var(--space-4);
}

.grid-2 { grid-template-columns: repeat(2, 1fr); }
.grid-3 { grid-template-columns: repeat(3, 1fr); }
.grid-4 { grid-template-columns: repeat(4, 1fr); }

.flex {
  display: flex;
  gap: var(--space-4);
}

.flex-column { flex-direction: column; }
.flex-wrap { flex-wrap: wrap; }

.items-center { align-items: center; }
.justify-center { justify-content: center; }
.justify-between { justify-content: space-between; }

/* Responsive grid adjustments */
@media (max-width: 768px) {
  .grid-2,
  .grid-3,
  .grid-4 {
    grid-template-columns: 1fr;
  }

  .container {
    padding: 0 var(--space-3);
  }

  .section {
    padding: var(--space-7) 0;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 0 var(--space-2);
  }

  .section {
    padding: var(--space-6) 0;
  }

  .grid,
  .flex {
    gap: var(--space-3);
  }
}

/* Card component with responsive spacing */
.card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  padding: var(--space-5);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.card-header {
  margin-bottom: var(--space-4);
}

.card-title {
  font-size: var(--font-size-xl);
  margin: 0 0 var(--space-2) 0;
}

.card-content {
  margin-bottom: var(--space-4);
}

.card-actions {
  display: flex;
  gap: var(--space-3);
  flex-wrap: wrap;
}

/* Button component */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-3) var(--space-5);
  border: none;
  border-radius: 4px;
  font-size: var(--font-size-md);
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: 44px; /* Touch target size */
}

.btn-primary {
  background: #007bff;
  color: white;
}

.btn-primary:hover {
  background: #0056b3;
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #545b62;
}

/* Form elements with responsive spacing */
.form-group {
  margin-bottom: var(--space-4);
}

.form-label {
  display: block;
  margin-bottom: var(--space-2);
  font-weight: 500;
}

.form-input,
.form-textarea,
.form-select {
  width: 100%;
  padding: var(--space-3);
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: var(--font-size-md);
  transition: border-color 0.2s ease;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.form-textarea {
  resize: vertical;
  min-height: 100px;
}

/* Responsive form adjustments */
@media (max-width: 480px) {
  .form-input,
  .form-textarea,
  .form-select {
    padding: var(--space-4);
  }

  .btn {
    width: 100%;
    justify-content: center;
  }

  .card-actions {
    flex-direction: column;
  }

  .card-actions .btn {
    width: 100%;
  }
}`}]}],projects:[{title:"Responsive Portfolio Website",description:"Build a complete portfolio website that showcases your work with responsive design, optimized images, fluid typography, and smooth animations across all devices."},{title:"E-commerce Product Page",description:"Create a responsive product page for an e-commerce site with image galleries, product variants, reviews, and a mobile-optimized checkout flow."},{title:"News Magazine Layout",description:"Design a responsive news magazine layout with complex grids, art-directed images, typography scales, and optimized content hierarchy for reading."},{title:"Dashboard Interface",description:"Build a responsive admin dashboard with data tables, charts, navigation, and forms that work seamlessly from mobile to desktop."},{title:"Restaurant Website",description:"Create a responsive restaurant website with menu display, reservation system, photo gallery, and location information optimized for mobile users."}],assessments:[{type:"quiz",questions:[{question:"What is the purpose of the viewport meta tag in responsive design?",options:["To set the website's color scheme","To control how the page is displayed on mobile devices","To optimize images for different screen sizes","To define the website's navigation structure"],correctAnswer:"To control how the page is displayed on mobile devices"},{question:"Which CSS unit is relative to the viewport width?",options:["em","rem","vw","pt"],correctAnswer:"vw"},{question:"What does the 'mobile-first' approach mean?",options:["Design for mobile devices first, then enhance for larger screens","Use only mobile devices for testing","Create separate mobile and desktop versions","Prioritize mobile app development over web"],correctAnswer:"Design for mobile devices first, then enhance for larger screens"},{question:"Which HTML element is used for art-directed responsive images?",options:["img","picture","figure","canvas"],correctAnswer:"picture"},{question:"What is the purpose of CSS Grid in responsive design?",options:["To create two-dimensional layouts","To optimize image loading","To manage typography scales","To handle form validation"],correctAnswer:"To create two-dimensional layouts"}]},{type:"evaluation",questions:[{question:"Design a responsive layout for a blog post page including header, content, sidebar, and footer. Explain your CSS Grid and Flexbox usage.",options:[],correctAnswer:""},{question:"Explain how you would implement responsive images for a product catalog. Include srcset, sizes, and modern image formats.",options:[],correctAnswer:""},{question:"Create a responsive typography system using CSS custom properties. Include fluid typography, spacing scales, and accessibility considerations.",options:[],correctAnswer:""}]}],aiPrompts:["How do I make my website responsive?","What's the difference between Flexbox and CSS Grid?","How do I implement responsive images?","How do I create a mobile-first design?","What's the best way to handle responsive typography?","How do I test responsive design?","How do I optimize images for responsive design?","What's the difference between px, em, and rem?","How do I create responsive navigation?","How do I handle touch interactions on mobile?"],resources:[{name:"Responsive Web Design Fundamentals",url:"https://developers.google.com/web/fundamentals/design-and-ux/responsive/"},{name:"CSS Grid Guide",url:"https://css-tricks.com/snippets/css/complete-guide-grid/"},{name:"Flexbox Guide",url:"https://css-tricks.com/snippets/css/a-guide-to-flexbox/"},{name:"Responsive Images",url:"https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images"},{name:"Viewport Meta Tag",url:"https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag"},{name:"Media Queries",url:"https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries"},{name:"Web.dev Responsive Design",url:"https://web.dev/responsive-web-design-basics/"},{name:"Google Mobile-Friendly Test",url:"https://search.google.com/test/mobile-friendly"}],toolsRequired:["Modern web browser with developer tools","Responsive design testing tools (BrowserStack, Responsively)","Image optimization tools (ImageOptim, TinyPNG)","CSS preprocessor (Sass, Less) - optional","Build tools (Webpack, Vite) - optional","Performance testing tools (Lighthouse, WebPageTest)","Accessibility testing tools (WAVE, axe)","Version control (Git)","Code editor with responsive preview"],bestPractices:["Use mobile-first approach for all new projects","Test on real devices, not just emulators","Optimize images for web delivery","Use semantic HTML for better accessibility","Implement proper touch targets for mobile","Use fluid typography with clamp() function","Test with different screen sizes and orientations","Consider performance impact of responsive features","Use CSS Grid for complex layouts","Implement proper loading states for images","Use modern image formats when possible","Consider users with different abilities","Test with slow network connections","Use progressive enhancement approach","Document responsive design decisions","Regularly audit and update responsive design","Use consistent spacing and typography scales","Implement proper error handling for media","Consider international users and text expansion","Use CSS custom properties for maintainable code"],commonPitfalls:["Fixed pixel widths that don't adapt","Images that don't scale properly","Typography that's too small on mobile","Navigation that doesn't work on touch devices","Horizontal scrolling on mobile devices","Ignoring performance impact of large images","Not testing on actual devices","Using deprecated techniques","Ignoring accessibility requirements","Not considering different orientations","Fixed heights that cause content overflow","Not optimizing for different network speeds","Ignoring users with motor disabilities","Not testing with screen readers","Using complex CSS that breaks on older browsers","Not planning for content expansion","Ignoring print styles","Not considering high contrast needs","Using non-responsive third-party components","Not maintaining aspect ratios properly"],careerRelevance:"Responsive design is fundamental to modern web development. With mobile devices accounting for over 60% of web traffic, responsive design skills are essential for any front-end developer. Companies need developers who can create websites that work seamlessly across all devices, improving user experience and conversion rates. Responsive design expertise demonstrates understanding of user-centered design, performance optimization, and modern CSS techniques. As mobile usage continues to grow, responsive design skills will remain highly valuable in the job market, with opportunities in web development, UI/UX design, and front-end engineering roles across industries."},xM={id:"react",tier:3,name:"React",description:"React is a popular JavaScript library for building user interfaces, particularly web applications. It enables developers to create reusable UI components that efficiently update and render when data changes, making it easier to build complex, interactive user interfaces with a component-based architecture.",difficulty:"intermediate",estimatedHours:20,prerequisites:["javascript","html5","css3"],learningObjectives:["Understand React's component-based architecture and how to create reusable UI components","Master React Hooks including useState, useEffect, useContext, and custom hooks","Implement state management solutions using Context API and external libraries","Optimize React application performance using memo, useMemo, and useCallback","Write comprehensive tests for React components using testing libraries","Apply advanced React patterns like Higher-Order Components and render props","Handle form management and validation in React applications","Implement proper error boundaries and error handling strategies","Understand React's reconciliation process and virtual DOM","Build responsive and accessible React applications","Integrate React with external APIs and manage asynchronous operations","Implement routing in React applications using React Router"],sections:[{id:"react-fundamentals",title:"React Fundamentals and Component Architecture",content:`React is a JavaScript library for building user interfaces that revolutionized web development by introducing a component-based architecture. At its core, React allows you to build encapsulated components that manage their own state and compose them to create complex UIs.

**What Makes React Special**:
- **Component-Based**: Break down UI into reusable, independent pieces
- **Declarative**: Describe what you want, not how to achieve it
- **Virtual DOM**: Efficiently updates only what changed
- **Unidirectional Data Flow**: Predictable state management
- **JSX**: Write HTML-like syntax in JavaScript

**Core Concepts**:
- **Components**: The building blocks of React applications
- **Props**: How data flows from parent to child components
- **State**: Local data that can change over time
- **Lifecycle**: Methods that run at different stages of a component's life
- **JSX**: Syntax extension for writing React elements

**Component Types**:
- **Functional Components**: Simple functions that return JSX
- **Class Components**: ES6 classes with lifecycle methods
- **Higher-Order Components**: Functions that enhance other components

**Best Practices**:
- Keep components small and focused on a single responsibility
- Use meaningful names that describe what the component does
- Prefer functional components with hooks over class components
- Extract reusable logic into custom hooks
- Use prop types or TypeScript for type safety`,keyTopics:["Component-based architecture","JSX syntax and benefits","Props vs State","Functional vs Class components","React's virtual DOM"],practicalExercises:["Create a simple functional component that displays user information","Build a class component with state and lifecycle methods","Pass props between parent and child components","Convert a class component to a functional component with hooks","Create a reusable Button component with different variants"],codeExamples:[{title:"Basic Functional Component",code:`import React from 'react';

function Welcome(props) {
  return <h1>Hello, {props.name}!</h1>;
}

// Usage
function App() {
  return (
    <div>
      <Welcome name="Alice" />
      <Welcome name="Bob" />
      <Welcome name="Charlie" />
    </div>
  );
}

export default App;`},{title:"Class Component with State",code:`import React, { Component } from 'react';

class Counter extends Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }

  increment = () => {
    this.setState({ count: this.state.count + 1 });
  }

  decrement = () => {
    this.setState({ count: this.state.count - 1 });
  }

  render() {
    return (
      <div>
        <h2>Count: {this.state.count}</h2>
        <button onClick={this.increment}>+</button>
        <button onClick={this.decrement}>-</button>
      </div>
    );
  }
}

export default Counter;`},{title:"Props and Component Composition",code:`import React from 'react';

// Reusable Card component
function Card({ title, children, className = '' }) {
  return (
    <div className={\`card \${className}\`}>
      {title && <h3 className="card-title">{title}</h3>}
      <div className="card-content">
        {children}
      </div>
    </div>
  );
}

// User Profile component using composition
function UserProfile({ user }) {
  return (
    <Card title="User Profile" className="user-profile">
      <div className="user-avatar">
        <img src={user.avatar} alt={user.name} />
      </div>
      <div className="user-info">
        <h4>{user.name}</h4>
        <p>{user.email}</p>
        <p>{user.bio}</p>
      </div>
      <div className="user-stats">
        <span>Posts: {user.posts}</span>
        <span>Followers: {user.followers}</span>
      </div>
    </Card>
  );
}

// Usage
const user = {
  name: "John Doe",
  email: "john@example.com",
  bio: "Full-stack developer passionate about React",
  avatar: "/avatar.jpg",
  posts: 42,
  followers: 1234
};

function App() {
  return <UserProfile user={user} />;
}`}]},{id:"react-hooks",title:"React Hooks: State and Lifecycle Management",content:`React Hooks revolutionized how we write React components by allowing us to use state and lifecycle features in functional components. Hooks are functions that let you 'hook into' React state and lifecycle features from function components.

**Why Hooks Matter**:
- **No More Classes**: Write components as functions
- **Reusable Logic**: Extract stateful logic into custom hooks
- **Better Composition**: Combine multiple hooks in creative ways
- **Backward Compatible**: Don't break existing code
- **Easier Testing**: Test hooks independently

**Essential Hooks**:
- **useState**: Add state to functional components
- **useEffect**: Handle side effects and lifecycle events
- **useContext**: Consume context values
- **useReducer**: Manage complex state logic
- **useCallback**: Memoize functions
- **useMemo**: Memoize expensive calculations
- **useRef**: Access DOM elements directly

**Rules of Hooks**:
- Only call hooks at the top level (not inside loops, conditions, or nested functions)
- Only call hooks from React function components or custom hooks
- Custom hooks must start with 'use' prefix

**Common Patterns**:
- **Data Fetching**: useEffect for API calls
- **Form Handling**: useState for form state
- **Event Handling**: useCallback for event handlers
- **Performance**: useMemo for expensive operations
- **Cleanup**: Return functions from useEffect for cleanup

**Custom Hooks**:
- Extract reusable logic from components
- Share logic between different components
- Test logic independently
- Follow naming convention: useSomething`,keyTopics:["useState for state management","useEffect for side effects","useContext for context consumption","Custom hooks creation and usage","Rules of hooks"],practicalExercises:["Implement a counter component using useState","Create a data fetching hook with useEffect","Build a form with controlled inputs using useState","Create a custom hook for localStorage management","Implement a timer component with useEffect cleanup"],codeExamples:[{title:"useState Hook - Basic State Management",code:`import React, { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);
  const [step, setStep] = useState(1);

  const increment = () => setCount(count + step);
  const decrement = () => setCount(count - step);
  const reset = () => setCount(0);

  return (
    <div>
      <h2>Counter: {count}</h2>
      <div>
        <label>
          Step:
          <input
            type="number"
            value={step}
            onChange={(e) => setStep(Number(e.target.value))}
            min="1"
            max="10"
          />
        </label>
      </div>
      <div>
        <button onClick={decrement}>-</button>
        <button onClick={reset}>Reset</button>
        <button onClick={increment}>+</button>
      </div>
    </div>
  );
}

export default Counter;`},{title:"useEffect Hook - Side Effects and Lifecycle",code:`import React, { useState, useEffect } from 'react';

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // Component did mount and userId changed
    const fetchUser = async () => {
      try {
        setLoading(true);
        const response = await fetch(\`/api/users/\${userId}\`);
        if (!response.ok) {
          throw new Error('Failed to fetch user');
        }
        const userData = await response.json();
        setUser(userData);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    if (userId) {
      fetchUser();
    }
  }, [userId]); // Dependency array - re-run when userId changes

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  if (!user) return <div>No user found</div>;

  return (
    <div>
      <h2>{user.name}</h2>
      <p>Email: {user.email}</p>
      <p>Role: {user.role}</p>
    </div>
  );
}

export default UserProfile;`},{title:"Custom Hook - Data Fetching",code:`import { useState, useEffect } from 'react';

// Custom hook for data fetching
function useFetch(url, options = {}) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);

        const response = await fetch(url, options);
        if (!response.ok) {
          throw new Error(\`HTTP error! status: \${response.status}\`);
        }

        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    if (url) {
      fetchData();
    }
  }, [url, JSON.stringify(options)]);

  return { data, loading, error };
}

// Usage in component
function UserList() {
  const { data: users, loading, error } = useFetch('/api/users');

  if (loading) return <div>Loading users...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <div>
      <h2>Users</h2>
      <ul>
        {users?.map(user => (
          <li key={user.id}>
            {user.name} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default UserList;`},{title:"useContext and useReducer - Advanced State Management",code:`import React, { useContext, useReducer, createContext } from 'react';

// Context for theme
const ThemeContext = createContext();

// Reducer for complex state
const todoReducer = (state, action) => {
  switch (action.type) {
    case 'ADD_TODO':
      return [...state, {
        id: Date.now(),
        text: action.payload,
        completed: false
      }];
    case 'TOGGLE_TODO':
      return state.map(todo =>
        todo.id === action.payload
          ? { ...todo, completed: !todo.completed }
          : todo
      );
    case 'DELETE_TODO':
      return state.filter(todo => todo.id !== action.payload);
    default:
      return state;
  }
};

// Theme Provider Component
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme(prevTheme => prevTheme === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// Todo App with useReducer
function TodoApp() {
  const [todos, dispatch] = useReducer(todoReducer, []);
  const [inputValue, setInputValue] = useState('');
  const { theme, toggleTheme } = useContext(ThemeContext);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (inputValue.trim()) {
      dispatch({ type: 'ADD_TODO', payload: inputValue });
      setInputValue('');
    }
  };

  return (
    <div className={\`app \${theme}\`}>
      <button onClick={toggleTheme}>
        Switch to {theme === 'light' ? 'Dark' : 'Light'} Mode
      </button>

      <form onSubmit={handleSubmit}>
        <input
          type="text"
          value={inputValue}
          onChange={(e) => setInputValue(e.target.value)}
          placeholder="Add a todo..."
        />
        <button type="submit">Add</button>
      </form>

      <ul>
        {todos.map(todo => (
          <li key={todo.id}>
            <span style={{
              textDecoration: todo.completed ? 'line-through' : 'none'
            }}>
              {todo.text}
            </span>
            <button onClick={() => dispatch({
              type: 'TOGGLE_TODO',
              payload: todo.id
            })}>
              {todo.completed ? 'Undo' : 'Complete'}
            </button>
            <button onClick={() => dispatch({
              type: 'DELETE_TODO',
              payload: todo.id
            })}>
              Delete
            </button>
          </li>
        ))}
      </ul>
    </div>
  );
}

// App component
function App() {
  return (
    <ThemeProvider>
      <TodoApp />
    </ThemeProvider>
  );
}

export default App;`}]},{id:"react-state-management",title:"Advanced State Management and Context API",content:`As React applications grow, managing state becomes increasingly complex. React provides several tools and patterns for effective state management, from the built-in Context API to external libraries like Redux and Zustand.

**State Management Challenges**:
- **Prop Drilling**: Passing props through multiple component layers
- **Complex State Logic**: Managing interrelated state variables
- **Performance Issues**: Unnecessary re-renders
- **Data Persistence**: Maintaining state across sessions
- **Server State**: Managing data from APIs

**Context API**:
- **createContext**: Creates a context object
- **Provider**: Supplies context value to component tree
- **useContext**: Consumes context value in components
- **Best for**: Theme, user preferences, global app state

**State Management Libraries**:
- **Redux**: Predictable state container with actions and reducers
- **Zustand**: Lightweight state management with hooks
- **Recoil**: State management with atoms and selectors
- **Jotai**: Primitive and flexible state management

**Server State Management**:
- **React Query/TanStack Query**: Powerful data synchronization
- **SWR**: React hooks for data fetching
- **Apollo Client**: GraphQL state management

**Performance Optimization**:
- **Memoization**: Prevent unnecessary re-renders
- **State Colocation**: Keep state close to where it's used
- **Lazy Loading**: Load state only when needed
- **State Normalization**: Efficient data structures

**Best Practices**:
- Choose the right tool for the job
- Keep state as local as possible
- Use selectors for computed values
- Implement proper error handling
- Test state management logic thoroughly`,keyTopics:["Context API implementation","Redux vs Context API","Server state management","State persistence strategies","Performance optimization techniques"],practicalExercises:["Implement theme switching with Context API","Create a shopping cart with useReducer","Build a user authentication context","Implement data fetching with React Query","Create a global notification system"],codeExamples:[{title:"Context API - Theme Management",code:`import React, { createContext, useContext, useState, useEffect } from 'react';

// Create theme context
const ThemeContext = createContext();

// Theme provider component
export function ThemeProvider({ children }) {
  const [theme, setTheme] = useState(() => {
    // Get initial theme from localStorage or system preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) return savedTheme;

    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  });

  // Save theme to localStorage when it changes
  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prevTheme => prevTheme === 'light' ? 'dark' : 'light');
  };

  const value = {
    theme,
    setTheme,
    toggleTheme,
    isDark: theme === 'dark',
    isLight: theme === 'light'
  };

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
}

// Custom hook to use theme
export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
}

// Usage in components
function ThemeToggle() {
  const { theme, toggleTheme } = useTheme();

  return (
    <button
      onClick={toggleTheme}
      aria-label={\`Switch to \${theme === 'light' ? 'dark' : 'light'} mode\`}
    >
      {theme === 'light' ? '🌙' : '☀️'}
    </button>
  );
}

function ThemedCard({ children }) {
  const { theme } = useTheme();

  return (
    <div className={\`card card--\${theme}\`}>
      {children}
    </div>
  );
}

function App() {
  return (
    <ThemeProvider>
      <div className="app">
        <header>
          <h1>My App</h1>
          <ThemeToggle />
        </header>
        <main>
          <ThemedCard>
            <h2>Welcome!</h2>
            <p>This card uses the current theme.</p>
          </ThemedCard>
        </main>
      </div>
    </ThemeProvider>
  );
}

export default App;`},{title:"Redux Store with Actions and Reducers",code:`import { createStore, combineReducers } from 'redux';

// Action types
const ADD_TODO = 'ADD_TODO';
const TOGGLE_TODO = 'TOGGLE_TODO';
const DELETE_TODO = 'DELETE_TODO';
const SET_FILTER = 'SET_FILTER';

// Action creators
export const addTodo = (text) => ({
  type: ADD_TODO,
  payload: { text, id: Date.now() }
});

export const toggleTodo = (id) => ({
  type: TOGGLE_TODO,
  payload: { id }
});

export const deleteTodo = (id) => ({
  type: DELETE_TODO,
  payload: { id }
});

export const setFilter = (filter) => ({
  type: SET_FILTER,
  payload: { filter }
});

// Reducers
const todosReducer = (state = [], action) => {
  switch (action.type) {
    case ADD_TODO:
      return [
        ...state,
        {
          id: action.payload.id,
          text: action.payload.text,
          completed: false
        }
      ];
    case TOGGLE_TODO:
      return state.map(todo =>
        todo.id === action.payload.id
          ? { ...todo, completed: !todo.completed }
          : todo
      );
    case DELETE_TODO:
      return state.filter(todo => todo.id !== action.payload.id);
    default:
      return state;
  }
};

const filterReducer = (state = 'ALL', action) => {
  switch (action.type) {
    case SET_FILTER:
      return action.payload.filter;
    default:
      return state;
  }
};

// Root reducer
const rootReducer = combineReducers({
  todos: todosReducer,
  filter: filterReducer
});

// Create store
const store = createStore(rootReducer);

// Selectors
export const getVisibleTodos = (state) => {
  const { todos, filter } = state;
  switch (filter) {
    case 'COMPLETED':
      return todos.filter(todo => todo.completed);
    case 'ACTIVE':
      return todos.filter(todo => !todo.completed);
    default:
      return todos;
  }
};

export default store;`},{title:"React Query for Server State Management",code:`import React from 'react';
import { QueryClient, QueryClientProvider, useQuery, useMutation, useQueryClient } from 'react-query';

// Create a client
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5, // 5 minutes
      cacheTime: 1000 * 60 * 10, // 10 minutes
      retry: 3,
      refetchOnWindowFocus: false
    }
  }
});

// API functions
const fetchPosts = async () => {
  const response = await fetch('/api/posts');
  if (!response.ok) {
    throw new Error('Failed to fetch posts');
  }
  return response.json();
};

const createPost = async (newPost) => {
  const response = await fetch('/api/posts', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(newPost),
  });
  if (!response.ok) {
    throw new Error('Failed to create post');
  }
  return response.json();
};

// Custom hook for posts
function usePosts() {
  return useQuery('posts', fetchPosts, {
    onError: (error) => {
      console.error('Error fetching posts:', error);
    }
  });
}

// Posts list component
function PostsList() {
  const { data: posts, isLoading, error, refetch } = usePosts();

  if (isLoading) return <div>Loading posts...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      <button onClick={refetch}>Refresh Posts</button>
      <ul>
        {posts?.map(post => (
          <li key={post.id}>
            <h3>{post.title}</h3>
            <p>{post.body}</p>
          </li>
        ))}
      </ul>
    </div>
  );
}

// Create post component
function CreatePost() {
  const queryClient = useQueryClient();
  const mutation = useMutation(createPost, {
    onSuccess: (newPost) => {
      // Update the cache
      queryClient.setQueryData('posts', (oldPosts) => [
        ...oldPosts,
        newPost
      ]);
      // Or invalidate and refetch
      // queryClient.invalidateQueries('posts');
    },
    onError: (error) => {
      console.error('Error creating post:', error);
    }
  });

  const handleSubmit = (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    const newPost = {
      title: formData.get('title'),
      body: formData.get('body'),
    };
    mutation.mutate(newPost);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="title" placeholder="Post title" required />
      <textarea name="body" placeholder="Post content" required />
      <button type="submit" disabled={mutation.isLoading}>
        {mutation.isLoading ? 'Creating...' : 'Create Post'}
      </button>
      {mutation.isError && (
        <div>Error: {mutation.error.message}</div>
      )}
      {mutation.isSuccess && (
        <div>Post created successfully!</div>
      )}
    </form>
  );
}

// App component
function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <div className="app">
        <h1>Posts App</h1>
        <CreatePost />
        <PostsList />
      </div>
    </QueryClientProvider>
  );
}

export default App;`}]},{id:"react-performance-optimization",title:"Performance Optimization and Best Practices",content:`React applications can suffer from performance issues as they grow in complexity. Understanding how to optimize React apps is crucial for delivering fast, responsive user experiences.

**Performance Bottlenecks**:
- **Unnecessary Re-renders**: Components re-rendering when they don't need to
- **Expensive Calculations**: Heavy computations on every render
- **Large Bundle Sizes**: Including unnecessary code
- **Memory Leaks**: Not cleaning up event listeners and subscriptions
- **Inefficient Updates**: Updating DOM elements unnecessarily

**React.memo**:
- Prevents re-renders when props haven't changed
- Shallow comparison by default
- Can provide custom comparison function
- Best for functional components

**useMemo and useCallback**:
- **useMemo**: Memoizes expensive calculations
- **useCallback**: Memoizes function references
- Prevents unnecessary re-computations
- Dependencies array controls when to recalculate

**Code Splitting**:
- **Dynamic imports**: Load code on demand
- **Route-based splitting**: Split by pages/routes
- **Component-based splitting**: Split large components
- **React.lazy**: Built-in code splitting for components

**Bundle Optimization**:
- **Tree shaking**: Remove unused code
- **Compression**: Gzip/Brotli compression
- **Image optimization**: Proper image formats and sizes
- **Vendor splitting**: Separate third-party libraries

**Profiling Tools**:
- **React DevTools Profiler**: Analyze component performance
- **Chrome DevTools**: Memory and performance tabs
- **Lighthouse**: Overall performance auditing
- **Webpack Bundle Analyzer**: Visualize bundle composition

**Best Practices**:
- Use keys properly in lists
- Avoid inline functions in render
- Implement proper error boundaries
- Use production builds for deployment
- Monitor performance metrics regularly`,keyTopics:["React.memo for component memoization","useMemo and useCallback hooks","Code splitting and lazy loading","Bundle optimization techniques","Performance profiling tools"],practicalExercises:["Optimize a slow-rendering component with React.memo","Implement useMemo for expensive calculations","Set up code splitting with React.lazy","Profile and optimize a React application","Implement virtual scrolling for large lists"],codeExamples:[{title:"React.memo - Preventing Unnecessary Re-renders",code:`import React from 'react';

// Without memoization - re-renders on every parent update
function ExpensiveComponent({ data, onClick }) {
  console.log('ExpensiveComponent rendered');
  return (
    <div>
      <h3>Expensive Component</h3>
      <p>Data: {JSON.stringify(data)}</p>
      <button onClick={onClick}>Click me</button>
    </div>
  );
}

// With memoization - only re-renders when props change
const MemoizedExpensiveComponent = React.memo(function ExpensiveComponent({
  data,
  onClick
}) {
  console.log('MemoizedExpensiveComponent rendered');
  return (
    <div>
      <h3>Expensive Component</h3>
      <p>Data: {JSON.stringify(data)}</p>
      <button onClick={onClick}>Click me</button>
    </div>
  );
});

// Custom comparison function
const CustomMemoComponent = React.memo(
  function CustomComponent({ user, count }) {
    console.log('CustomMemoComponent rendered');
    return (
      <div>
        <h4>{user.name}</h4>
        <p>Count: {count}</p>
      </div>
    );
  },
  (prevProps, nextProps) => {
    // Only re-render if user name changed or count increased significantly
    return (
      prevProps.user.name === nextProps.user.name &&
      Math.abs(prevProps.count - nextProps.count) < 5
    );
  }
);

// Usage
function App() {
  const [count, setCount] = useState(0);
  const [otherCount, setOtherCount] = useState(0);

  const user = { name: 'John', age: 30 };

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        Update Count: {count}
      </button>
      <button onClick={() => setOtherCount(otherCount + 1)}>
        Update Other: {otherCount}
      </button>

      {/* This will re-render on every count change */}
      <ExpensiveComponent
        data={user}
        onClick={() => console.log('clicked')}
      />

      {/* This will only re-render when user or onClick changes */}
      <MemoizedExpensiveComponent
        data={user}
        onClick={() => console.log('clicked')}
      />

      {/* This uses custom comparison logic */}
      <CustomMemoComponent
        user={user}
        count={count}
      />
    </div>
  );
}

export default App;`},{title:"useMemo and useCallback - Optimizing Computations",code:`import React, { useState, useMemo, useCallback } from 'react';

// Expensive calculation function
function calculateFibonacci(n) {
  console.log('Calculating Fibonacci for:', n);
  if (n <= 1) return n;
  return calculateFibonacci(n - 1) + calculateFibonacci(n - 2);
}

// Without optimization
function SlowComponent() {
  const [count, setCount] = useState(0);
  const [input, setInput] = useState('');

  // This recalculates on every render
  const fibonacci = calculateFibonacci(count);

  return (
    <div>
      <input
        value={input}
        onChange={(e) => setInput(e.target.value)}
        placeholder="Type something..."
      />
      <button onClick={() => setCount(count + 1)}>
        Increment: {count}
      </button>
      <p>Fibonacci: {fibonacci}</p>
    </div>
  );
}

// With useMemo optimization
function OptimizedComponent() {
  const [count, setCount] = useState(0);
  const [input, setInput] = useState('');

  // Only recalculates when count changes
  const fibonacci = useMemo(() => calculateFibonacci(count), [count]);

  return (
    <div>
      <input
        value={input}
        onChange={(e) => setInput(e.target.value)}
        placeholder="Type something..."
      />
      <button onClick={() => setCount(count + 1)}>
        Increment: {count}
      </button>
      <p>Fibonacci: {fibonacci}</p>
    </div>
  );
}

// With useCallback for event handlers
function EventHandlerComponent() {
  const [count, setCount] = useState(0);
  const [todos, setTodos] = useState([]);

  // Without useCallback - new function on every render
  const addTodo = () => {
    setTodos([...todos, \`Todo \${todos.length + 1}\`]);
  };

  // With useCallback - stable function reference
  const increment = useCallback(() => {
    setCount(prevCount => prevCount + 1);
  }, []); // Empty dependency array - never changes

  const clearTodos = useCallback(() => {
    setTodos([]);
  }, []); // Empty dependency array - never changes

  return (
    <div>
      <button onClick={increment}>Count: {count}</button>
      <button onClick={addTodo}>Add Todo</button>
      <button onClick={clearTodos}>Clear Todos</button>
      <ul>
        {todos.map((todo, index) => (
          <li key={index}>{todo}</li>
        ))}
      </ul>
    </div>
  );
}

// Complex calculation with multiple dependencies
function ComplexCalculationComponent() {
  const [a, setA] = useState(1);
  const [b, setB] = useState(2);
  const [c, setC] = useState(3);

  // Only recalculates when a or b changes
  const result = useMemo(() => {
    console.log('Computing expensive calculation...');
    return (a * b) + Math.sqrt(c);
  }, [a, b]); // c is not in dependencies

  return (
    <div>
      <div>
        <label>A: <input type="number" value={a} onChange={e => setA(Number(e.target.value))} /></label>
      </div>
      <div>
        <label>B: <input type="number" value={b} onChange={e => setB(Number(e.target.value))} /></label>
      </div>
      <div>
        <label>C: <input type="number" value={c} onChange={e => setC(Number(e.target.value))} /></label>
      </div>
      <p>Result: {result}</p>
      <p>Change C - notice result doesn't recalculate</p>
    </div>
  );
}

export { SlowComponent, OptimizedComponent, EventHandlerComponent, ComplexCalculationComponent };`},{title:"Code Splitting with React.lazy and Suspense",code:`import React, { Suspense, lazy } from 'react';
import { BrowserRouter as Router, Routes, Route, Link } from 'react-router-dom';

// Lazy load components
const Home = lazy(() => import('./components/Home'));
const About = lazy(() => import('./components/About'));
const Contact = lazy(() => import('./components/Contact'));
const Dashboard = lazy(() => import('./components/Dashboard'));
const Admin = lazy(() => import('./components/Admin'));

// Loading component
function LoadingSpinner() {
  return (
    <div className="loading-spinner">
      <div className="spinner"></div>
      <p>Loading...</p>
    </div>
  );
}

// Error boundary for lazy loading
class LazyErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Lazy loading error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="error-boundary">
          <h2>Something went wrong.</h2>
          <button onClick={() => this.setState({ hasError: false })}>
            Try again
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// Main App component
function App() {
  return (
    <Router>
      <LazyErrorBoundary>
        <div className="app">
          <nav>
            <Link to="/">Home</Link>
            <Link to="/about">About</Link>
            <Link to="/contact">Contact</Link>
            <Link to="/dashboard">Dashboard</Link>
            <Link to="/admin">Admin</Link>
          </nav>

          <Suspense fallback={<LoadingSpinner />}>
            <Routes>
              <Route path="/" element={<Home />} />
              <Route path="/about" element={<About />} />
              <Route path="/contact" element={<Contact />} />
              <Route path="/dashboard" element={<Dashboard />} />
              <Route path="/admin" element={<Admin />} />
            </Routes>
          </Suspense>
        </div>
      </LazyErrorBoundary>
    </Router>
  );
}

// Component with conditional loading
const ConditionalComponent = lazy(() =>
  import('./components/ConditionalComponent')
);

function AdvancedApp() {
  const [showComponent, setShowComponent] = useState(false);

  return (
    <div>
      <button onClick={() => setShowComponent(true)}>
        Load Conditional Component
      </button>

      {showComponent && (
        <Suspense fallback={<LoadingSpinner />}>
          <ConditionalComponent />
        </Suspense>
      )}
    </div>
  );
}

// Dynamic import with retry logic
function loadComponent(retryCount = 0) {
  return import('./components/HeavyComponent')
    .catch(error => {
      if (retryCount < 3) {
        console.log(\`Retrying component load... (\${retryCount + 1}/3)\`);
        return new Promise(resolve => {
          setTimeout(() => resolve(loadComponent(retryCount + 1)), 1000);
        });
      }
      throw error;
    });
}

const HeavyComponent = lazy(() => loadComponent());

function ResilientApp() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <HeavyComponent />
    </Suspense>
  );
}

export default App;
export { AdvancedApp, ResilientApp };`},{title:"Error Boundaries and Performance Monitoring",code:`import React from 'react';

// Basic Error Boundary
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // Log error to monitoring service
    console.error('Error caught by boundary:', error, errorInfo);

    this.setState({
      error,
      errorInfo
    });

    // Send to error monitoring service
    if (typeof window !== 'undefined' && window.errorMonitoring) {
      window.errorMonitoring.captureException(error, {
        extra: { errorInfo }
      });
    }
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="error-boundary">
          <h2>Something went wrong.</h2>
          <details style={{ whiteSpace: 'pre-wrap' }}>
            <summary>Error Details (Development)</summary>
            {this.state.error && this.state.error.toString()}
            <br />
            {this.state.errorInfo.componentStack}
          </details>
          <button onClick={() => this.setState({ hasError: false })}>
            Try again
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// Higher-Order Component for Error Boundaries
function withErrorBoundary(WrappedComponent, fallbackComponent) {
  return function ErrorBoundaryHOC(props) {
    return (
      <ErrorBoundary fallback={fallbackComponent}>
        <WrappedComponent {...props} />
      </ErrorBoundary>
    );
  };
}

// Performance monitoring hook
function usePerformanceMonitor(componentName) {
  React.useEffect(() => {
    const startTime = performance.now();

    return () => {
      const endTime = performance.now();
      const duration = endTime - startTime;

      console.log(\`\${componentName} render time: \${duration.toFixed(2)}ms\`);

      // Send to monitoring service
      if (typeof window !== 'undefined' && window.performanceMonitoring) {
        window.performanceMonitoring.trackRender(componentName, duration);
      }
    };
  }, [componentName]);
}

// Component with performance monitoring
function MonitoredComponent({ data }) {
  usePerformanceMonitor('MonitoredComponent');

  return (
    <div>
      <h3>Performance Monitored Component</h3>
      <p>Data length: {data.length}</p>
      <ul>
        {data.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
    </div>
  );
}

// Component that throws errors for testing
function BuggyComponent() {
  const [shouldThrow, setShouldThrow] = React.useState(false);

  if (shouldThrow) {
    throw new Error('This is a test error!');
  }

  return (
    <div>
      <button onClick={() => setShouldThrow(true)}>
        Throw Error
      </button>
    </div>
  );
}

// App with error boundaries
function App() {
  return (
    <ErrorBoundary>
      <div className="app">
        <h1>Error Boundary Demo</h1>

        <ErrorBoundary>
          <BuggyComponent />
        </ErrorBoundary>

        <ErrorBoundary>
          <MonitoredComponent data={['Item 1', 'Item 2', 'Item 3']} />
        </ErrorBoundary>

        <ErrorBoundary>
          <div>
            <h2>Normal Component</h2>
            <p>This won't break if other components error.</p>
          </div>
        </ErrorBoundary>
      </div>
    </ErrorBoundary>
  );
}

export default App;
export { ErrorBoundary, withErrorBoundary, usePerformanceMonitor };`}]},{id:"react-testing",title:"Testing React Components and Applications",content:`Testing is crucial for maintaining code quality and preventing regressions in React applications. A comprehensive testing strategy includes unit tests, integration tests, and end-to-end tests.

**Testing Pyramid**:
- **Unit Tests**: Test individual functions and components in isolation
- **Integration Tests**: Test how components work together
- **E2E Tests**: Test complete user workflows

**Testing Libraries**:
- **Jest**: Test runner with assertions and mocking
- **React Testing Library**: Test React components from user perspective
- **Enzyme**: Alternative testing utility (less recommended now)
- **Cypress/Playwright**: End-to-end testing frameworks

**Testing Best Practices**:
- Test behavior, not implementation details
- Use descriptive test names
- Keep tests isolated and independent
- Test error states and edge cases
- Use test doubles (mocks, stubs, spies) appropriately
- Maintain fast test execution

**Types of Tests**:
- **Unit Tests**: Test individual functions and hooks
- **Component Tests**: Test component rendering and interactions
- **Integration Tests**: Test component combinations
- **Snapshot Tests**: Catch unexpected UI changes
- **Accessibility Tests**: Ensure inclusive user experiences

**Test Organization**:
- Group related tests in describe blocks
- Use beforeEach/afterEach for setup/cleanup
- Follow naming conventions (describe, it, test)
- Keep test files close to source files

**Mocking Strategies**:
- Mock external dependencies
- Mock API calls
- Mock browser APIs
- Mock custom hooks
- Use test-specific implementations

**Continuous Integration**:
- Run tests on every commit
- Set up automated test pipelines
- Monitor test coverage
- Fail builds on test failures`,keyTopics:["Unit testing React components","Integration testing strategies","Mocking and test doubles","Testing hooks and custom logic","End-to-end testing approaches"],practicalExercises:["Write unit tests for a custom hook","Test a form component with user interactions","Create integration tests for a multi-component feature","Set up snapshot testing for UI components","Implement accessibility testing"],codeExamples:[{title:"Unit Testing React Components with Jest and RTL",code:`import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import '@testing-library/jest-dom';

// Component to test
function Counter({ initialCount = 0 }) {
  const [count, setCount] = React.useState(initialCount);

  return (
    <div>
      <button onClick={() => setCount(count - 1)}>-</button>
      <span data-testid="count">{count}</span>
      <button onClick={() => setCount(count + 1)}>+</button>
      <button onClick={() => setCount(initialCount)}>Reset</button>
    </div>
  );
}

// Basic rendering test
test('renders counter with initial value', () => {
  render(<Counter initialCount={5} />);
  const countElement = screen.getByTestId('count');
  expect(countElement).toHaveTextContent('5');
});

// User interaction test
test('increments counter when + button is clicked', () => {
  render(<Counter />);
  const countElement = screen.getByTestId('count');
  const incrementButton = screen.getByRole('button', { name: '+' });

  expect(countElement).toHaveTextContent('0');
  userEvent.click(incrementButton);
  expect(countElement).toHaveTextContent('1');
});

// Multiple interactions test
test('handles multiple increment and decrement operations', () => {
  render(<Counter />);
  const countElement = screen.getByTestId('count');
  const incrementButton = screen.getByRole('button', { name: '+' });
  const decrementButton = screen.getByRole('button', { name: '-' });

  userEvent.click(incrementButton);
  userEvent.click(incrementButton);
  expect(countElement).toHaveTextContent('2');

  userEvent.click(decrementButton);
  expect(countElement).toHaveTextContent('1');
});

// Reset functionality test
test('resets counter to initial value', () => {
  render(<Counter initialCount={10} />);
  const countElement = screen.getByTestId('count');
  const incrementButton = screen.getByRole('button', { name: '+' });
  const resetButton = screen.getByRole('button', { name: 'Reset' });

  userEvent.click(incrementButton);
  expect(countElement).toHaveTextContent('11');

  userEvent.click(resetButton);
  expect(countElement).toHaveTextContent('10');
});

// Accessibility test
test('has proper ARIA labels and keyboard navigation', () => {
  render(<Counter />);
  const buttons = screen.getAllByRole('button');

  // Check that buttons are keyboard accessible
  buttons.forEach(button => {
    expect(button).toBeVisible();
    button.focus();
    expect(button).toHaveFocus();
  });
});`},{title:"Testing Custom Hooks",code:`import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import { renderHook, act } from '@testing-library/react-hooks';

// Custom hook to test
function useCounter(initialValue = 0) {
  const [count, setCount] = React.useState(initialValue);

  const increment = React.useCallback(() => {
    setCount(prevCount => prevCount + 1);
  }, []);

  const decrement = React.useCallback(() => {
    setCount(prevCount => prevCount - 1);
  }, []);

  const reset = React.useCallback(() => {
    setCount(initialValue);
  }, [initialValue]);

  return { count, increment, decrement, reset };
}

// Hook testing
describe('useCounter', () => {
  test('should initialize with default value', () => {
    const { result } = renderHook(() => useCounter());
    expect(result.current.count).toBe(0);
  });

  test('should initialize with provided value', () => {
    const { result } = renderHook(() => useCounter(10));
    expect(result.current.count).toBe(10);
  });

  test('should increment count', () => {
    const { result } = renderHook(() => useCounter());

    act(() => {
      result.current.increment();
    });

    expect(result.current.count).toBe(1);
  });

  test('should decrement count', () => {
    const { result } = renderHook(() => useCounter(5));

    act(() => {
      result.current.decrement();
    });

    expect(result.current.count).toBe(4);
  });

  test('should reset to initial value', () => {
    const { result } = renderHook(() => useCounter(10));

    act(() => {
      result.current.increment();
      result.current.increment();
    });
    expect(result.current.count).toBe(12);

    act(() => {
      result.current.reset();
    });
    expect(result.current.count).toBe(10);
  });

  test('should handle multiple operations', () => {
    const { result } = renderHook(() => useCounter());

    act(() => {
      result.current.increment();
      result.current.increment();
      result.current.decrement();
    });

    expect(result.current.count).toBe(1);
  });
});

// Async hook testing
function useAsyncData(url) {
  const [data, setData] = React.useState(null);
  const [loading, setLoading] = React.useState(true);
  const [error, setError] = React.useState(null);

  React.useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch(url);
        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err);
      } finally {
        setLoading(false);
      }
    };

    if (url) {
      fetchData();
    }
  }, [url]);

  return { data, loading, error };
}

// Mock fetch globally
global.fetch = jest.fn();

describe('useAsyncData', () => {
  beforeEach(() => {
    fetch.mockClear();
  });

  test('should handle successful data fetch', async () => {
    const mockData = { id: 1, name: 'Test' };
    fetch.mockResolvedValueOnce({
      json: () => Promise.resolve(mockData)
    });

    const { result, waitForNextUpdate } = renderHook(() =>
      useAsyncData('/api/test')
    );

    expect(result.current.loading).toBe(true);
    expect(result.current.data).toBe(null);

    await waitForNextUpdate();

    expect(result.current.loading).toBe(false);
    expect(result.current.data).toBe(mockData);
    expect(result.current.error).toBe(null);
  });

  test('should handle fetch error', async () => {
    const mockError = new Error('Network error');
    fetch.mockRejectedValueOnce(mockError);

    const { result, waitForNextUpdate } = renderHook(() =>
      useAsyncData('/api/test')
    );

    await waitForNextUpdate();

    expect(result.current.loading).toBe(false);
    expect(result.current.data).toBe(null);
    expect(result.current.error).toBe(mockError);
  });
});`},{title:"Integration Testing with React Testing Library",code:`import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';

// Mock API
const mockAPI = {
  login: jest.fn(),
  logout: jest.fn(),
  getUser: jest.fn()
};

// LoginForm component
function LoginForm({ onLogin }) {
  const [email, setEmail] = React.useState('');
  const [password, setPassword] = React.useState('');
  const [loading, setLoading] = React.useState(false);
  const [error, setError] = React.useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const result = await mockAPI.login(email, password);
      onLogin(result.user);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} data-testid="login-form">
      <div>
        <label htmlFor="email">Email:</label>
        <input
          id="email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
        />
      </div>
      <div>
        <label htmlFor="password">Password:</label>
        <input
          id="password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          required
        />
      </div>
      {error && <div data-testid="error-message">{error}</div>}
      <button type="submit" disabled={loading}>
        {loading ? 'Logging in...' : 'Login'}
      </button>
    </form>
  );
}

// App component that uses LoginForm
function App() {
  const [user, setUser] = React.useState(null);

  const handleLogin = (userData) => {
    setUser(userData);
  };

  const handleLogout = () => {
    mockAPI.logout();
    setUser(null);
  };

  if (user) {
    return (
      <div>
        <h1>Welcome, {user.name}!</h1>
        <button onClick={handleLogout}>Logout</button>
      </div>
    );
  }

  return <LoginForm onLogin={handleLogin} />;
}

// Integration tests
describe('Login Flow Integration', () => {
  beforeEach(() => {
    mockAPI.login.mockClear();
    mockAPI.logout.mockClear();
  });

  test('successful login flow', async () => {
    const mockUser = { id: 1, name: 'John Doe', email: 'john@example.com' };
    mockAPI.login.mockResolvedValueOnce({ user: mockUser });

    render(<App />);

    // Fill out form
    const emailInput = screen.getByLabelText(/email/i);
    const passwordInput = screen.getByLabelText(/password/i);
    const submitButton = screen.getByRole('button', { name: /login/i });

    userEvent.type(emailInput, 'john@example.com');
    userEvent.type(passwordInput, 'password123');
    userEvent.click(submitButton);

    // Check loading state
    expect(submitButton).toBeDisabled();
    expect(submitButton).toHaveTextContent('Logging in...');

    // Wait for login to complete
    await waitFor(() => {
      expect(screen.getByText('Welcome, John Doe!')).toBeInTheDocument();
    });

    expect(mockAPI.login).toHaveBeenCalledWith('john@example.com', 'password123');
    expect(mockAPI.login).toHaveBeenCalledTimes(1);
  });

  test('login error handling', async () => {
    const errorMessage = 'Invalid credentials';
    mockAPI.login.mockRejectedValueOnce(new Error(errorMessage));

    render(<App />);

    const emailInput = screen.getByLabelText(/email/i);
    const passwordInput = screen.getByLabelText(/password/i);
    const submitButton = screen.getByRole('button', { name: /login/i });

    userEvent.type(emailInput, 'wrong@email.com');
    userEvent.type(passwordInput, 'wrongpassword');
    userEvent.click(submitButton);

    // Wait for error to appear
    await waitFor(() => {
      expect(screen.getByTestId('error-message')).toHaveTextContent(errorMessage);
    });

    // Form should still be visible
    expect(emailInput).toBeInTheDocument();
    expect(passwordInput).toBeInTheDocument();
  });

  test('logout functionality', async () => {
    const mockUser = { id: 1, name: 'John Doe', email: 'john@example.com' };
    mockAPI.login.mockResolvedValueOnce({ user: mockUser });

    render(<App />);

    // Login first
    userEvent.type(screen.getByLabelText(/email/i), 'john@example.com');
    userEvent.type(screen.getByLabelText(/password/i), 'password123');
    userEvent.click(screen.getByRole('button', { name: /login/i }));

    await waitFor(() => {
      expect(screen.getByText('Welcome, John Doe!')).toBeInTheDocument();
    });

    // Logout
    const logoutButton = screen.getByRole('button', { name: /logout/i });
    userEvent.click(logoutButton);

    // Should return to login form
    expect(screen.getByTestId('login-form')).toBeInTheDocument();
    expect(mockAPI.logout).toHaveBeenCalledTimes(1);
  });

  test('form validation', () => {
    render(<App />);

    const submitButton = screen.getByRole('button', { name: /login/i });

    // Try to submit empty form
    userEvent.click(submitButton);

    // HTML5 validation should prevent submission
    expect(mockAPI.login).not.toHaveBeenCalled();
  });
});`},{title:"Snapshot Testing and Accessibility Testing",code:`import React from 'react';
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';

// Add jest-axe matchers
expect.extend(toHaveNoViolations);

// Component to test
function ArticleCard({ title, excerpt, author, date }) {
  return (
    <article className="article-card">
      <header>
        <h2>{title}</h2>
        <div className="article-meta">
          <span className="author">By {author}</span>
          <time dateTime={date}>{new Date(date).toLocaleDateString()}</time>
        </div>
      </header>
      <p className="excerpt">{excerpt}</p>
      <footer>
        <button className="read-more">Read More</button>
      </footer>
    </article>
  );
}

// Snapshot test
describe('ArticleCard Snapshots', () => {
  test('renders correctly with all props', () => {
    const { container } = render(
      <ArticleCard
        title="React Testing Best Practices"
        excerpt="Learn how to write maintainable and reliable tests for your React applications."
        author="Jane Smith"
        date="2024-01-15"
      />
    );

    // Create snapshot
    expect(container.firstChild).toMatchSnapshot();
  });

  test('renders with minimal props', () => {
    const { container } = render(
      <ArticleCard
        title="Short Title"
        excerpt="Brief excerpt"
        author="Author"
        date="2024-01-01"
      />
    );

    expect(container.firstChild).toMatchSnapshot();
  });
});

// Accessibility tests
describe('ArticleCard Accessibility', () => {
  test('should have no accessibility violations', async () => {
    const { container } = render(
      <ArticleCard
        title="Accessible Article Title"
        excerpt="This article content is accessible to all users."
        author="Accessibility Expert"
        date="2024-01-15"
      />
    );

    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('should have proper heading hierarchy', () => {
    render(
      <ArticleCard
        title="Test Article"
        excerpt="Test content"
        author="Test Author"
        date="2024-01-15"
      />
    );

    const heading = screen.getByRole('heading', { level: 2 });
    expect(heading).toHaveTextContent('Test Article');
  });

  test('should have proper ARIA labels and semantic HTML', () => {
    render(
      <ArticleCard
        title="Semantic HTML Article"
        excerpt="Content with proper semantics"
        author="Semantic Expert"
        date="2024-01-15"
      />
    );

    // Check semantic elements
    expect(screen.getByRole('article')).toBeInTheDocument();
    expect(screen.getByRole('heading')).toBeInTheDocument();
    expect(screen.getByRole('button')).toBeInTheDocument();

    // Check time element has proper datetime
    const timeElement = screen.getByRole('time');
    expect(timeElement).toHaveAttribute('datetime', '2024-01-15');
  });

  test('should be keyboard navigable', () => {
    render(
      <ArticleCard
        title="Keyboard Navigation Test"
        excerpt="Testing keyboard accessibility"
        author="A11y Tester"
        date="2024-01-15"
      />
    );

    const button = screen.getByRole('button');
    button.focus();
    expect(button).toHaveFocus();
  });
});

// Performance testing utilities
describe('Performance Tests', () => {
  test('renders within performance budget', () => {
    const startTime = performance.now();

    render(
      <ArticleCard
        title="Performance Test Article"
        excerpt="Testing render performance"
        author="Performance Tester"
        date="2024-01-15"
      />
    );

    const endTime = performance.now();
    const renderTime = endTime - startTime;

    // Assert render time is under budget (e.g., 16ms for 60fps)
    expect(renderTime).toBeLessThan(16);
  });

  test('handles large content efficiently', () => {
    const largeExcerpt = 'A'.repeat(10000); // 10KB of content

    const { rerender } = render(
      <ArticleCard
        title="Large Content Test"
        excerpt={largeExcerpt}
        author="Content Tester"
        date="2024-01-15"
      />
    );

    // Measure rerender performance
    const startTime = performance.now();
    rerender(
      <ArticleCard
        title="Updated Large Content Test"
        excerpt={largeExcerpt}
        author="Updated Content Tester"
        date="2024-01-16"
      />
    );
    const endTime = performance.now();

    expect(endTime - startTime).toBeLessThan(10);
  });
});

// Test utilities and helpers
export function renderWithProviders(ui, options = {}) {
  const Wrapper = ({ children }) => (
    <div data-testid="test-wrapper">
      {children}
    </div>
  );

  return render(ui, { wrapper: Wrapper, ...options });
}

export function createMockUser(overrides = {}) {
  return {
    id: 1,
    name: 'Test User',
    email: 'test@example.com',
    avatar: '/avatar.jpg',
    ...overrides
  };
}

export function waitForLoadingToFinish() {
  return waitFor(() => {
    expect(screen.queryByText(/loading/i)).not.toBeInTheDocument();
  });
}

// Custom matchers
expect.extend({
  toBeVisibleInViewport(received) {
    const pass = received && received.getBoundingClientRect().top >= 0;
    return {
      message: () => \`expected element to be visible in viewport\`,
      pass
    };
  }
});`}]},{id:"react-advanced-patterns",title:"Advanced React Patterns and Best Practices",content:`As React applications grow in complexity, mastering advanced patterns becomes essential for maintaining clean, scalable, and maintainable codebases.

**Higher-Order Components (HOC)**:
- Functions that take a component and return an enhanced component
- Used for cross-cutting concerns like authentication, logging, data fetching
- Follow naming convention: withSomething (e.g., withAuth, withData)
- Can be replaced with hooks in many cases but still useful for some patterns

**Render Props Pattern**:
- Components that accept a function as children
- Allows sharing logic between components
- Provides more flexibility than HOC in some cases
- Commonly used in libraries like React Router, Formik

**Compound Components**:
- Group of components that work together
- Share implicit state through React context
- Provide a clean, declarative API
- Example: Select, SelectOption, SelectGroup

**Controlled vs Uncontrolled Components**:
- **Controlled**: Component state controlled by React state
- **Uncontrolled**: Component manages its own state
- Controlled preferred for complex forms and validation
- Uncontrolled useful for simple cases or integration with non-React code

**Custom Hooks**:
- Extract reusable logic from components
- Follow naming convention: useSomething
- Can use other hooks inside custom hooks
- Make components more focused and testable

**Error Boundaries**:
- Catch JavaScript errors in component tree
- Prevent entire app crashes
- Provide fallback UI for error states
- Only work for class components (hooks alternative coming)

**Portals**:
- Render children into a DOM node outside the parent component
- Useful for modals, tooltips, dropdowns
- Break out of parent container styling constraints
- Maintain event bubbling and context

**Suspense for Data Fetching**:
- Declarative way to handle async operations
- Works with React.lazy for code splitting
- Provide loading states at component level
- Better user experience with skeleton screens`,keyTopics:["Higher-Order Components (HOC)","Render props pattern","Compound components","Custom hooks patterns","Error boundaries and error handling"],practicalExercises:["Create a reusable HOC for authentication","Implement a compound component for a custom select","Build a render props component for data fetching","Create custom hooks for form handling","Implement error boundaries for better UX"],codeExamples:[{title:"Higher-Order Components (HOC)",code:`import React from 'react';

// Basic HOC structure
function withLogging(WrappedComponent) {
  return function WithLoggingComponent(props) {
    React.useEffect(() => {
      console.log(\`Component \${WrappedComponent.name} mounted\`);
      return () => {
        console.log(\`Component \${WrappedComponent.name} unmounted\`);
      };
    }, []);

    return <WrappedComponent {...props} />;
  };
}

// HOC with authentication
function withAuth(WrappedComponent) {
  return function WithAuthComponent(props) {
    const [user, setUser] = React.useState(null);
    const [loading, setLoading] = React.useState(true);

    React.useEffect(() => {
      // Simulate authentication check
      const checkAuth = async () => {
        try {
          const userData = await fakeAuthAPI.getCurrentUser();
          setUser(userData);
        } catch (error) {
          // Redirect to login or show error
          console.error('Authentication failed:', error);
        } finally {
          setLoading(false);
        }
      };

      checkAuth();
    }, []);

    if (loading) {
      return <div>Loading...</div>;
    }

    if (!user) {
      return <div>Please log in to access this content.</div>;
    }

    return <WrappedComponent {...props} user={user} />;
  };
}

// HOC with data fetching
function withData(WrappedComponent, dataUrl) {
  return function WithDataComponent(props) {
    const [data, setData] = React.useState(null);
    const [loading, setLoading] = React.useState(true);
    const [error, setError] = React.useState(null);

    React.useEffect(() => {
      const fetchData = async () => {
        try {
          setLoading(true);
          const response = await fetch(dataUrl);
          const result = await response.json();
          setData(result);
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      fetchData();
    }, []);

    return (
      <WrappedComponent
        {...props}
        data={data}
        loading={loading}
        error={error}
      />
    );
  };
}

// Usage
function UserProfile({ user, data, loading, error }) {
  if (loading) return <div>Loading profile...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <div>
      <h2>{user.name}'s Profile</h2>
      <div>Posts: {data?.posts?.length || 0}</div>
      <div>Followers: {data?.followers || 0}</div>
    </div>
  );
}

// Apply multiple HOCs
const AuthenticatedUserProfile = withAuth(
  withLogging(
    withData(UserProfile, '/api/user/profile')
  )
);

function App() {
  return <AuthenticatedUserProfile />;
}

export default App;`},{title:"Render Props Pattern",code:`import React from 'react';

// Basic render props component
class MouseTracker extends React.Component {
  constructor(props) {
    super(props);
    this.state = { x: 0, y: 0 };
  }

  handleMouseMove = (event) => {
    this.setState({
      x: event.clientX,
      y: event.clientY
    });
  };

  render() {
    return (
      <div style={{ height: '100vh' }} onMouseMove={this.handleMouseMove}>
        {this.props.children(this.state)}
      </div>
    );
  }
}

// Usage of render props
function App() {
  return (
    <MouseTracker>
      {mouse => (
        <div>
          <h2>Mouse position:</h2>
          <p>X: {mouse.x}, Y: {mouse.y}</p>
        </div>
      )}
    </MouseTracker>
  );
}

// Advanced render props with data fetching
class DataFetcher extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      data: null,
      loading: true,
      error: null
    };
  }

  componentDidMount() {
    this.fetchData();
  }

  componentDidUpdate(prevProps) {
    if (prevProps.url !== this.props.url) {
      this.fetchData();
    }
  }

  fetchData = async () => {
    try {
      this.setState({ loading: true, error: null });
      const response = await fetch(this.props.url);
      const data = await response.json();
      this.setState({ data, loading: false });
    } catch (error) {
      this.setState({ error: error.message, loading: false });
    }
  };

  render() {
    return this.props.children(this.state);
  }
}

// Usage with different data sources
function UserList() {
  return (
    <DataFetcher url="/api/users">
      {({ data, loading, error }) => {
        if (loading) return <div>Loading users...</div>;
        if (error) return <div>Error: {error}</div>;

        return (
          <ul>
            {data?.map(user => (
              <li key={user.id}>{user.name}</li>
            ))}
          </ul>
        );
      }}
    </DataFetcher>
  );
}

function PostsList() {
  return (
    <DataFetcher url="/api/posts">
      {({ data, loading, error }) => {
        if (loading) return <div>Loading posts...</div>;
        if (error) return <div>Error: {error}</div>;

        return (
          <ul>
            {data?.map(post => (
              <li key={post.id}>
                <h3>{post.title}</h3>
                <p>{post.body}</p>
              </li>
            ))}
          </ul>
        );
      }}
    </DataFetcher>
  );
}

// Render props with form handling
class Form extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      values: props.initialValues || {},
      errors: {},
      touched: {}
    };
  }

  handleChange = (name) => (event) => {
    const { value } = event.target;
    this.setState(prevState => ({
      values: {
        ...prevState.values,
        [name]: value
      }
    }));
  };

  handleBlur = (name) => () => {
    this.setState(prevState => ({
      touched: {
        ...prevState.touched,
        [name]: true
      }
    }));
  };

  handleSubmit = (event) => {
    event.preventDefault();
    this.props.onSubmit(this.state.values);
  };

  render() {
    return this.props.children({
      values: this.state.values,
      errors: this.state.errors,
      touched: this.state.touched,
      handleChange: this.handleChange,
      handleBlur: this.handleBlur,
      handleSubmit: this.handleSubmit
    });
  }
}

// Usage
function LoginForm({ onLogin }) {
  return (
    <Form
      initialValues={{ email: '', password: '' }}
      onSubmit={onLogin}
    >
      {({ values, handleChange, handleBlur, handleSubmit }) => (
        <form onSubmit={handleSubmit}>
          <div>
            <label>Email:</label>
            <input
              type="email"
              name="email"
              value={values.email}
              onChange={handleChange('email')}
              onBlur={handleBlur('email')}
            />
          </div>
          <div>
            <label>Password:</label>
            <input
              type="password"
              name="password"
              value={values.password}
              onChange={handleChange('password')}
              onBlur={handleBlur('password')}
            />
          </div>
          <button type="submit">Login</button>
        </form>
      )}
    </Form>
  );
}

export { MouseTracker, DataFetcher, Form };`},{title:"Compound Components Pattern",code:`import React, { createContext, useContext, useState } from 'react';

// Create context for compound components
const TabsContext = createContext();

// Main Tabs component
function Tabs({ children, defaultActive = 0 }) {
  const [activeTab, setActiveTab] = useState(defaultActive);

  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      <div className="tabs">{children}</div>
    </TabsContext.Provider>
  );
}

// TabList component
function TabList({ children }) {
  return (
    <div className="tab-list" role="tablist">
      {children}
    </div>
  );
}

// Individual Tab component
function Tab({ index, children }) {
  const { activeTab, setActiveTab } = useContext(TabsContext);

  return (
    <button
      className={\`tab \${activeTab === index ? 'active' : ''}\`}
      onClick={() => setActiveTab(index)}
      role="tab"
      aria-selected={activeTab === index}
    >
      {children}
    </button>
  );
}

// TabPanels component
function TabPanels({ children }) {
  return (
    <div className="tab-panels">
      {children}
    </div>
  );
}

// Individual TabPanel component
function TabPanel({ index, children }) {
  const { activeTab } = useContext(TabsContext);

  if (activeTab !== index) {
    return null;
  }

  return (
    <div className="tab-panel" role="tabpanel">
      {children}
    </div>
  );
}

// Usage
function App() {
  return (
    <Tabs defaultActive={0}>
      <TabList>
        <Tab index={0}>Home</Tab>
        <Tab index={1}>About</Tab>
        <Tab index={2}>Contact</Tab>
      </TabList>

      <TabPanels>
        <TabPanel index={0}>
          <h2>Welcome Home</h2>
          <p>This is the home tab content.</p>
        </TabPanel>

        <TabPanel index={1}>
          <h2>About Us</h2>
          <p>Learn more about our company.</p>
        </TabPanel>

        <TabPanel index={2}>
          <h2>Contact Us</h2>
          <p>Get in touch with our team.</p>
        </TabPanel>
      </TabPanels>
    </Tabs>
  );
}

// Advanced compound component with form validation
const FormContext = createContext();

function Form({ children, onSubmit }) {
  const [values, setValues] = useState({});
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});

  const handleChange = (name, value) => {
    setValues(prev => ({ ...prev, [name]: value }));
  };

  const handleBlur = (name) => {
    setTouched(prev => ({ ...prev, [name]: true }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(values);
  };

  return (
    <FormContext.Provider value={{
      values,
      errors,
      touched,
      handleChange,
      handleBlur,
      handleSubmit
    }}>
      <form onSubmit={handleSubmit}>
        {children}
      </form>
    </FormContext.Provider>
  );
}

function FormField({ name, label, type = 'text', validation }) {
  const { values, errors, touched, handleChange, handleBlur } = useContext(FormContext);

  return (
    <div className="form-field">
      <label htmlFor={name}>{label}</label>
      <input
        id={name}
        name={name}
        type={type}
        value={values[name] || ''}
        onChange={(e) => handleChange(name, e.target.value)}
        onBlur={() => handleBlur(name)}
      />
      {touched[name] && errors[name] && (
        <span className="error">{errors[name]}</span>
      )}
    </div>
  );
}

function SubmitButton({ children }) {
  return (
    <button type="submit" className="submit-button">
      {children}
    </button>
  );
}

// Usage
function RegistrationForm() {
  const handleSubmit = (values) => {
    console.log('Form submitted:', values);
  };

  return (
    <Form onSubmit={handleSubmit}>
      <FormField name="firstName" label="First Name" />
      <FormField name="lastName" label="Last Name" />
      <FormField name="email" label="Email" type="email" />
      <FormField name="password" label="Password" type="password" />
      <SubmitButton>Register</SubmitButton>
    </Form>
  );
}

export { Tabs, TabList, Tab, TabPanels, TabPanel, Form, FormField, SubmitButton };`},{title:"Custom Hooks and Advanced Patterns",code:`import { useState, useEffect, useCallback, useRef } from 'react';

// Custom hook for localStorage with SSR support
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    if (typeof window === 'undefined') {
      return initialValue;
    }

    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(\`Error reading localStorage key "\${key}":\`, error);
      return initialValue;
    }
  });

  const setValue = useCallback((value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);

      if (typeof window !== 'undefined') {
        window.localStorage.setItem(key, JSON.stringify(valueToStore));
      }
    } catch (error) {
      console.error(\`Error setting localStorage key "\${key}":\`, error);
    }
  }, [key, storedValue]);

  return [storedValue, setValue];
}

// Custom hook for form handling
function useForm(initialValues = {}, validate) {
  const [values, setValues] = useState(initialValues);
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleChange = useCallback((name, value) => {
    setValues(prev => ({ ...prev, [name]: value }));
  }, []);

  const handleBlur = useCallback((name) => {
    setTouched(prev => ({ ...prev, [name]: true }));
  }, []);

  const handleSubmit = useCallback(async (onSubmit) => {
    setIsSubmitting(true);

    if (validate) {
      const validationErrors = validate(values);
      setErrors(validationErrors);

      if (Object.keys(validationErrors).length > 0) {
        setIsSubmitting(false);
        return;
      }
    }

    try {
      await onSubmit(values);
    } catch (error) {
      console.error('Form submission error:', error);
    } finally {
      setIsSubmitting(false);
    }
  }, [values, validate]);

  const reset = useCallback(() => {
    setValues(initialValues);
    setErrors({});
    setTouched({});
    setIsSubmitting(false);
  }, [initialValues]);

  return {
    values,
    errors,
    touched,
    isSubmitting,
    handleChange,
    handleBlur,
    handleSubmit,
    reset,
    setValues,
    setErrors
  };
}

// Custom hook for async operations
function useAsync(asyncFunction, immediate = true) {
  const [status, setStatus] = useState('idle');
  const [value, setValue] = useState(null);
  const [error, setError] = useState(null);

  const execute = useCallback(() => {
    setStatus('pending');
    setValue(null);
    setError(null);

    return asyncFunction()
      .then(response => {
        setValue(response);
        setStatus('success');
        return response;
      })
      .catch(error => {
        setError(error);
        setStatus('error');
        throw error;
      });
  }, [asyncFunction]);

  useEffect(() => {
    if (immediate) {
      execute();
    }
  }, [execute, immediate]);

  return { execute, status, value, error };
}

// Custom hook for previous value tracking
function usePrevious(value) {
  const ref = useRef();

  useEffect(() => {
    ref.current = value;
  });

  return ref.current;
}

// Custom hook for debounced value
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

// Custom hook for window size
function useWindowSize() {
  const [windowSize, setWindowSize] = useState({
    width: typeof window !== 'undefined' ? window.innerWidth : 0,
    height: typeof window !== 'undefined' ? window.innerHeight : 0
  });

  useEffect(() => {
    function handleResize() {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    }

    if (typeof window !== 'undefined') {
      window.addEventListener('resize', handleResize);
      return () => window.removeEventListener('resize', handleResize);
    }
  }, []);

  return windowSize;
}

// Usage examples
function App() {
  // Local storage
  const [name, setName] = useLocalStorage('name', 'John');

  // Form handling
  const loginForm = useForm(
    { email: '', password: '' },
    (values) => {
      const errors = {};
      if (!values.email) errors.email = 'Email is required';
      if (!values.password) errors.password = 'Password is required';
      return errors;
    }
  );

  // Async operation
  const { execute: login, status, error } = useAsync(async () => {
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(loginForm.values)
    });
    return response.json();
  }, false);

  // Window size
  const { width } = useWindowSize();

  // Debounced search
  const [searchTerm, setSearchTerm] = useState('');
  const debouncedSearchTerm = useDebounce(searchTerm, 300);

  return (
    <div>
      <h1>Custom Hooks Demo</h1>

      {/* Local Storage */}
      <div>
        <input
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder="Enter your name"
        />
        <p>Hello, {name}!</p>
      </div>

      {/* Form */}
      <form onSubmit={(e) => {
        e.preventDefault();
        loginForm.handleSubmit(login);
      }}>
        <input
          name="email"
          value={loginForm.values.email}
          onChange={(e) => loginForm.handleChange('email', e.target.value)}
          onBlur={() => loginForm.handleBlur('email')}
          placeholder="Email"
        />
        {loginForm.errors.email && <span>{loginForm.errors.email}</span>}

        <input
          name="password"
          type="password"
          value={loginForm.values.password}
          onChange={(e) => loginForm.handleChange('password', e.target.value)}
          onBlur={() => loginForm.handleBlur('password')}
          placeholder="Password"
        />
        {loginForm.errors.password && <span>{loginForm.errors.password}</span>}

        <button type="submit" disabled={loginForm.isSubmitting}>
          {loginForm.isSubmitting ? 'Logging in...' : 'Login'}
        </button>
      </form>

      {/* Window size */}
      <p>Window width: {width}px</p>

      {/* Debounced search */}
      <input
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
        placeholder="Search..."
      />
      <p>Searching for: {debouncedSearchTerm}</p>
    </div>
  );
}

export { useLocalStorage, useForm, useAsync, usePrevious, useDebounce, useWindowSize };`}]}],projects:[{title:"React Task Management App",description:"Build a comprehensive task management application using React with advanced state management, custom hooks, and modern React patterns. Include features like task creation, editing, filtering, and local storage persistence."},{title:"React E-commerce Dashboard",description:"Create an admin dashboard for an e-commerce platform with data visualization, real-time updates, and complex state management. Implement features like product management, order tracking, and analytics."},{title:"React Social Media Feed",description:"Develop a social media feed component with infinite scrolling, real-time updates, and advanced interaction patterns. Focus on performance optimization and user experience."},{title:"React Form Builder",description:"Build a drag-and-drop form builder with validation, conditional logic, and multiple output formats. Use compound components and advanced React patterns for a clean API."},{title:"React Data Visualization Library",description:"Create a reusable data visualization library with charts, graphs, and interactive components. Focus on performance, accessibility, and extensibility."}],assessments:[{type:"quiz",questions:[{question:"What is the primary purpose of React Hooks?",options:["To replace class components entirely","To add state and lifecycle features to functional components","To optimize React's rendering performance","To handle routing in React applications"],correctAnswer:"To add state and lifecycle features to functional components"},{question:"Which hook is used to optimize performance by memoizing values?",options:["useState","useEffect","useMemo","useContext"],correctAnswer:"useMemo"},{question:"What is the correct way to prevent unnecessary re-renders in React?",options:["Using React.memo for functional components","Using useCallback for event handlers","Using useMemo for expensive calculations","All of the above"],correctAnswer:"All of the above"},{question:"What is the Context API primarily used for?",options:["Managing local component state","Sharing state between components without prop drilling","Handling side effects in functional components","Optimizing component re-renders"],correctAnswer:"Sharing state between components without prop drilling"},{question:"Which testing library is most commonly used with React?",options:["Mocha","Jasmine","React Testing Library","QUnit"],correctAnswer:"React Testing Library"}]},{type:"evaluation",questions:[{question:"Design a React component architecture for a complex e-commerce product page. Explain your use of hooks, context, and performance optimization techniques.",options:[],correctAnswer:""},{question:"Explain how you would implement a custom hook for data fetching with error handling, loading states, and caching. Provide code examples.",options:[],correctAnswer:""},{question:"Describe the differences between various state management solutions in React (useState, useReducer, Context API, Redux). When would you choose each approach?",options:[],correctAnswer:""}]}],aiPrompts:["How do I create a React component?","What's the difference between useState and useEffect?","How do I optimize React performance?","How do I manage state in React?","How do I test React components?","What's the Context API and when to use it?","How do I handle forms in React?","How do I implement routing in React?","How do I fetch data in React?","How do I handle errors in React?","How do I create custom hooks?","How do I implement authentication in React?","How do I optimize bundle size in React?","How do I handle side effects in React?","How do I implement lazy loading in React?"],resources:[{name:"React Official Documentation",url:"https://reactjs.org/docs/getting-started.html"},{name:"React Hooks Documentation",url:"https://reactjs.org/docs/hooks-intro.html"},{name:"React Testing Library",url:"https://testing-library.com/docs/react-testing-library/intro/"},{name:"React Performance Best Practices",url:"https://reactjs.org/docs/optimizing-performance.html"},{name:"Advanced React Patterns",url:"https://www.patterns.dev/posts/advanced-react-patterns"},{name:"React DevTools",url:"https://reactjs.org/blog/2019/08/15/new-react-devtools.html"},{name:"Create React App",url:"https://create-react-app.dev/"},{name:"Next.js Documentation",url:"https://nextjs.org/docs"}],toolsRequired:["Node.js (v14 or higher)","npm or yarn package manager","Modern web browser with developer tools","Code editor (VS Code recommended)","React Developer Tools browser extension","Jest testing framework","React Testing Library","ESLint for code linting","Prettier for code formatting"],bestPractices:["Use functional components with hooks over class components","Keep components small and focused on a single responsibility","Use meaningful component and prop names","Implement proper TypeScript types for better development experience","Use custom hooks to extract reusable logic","Optimize performance with React.memo, useMemo, and useCallback","Write comprehensive tests for components and hooks","Use the Context API for global state management","Implement proper error boundaries for better user experience","Follow React's best practices for accessibility","Use React's built-in hooks before reaching for external libraries","Keep your bundle size small with code splitting","Use meaningful commit messages and follow conventional commits","Document your components with PropTypes or TypeScript","Use the latest stable version of React and keep dependencies updated","Implement proper loading states and error handling","Use semantic HTML and proper ARIA attributes","Test your application across different browsers and devices","Monitor performance metrics and optimize when necessary","Follow the single responsibility principle for components"],commonPitfalls:["Mutating state directly instead of using setState","Not using dependency arrays correctly in useEffect","Creating infinite re-render loops","Not cleaning up event listeners and subscriptions","Using outdated patterns like class components unnecessarily","Not handling loading and error states properly","Overusing Context API for local state","Not optimizing list rendering with keys","Mixing different state management solutions unnecessarily","Not testing components thoroughly","Ignoring accessibility best practices","Not handling prop validation properly","Creating components that are too large and complex","Not using React's built-in performance optimization features","Ignoring TypeScript for better type safety","Not following React's naming conventions","Using deprecated lifecycle methods","Not handling async operations properly","Creating memory leaks with improper cleanup","Not considering mobile and responsive design"],careerRelevance:"React is one of the most in-demand skills in modern web development, with over 40% of developers using it professionally. Companies like Facebook, Netflix, Airbnb, and thousands of others rely on React for their web applications. Mastering React opens doors to frontend development roles, full-stack positions, and even mobile development with React Native. The ecosystem is vast with excellent job opportunities, competitive salaries, and continuous innovation. React developers are highly sought after for their ability to build scalable, maintainable user interfaces that deliver exceptional user experiences."},RM={id:"firebase",tier:3,name:"Firebase",description:"Firebase is a comprehensive Backend-as-a-Service (BaaS) platform developed by Google that provides developers with a suite of tools and services to build, deploy, and scale web and mobile applications. It offers real-time database capabilities, authentication, cloud storage, serverless functions, and hosting services, enabling developers to focus on building great user experiences without managing backend infrastructure.",difficulty:"intermediate",estimatedHours:18,prerequisites:["javascript","authentication"],learningObjectives:["Set up and configure Firebase projects with proper security settings","Implement Firestore database operations including CRUD operations and real-time listeners","Integrate Firebase Authentication with multiple providers (email, social logins, anonymous)","Manage file uploads and downloads using Firebase Cloud Storage","Deploy serverless functions using Firebase Cloud Functions","Configure and deploy applications using Firebase Hosting","Implement security rules for Firestore and Cloud Storage","Handle offline data synchronization and conflict resolution","Monitor application performance using Firebase Analytics and Performance Monitoring","Implement proper error handling and data validation strategies","Use Firebase Admin SDK for server-side operations","Optimize Firebase usage for cost and performance"],sections:[{id:"firebase-setup-configuration",title:"Firebase Setup and Project Configuration",content:`Firebase setup is the foundation of any Firebase-powered application. The Firebase Console provides a web-based interface for managing all Firebase services, while the Firebase SDK enables seamless integration with web and mobile applications. Proper configuration ensures security, performance, and scalability from the start.

**Firebase Console Overview**:
- **Project Creation**: Setting up new Firebase projects with unique identifiers
- **Service Integration**: Enabling and configuring individual Firebase services
- **Environment Management**: Managing development, staging, and production environments
- **Billing and Usage**: Monitoring resource consumption and managing costs

**SDK Integration**:
- **Web SDK**: JavaScript/TypeScript integration for web applications
- **Mobile SDKs**: Native platform integration for iOS and Android
- **Admin SDK**: Server-side operations and management
- **Configuration**: Environment-specific configuration management

**Security First Approach**:
- **API Keys**: Proper management of Firebase configuration
- **Environment Variables**: Secure storage of sensitive configuration
- **Access Control**: Implementing proper authentication and authorization
- **Data Validation**: Input sanitization and validation strategies

**Best Practices**:
- Use separate Firebase projects for development, staging, and production
- Implement proper error handling for Firebase operations
- Monitor Firebase usage and costs regularly
- Keep Firebase SDKs updated to latest versions
- Use Firebase Security Rules to protect data
- Implement proper logging and monitoring`,keyTopics:["Firebase Console navigation and project setup","SDK integration and configuration","Environment management strategies","Security configuration and API key management"],practicalExercises:["Create a new Firebase project and configure authentication","Set up Firebase SDK in a web application with proper configuration","Configure separate environments for development and production","Implement proper error handling for Firebase initialization"],codeExamples:[{title:"Firebase Project Setup and Configuration",code:`import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';
import { getStorage } from 'firebase/storage';
import { getFunctions } from 'firebase/functions';

// Firebase configuration object
const firebaseConfig = {
  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,
  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,
  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.REACT_APP_FIREBASE_APP_ID,
  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Firebase services
export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);
export const functions = getFunctions(app);

export default app;`},{title:"Environment-Specific Configuration",code:`// .env.local (Development)
REACT_APP_FIREBASE_API_KEY=your_dev_api_key
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project-dev.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project-dev
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project-dev.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=123456789
REACT_APP_FIREBASE_APP_ID=1:123456789:web:abcdef123456
REACT_APP_FIREBASE_MEASUREMENT_ID=G-ABCDEFGHIJ

// .env.production (Production)
REACT_APP_FIREBASE_API_KEY=your_prod_api_key
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=987654321
REACT_APP_FIREBASE_APP_ID=1:987654321:web:zyxwvut987654
REACT_APP_FIREBASE_MEASUREMENT_ID=G-ZYXWVUTSRQ

// config/firebase.js
const getFirebaseConfig = () => {
  const config = {
    development: {
      apiKey: process.env.REACT_APP_FIREBASE_API_KEY,
      authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,
      projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,
      // ... other config
    },
    production: {
      apiKey: process.env.REACT_APP_FIREBASE_PROD_API_KEY,
      authDomain: process.env.REACT_APP_FIREBASE_PROD_AUTH_DOMAIN,
      projectId: process.env.REACT_APP_FIREBASE_PROD_PROJECT_ID,
      // ... other config
    }
  };

  const environment = process.env.NODE_ENV || 'development';
  return config[environment];
};

export default getFirebaseConfig;`}]},{id:"firebase-firestore-database",title:"Firestore Database Operations and Real-Time Data",content:`Firestore is Firebase's NoSQL cloud database that provides real-time data synchronization across all connected clients. It offers flexible data modeling, powerful querying capabilities, and automatic scaling. Understanding Firestore's document-based structure and real-time capabilities is crucial for building responsive applications.

**Firestore Data Model**:
- **Collections**: Groups of documents with similar structure
- **Documents**: Individual records containing fields and data
- **Fields**: Key-value pairs within documents
- **Subcollections**: Nested collections within documents
- **References**: Pointers to other documents or collections

**CRUD Operations**:
- **Create**: Adding new documents to collections
- **Read**: Querying and retrieving document data
- **Update**: Modifying existing document fields
- **Delete**: Removing documents from collections

**Real-Time Updates**:
- **Listeners**: Real-time data synchronization
- **Snapshots**: Current state of queried data
- **Change Types**: Added, modified, removed events
- **Offline Support**: Local data persistence and sync

**Query Capabilities**:
- **Simple Queries**: Basic field comparisons
- **Compound Queries**: Multiple field conditions
- **Range Queries**: Ordering and limiting results
- **Collection Group Queries**: Querying across subcollections

**Performance Optimization**:
- **Indexing**: Automatic and manual index management
- **Pagination**: Efficiently loading large datasets
- **Caching**: Client-side data caching strategies
- **Batch Operations**: Multiple operations in single request

**Best Practices**:
- Design data structure based on query patterns
- Use appropriate data types for fields
- Implement proper error handling for all operations
- Monitor query performance and optimize slow queries
- Use transactions for atomic operations
- Implement data validation at application level`,keyTopics:["Firestore data modeling and document structure","CRUD operations with Firestore","Real-time listeners and data synchronization","Query optimization and performance"],practicalExercises:["Design a Firestore data structure for a social media application","Implement CRUD operations for user profiles and posts","Set up real-time listeners for live chat functionality","Create complex queries with multiple conditions and ordering"],codeExamples:[{title:"Firestore CRUD Operations",code:`import {
  collection,
  doc,
  addDoc,
  updateDoc,
  deleteDoc,
  getDoc,
  getDocs,
  query,
  where,
  orderBy,
  limit,
  onSnapshot
} from 'firebase/firestore';
import { db } from './firebase';

// Create a new document
export const createUser = async (userData) => {
  try {
    const docRef = await addDoc(collection(db, 'users'), {
      ...userData,
      createdAt: new Date(),
      updatedAt: new Date()
    });
    console.log('Document written with ID: ', docRef.id);
    return docRef.id;
  } catch (error) {
    console.error('Error adding document: ', error);
    throw error;
  }
};

// Read a single document
export const getUser = async (userId) => {
  try {
    const docRef = doc(db, 'users', userId);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      return { id: docSnap.id, ...docSnap.data() };
    } else {
      throw new Error('User not found');
    }
  } catch (error) {
    console.error('Error getting document: ', error);
    throw error;
  }
};

// Update a document
export const updateUser = async (userId, updateData) => {
  try {
    const docRef = doc(db, 'users', userId);
    await updateDoc(docRef, {
      ...updateData,
      updatedAt: new Date()
    });
    console.log('Document updated successfully');
  } catch (error) {
    console.error('Error updating document: ', error);
    throw error;
  }
};

// Delete a document
export const deleteUser = async (userId) => {
  try {
    await deleteDoc(doc(db, 'users', userId));
    console.log('Document deleted successfully');
  } catch (error) {
    console.error('Error deleting document: ', error);
    throw error;
  }
};

// Query documents
export const getUsersByRole = async (role) => {
  try {
    const q = query(
      collection(db, 'users'),
      where('role', '==', role),
      orderBy('createdAt', 'desc'),
      limit(10)
    );

    const querySnapshot = await getDocs(q);
    const users = [];
    querySnapshot.forEach((doc) => {
      users.push({ id: doc.id, ...doc.data() });
    });

    return users;
  } catch (error) {
    console.error('Error querying documents: ', error);
    throw error;
  }
};`},{title:"Real-Time Data Synchronization",code:`import { collection, query, where, onSnapshot, orderBy } from 'firebase/firestore';
import { db } from './firebase';

// Real-time listener for user posts
export const subscribeToUserPosts = (userId, callback) => {
  const q = query(
    collection(db, 'posts'),
    where('authorId', '==', userId),
    orderBy('createdAt', 'desc')
  );

  const unsubscribe = onSnapshot(q, (querySnapshot) => {
    const posts = [];
    querySnapshot.forEach((doc) => {
      posts.push({
        id: doc.id,
        ...doc.data(),
        createdAt: doc.data().createdAt?.toDate()
      });
    });

    callback(posts);
  }, (error) => {
    console.error('Error listening to posts: ', error);
  });

  return unsubscribe;
};

// Real-time chat messages listener
export const subscribeToChatMessages = (chatId, callback) => {
  const q = query(
    collection(db, 'chats', chatId, 'messages'),
    orderBy('timestamp', 'asc')
  );

  const unsubscribe = onSnapshot(q, (querySnapshot) => {
    const changes = querySnapshot.docChanges();
    const newMessages = [];

    changes.forEach((change) => {
      if (change.type === 'added') {
        newMessages.push({
          id: change.doc.id,
          ...change.doc.data(),
          timestamp: change.doc.data().timestamp?.toDate()
        });
      }
    });

    if (newMessages.length > 0) {
      callback(newMessages);
    }
  }, (error) => {
    console.error('Error listening to chat messages: ', error);
  });

  return unsubscribe;
};

// Real-time user presence tracking
export const trackUserPresence = (userId) => {
  const userStatusRef = doc(db, 'status', userId);

  // Set user as online
  const setOnline = async () => {
    try {
      await updateDoc(userStatusRef, {
        state: 'online',
        lastChanged: new Date()
      });
    } catch (error) {
      console.error('Error setting online status: ', error);
    }
  };

  // Set user as offline
  const setOffline = async () => {
    try {
      await updateDoc(userStatusRef, {
        state: 'offline',
        lastChanged: new Date()
      });
    } catch (error) {
      console.error('Error setting offline status: ', error);
    }
  };

  // Listen for connection state changes
  const unsubscribe = onSnapshot(doc(db, '.info/connected'), async (snapshot) => {
    if (snapshot.data()?.connected) {
      await setOnline();
    } else {
      await setOffline();
    }
  });

  // Set offline when page unloads
  window.addEventListener('beforeunload', setOffline);

  return () => {
    unsubscribe();
    window.removeEventListener('beforeunload', setOffline);
    setOffline();
  };
};

// Usage in React component
import { useEffect, useState } from 'react';

function UserPosts({ userId }) {
  const [posts, setPosts] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = subscribeToUserPosts(userId, (newPosts) => {
      setPosts(newPosts);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [userId]);

  if (loading) return <div>Loading posts...</div>;

  return (
    <div>
      <h2>User Posts</h2>
      {posts.map(post => (
        <div key={post.id}>
          <h3>{post.title}</h3>
          <p>{post.content}</p>
          <small>{post.createdAt?.toLocaleString()}</small>
        </div>
      ))}
    </div>
  );
}

export default UserPosts;`},{title:"Firestore Security Rules",code:`// firestore.rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    function isAdmin() {
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }

    function hasPermission(permission) {
      return isAuthenticated() &&
             get(/databases/$(database)/documents/user_permissions/$(request.auth.uid)).data[permission] == true;
    }

    // Users collection rules
    match /users/{userId} {
      // Allow read for authenticated users
      allow read: if isAuthenticated();

      // Allow create for anyone (during registration)
      allow create: if request.auth != null &&
                       request.auth.uid == userId &&
                       request.resource.data.keys().hasAll(['email', 'displayName']) &&
                       request.resource.data.email == request.auth.token.email;

      // Allow update for owner or admin
      allow update: if isOwner(userId) || isAdmin();

      // Allow delete for admin only
      allow delete: if isAdmin();
    }

    // Posts collection rules
    match /posts/{postId} {
      // Allow read for all authenticated users
      allow read: if isAuthenticated();

      // Allow create for authenticated users
      allow create: if isAuthenticated() &&
                       request.auth.uid == request.resource.data.authorId &&
                       request.resource.data.keys().hasAll(['title', 'content', 'authorId']);

      // Allow update for author or admin
      allow update: if isOwner(resource.data.authorId) || isAdmin();

      // Allow delete for author or admin
      allow delete: if isOwner(resource.data.authorId) || isAdmin();
    }

    // Comments subcollection rules
    match /posts/{postId}/comments/{commentId} {
      // Allow read for authenticated users
      allow read: if isAuthenticated();

      // Allow create for authenticated users
      allow create: if isAuthenticated() &&
                       request.auth.uid == request.resource.data.authorId;

      // Allow update for author only
      allow update: if isOwner(resource.data.authorId);

      // Allow delete for author or post author or admin
      allow delete: if isOwner(resource.data.authorId) ||
                       isOwner(get(/databases/$(database)/documents/posts/$(postId)).data.authorId) ||
                       isAdmin();
    }

    // Private messages collection
    match /messages/{messageId} {
      // Allow read/write only for participants
      allow read, write: if isAuthenticated() &&
                            (request.auth.uid == resource.data.senderId ||
                             request.auth.uid == resource.data.receiverId);
    }

    // Admin-only collections
    match /admin/{document=**} {
      allow read, write: if isAdmin();
    }

    // Public content (read-only for all)
    match /public/{document=**} {
      allow read: if true;
      allow write: if false;
    }
  }
}

// Validate data structure
function validatePostData() {
  return request.resource.data.keys().hasAll(['title', 'content', 'authorId']) &&
         request.resource.data.title.size() > 0 &&
         request.resource.data.title.size() <= 200 &&
         request.resource.data.content.size() > 0 &&
         request.resource.data.content.size() <= 10000;
}

function validateCommentData() {
  return request.resource.data.keys().hasAll(['content', 'authorId', 'postId']) &&
         request.resource.data.content.size() > 0 &&
         request.resource.data.content.size() <= 1000;
}`}]},{id:"firebase-authentication",title:"Firebase Authentication and User Management",content:`Firebase Authentication provides a comprehensive solution for user authentication and management. It supports multiple authentication methods including email/password, social logins, phone authentication, and anonymous authentication. The service handles user sessions, password resets, email verification, and provides secure token-based authentication.

**Authentication Methods**:
- **Email/Password**: Traditional username and password authentication
- **Social Providers**: Google, Facebook, Twitter, GitHub integration
- **Phone Authentication**: SMS-based verification
- **Anonymous Authentication**: Temporary user sessions
- **Custom Authentication**: Integration with existing authentication systems

**User Management**:
- **User Profiles**: Storing additional user information
- **Email Verification**: Confirming user email addresses
- **Password Reset**: Secure password recovery flow
- **Account Linking**: Connecting multiple authentication providers
- **User Sessions**: Managing login state and session persistence

**Security Features**:
- **Token Management**: JWT tokens for secure API access
- **Session Handling**: Automatic token refresh and session management
- **Security Rules**: Integration with Firestore and Storage security
- **Audit Logging**: Tracking authentication events

**Advanced Features**:
- **Multi-Factor Authentication**: Additional security layer
- **Account Recovery**: Secure account recovery options
- **User Migration**: Importing users from other systems
- **Custom Claims**: Adding custom data to authentication tokens

**Best Practices**:
- Always verify email addresses for important accounts
- Implement proper password policies
- Use secure token storage mechanisms
- Handle authentication errors gracefully
- Monitor authentication events for security
- Implement proper logout functionality
- Use Firebase Security Rules to protect user data`,keyTopics:["Multiple authentication providers and methods","User session management and persistence","Security best practices for authentication","Custom authentication flows and user management"],practicalExercises:["Implement email/password authentication with email verification","Set up social login with Google and Facebook providers","Create a user profile management system","Implement password reset and account recovery flows"],codeExamples:[{title:"Firebase Authentication Setup and Email/Password Auth",code:`import {
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  sendEmailVerification,
  sendPasswordResetEmail,
  onAuthStateChanged,
  updateProfile
} from 'firebase/auth';
import { auth } from './firebase';

// Sign up with email and password
export const signUp = async (email, password, displayName) => {
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Update display name
    await updateProfile(user, {
      displayName: displayName
    });

    // Send email verification
    await sendEmailVerification(user);

    console.log('User signed up successfully:', user.uid);
    return user;
  } catch (error) {
    console.error('Error signing up:', error);
    throw error;
  }
};

// Sign in with email and password
export const signIn = async (email, password) => {
  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Check if email is verified
    if (!user.emailVerified) {
      throw new Error('Please verify your email before signing in.');
    }

    console.log('User signed in successfully:', user.uid);
    return user;
  } catch (error) {
    console.error('Error signing in:', error);
    throw error;
  }
};

// Sign out
export const logout = async () => {
  try {
    await signOut(auth);
    console.log('User signed out successfully');
  } catch (error) {
    console.error('Error signing out:', error);
    throw error;
  }
};

// Send password reset email
export const resetPassword = async (email) => {
  try {
    await sendPasswordResetEmail(auth, email);
    console.log('Password reset email sent successfully');
  } catch (error) {
    console.error('Error sending password reset email:', error);
    throw error;
  }
};

// Resend email verification
export const resendVerificationEmail = async () => {
  try {
    const user = auth.currentUser;
    if (user) {
      await sendEmailVerification(user);
      console.log('Verification email sent successfully');
    } else {
      throw new Error('No user is currently signed in');
    }
  } catch (error) {
    console.error('Error sending verification email:', error);
    throw error;
  }
};

// Auth state listener
export const onAuthStateChange = (callback) => {
  return onAuthStateChanged(auth, (user) => {
    if (user) {
      console.log('User is signed in:', user.uid);
      callback(user);
    } else {
      console.log('User is signed out');
      callback(null);
    }
  });
};`},{title:"Social Authentication Providers",code:`import {
  GoogleAuthProvider,
  FacebookAuthProvider,
  TwitterAuthProvider,
  GithubAuthProvider,
  signInWithPopup,
  signInWithRedirect,
  getRedirectResult,
  linkWithPopup,
  unlink
} from 'firebase/auth';
import { auth } from './firebase';

// Google Authentication
export const signInWithGoogle = async () => {
  try {
    const provider = new GoogleAuthProvider();

    // Add additional scopes if needed
    provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
    provider.setCustomParameters({
      prompt: 'select_account'
    });

    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    console.log('Google sign in successful:', user.uid);
    return user;
  } catch (error) {
    console.error('Error signing in with Google:', error);
    throw error;
  }
};

// Facebook Authentication
export const signInWithFacebook = async () => {
  try {
    const provider = new FacebookAuthProvider();

    // Add permissions
    provider.addScope('email');
    provider.addScope('public_profile');

    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    console.log('Facebook sign in successful:', user.uid);
    return user;
  } catch (error) {
    console.error('Error signing in with Facebook:', error);
    throw error;
  }
};

// GitHub Authentication
export const signInWithGithub = async () => {
  try {
    const provider = new GithubAuthProvider();

    // Add scopes
    provider.addScope('repo');
    provider.addScope('user');

    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    console.log('GitHub sign in successful:', user.uid);
    return user;
  } catch (error) {
    console.error('Error signing in with GitHub:', error);
    throw error;
  }
};

// Handle redirect result (for mobile or when popup is blocked)
export const handleRedirectResult = async () => {
  try {
    const result = await getRedirectResult(auth);

    if (result) {
      const user = result.user;
      console.log('Redirect sign in successful:', user.uid);
      return user;
    }

    return null;
  } catch (error) {
    console.error('Error handling redirect result:', error);
    throw error;
  }
};

// Link multiple authentication providers
export const linkGoogleAccount = async () => {
  try {
    const provider = new GoogleAuthProvider();
    const result = await linkWithPopup(auth.currentUser, provider);

    console.log('Account linked successfully');
    return result.user;
  } catch (error) {
    console.error('Error linking account:', error);
    throw error;
  }
};

// Unlink authentication provider
export const unlinkProvider = async (providerId) => {
  try {
    await unlink(auth.currentUser, providerId);
    console.log('Provider unlinked successfully');
  } catch (error) {
    console.error('Error unlinking provider:', error);
    throw error;
  }
};

// Get available authentication providers
export const getProviderData = () => {
  const user = auth.currentUser;
  if (!user) return [];

  return user.providerData.map(provider => ({
    providerId: provider.providerId,
    displayName: provider.displayName,
    email: provider.email,
    photoURL: provider.photoURL
  }));
};

// Usage in React component
import { useEffect, useState } from 'react';
import { onAuthStateChange, signInWithGoogle, logout } from './auth';

function AuthComponent() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = onAuthStateChange((user) => {
      setUser(user);
      setLoading(false);
    });

    return () => unsubscribe();
  }, []);

  const handleGoogleSignIn = async () => {
    try {
      await signInWithGoogle();
    } catch (error) {
      console.error('Google sign in failed:', error);
    }
  };

  const handleLogout = async () => {
    try {
      await logout();
    } catch (error) {
      console.error('Logout failed:', error);
    }
  };

  if (loading) return <div>Loading...</div>;

  return (
    <div>
      {user ? (
        <div>
          <h2>Welcome, {user.displayName}!</h2>
          <p>Email: {user.email}</p>
          <p>Email verified: {user.emailVerified ? 'Yes' : 'No'}</p>
          <button onClick={handleLogout}>Logout</button>
        </div>
      ) : (
        <div>
          <h2>Please sign in</h2>
          <button onClick={handleGoogleSignIn}>Sign in with Google</button>
        </div>
      )}
    </div>
  );
}

export default AuthComponent;`},{title:"User Profile Management and Custom Claims",code:`import {
  updateProfile,
  updateEmail,
  updatePassword,
  reauthenticateWithCredential,
  EmailAuthProvider
} from 'firebase/auth';
import { doc, setDoc, getDoc, updateDoc } from 'firebase/firestore';
import { auth, db } from './firebase';

// Update user profile
export const updateUserProfile = async (updates) => {
  try {
    const user = auth.currentUser;
    if (!user) throw new Error('No user is currently signed in');

    // Update Firebase Auth profile
    await updateProfile(user, {
      displayName: updates.displayName,
      photoURL: updates.photoURL
    });

    // Update Firestore user document
    const userRef = doc(db, 'users', user.uid);
    await updateDoc(userRef, {
      ...updates,
      updatedAt: new Date()
    });

    console.log('Profile updated successfully');
    return user;
  } catch (error) {
    console.error('Error updating profile:', error);
    throw error;
  }
};

// Update user email (requires reauthentication)
export const updateUserEmail = async (newEmail, currentPassword) => {
  try {
    const user = auth.currentUser;
    if (!user) throw new Error('No user is currently signed in');

    // Reauthenticate user
    const credential = EmailAuthProvider.credential(user.email, currentPassword);
    await reauthenticateWithCredential(user, credential);

    // Update email
    await updateEmail(user, newEmail);

    // Send verification email
    await sendEmailVerification(user);

    // Update Firestore
    const userRef = doc(db, 'users', user.uid);
    await updateDoc(userRef, {
      email: newEmail,
      emailVerified: false,
      updatedAt: new Date()
    });

    console.log('Email updated successfully. Please verify your new email.');
  } catch (error) {
    console.error('Error updating email:', error);
    throw error;
  }
};

// Update user password
export const updateUserPassword = async (currentPassword, newPassword) => {
  try {
    const user = auth.currentUser;
    if (!user) throw new Error('No user is currently signed in');

    // Reauthenticate user
    const credential = EmailAuthProvider.credential(user.email, currentPassword);
    await reauthenticateWithCredential(user, credential);

    // Update password
    await updatePassword(user, newPassword);

    console.log('Password updated successfully');
  } catch (error) {
    console.error('Error updating password:', error);
    throw error;
  }
};

// Get extended user profile from Firestore
export const getUserProfile = async (userId) => {
  try {
    const userRef = doc(db, 'users', userId);
    const userSnap = await getDoc(userRef);

    if (userSnap.exists()) {
      return { id: userSnap.id, ...userSnap.data() };
    } else {
      throw new Error('User profile not found');
    }
  } catch (error) {
    console.error('Error getting user profile:', error);
    throw error;
  }
};

// Create initial user profile
export const createUserProfile = async (user, additionalData = {}) => {
  try {
    const userRef = doc(db, 'users', user.uid);
    const userData = {
      uid: user.uid,
      email: user.email,
      displayName: user.displayName,
      photoURL: user.photoURL,
      emailVerified: user.emailVerified,
      provider: user.providerData[0]?.providerId || 'password',
      createdAt: new Date(),
      updatedAt: new Date(),
      ...additionalData
    };

    await setDoc(userRef, userData);
    console.log('User profile created successfully');
    return userData;
  } catch (error) {
    console.error('Error creating user profile:', error);
    throw error;
  }
};

// Delete user account and profile
export const deleteUserAccount = async () => {
  try {
    const user = auth.currentUser;
    if (!user) throw new Error('No user is currently signed in');

    // Delete Firestore user document
    const userRef = doc(db, 'users', user.uid);
    await deleteDoc(userRef);

    // Delete Firebase Auth user
    await user.delete();

    console.log('User account deleted successfully');
  } catch (error) {
    console.error('Error deleting user account:', error);
    throw error;
  }
};

// Usage in React component
import { useEffect, useState } from 'react';
import { onAuthStateChange, getUserProfile, createUserProfile } from './auth';

function UserProfile() {
  const [user, setUser] = useState(null);
  const [profile, setProfile] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = onAuthStateChange(async (authUser) => {
      setUser(authUser);

      if (authUser) {
        try {
          let userProfile = await getUserProfile(authUser.uid);
          setProfile(userProfile);
        } catch (error) {
          // Profile doesn't exist, create it
          const newProfile = await createUserProfile(authUser, {
            bio: '',
            location: '',
            website: ''
          });
          setProfile(newProfile);
        }
      } else {
        setProfile(null);
      }

      setLoading(false);
    });

    return () => unsubscribe();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (!user) return <div>Please sign in to view your profile</div>;

  return (
    <div>
      <h2>{profile?.displayName || user.displayName}</h2>
      <p>Email: {user.email}</p>
      <p>Bio: {profile?.bio || 'No bio yet'}</p>
      <p>Location: {profile?.location || 'Not specified'}</p>
      <p>Member since: {profile?.createdAt?.toDate().toLocaleDateString()}</p>
    </div>
  );
}

export default UserProfile;`}]},{id:"firebase-cloud-storage",title:"Firebase Cloud Storage for File Management",content:`Firebase Cloud Storage provides secure, scalable file storage and serving capabilities. It integrates seamlessly with Firebase Authentication and Firestore, offering features like file uploads, downloads, metadata management, and access control. Cloud Storage is ideal for storing user-generated content, images, videos, and other media files.

**Storage Architecture**:
- **Buckets**: Top-level containers for files
- **Folders/Paths**: Hierarchical organization of files
- **Files**: Individual stored objects with metadata
- **References**: Pointers to files for upload/download operations

**File Operations**:
- **Upload**: Transferring files to Cloud Storage
- **Download**: Retrieving files from storage
- **Delete**: Removing files from storage
- **Metadata**: Managing file information and properties
- **Progress Tracking**: Monitoring upload/download progress

**Security and Access Control**:
- **Storage Security Rules**: Firebase rules for access control
- **Authentication Integration**: User-based access permissions
- **Public/Private Files**: Controlling file visibility
- **Signed URLs**: Temporary access to private files

**Performance Optimization**:
- **Compression**: Reducing file sizes for faster transfers
- **Caching**: Client-side and CDN caching strategies
- **Resumable Uploads**: Handling interrupted uploads
- **Thumbnail Generation**: Automatic image processing

**Best Practices**:
- Implement proper file validation before upload
- Use appropriate file naming conventions
- Monitor storage usage and costs
- Implement proper error handling for all operations
- Use compression for large files
- Implement proper cleanup of unused files
- Use Firebase Storage security rules effectively`,keyTopics:["File upload and download operations","Storage security rules and access control","File metadata management and optimization","Integration with Firestore for file references"],practicalExercises:["Implement image upload with progress tracking and validation","Create a file management system with CRUD operations","Set up proper storage security rules for user files","Implement file compression and optimization strategies"],codeExamples:[{title:"File Upload and Download Operations",code:`import {
  ref,
  uploadBytes,
  uploadBytesResumable,
  getDownloadURL,
  deleteObject,
  listAll,
  getMetadata,
  updateMetadata
} from 'firebase/storage';
import { storage } from './firebase';

// Upload file to Firebase Storage
export const uploadFile = async (file, path, metadata = {}) => {
  try {
    const storageRef = ref(storage, path);
    const uploadResult = await uploadBytes(storageRef, file, {
      contentType: file.type,
      customMetadata: metadata
    });

    console.log('File uploaded successfully:', uploadResult.ref.fullPath);
    return uploadResult.ref;
  } catch (error) {
    console.error('Error uploading file:', error);
    throw error;
  }
};

// Upload with progress tracking
export const uploadFileWithProgress = (file, path, onProgress, metadata = {}) => {
  return new Promise((resolve, reject) => {
    const storageRef = ref(storage, path);
    const uploadTask = uploadBytesResumable(storageRef, file, {
      contentType: file.type,
      customMetadata: metadata
    });

    // Monitor upload progress
    uploadTask.on('state_changed',
      (snapshot) => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        onProgress(progress);
      },
      (error) => {
        console.error('Upload error:', error);
        reject(error);
      },
      async () => {
        try {
          const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
          resolve({
            ref: uploadTask.snapshot.ref,
            downloadURL,
            metadata: uploadTask.snapshot.metadata
          });
        } catch (error) {
          reject(error);
        }
      }
    );
  });
};

// Download file
export const downloadFile = async (path) => {
  try {
    const storageRef = ref(storage, path);
    const downloadURL = await getDownloadURL(storageRef);
    return downloadURL;
  } catch (error) {
    console.error('Error getting download URL:', error);
    throw error;
  }
};

// Delete file
export const deleteFile = async (path) => {
  try {
    const storageRef = ref(storage, path);
    await deleteObject(storageRef);
    console.log('File deleted successfully');
  } catch (error) {
    console.error('Error deleting file:', error);
    throw error;
  }
};

// List files in directory
export const listFiles = async (path) => {
  try {
    const storageRef = ref(storage, path);
    const result = await listAll(storageRef);

    const files = result.items.map(item => ({
      name: item.name,
      fullPath: item.fullPath,
      bucket: item.bucket
    }));

    return files;
  } catch (error) {
    console.error('Error listing files:', error);
    throw error;
  }
};

// Get file metadata
export const getFileMetadata = async (path) => {
  try {
    const storageRef = ref(storage, path);
    const metadata = await getMetadata(storageRef);
    return metadata;
  } catch (error) {
    console.error('Error getting metadata:', error);
    throw error;
  }
};

// Update file metadata
export const updateFileMetadata = async (path, newMetadata) => {
  try {
    const storageRef = ref(storage, path);
    const updatedMetadata = await updateMetadata(storageRef, {
      customMetadata: newMetadata
    });
    return updatedMetadata;
  } catch (error) {
    console.error('Error updating metadata:', error);
    throw error;
  }
};`},{title:"Image Upload with Compression and Validation",code:`import { uploadFileWithProgress, getDownloadURL } from './storage';
import { doc, updateDoc } from 'firebase/firestore';
import { db } from './firebase';

// Compress image before upload
export const compressImage = (file, maxWidth = 1920, quality = 0.8) => {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

    img.onload = () => {
      // Calculate new dimensions
      let { width, height } = img;

      if (width > maxWidth) {
        height = (height * maxWidth) / width;
        width = maxWidth;
      }

      canvas.width = width;
      canvas.height = height;

      // Draw and compress
      ctx.drawImage(img, 0, 0, width, height);

      canvas.toBlob(resolve, 'image/jpeg', quality);
    };

    img.src = URL.createObjectURL(file);
  });
};

// Validate file before upload
export const validateFile = (file, options = {}) => {
  const {
    maxSize = 10 * 1024 * 1024, // 10MB
    allowedTypes = ['image/jpeg', 'image/png', 'image/gif'],
    allowedExtensions = ['.jpg', '.jpeg', '.png', '.gif']
  } = options;

  // Check file size
  if (file.size > maxSize) {
    throw new Error(\`File size must be less than \${maxSize / (1024 * 1024)}MB\`);
  }

  // Check file type
  if (!allowedTypes.includes(file.type)) {
    throw new Error(\`File type \${file.type} is not allowed. Allowed types: \${allowedTypes.join(', ')}\`);
  }

  // Check file extension
  const fileName = file.name.toLowerCase();
  const hasValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));
  if (!hasValidExtension) {
    throw new Error(\`File extension is not allowed. Allowed extensions: \${allowedExtensions.join(', ')}\`);
  }

  return true;
};

// Upload profile image
export const uploadProfileImage = async (userId, file, onProgress) => {
  try {
    // Validate file
    validateFile(file, {
      maxSize: 5 * 1024 * 1024, // 5MB
      allowedTypes: ['image/jpeg', 'image/png'],
      allowedExtensions: ['.jpg', '.jpeg', '.png']
    });

    // Compress image
    const compressedFile = await compressImage(file);

    // Generate unique filename
    const timestamp = Date.now();
    const extension = file.name.split('.').pop();
    const fileName = \`profile_\${userId}_\${timestamp}.\${extension}\`;
    const path = \`users/\${userId}/profile/\${fileName}\`;

    // Upload with progress
    const result = await uploadFileWithProgress(
      compressedFile,
      path,
      onProgress,
      {
        userId,
        uploadedAt: new Date().toISOString(),
        originalName: file.name,
        compressed: 'true'
      }
    );

    // Update user profile with new image URL
    const userRef = doc(db, 'users', userId);
    await updateDoc(userRef, {
      photoURL: result.downloadURL,
      profileImagePath: result.ref.fullPath,
      updatedAt: new Date()
    });

    return result;
  } catch (error) {
    console.error('Error uploading profile image:', error);
    throw error;
  }
};

// Upload multiple files
export const uploadMultipleFiles = async (userId, files, onProgress) => {
  const uploadPromises = files.map(async (file, index) => {
    try {
      validateFile(file);

      const timestamp = Date.now();
      const extension = file.name.split('.').pop();
      const fileName = \`file_\${userId}_\${timestamp}_\${index}.\${extension}\`;
      const path = \`users/\${userId}/files/\${fileName}\`;

      const result = await uploadFileWithProgress(
        file,
        path,
        (progress) => onProgress(file.name, progress),
        {
          userId,
          uploadedAt: new Date().toISOString(),
          originalName: file.name
        }
      );

      return {
        file: file.name,
        success: true,
        downloadURL: result.downloadURL,
        path: result.ref.fullPath
      };
    } catch (error) {
      return {
        file: file.name,
        success: false,
        error: error.message
      };
    }
  });

  const results = await Promise.allSettled(uploadPromises);
  return results.map(result => result.value || result.reason);
};

// Generate thumbnail for image
export const generateThumbnail = (file, maxSize = 200) => {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

    img.onload = () => {
      const { width, height } = img;

      // Calculate thumbnail dimensions
      let thumbWidth, thumbHeight;
      if (width > height) {
        thumbWidth = maxSize;
        thumbHeight = (height * maxSize) / width;
      } else {
        thumbHeight = maxSize;
        thumbWidth = (width * maxSize) / height;
      }

      canvas.width = thumbWidth;
      canvas.height = thumbHeight;

      ctx.drawImage(img, 0, 0, thumbWidth, thumbHeight);
      canvas.toBlob(resolve, 'image/jpeg', 0.8);
    };

    img.src = URL.createObjectURL(file);
  });
};

// Usage in React component
import { useState } from 'react';
import { uploadProfileImage, uploadMultipleFiles } from './storage';

function FileUploadComponent({ userId }) {
  const [uploading, setUploading] = useState(false);
  const [progress, setProgress] = useState(0);
  const [results, setResults] = useState([]);

  const handleProfileImageUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    setUploading(true);
    setProgress(0);

    try {
      const result = await uploadProfileImage(
        userId,
        file,
        (progress) => setProgress(progress)
      );

      console.log('Profile image uploaded:', result.downloadURL);
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
      setProgress(0);
    }
  };

  const handleMultipleFilesUpload = async (event) => {
    const files = Array.from(event.target.files);
    if (files.length === 0) return;

    setUploading(true);
    setResults([]);

    try {
      const uploadResults = await uploadMultipleFiles(
        userId,
        files,
        (fileName, progress) => {
          console.log(\`\${fileName}: \${progress.toFixed(1)}%\`);
        }
      );

      setResults(uploadResults);
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
    }
  };

  return (
    <div>
      <div>
        <h3>Profile Image</h3>
        <input
          type="file"
          accept="image/*"
          onChange={handleProfileImageUpload}
          disabled={uploading}
        />
        {uploading && <progress value={progress} max="100" />}
      </div>

      <div>
        <h3>Multiple Files</h3>
        <input
          type="file"
          multiple
          onChange={handleMultipleFilesUpload}
          disabled={uploading}
        />
        {uploading && <div>Uploading files...</div>}
      </div>

      {results.length > 0 && (
        <div>
          <h4>Upload Results:</h4>
          <ul>
            {results.map((result, index) => (
              <li key={index}>
                {result.file}: {result.success ? '✅ Success' : \`❌ \${result.error}\`}
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}

export default FileUploadComponent;`},{title:"Firebase Storage Security Rules",code:`// storage.rules

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    function isAdmin() {
      return isAuthenticated() &&
             firestore.exists(/databases/(default)/documents/admins/$(request.auth.uid));
    }

    function isValidImage() {
      return request.resource.contentType.matches('image/.*') &&
             request.resource.size < 10 * 1024 * 1024 && // 10MB
             request.resource.size > 0;
    }

    function isValidDocument() {
      return request.resource.contentType.matches('application/(pdf|msword|vnd.openxmlformats-officedocument.wordprocessingml.document)') &&
             request.resource.size < 25 * 1024 * 1024; // 25MB
    }

    // Public files (read-only for all users)
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if false;
      allow delete: if false;
    }

    // User profile images
    match /users/{userId}/profile/{fileName} {
      // Allow read for all authenticated users
      allow read: if isAuthenticated();

      // Allow write for the user or admin
      allow write: if isOwner(userId) || isAdmin();

      // Allow delete for the user or admin
      allow delete: if isOwner(userId) || isAdmin();

      // Validate file type and size
      allow write: if isValidImage() &&
                      fileName.matches('profile_' + userId + '_\\d+\\.(jpg|jpeg|png|gif)$');

      // Validate metadata
      allow write: if request.resource.metadata['userId'] == userId;
    }

    // User uploaded files
    match /users/{userId}/files/{fileName} {
      // Allow read for the user or admin
      allow read: if isOwner(userId) || isAdmin();

      // Allow write for the user
      allow write: if isOwner(userId) && (
        isValidImage() ||
        isValidDocument() ||
        request.resource.contentType.matches('text/.*') ||
        request.resource.contentType.matches('application/json')
      );

      // Allow delete for the user or admin
      allow delete: if isOwner(userId) || isAdmin();

      // Validate metadata
      allow write: if request.resource.metadata['userId'] == userId;
    }

    // Group or project files
    match /groups/{groupId}/{allPaths=**} {
      // Check if user is member of the group
      function isGroupMember() {
        return isAuthenticated() &&
               firestore.exists(/databases/(default)/documents/groups/$(groupId)/members/$(request.auth.uid));
      }

      // Check if user is group admin
      function isGroupAdmin() {
        return isAuthenticated() &&
               firestore.get(/databases/(default)/documents/groups/$(groupId)/members/$(request.auth.uid)).data.role == 'admin';
      }

      allow read: if isGroupMember() || isGroupAdmin();
      allow write: if isGroupMember();
      allow delete: if isGroupAdmin() || (
        isGroupMember() &&
        request.auth.uid == resource.metadata['uploadedBy']
      );
    }

    // Temporary files (auto-delete after certain time)
    match /temp/{userId}/{fileName} {
      allow read, write: if isOwner(userId);
      allow delete: if isOwner(userId) || isAdmin();

      // Files in temp folder should be automatically cleaned up
      // This would be handled by Cloud Functions
    }

    // Admin-only files
    match /admin/{allPaths=**} {
      allow read, write, delete: if isAdmin();
    }

    // Backup files (read-only)
    match /backups/{allPaths=**} {
      allow read: if isAdmin();
      allow write, delete: if false;
    }

    // Thumbnails (auto-generated)
    match /thumbnails/{allPaths=**} {
      allow read: if true;  // Public read access for thumbnails
      allow write: if false; // Only Cloud Functions can write thumbnails
      allow delete: if false;
    }
  }
}

// Additional validation rules
function validateFileName(fileName) {
  // Prevent directory traversal attacks
  return !fileName.contains('..') &&
         !fileName.contains('/') &&
         !fileName.contains('\\') &&
         fileName.size() > 0 &&
         fileName.size() < 255;
}

function validateMetadata() {
  return request.resource.metadata.keys().hasAll(['userId', 'uploadedAt']) &&
         request.resource.metadata['userId'] == request.auth.uid;
}

// Rate limiting helper (requires Cloud Functions)
function checkRateLimit(userId, operation) {
  // This would check against a Firestore document tracking user operations
  // Implementation would be in Cloud Functions
  return true; // Placeholder
}`}]},{id:"firebase-cloud-functions",title:"Firebase Cloud Functions for Serverless Computing",content:`Firebase Cloud Functions enable serverless computing by running backend code in response to events triggered by Firebase features and HTTPS requests. Functions can be written in Node.js and automatically scale with your application needs. They integrate seamlessly with other Firebase services and can be triggered by various events.

**Function Types**:
- **HTTP Functions**: Respond to HTTP requests and webhooks
- **Callable Functions**: Called directly from client applications
- **Background Functions**: Triggered by Firebase events
- **Scheduled Functions**: Run on a schedule using Cloud Scheduler

**Event Triggers**:
- **Firestore Events**: Document creation, updates, deletions
- **Authentication Events**: User creation, deletion
- **Storage Events**: File upload, deletion, metadata changes
- **Analytics Events**: Conversion events and custom events
- **Pub/Sub**: Custom event-driven triggers

**Function Lifecycle**:
- **Cold Start**: Initial function execution (can be slow)
- **Warm Execution**: Subsequent executions (faster)
- **Scaling**: Automatic scaling based on load
- **Timeout**: Maximum execution time (9 minutes for HTTP, 540 seconds for background)

**Best Practices**:
- Keep functions small and focused on single responsibilities
- Use appropriate memory allocation for function needs
- Implement proper error handling and logging
- Use environment variables for configuration
- Monitor function performance and costs
- Implement proper authentication for sensitive operations
- Use connection pooling for database connections
- Implement retry logic for transient failures

**Security Considerations**:
- Validate input data thoroughly
- Use Firebase Admin SDK for server-side operations
- Implement proper authentication checks
- Avoid exposing sensitive information in function responses
- Use Firebase Security Rules in conjunction with function logic`,keyTopics:["HTTP and callable function implementation","Event-driven background functions","Function deployment and monitoring","Integration with other Firebase services"],practicalExercises:["Create HTTP functions for API endpoints","Implement Firestore-triggered background functions","Set up authentication event handlers","Create scheduled functions for maintenance tasks"],codeExamples:[{title:"HTTP and Callable Cloud Functions",code:`const functions = require('firebase-functions');
const admin = require('firebase-admin');
const cors = require('cors')({ origin: true });

admin.initializeApp();

// HTTP Function - API Endpoint
exports.getUserProfile = functions.https.onRequest(async (req, res) => {
  // Enable CORS
  cors(req, res, async () => {
    try {
      // Only allow GET requests
      if (req.method !== 'GET') {
        return res.status(405).json({ error: 'Method not allowed' });
      }

      // Get user ID from query parameters
      const { userId } = req.query;

      if (!userId) {
        return res.status(400).json({ error: 'User ID is required' });
      }

      // Get user data from Firestore
      const userDoc = await admin.firestore()
        .collection('users')
        .doc(userId)
        .get();

      if (!userDoc.exists) {
        return res.status(404).json({ error: 'User not found' });
      }

      const userData = userDoc.data();

      // Return user profile (exclude sensitive data)
      const profile = {
        uid: userData.uid,
        displayName: userData.displayName,
        email: userData.email,
        photoURL: userData.photoURL,
        bio: userData.bio,
        createdAt: userData.createdAt
      };

      res.json({ profile });
    } catch (error) {
      console.error('Error getting user profile:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  });
});

// Callable Function - Client-side function call
exports.createPost = functions.https.onCall(async (data, context) => {
  // Check if user is authenticated
  if (!context.auth) {
    throw new functions.https.HttpsError(
      'unauthenticated',
      'User must be authenticated to create posts'
    );
  }

  const { title, content, tags = [] } = data;

  // Validate input
  if (!title || !content) {
    throw new functions.https.HttpsError(
      'invalid-argument',
      'Title and content are required'
    );
  }

  if (title.length > 200 || content.length > 10000) {
    throw new functions.https.HttpsError(
      'invalid-argument',
      'Title or content too long'
    );
  }

  try {
    const userId = context.auth.uid;
    const postData = {
      title: title.trim(),
      content: content.trim(),
      tags,
      authorId: userId,
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      updatedAt: admin.firestore.FieldValue.serverTimestamp(),
      likesCount: 0,
      commentsCount: 0
    };

    // Create post document
    const postRef = await admin.firestore()
      .collection('posts')
      .add(postData);

    // Update user's post count
    const userRef = admin.firestore().collection('users').doc(userId);
    await userRef.update({
      postsCount: admin.firestore.FieldValue.increment(1),
      updatedAt: admin.firestore.FieldValue.serverTimestamp()
    });

    return {
      postId: postRef.id,
      message: 'Post created successfully'
    };
  } catch (error) {
    console.error('Error creating post:', error);
    throw new functions.https.HttpsError(
      'internal',
      'Failed to create post'
    );
  }
});

// HTTP Function with Authentication
exports.updateUserProfile = functions.https.onRequest(async (req, res) => {
  cors(req, res, async () => {
    try {
      // Only allow POST requests
      if (req.method !== 'POST') {
        return res.status(405).json({ error: 'Method not allowed' });
      }

      // Verify Firebase Auth token
      const authHeader = req.headers.authorization;
      if (!authHeader || !authHeader.startsWith('Bearer ')) {
        return res.status(401).json({ error: 'Unauthorized' });
      }

      const idToken = authHeader.split('Bearer ')[1];
      let decodedToken;

      try {
        decodedToken = await admin.auth().verifyIdToken(idToken);
      } catch (error) {
        return res.status(401).json({ error: 'Invalid token' });
      }

      const userId = decodedToken.uid;
      const { displayName, bio, website } = req.body;

      // Validate input
      if (displayName && displayName.length > 50) {
        return res.status(400).json({ error: 'Display name too long' });
      }

      if (bio && bio.length > 500) {
        return res.status(400).json({ error: 'Bio too long' });
      }

      // Update user profile
      const updateData = {};
      if (displayName !== undefined) updateData.displayName = displayName;
      if (bio !== undefined) updateData.bio = bio;
      if (website !== undefined) updateData.website = website;
      updateData.updatedAt = admin.firestore.FieldValue.serverTimestamp();

      await admin.firestore()
        .collection('users')
        .doc(userId)
        .update(updateData);

      res.json({ message: 'Profile updated successfully' });
    } catch (error) {
      console.error('Error updating profile:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  });
});`},{title:"Background Functions and Event Triggers",code:`const functions = require('firebase-functions');
const admin = require('firebase-admin');

admin.initializeApp();

// Firestore Trigger - New user created
exports.onUserCreated = functions.firestore
  .document('users/{userId}')
  .onCreate(async (snap, context) => {
    const userData = snap.data();
    const userId = context.params.userId;

    console.log('New user created:', userId);

    try {
      // Create user stats document
      await admin.firestore()
        .collection('userStats')
        .doc(userId)
        .set({
          userId,
          postsCount: 0,
          likesCount: 0,
          followersCount: 0,
          followingCount: 0,
          createdAt: admin.firestore.FieldValue.serverTimestamp()
        });

      // Create user preferences
      await admin.firestore()
        .collection('userPreferences')
        .doc(userId)
        .set({
          userId,
          theme: 'light',
          notifications: {
            email: true,
            push: true,
            likes: true,
            comments: true,
            follows: true
          },
          privacy: {
            profileVisible: true,
            showOnlineStatus: true,
            allowMessages: true
          },
          createdAt: admin.firestore.FieldValue.serverTimestamp()
        });

      // Send welcome email (using a service like SendGrid)
      await sendWelcomeEmail(userData.email, userData.displayName);

      console.log('User initialization completed for:', userId);
    } catch (error) {
      console.error('Error initializing user:', error);
    }
  });

// Firestore Trigger - Post created
exports.onPostCreated = functions.firestore
  .document('posts/{postId}')
  .onCreate(async (snap, context) => {
    const postData = snap.data();
    const postId = context.params.postId;

    console.log('New post created:', postId);

    try {
      // Update post count in tags
      if (postData.tags && postData.tags.length > 0) {
        const tagUpdates = postData.tags.map(tag =>
          admin.firestore()
            .collection('tags')
            .doc(tag)
            .set({
              name: tag,
              postsCount: admin.firestore.FieldValue.increment(1),
              updatedAt: admin.firestore.FieldValue.serverTimestamp()
            }, { merge: true })
        );

        await Promise.all(tagUpdates);
      }

      // Create post analytics
      await admin.firestore()
        .collection('postAnalytics')
        .doc(postId)
        .set({
          postId,
          viewsCount: 0,
          likesCount: 0,
          commentsCount: 0,
          sharesCount: 0,
          createdAt: admin.firestore.FieldValue.serverTimestamp()
        });

      // Notify followers (if this was a real app)
      // This would involve querying followers and sending notifications

      console.log('Post processing completed for:', postId);
    } catch (error) {
      console.error('Error processing post:', error);
    }
  });

// Authentication Trigger - User deleted
exports.onUserDeleted = functions.auth
  .user()
  .onDelete(async (user) => {
    const userId = user.uid;

    console.log('User deleted:', userId);

    try {
      // Delete user data from Firestore
      const batch = admin.firestore().batch();

      // Delete user document
      batch.delete(admin.firestore().collection('users').doc(userId));

      // Delete user stats
      batch.delete(admin.firestore().collection('userStats').doc(userId));

      // Delete user preferences
      batch.delete(admin.firestore().collection('userPreferences').doc(userId));

      // Delete user's posts
      const postsQuery = admin.firestore()
        .collection('posts')
        .where('authorId', '==', userId);

      const postsSnapshot = await postsQuery.get();
      postsSnapshot.forEach(doc => {
        batch.delete(doc.ref);
      });

      // Delete user's likes
      const likesQuery = admin.firestore()
        .collection('likes')
        .where('userId', '==', userId);

      const likesSnapshot = await likesQuery.get();
      likesSnapshot.forEach(doc => {
        batch.delete(doc.ref);
      });

      await batch.commit();

      // Delete user's files from Storage
      const bucket = admin.storage().bucket();
      const [files] = await bucket.getFiles({ prefix: \`users/\${userId}/\` });

      const deletePromises = files.map(file => file.delete());
      await Promise.all(deletePromises);

      console.log('User cleanup completed for:', userId);
    } catch (error) {
      console.error('Error cleaning up user data:', error);
    }
  });

// Storage Trigger - File uploaded
exports.onFileUploaded = functions.storage
  .object()
  .onFinalize(async (object) => {
    const filePath = object.name;
    const bucket = admin.storage().bucket();

    console.log('File uploaded:', filePath);

    try {
      // Generate thumbnail for images
      if (object.contentType.startsWith('image/') &&
          !filePath.includes('thumbnails/')) {

        const thumbnailPath = \`thumbnails/\${filePath}\`;
        const file = bucket.file(filePath);
        const thumbnailFile = bucket.file(thumbnailPath);

        // Download file
        const [fileBuffer] = await file.download();

        // Generate thumbnail (simplified - you'd use a library like sharp)
        const thumbnailBuffer = await generateThumbnail(fileBuffer);

        // Upload thumbnail
        await thumbnailFile.save(thumbnailBuffer, {
          metadata: {
            contentType: object.contentType,
            metadata: {
              originalFile: filePath,
              generatedAt: new Date().toISOString()
            }
          }
        });

        console.log('Thumbnail generated for:', filePath);
      }

      // Update file metadata in Firestore
      const fileDoc = {
        path: filePath,
        size: object.size,
        contentType: object.contentType,
        uploadedAt: admin.firestore.FieldValue.serverTimestamp(),
        userId: extractUserIdFromPath(filePath) // Custom function
      };

      await admin.firestore()
        .collection('files')
        .doc(generateFileId(filePath))
        .set(fileDoc);

    } catch (error) {
      console.error('Error processing uploaded file:', error);
    }
  });

// Scheduled Function - Daily cleanup
exports.dailyCleanup = functions.pubsub
  .schedule('0 2 * * *') // Run daily at 2 AM
  .timeZone('America/New_York')
  .onRun(async (context) => {
    console.log('Running daily cleanup...');

    try {
      // Delete old temporary files
      const bucket = admin.storage().bucket();
      const [files] = await bucket.getFiles({
        prefix: 'temp/',
      });

      const oneDayAgo = new Date();
      oneDayAgo.setDate(oneDayAgo.getDate() - 1);

      const deletePromises = files
        .filter(file => {
          const createdTime = new Date(file.metadata.timeCreated);
          return createdTime < oneDayAgo;
        })
        .map(file => file.delete());

      await Promise.all(deletePromises);

      // Clean up old analytics data
      const analyticsQuery = admin.firestore()
        .collection('analytics')
        .where('createdAt', '<', oneDayAgo);

      const snapshot = await analyticsQuery.get();
      const batch = admin.firestore().batch();

      snapshot.forEach(doc => {
        batch.delete(doc.ref);
      });

      await batch.commit();

      console.log('Daily cleanup completed');
    } catch (error) {
      console.error('Error during daily cleanup:', error);
    }
  });

// Helper functions
async function sendWelcomeEmail(email, displayName) {
  // Implementation would use a service like SendGrid or Mailgun
  console.log(\`Welcome email sent to \${email} for user \${displayName}\`);
}

function extractUserIdFromPath(filePath) {
  // Extract user ID from file path like 'users/userId/filename'
  const parts = filePath.split('/');
  return parts.length >= 2 ? parts[1] : null;
}

function generateFileId(filePath) {
  // Generate a unique ID for the file document
  return filePath.replace(///g, '_').replace(/./g, '_');
}

async function generateThumbnail(buffer) {
  // Simplified thumbnail generation
  // In a real app, you'd use a library like sharp
  return buffer; // Placeholder
}`},{title:"Advanced Function Patterns and Error Handling",code:`const functions = require('firebase-functions');
const admin = require('firebase-admin');
const { PubSub } = require('@google-cloud/pubsub');

admin.initializeApp();
const pubsub = new PubSub();

// Advanced error handling and retry logic
exports.processPayment = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', 'Authentication required');
  }

  const { amount, currency, paymentMethodId } = data;

  // Validate input
  if (!amount || amount <= 0) {
    throw new functions.https.HttpsError('invalid-argument', 'Invalid amount');
  }

  if (!currency || !['USD', 'EUR', 'GBP'].includes(currency)) {
    throw new functions.https.HttpsError('invalid-argument', 'Invalid currency');
  }

  try {
    // Process payment with retry logic
    const paymentResult = await processPaymentWithRetry({
      amount,
      currency,
      paymentMethodId,
      userId: context.auth.uid
    });

    // Log successful payment
    await logPaymentEvent(context.auth.uid, 'success', paymentResult);

    return {
      success: true,
      paymentId: paymentResult.id,
      amount: paymentResult.amount,
      currency: paymentResult.currency
    };

  } catch (error) {
    // Log failed payment
    await logPaymentEvent(context.auth.uid, 'failed', { error: error.message });

    // Throw appropriate error based on error type
    if (error.type === 'card_declined') {
      throw new functions.https.HttpsError('failed-precondition', 'Card was declined');
    } else if (error.type === 'insufficient_funds') {
      throw new functions.https.HttpsError('failed-precondition', 'Insufficient funds');
    } else {
      throw new functions.https.HttpsError('internal', 'Payment processing failed');
    }
  }
});

// Function with timeout and memory optimization
exports.generateReport = functions
  .runWith({
    timeoutSeconds: 540, // 9 minutes
    memory: '1GB'
  })
  .https.onCall(async (data, context) => {
    if (!context.auth) {
      throw new functions.https.HttpsError('unauthenticated', 'Authentication required');
    }

    const { reportType, dateRange } = data;

    try {
      // Start report generation
      const reportId = await startReportGeneration(context.auth.uid, reportType, dateRange);

      // Publish message to Pub/Sub for async processing
      const topicName = 'report-generation';
      const messageData = {
        reportId,
        userId: context.auth.uid,
        reportType,
        dateRange
      };

      await pubsub.topic(topicName).publish(Buffer.from(JSON.stringify(messageData)));

      return {
        reportId,
        status: 'processing',
        message: 'Report generation started. You will be notified when complete.'
      };

    } catch (error) {
      console.error('Error starting report generation:', error);
      throw new functions.https.HttpsError('internal', 'Failed to start report generation');
    }
  });

// Pub/Sub triggered function for async report processing
exports.processReportGeneration = functions
  .runWith({
    timeoutSeconds: 540,
    memory: '2GB'
  })
  .pubsub.topic('report-generation')
  .onPublish(async (message) => {
    const { reportId, userId, reportType, dateRange } = message.json;

    console.log(\`Processing report \${reportId} for user \${userId}\`);

    try {
      // Update report status
      await updateReportStatus(reportId, 'processing');

      // Generate report data (this could take a long time)
      const reportData = await generateReportData(reportType, dateRange, userId);

      // Store report in Cloud Storage
      const bucket = admin.storage().bucket();
      const fileName = \`reports/\${userId}/\${reportId}.json\`;
      const file = bucket.file(fileName);

      await file.save(JSON.stringify(reportData), {
        metadata: {
          contentType: 'application/json',
          metadata: {
            reportId,
            userId,
            reportType,
            generatedAt: new Date().toISOString()
          }
        }
      });

      // Update report status and add download URL
      const [downloadURL] = await file.getSignedUrl({
        action: 'read',
        expires: Date.now() + 7 * 24 * 60 * 60 * 1000 // 7 days
      });

      await updateReportStatus(reportId, 'completed', downloadURL);

      // Send notification to user
      await sendNotification(userId, 'report_ready', {
        reportId,
        downloadURL,
        reportType
      });

      console.log(\`Report \${reportId} completed successfully\`);

    } catch (error) {
      console.error(\`Error processing report \${reportId}:\`, error);

      // Update report status to failed
      await updateReportStatus(reportId, 'failed', null, error.message);

      // Send failure notification
      await sendNotification(userId, 'report_failed', {
        reportId,
        error: error.message
      });
    }
  });

// Function composition and middleware pattern
const withAuth = (handler) => async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', 'Authentication required');
  }
  return handler(data, context);
};

const withValidation = (schema) => (handler) => async (data, context) => {
  const { error } = schema.validate(data);
  if (error) {
    throw new functions.https.HttpsError('invalid-argument', error.details[0].message);
  }
  return handler(data, context);
};

const withLogging = (handler) => async (data, context) => {
  const startTime = Date.now();
  console.log(\`Function called by user \${context.auth?.uid}\`);

  try {
    const result = await handler(data, context);
    const duration = Date.now() - startTime;
    console.log(\`Function completed in \${duration}ms\`);
    return result;
  } catch (error) {
    const duration = Date.now() - startTime;
    console.error(\`Function failed after \${duration}ms:\`, error);
    throw error;
  }
};

// Using function composition
const Joi = require('joi');

const updateProfileSchema = Joi.object({
  displayName: Joi.string().min(1).max(50),
  bio: Joi.string().max(500),
  website: Joi.string().uri()
});

exports.updateProfile = functions.https.onCall(
  withLogging(
    withAuth(
      withValidation(updateProfileSchema)(
        async (data, context) => {
          const userId = context.auth.uid;

          await admin.firestore()
            .collection('users')
            .doc(userId)
            .update({
              ...data,
              updatedAt: admin.firestore.FieldValue.serverTimestamp()
            });

          return { message: 'Profile updated successfully' };
        }
      )
    )
  )
);

// Helper functions
async function processPaymentWithRetry(paymentData, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await processPayment(paymentData);
    } catch (error) {
      if (attempt === maxRetries || !isRetryableError(error)) {
        throw error;
      }
      console.log(\`Payment attempt \${attempt} failed, retrying...\`);
      await sleep(1000 * attempt); // Exponential backoff
    }
  }
}

function isRetryableError(error) {
  // Define which errors should be retried
  return ['network_error', 'timeout', 'server_error'].includes(error.type);
}

async function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function logPaymentEvent(userId, status, data) {
  await admin.firestore().collection('paymentLogs').add({
    userId,
    status,
    data,
    timestamp: admin.firestore.FieldValue.serverTimestamp()
  });
}

async function startReportGeneration(userId, reportType, dateRange) {
  const reportRef = await admin.firestore().collection('reports').add({
    userId,
    reportType,
    dateRange,
    status: 'pending',
    createdAt: admin.firestore.FieldValue.serverTimestamp()
  });

  return reportRef.id;
}

async function updateReportStatus(reportId, status, downloadURL = null, error = null) {
  const updateData = {
    status,
    updatedAt: admin.firestore.FieldValue.serverTimestamp()
  };

  if (downloadURL) updateData.downloadURL = downloadURL;
  if (error) updateData.error = error;

  await admin.firestore()
    .collection('reports')
    .doc(reportId)
    .update(updateData);
}

async function sendNotification(userId, type, data) {
  // Implementation would integrate with FCM or another notification service
  console.log(\`Sending \${type} notification to user \${userId}:\`, data);
}

// Placeholder functions (would be implemented with actual services)
async function processPayment(data) {
  // Integration with payment processor like Stripe
  throw new Error('Payment processing not implemented');
}

async function generateReportData(reportType, dateRange, userId) {
  // Generate actual report data based on type
  return { reportType, dateRange, userId, data: [] };
}`}]},{id:"firebase-hosting-deployment",title:"Firebase Hosting and Application Deployment",content:`Firebase Hosting provides fast, secure, and reliable web hosting for static and dynamic content. It offers global CDN, SSL certificates, and seamless integration with other Firebase services. Hosting supports single-page applications, static sites, and can serve dynamic content through Cloud Functions.

**Hosting Features**:
- **Global CDN**: Fast content delivery worldwide
- **SSL Certificates**: Automatic HTTPS encryption
- **Custom Domains**: Support for custom domain names
- **Rewrites and Redirects**: URL routing and redirection rules
- **Headers Configuration**: Custom HTTP headers
- **Caching**: Intelligent caching strategies

**Deployment Process**:
- **Build Optimization**: Production-ready builds
- **Asset Optimization**: File compression and optimization
- **Deploy Command**: Firebase CLI deployment
- **Version Control**: Rollback and version management
- **Preview Channels**: Test deployments before production

**Performance Optimization**:
- **Lazy Loading**: Code splitting and lazy loading
- **Image Optimization**: Automatic image compression
- **Caching Strategies**: Browser and CDN caching
- **Bundle Analysis**: Bundle size optimization
- **Preloading**: Resource preloading strategies

**Security Features**:
- **HTTPS Enforcement**: Automatic SSL/TLS
- **CSP Headers**: Content Security Policy
- **HSTS**: HTTP Strict Transport Security
- **Security Rules**: Integration with Firebase Security Rules

**Best Practices**:
- Use production builds for deployment
- Implement proper caching strategies
- Monitor performance metrics
- Use preview channels for testing
- Implement proper error pages
- Configure redirects for SEO
- Use Firebase Analytics for insights
- Regularly update dependencies`,keyTopics:["Firebase Hosting setup and configuration","Deployment process and optimization","Custom domains and SSL certificates","Performance monitoring and optimization"],practicalExercises:["Deploy a React application to Firebase Hosting","Configure custom domain and SSL certificate","Set up preview channels for testing","Implement caching and performance optimization"],codeExamples:[{title:"Firebase Hosting Configuration",code:`// firebase.json - Firebase Hosting configuration
{
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "/api/**",
        "function": "api"
      },
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "redirects": [
      {
        "source": "/old-page",
        "destination": "/new-page",
        "type": 301
      }
    ],
    "headers": [
      {
        "source": "**/*.@(js|css)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      },
      {
        "source": "**/*.@(jpg|jpeg|gif|png|svg|webp|ico)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      },
      {
        "source": "/api/**",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "no-cache"
          }
        ]
      },
      {
        "source": "**",
        "headers": [
          {
            "key": "X-Content-Type-Options",
            "value": "nosniff"
          },
          {
            "key": "X-Frame-Options",
            "value": "DENY"
          },
          {
            "key": "X-XSS-Protection",
            "value": "1; mode=block"
          },
          {
            "key": "Referrer-Policy",
            "value": "strict-origin-when-cross-origin"
          }
        ]
      }
    ],
    "trailingSlash": false,
    "appAssociation": "AUTO",
    "cleanUrls": true
  },
  "functions": {
    "source": "functions",
    "runtime": "nodejs18"
  },
  "emulators": {
    "auth": {
      "port": 9099
    },
    "firestore": {
      "port": 8080
    },
    "functions": {
      "port": 5001
    },
    "hosting": {
      "port": 5000
    },
    "storage": {
      "port": 9199
    }
  }
}

// .firebaserc - Firebase project configuration
{
  "projects": {
    "default": "your-project-id",
    "production": "your-project-id",
    "staging": "your-project-id-staging"
  },
  "targets": {
    "your-project-id": {
      "hosting": {
        "production": [
          "your-project-id"
        ],
        "staging": [
          "your-project-id-staging"
        ]
      }
    }
  }
}`},{title:"Deployment Scripts and Automation",code:`// package.json scripts for Firebase deployment
{
  "scripts": {
    "build": "vite build",
    "build:staging": "vite build --mode staging",
    "build:production": "vite build --mode production",
    "deploy": "npm run build && firebase deploy --only hosting",
    "deploy:staging": "npm run build:staging && firebase deploy --only hosting:staging",
    "deploy:production": "npm run build:production && firebase deploy --only hosting:production",
    "deploy:functions": "firebase deploy --only functions",
    "deploy:all": "npm run build && firebase deploy",
    "preview": "npm run build && firebase hosting:channel:deploy preview",
    "preview:staging": "npm run build:staging && firebase hosting:channel:deploy staging-preview",
    "serve": "firebase serve",
    "emulate": "firebase emulators:start",
    "test:emulate": "firebase emulators:exec --only firestore,functions 'npm test'"
  }
}

// deploy.js - Advanced deployment script
const { execSync } = require('child_process');
const fs = require('fs');

function runCommand(command, description) {
  console.log(\`🚀 \${description}...\`);
  try {
    execSync(command, { stdio: 'inherit' });
    console.log(\`✅ \${description} completed\`);
  } catch (error) {
    console.error(\`❌ \${description} failed:\`, error);
    process.exit(1);
  }
}

function checkEnvironment() {
  console.log('🔍 Checking environment...');

  // Check if Firebase CLI is installed
  try {
    execSync('firebase --version', { stdio: 'pipe' });
  } catch (error) {
    console.error('❌ Firebase CLI is not installed. Run: npm install -g firebase-tools');
    process.exit(1);
  }

  // Check if user is logged in
  try {
    execSync('firebase projects:list', { stdio: 'pipe' });
  } catch (error) {
    console.error('❌ Not logged in to Firebase. Run: firebase login');
    process.exit(1);
  }

  console.log('✅ Environment check passed');
}

function validateBuild() {
  console.log('🔍 Validating build...');

  if (!fs.existsSync('dist')) {
    console.error('❌ Build directory not found. Run build first.');
    process.exit(1);
  }

  const indexHtml = fs.readFileSync('dist/index.html', 'utf8');
  if (!indexHtml.includes('<title>')) {
    console.warn('⚠️  index.html might be missing title tag');
  }

  console.log('✅ Build validation passed');
}

function backupCurrentVersion() {
  console.log('💾 Creating backup...');

  try {
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    execSync(\`firebase hosting:clone \${process.env.FIREBASE_PROJECT_ID}:live backup-\${timestamp}\`, { stdio: 'pipe' });
    console.log('✅ Backup created');
  } catch (error) {
    console.warn('⚠️  Backup creation failed, continuing with deployment');
  }
}

function runTests() {
  console.log('🧪 Running tests...');

  try {
    execSync('npm test', { stdio: 'inherit' });
    console.log('✅ Tests passed');
  } catch (error) {
    console.error('❌ Tests failed');
    process.exit(1);
  }
}

function deployToStaging() {
  console.log('🚀 Deploying to staging...');

  runCommand('npm run build:staging', 'Building for staging');
  runCommand('firebase use staging', 'Switching to staging project');
  runCommand('firebase deploy --only hosting', 'Deploying to staging');

  console.log('✅ Staging deployment completed');
  console.log('🌐 Staging URL: https://staging-project-id.web.app');
}

function deployToProduction() {
  console.log('🚀 Deploying to production...');

  // Get confirmation for production deployment
  const readline = require('readline');
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

  rl.question('Are you sure you want to deploy to production? (yes/no): ', (answer) => {
    if (answer.toLowerCase() !== 'yes') {
      console.log('❌ Production deployment cancelled');
      rl.close();
      return;
    }

    rl.close();

    try {
      runCommand('npm run build:production', 'Building for production');
      runCommand('firebase use production', 'Switching to production project');

      // Create backup before production deployment
      backupCurrentVersion();

      runCommand('firebase deploy --only hosting', 'Deploying to production');

      console.log('✅ Production deployment completed');
      console.log('🌐 Production URL: https://your-project-id.web.app');

      // Send deployment notification
      sendDeploymentNotification('production', 'success');

    } catch (error) {
      sendDeploymentNotification('production', 'failed', error.message);
      throw error;
    }
  });
}

function sendDeploymentNotification(environment, status, error = null) {
  // Implementation would send notifications via email, Slack, etc.
  console.log(\`📢 Deployment to \${environment} \${status}\`);

  if (error) {
    console.error('Deployment error:', error);
  }
}

// Main deployment process
const environment = process.argv[2] || 'staging';

console.log(\`🚀 Starting deployment to \${environment}\`);

checkEnvironment();
validateBuild();

if (environment === 'production') {
  runTests(); // Run tests for production
}

if (environment === 'staging') {
  deployToStaging();
} else if (environment === 'production') {
  deployToProduction();
} else {
  console.error(\`❌ Invalid environment: \${environment}. Use 'staging' or 'production'\`);
  process.exit(1);
}

// Usage:
// node deploy.js staging    # Deploy to staging
// node deploy.js production # Deploy to production`},{title:"Performance Monitoring and Optimization",code:`// Performance monitoring setup
import { getPerformance } from 'firebase/performance';
import { getAnalytics } from 'firebase/analytics';

// Initialize Performance Monitoring
const perf = getPerformance(app);
const analytics = getAnalytics(app);

// Custom performance tracing
export const traceApiCall = async (apiName, apiCall) => {
  const trace = perf.trace(apiName);
  trace.start();

  try {
    const result = await apiCall();
    trace.stop();
    return result;
  } catch (error) {
    trace.stop();
    throw error;
  }
};

// Monitor component render performance
import { useEffect } from 'react';

export const usePerformanceTrace = (componentName) => {
  useEffect(() => {
    const trace = perf.trace(\`render_\${componentName}\`);
    trace.start();

    return () => {
      trace.stop();
    };
  }, [componentName]);
};

// Monitor custom metrics
export const recordCustomMetric = (metricName, value) => {
  // Record custom metric
  analytics.logEvent('custom_metric', {
    metric_name: metricName,
    value: value
  });
};

// Bundle analysis and optimization
// vite.config.js
import { defineConfig } from 'vite';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // Separate vendor chunks
          vendor: ['react', 'react-dom'],
          firebase: ['firebase/app', 'firebase/auth', 'firebase/firestore'],
          ui: ['lucide-react', 'tailwindcss']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  plugins: [
    visualizer({
      filename: 'dist/stats.html',
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ]
});

// Service worker for caching
// public/sw.js
const CACHE_NAME = 'my-app-v1';
const urlsToCache = [
  '/',
  '/static/js/bundle.js',
  '/static/css/main.css',
  '/manifest.json'
];

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then((response) => {
        // Return cached version or fetch from network
        return response || fetch(event.request);
      }
    )
  );
});

// Lighthouse CI configuration
// .lighthouseci/config.json
{
  "ci": {
    "collect": {
      "numberOfRuns": 3,
      "startServerCommand": "npm run serve",
      "startServerReadyPattern": "Local development server",
      "url": ["http://localhost:5000"]
    },
    "assert": {
      "assertions": {
        "categories:performance": ["error", {"minScore": 0.9}],
        "categories:accessibility": ["error", {"minScore": 0.9}],
        "categories:best-practices": ["error", {"minScore": 0.9}],
        "categories:seo": ["error", {"minScore": 0.9}],
        "categories:pwa": "off"
      }
    },
    "upload": {
      "target": "temporary-public-storage"
    }
  }
}

// Performance monitoring hook
import { useEffect, useState } from 'react';

export const usePageLoadPerformance = () => {
  const [metrics, setMetrics] = useState(null);

  useEffect(() => {
    const observer = new PerformanceObserver((list) => {
      const entries = list.getEntries();
      const navigation = entries.find(entry => entry.entryType === 'navigation');

      if (navigation) {
        setMetrics({
          dnsLookup: navigation.domainLookupEnd - navigation.domainLookupStart,
          tcpConnect: navigation.connectEnd - navigation.connectStart,
          serverResponse: navigation.responseStart - navigation.requestStart,
          pageLoad: navigation.loadEventEnd - navigation.navigationStart,
          domContentLoaded: navigation.domContentLoadedEventEnd - navigation.navigationStart
        });
      }
    });

    observer.observe({ entryTypes: ['navigation'] });

    return () => observer.disconnect();
  }, []);

  return metrics;
};

// Error boundary with performance tracking
import React from 'react';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    // Log error to Firebase Analytics
    analytics.logEvent('exception', {
      description: error.toString(),
      fatal: false,
      customData: {
        componentStack: errorInfo.componentStack
      }
    });

    // Log to console for development
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="error-boundary">
          <h2>Something went wrong</h2>
          <button onClick={() => this.setState({ hasError: false })}>
            Try again
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

// Web vitals tracking
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

export const reportWebVitals = (metric) => {
  // Send to Firebase Analytics
  analytics.logEvent('web_vitals', {
    name: metric.name,
    value: Math.round(metric.value),
    id: metric.id,
    delta: metric.delta
  });

  // Log to console in development
  if (process.env.NODE_ENV === 'development') {
    console.log(metric);
  }
};

// Initialize web vitals tracking
if (typeof window !== 'undefined') {
  getCLS(reportWebVitals);
  getFID(reportWebVitals);
  getFCP(reportWebVitals);
  getLCP(reportWebVitals);
  getTTFB(reportWebVitals);
}`}]}],projects:[{title:"Firebase Social Media App",description:"Build a complete social media application using Firebase with real-time posts, user authentication, file uploads, and push notifications. Implement features like user profiles, following system, likes, comments, and real-time chat."},{title:"Firebase E-commerce Platform",description:"Create an e-commerce platform with Firebase backend including product catalog, shopping cart, payment processing, order management, and real-time inventory tracking. Implement user reviews, wishlists, and admin dashboard."},{title:"Firebase Task Management System",description:"Develop a collaborative task management application with real-time updates, team management, file attachments, and progress tracking. Include features like project boards, time tracking, and automated notifications."},{title:"Firebase Analytics Dashboard",description:"Build a comprehensive analytics dashboard that aggregates data from multiple Firebase services. Include real-time metrics, custom reports, data visualization, and automated insights generation."},{title:"Firebase IoT Monitoring System",description:"Create an IoT device monitoring system using Firebase for data collection, real-time alerts, device management, and historical data analysis. Implement features like device registration, firmware updates, and predictive maintenance."}],assessments:[{type:"quiz",questions:[{question:"What is the primary purpose of Firestore in Firebase?",options:["File storage and serving","Real-time NoSQL database","User authentication","Serverless function execution"],correctAnswer:"Real-time NoSQL database"},{question:"Which Firebase service is used for user authentication?",options:["Firestore","Firebase Auth","Cloud Storage","Cloud Functions"],correctAnswer:"Firebase Auth"},{question:"What type of security rules are used in Firestore?",options:["SQL-based rules","JSON-based rules","JavaScript functions","YAML configuration files"],correctAnswer:"JavaScript functions"},{question:"Which Firebase service provides file storage capabilities?",options:["Firestore","Firebase Auth","Cloud Storage","Cloud Functions"],correctAnswer:"Cloud Storage"},{question:"What is the maximum timeout for Firebase Cloud Functions?",options:["30 seconds","60 seconds","540 seconds","900 seconds"],correctAnswer:"540 seconds"}]},{type:"evaluation",questions:[{question:"Design a Firebase architecture for a real-time chat application. Explain your choice of database structure, security rules, and real-time synchronization strategy.",options:[],correctAnswer:""},{question:"Compare and contrast Firestore and Realtime Database. When would you choose one over the other for different types of applications?",options:[],correctAnswer:""},{question:"Explain how to implement offline data synchronization in a Firebase application. What are the key considerations and potential challenges?",options:[],correctAnswer:""}]}],aiPrompts:["How do I set up Firebase in my project?","How do I implement user authentication with Firebase?","How do I use Firestore for data storage?","How do I upload files to Firebase Storage?","How do I create Firebase Cloud Functions?","How do I deploy my app to Firebase Hosting?","How do I implement real-time features with Firebase?","How do I secure my Firebase application?","How do I handle offline data in Firebase?","How do I monitor Firebase performance?","How do I implement Firebase Analytics?","How do I use Firebase Security Rules?","How do I optimize Firebase costs?","How do I handle Firebase errors?","How do I migrate data in Firebase?"],resources:[{name:"Firebase Official Documentation",url:"https://firebase.google.com/docs"},{name:"Firestore Documentation",url:"https://firebase.google.com/docs/firestore"},{name:"Firebase Auth Documentation",url:"https://firebase.google.com/docs/auth"},{name:"Cloud Storage Documentation",url:"https://firebase.google.com/docs/storage"},{name:"Cloud Functions Documentation",url:"https://firebase.google.com/docs/functions"},{name:"Firebase Hosting Documentation",url:"https://firebase.google.com/docs/hosting"},{name:"Firebase Security Rules",url:"https://firebase.google.com/docs/security"},{name:"Firebase Performance Monitoring",url:"https://firebase.google.com/docs/perf-mon"}],toolsRequired:["Node.js (v16 or higher)","Firebase CLI","Modern web browser","Code editor (VS Code recommended)","Git for version control","Firebase Admin SDK (for server-side operations)","Postman or similar API testing tool","Lighthouse for performance testing"],bestPractices:["Use separate Firebase projects for development, staging, and production","Implement proper security rules for all Firebase services","Use Firebase Auth for user authentication and authorization","Design Firestore data structure based on query patterns","Implement proper error handling for all Firebase operations","Use Firebase Cloud Functions for server-side logic","Monitor Firebase usage and costs regularly","Implement offline data synchronization when appropriate","Use Firebase Hosting for fast, secure web deployment","Implement proper data validation and sanitization","Use Firebase Analytics for user behavior insights","Optimize bundle sizes and loading performance","Implement proper caching strategies","Use Firebase Performance Monitoring for optimization","Regularly update Firebase SDKs and dependencies","Implement proper logging and monitoring","Use Firebase Security Rules effectively","Design for scalability from the beginning","Implement proper backup and recovery strategies","Use Firebase Admin SDK for server-side operations securely"],commonPitfalls:["Exposing Firebase configuration in client-side code","Not implementing proper security rules","Designing Firestore structure without considering query patterns","Not handling Firebase errors properly","Ignoring offline data synchronization","Not monitoring Firebase costs and usage","Using Firebase Auth tokens insecurely","Not implementing proper data validation","Ignoring Firebase performance optimization","Not using Firebase Admin SDK securely","Designing monolithic Cloud Functions","Not implementing proper error boundaries","Ignoring Firebase security best practices","Not testing Firebase integrations thoroughly","Not implementing proper backup strategies","Using deprecated Firebase features","Not monitoring function execution times","Ignoring Firebase rate limits","Not implementing proper authentication flows","Using Firebase for inappropriate use cases"],careerRelevance:"Firebase is one of the most popular Backend-as-a-Service platforms, used by millions of developers worldwide. Companies like Google, Facebook, Spotify, and thousands of startups rely on Firebase for their applications. Firebase developers are in high demand for full-stack development roles, with competitive salaries and excellent career prospects. The platform's comprehensive feature set makes Firebase developers versatile and valuable in modern web and mobile development ecosystems."},kM={id:"mongodb",tier:3,name:"MongoDB",description:"MongoDB is a leading NoSQL document database that provides high performance, high availability, and easy scalability. It stores data in flexible, JSON-like documents, making it easier to work with data that doesn't fit neatly into traditional relational structures. MongoDB is designed for modern application development and big data processing, offering powerful querying capabilities, indexing strategies, and seamless integration with popular programming languages.",difficulty:"intermediate",estimatedHours:16,prerequisites:["nodejs","json"],learningObjectives:["Design flexible document schemas and data models for MongoDB collections","Implement comprehensive CRUD operations using MongoDB drivers and ODMs","Build complex aggregation pipelines for data analysis and reporting","Create and manage database indexes for optimal query performance","Establish data relationships using embedding and referencing patterns","Deploy and manage MongoDB databases using MongoDB Atlas","Implement backup and recovery strategies for data protection","Handle database transactions and ensure data consistency","Optimize MongoDB performance through proper indexing and query design","Implement security best practices for MongoDB deployments","Use MongoDB Compass for database administration and visualization","Integrate MongoDB with Node.js applications using Mongoose ODM"],sections:[{id:"mongodb-document-modeling",title:"Document Modeling and Schema Design",content:`Document modeling in MongoDB is fundamentally different from traditional relational database design. Instead of normalizing data across multiple tables, MongoDB encourages embedding related data in single documents when possible, while using references for less frequently accessed or highly independent data. The key is finding the right balance between embedding and referencing based on your application's data access patterns.

**Document Structure Principles**:
- **Atomicity**: Design documents to support atomic operations
- **Read Patterns**: Structure data to match common query patterns
- **Write Patterns**: Consider update frequency and complexity
- **Data Relationships**: Choose between embedding and referencing
- **Flexibility**: Leverage MongoDB's schema-less nature appropriately

**Embedding vs Referencing**:
- **Embedding**: Include related data directly in parent documents
- **Referencing**: Store related data in separate collections with references
- **Hybrid Approach**: Combine both strategies for optimal performance

**Schema Design Patterns**:
- **One-to-One**: Simple embedding or referencing
- **One-to-Many**: Embedding for small arrays, referencing for large datasets
- **Many-to-Many**: Reference arrays or intermediate collections
- **Polymorphic**: Handle different document types in same collection

**Best Practices**:
- Design for query patterns, not just storage efficiency
- Consider document size limits (16MB per document)
- Plan for data growth and evolution
- Use meaningful field names and consistent naming conventions
- Implement proper validation rules
- Document your schema decisions for team consistency`,keyTopics:["MongoDB document structure and BSON format","Embedding vs referencing strategies","Schema design patterns for different relationships","Data modeling for performance and scalability"],practicalExercises:["Design a document schema for a blog application with users, posts, and comments","Model a product catalog with categories, reviews, and inventory data","Create a social media schema with users, posts, likes, and followers","Design an e-commerce schema with orders, products, and customer data"],codeExamples:[{title:"User Profile Document Schema",code:`// User profile with embedded preferences and referenced posts
const userSchema = {
  _id: ObjectId("507f1f77bcf86cd799439011"),
  username: "johndoe",
  email: "john.doe@example.com",
  profile: {
    firstName: "John",
    lastName: "Doe",
    avatar: "https://example.com/avatar.jpg",
    bio: "Software developer passionate about MongoDB",
    location: {
      city: "San Francisco",
      state: "CA",
      country: "USA"
    }
  },
  preferences: {
    theme: "dark",
    notifications: {
      email: true,
      push: false,
      sms: false
    },
    privacy: {
      profileVisible: true,
      showOnlineStatus: true,
      allowMessages: true
    }
  },
  stats: {
    postsCount: 42,
    followersCount: 156,
    followingCount: 89,
    joinedAt: ISODate("2023-01-15T00:00:00Z"),
    lastActiveAt: ISODate("2024-01-20T14:30:00Z")
  },
  // Reference to posts (one-to-many relationship)
  postIds: [
    ObjectId("507f1f77bcf86cd799439012"),
    ObjectId("507f1f77bcf86cd799439013")
  ]
};

// Post document with author reference
const postSchema = {
  _id: ObjectId("507f1f77bcf86cd799439012"),
  title: "Getting Started with MongoDB",
  content: "MongoDB is a powerful NoSQL database...",
  excerpt: "Learn the basics of MongoDB document modeling",
  authorId: ObjectId("507f1f77bcf86cd799439011"), // Reference to user
  tags: ["mongodb", "nosql", "database"],
  category: "Technology",
  status: "published",
  metadata: {
    wordCount: 1250,
    readingTime: 6,
    featured: true
  },
  stats: {
    views: 1250,
    likes: 45,
    comments: 12
  },
  publishedAt: ISODate("2024-01-15T10:00:00Z"),
  updatedAt: ISODate("2024-01-15T10:00:00Z"),
  // Embedded comments (for frequently accessed data)
  recentComments: [
    {
      _id: ObjectId("507f1f77bcf86cd799439014"),
      authorId: ObjectId("507f1f77bcf86cd799439015"),
      content: "Great article!",
      createdAt: ISODate("2024-01-16T09:30:00Z")
    }
  ]
};`},{title:"E-commerce Product Catalog Schema",code:`// Product document with embedded variants and reviews
const productSchema = {
  _id: ObjectId("507f1f77bcf86cd799439016"),
  name: "Wireless Bluetooth Headphones",
  description: "High-quality wireless headphones with noise cancellation",
  sku: "WH-1000XM4",
  brand: "Sony",
  category: "Electronics",
  subcategory: "Audio",
  price: {
    current: 299.99,
    original: 349.99,
    currency: "USD",
    discount: 14.3
  },
  inventory: {
    total: 150,
    available: 89,
    reserved: 12,
    lowStockThreshold: 10
  },
  // Embedded product variants
  variants: [
    {
      _id: ObjectId("507f1f77bcf86cd799439017"),
      name: "Black",
      sku: "WH-1000XM4-BLK",
      price: 299.99,
      inventory: 45,
      images: [
        "https://example.com/product-black-1.jpg",
        "https://example.com/product-black-2.jpg"
      ]
    },
    {
      _id: ObjectId("507f1f77bcf86cd799439018"),
      name: "White",
      sku: "WH-1000XM4-WHT",
      price: 299.99,
      inventory: 44,
      images: [
        "https://example.com/product-white-1.jpg",
        "https://example.com/product-white-2.jpg"
      ]
    }
  ],
  specifications: {
    batteryLife: "30 hours",
    connectivity: "Bluetooth 5.0",
    weight: "250g",
    dimensions: {
      length: 18.5,
      width: 16.5,
      height: 8.0,
      unit: "cm"
    }
  },
  // Embedded reviews summary for quick access
  reviewsSummary: {
    averageRating: 4.5,
    totalReviews: 128,
    ratingDistribution: {
      5: 89,
      4: 25,
      3: 8,
      2: 4,
      1: 2
    }
  },
  tags: ["wireless", "bluetooth", "noise-cancelling", "sony"],
  seo: {
    metaTitle: "Sony WH-1000XM4 Wireless Headphones",
    metaDescription: "Premium wireless headphones with industry-leading noise cancellation",
    slug: "sony-wh-1000xm4-wireless-headphones"
  },
  createdAt: ISODate("2024-01-01T00:00:00Z"),
  updatedAt: ISODate("2024-01-20T12:00:00Z")
};

// Separate reviews collection for detailed reviews
const reviewSchema = {
  _id: ObjectId("507f1f77bcf86cd799439019"),
  productId: ObjectId("507f1f77bcf86cd799439016"),
  userId: ObjectId("507f1f77bcf86cd799439011"),
  orderId: ObjectId("507f1f77bcf86cd799439020"),
  rating: 5,
  title: "Excellent sound quality!",
  content: "These headphones exceeded my expectations...",
  pros: ["Great sound", "Comfortable", "Long battery life"],
  cons: ["Pricey"],
  verified: true, // Purchased on our platform
  helpful: {
    count: 12,
    votedBy: [ObjectId("..."), ObjectId("...")]
  },
  images: [
    "https://example.com/review-image-1.jpg"
  ],
  createdAt: ISODate("2024-01-18T15:30:00Z"),
  updatedAt: ISODate("2024-01-18T15:30:00Z")
};`}]},{id:"mongodb-crud-operations",title:"CRUD Operations with MongoDB Drivers",content:`MongoDB provides official drivers for most programming languages, enabling seamless integration with applications. The Node.js driver offers both callback-based and promise-based APIs, with Mongoose providing an additional Object-Document Mapping (ODM) layer for enhanced developer experience. Understanding CRUD operations is fundamental to working effectively with MongoDB.

**MongoDB Node.js Driver**:
- **Connection Management**: Establishing and managing database connections
- **Database Operations**: Working with databases, collections, and documents
- **Query Building**: Constructing queries with filters, projections, and options
- **Result Handling**: Processing query results and handling errors
- **Connection Pooling**: Efficient connection management for high-performance applications

**Mongoose ODM Features**:
- **Schema Definition**: Defining document structure and validation rules
- **Model Creation**: Creating models for database operations
- **Middleware**: Pre and post operation hooks
- **Plugins**: Extending functionality with reusable plugins
- **Population**: Automatic referencing and data population

**CRUD Operation Patterns**:
- **Create**: Inserting single or multiple documents
- **Read**: Querying documents with various filters and options
- **Update**: Modifying existing documents with different strategies
- **Delete**: Removing documents with safety considerations

**Advanced Query Features**:
- **Projection**: Selecting specific fields to return
- **Sorting**: Ordering results by one or more fields
- **Pagination**: Implementing efficient pagination strategies
- **Text Search**: Full-text search capabilities
- **Geospatial Queries**: Location-based queries and operations

**Best Practices**:
- Use connection pooling for better performance
- Implement proper error handling for all operations
- Use indexes to optimize query performance
- Validate data before insertion
- Use transactions for multi-document operations
- Implement proper logging and monitoring`,keyTopics:["MongoDB Node.js driver setup and configuration","Basic CRUD operations with native driver","Mongoose ODM schema definition and models","Advanced querying techniques and operators"],practicalExercises:["Implement user registration and profile management with MongoDB","Create a blog system with posts, comments, and user interactions","Build a product catalog with search and filtering capabilities","Develop a task management system with MongoDB backend"],codeExamples:[{title:"MongoDB Node.js Driver CRUD Operations",code:`const { MongoClient } = require('mongodb');

// Connection URL
const url = 'mongodb://localhost:27017';
const client = new MongoClient(url);

// Database Name
const dbName = 'myapp';

async function connectToMongoDB() {
  try {
    await client.connect();
    console.log('Connected successfully to MongoDB');
    const db = client.db(dbName);
    return db;
  } catch (error) {
    console.error('MongoDB connection error:', error);
    throw error;
  }
}

// CREATE - Insert single document
async function createUser(userData) {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    const result = await collection.insertOne({
      ...userData,
      createdAt: new Date(),
      updatedAt: new Date()
    });

    console.log('User created with ID:', result.insertedId);
    return result.insertedId;
  } catch (error) {
    console.error('Error creating user:', error);
    throw error;
  }
}

// READ - Find documents with various queries
async function getUsers(query = {}, options = {}) {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    const users = await collection.find(query, options).toArray();
    return users;
  } catch (error) {
    console.error('Error fetching users:', error);
    throw error;
  }
}

// UPDATE - Update single document
async function updateUser(userId, updateData) {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    const result = await collection.updateOne(
      { _id: new ObjectId(userId) },
      {
        $set: {
          ...updateData,
          updatedAt: new Date()
        }
      }
    );

    if (result.matchedCount === 0) {
      throw new Error('User not found');
    }

    console.log('User updated successfully');
    return result;
  } catch (error) {
    console.error('Error updating user:', error);
    throw error;
  }
}

// DELETE - Delete single document
async function deleteUser(userId) {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    const result = await collection.deleteOne({ _id: new ObjectId(userId) });

    if (result.deletedCount === 0) {
      throw new Error('User not found');
    }

    console.log('User deleted successfully');
    return result;
  } catch (error) {
    console.error('Error deleting user:', error);
    throw error;
  }
}

// Advanced queries
async function searchUsers() {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    // Find active users with pagination
    const activeUsers = await collection
      .find({ status: 'active' })
      .sort({ createdAt: -1 })
      .limit(10)
      .skip(0)
      .toArray();

    // Find users by email pattern
    const emailUsers = await collection
      .find({ email: { $regex: '@company.com$', $options: 'i' } })
      .toArray();

    // Find users with specific preferences
    const preferenceUsers = await collection
      .find({
        'preferences.notifications.email': true,
        'stats.postsCount': { $gte: 5 }
      })
      .project({ username: 1, email: 1, stats: 1 })
      .toArray();

    return { activeUsers, emailUsers, preferenceUsers };
  } catch (error) {
    console.error('Error searching users:', error);
    throw error;
  }
}

// Bulk operations
async function bulkInsertUsers(users) {
  const db = await connectToMongoDB();
  const collection = db.collection('users');

  try {
    const bulkOps = users.map(user => ({
      insertOne: {
        document: {
          ...user,
          createdAt: new Date(),
          updatedAt: new Date()
        }
      }
    }));

    const result = await collection.bulkWrite(bulkOps);
    console.log('Bulk insert completed:', result.insertedCount, 'documents');
    return result;
  } catch (error) {
    console.error('Error in bulk insert:', error);
    throw error;
  }
}

module.exports = {
  connectToMongoDB,
  createUser,
  getUsers,
  updateUser,
  deleteUser,
  searchUsers,
  bulkInsertUsers
};`},{title:"Mongoose ODM Schema and Model Operations",code:`const mongoose = require('mongoose');

// Connect to MongoDB
async function connectToMongoDB() {
  try {
    await mongoose.connect('mongodb://localhost:27017/myapp', {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log('Connected to MongoDB with Mongoose');
  } catch (error) {
    console.error('MongoDB connection error:', error);
    throw error;
  }
}

// User Schema Definition
const userSchema = new mongoose.Schema({
  username: {
    type: String,
    required: true,
    unique: true,
    trim: true,
    minlength: 3,
    maxlength: 50
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true,
    validate: {
      validator: function(v) {
        return /^[^s@]+@[^s@]+.[^s@]+$/.test(v);
      },
      message: 'Invalid email format'
    }
  },
  password: {
    type: String,
    required: true,
    minlength: 6
  },
  profile: {
    firstName: String,
    lastName: String,
    avatar: String,
    bio: {
      type: String,
      maxlength: 500
    },
    location: {
      city: String,
      state: String,
      country: String
    }
  },
  preferences: {
    theme: {
      type: String,
      enum: ['light', 'dark'],
      default: 'light'
    },
    notifications: {
      email: { type: Boolean, default: true },
      push: { type: Boolean, default: false },
      sms: { type: Boolean, default: false }
    }
  },
  stats: {
    postsCount: { type: Number, default: 0 },
    followersCount: { type: Number, default: 0 },
    followingCount: { type: Number, default: 0 }
  },
  role: {
    type: String,
    enum: ['user', 'moderator', 'admin'],
    default: 'user'
  },
  isActive: {
    type: Boolean,
    default: true
  }
}, {
  timestamps: true, // Adds createdAt and updatedAt
  toJSON: { virtuals: true },
  toObject: { virtuals: true }
});

// Virtual for full name
userSchema.virtual('fullName').get(function() {
  if (this.profile.firstName && this.profile.lastName) {
    return \`\${this.profile.firstName} \${this.profile.lastName}\`;
  }
  return this.username;
});

// Instance method
userSchema.methods.getPublicProfile = function() {
  return {
    _id: this._id,
    username: this.username,
    fullName: this.fullName,
    avatar: this.profile.avatar,
    bio: this.profile.bio,
    stats: this.stats,
    createdAt: this.createdAt
  };
};

// Static method
userSchema.statics.findByUsername = function(username) {
  return this.findOne({ username: new RegExp(username, 'i') });
};

// Pre-save middleware
userSchema.pre('save', async function(next) {
  // Hash password before saving
  if (this.isModified('password')) {
    const bcrypt = require('bcrypt');
    this.password = await bcrypt.hash(this.password, 12);
  }
  next();
});

// Post-save middleware
userSchema.post('save', function(doc) {
  console.log(\`User \${doc.username} has been saved\`);
});

// Index for performance
userSchema.index({ username: 1 });
userSchema.index({ email: 1 });
userSchema.index({ 'stats.postsCount': -1 });
userSchema.index({ createdAt: -1 });

// Create User model
const User = mongoose.model('User', userSchema);

// CRUD Operations with Mongoose
class UserService {
  // Create user
  static async createUser(userData) {
    try {
      const user = new User(userData);
      await user.save();
      console.log('User created:', user.username);
      return user.getPublicProfile();
    } catch (error) {
      console.error('Error creating user:', error);
      throw error;
    }
  }

  // Get user by ID
  static async getUserById(userId) {
    try {
      const user = await User.findById(userId);
      if (!user) {
        throw new Error('User not found');
      }
      return user.getPublicProfile();
    } catch (error) {
      console.error('Error fetching user:', error);
      throw error;
    }
  }

  // Update user
  static async updateUser(userId, updateData) {
    try {
      const user = await User.findByIdAndUpdate(
        userId,
        updateData,
        { new: true, runValidators: true }
      );

      if (!user) {
        throw new Error('User not found');
      }

      return user.getPublicProfile();
    } catch (error) {
      console.error('Error updating user:', error);
      throw error;
    }
  }

  // Delete user
  static async deleteUser(userId) {
    try {
      const user = await User.findByIdAndDelete(userId);
      if (!user) {
        throw new Error('User not found');
      }
      console.log('User deleted:', user.username);
      return { message: 'User deleted successfully' };
    } catch (error) {
      console.error('Error deleting user:', error);
      throw error;
    }
  }

  // Search users
  static async searchUsers(query, options = {}) {
    try {
      const { page = 1, limit = 10, sort = '-createdAt' } = options;

      const users = await User.find(query)
        .sort(sort)
        .limit(limit)
        .skip((page - 1) * limit)
        .select('username profile stats createdAt');

      const total = await User.countDocuments(query);

      return {
        users: users.map(user => user.getPublicProfile()),
        pagination: {
          page,
          limit,
          total,
          pages: Math.ceil(total / limit)
        }
      };
    } catch (error) {
      console.error('Error searching users:', error);
      throw error;
    }
  }

  // Follow user
  static async followUser(followerId, targetUserId) {
    try {
      const session = await mongoose.startSession();
      session.startTransaction();

      try {
        // Add to following list
        await User.findByIdAndUpdate(followerId, {
          $addToSet: { following: targetUserId },
          $inc: { 'stats.followingCount': 1 }
        }, { session });

        // Add to followers list
        await User.findByIdAndUpdate(targetUserId, {
          $addToSet: { followers: followerId },
          $inc: { 'stats.followersCount': 1 }
        }, { session });

        await session.commitTransaction();
        return { message: 'User followed successfully' };
      } catch (error) {
        await session.abortTransaction();
        throw error;
      } finally {
        session.endSession();
      }
    } catch (error) {
      console.error('Error following user:', error);
      throw error;
    }
  }
}

module.exports = {
  connectToMongoDB,
  User,
  UserService
};`}]},{id:"mongodb-aggregation-framework",title:"Aggregation Framework and Data Analysis",content:`MongoDB's Aggregation Framework is a powerful tool for data analysis and transformation, providing a pipeline-based approach to process and analyze data within the database. It offers operators for filtering, grouping, sorting, and transforming documents, enabling complex data analysis without moving data to the application layer.

**Pipeline Stages**:
- **$match**: Filter documents based on conditions
- **$group**: Group documents by specified fields
- **$sort**: Sort documents by specified fields
- **$project**: Reshape documents with specified fields
- **$limit/$skip**: Control number of documents in result
- **$unwind**: Deconstruct array fields
- **$lookup**: Perform left outer joins with other collections

**Aggregation Operators**:
- **Arithmetic Operators**: $add, $subtract, $multiply, $divide
- **String Operators**: $concat, $substr, $toLower, $toUpper
- **Date Operators**: $year, $month, $dayOfMonth, $dateToString
- **Array Operators**: $size, $in, $push, $addToSet
- **Conditional Operators**: $cond, $ifNull, $switch

**Performance Considerations**:
- **Index Usage**: Ensure aggregation uses appropriate indexes
- **Memory Limits**: Be aware of 100MB memory limit for aggregation
- **Disk Usage**: Use $diskUse option for large aggregations
- **Pipeline Optimization**: Order stages for optimal performance

**Advanced Patterns**:
- **Facet Search**: Multiple aggregation pipelines in one query
- **Bucket Operations**: Group data into buckets or histograms
- **Graph Lookup**: Perform recursive searches in hierarchical data
- **Map-Reduce**: Alternative aggregation approach for complex operations

**Best Practices**:
- Use $match early in pipeline to reduce documents processed
- Create indexes on fields used in $match and $sort stages
- Use $project to limit fields and improve performance
- Consider using $facet for multiple related aggregations
- Monitor aggregation performance and optimize slow queries
- Use explain() to analyze aggregation execution`,keyTopics:["Aggregation pipeline stages and operators","Complex data analysis and reporting","Performance optimization for aggregations","Real-world aggregation use cases"],practicalExercises:["Build sales analytics with aggregation pipelines","Create user engagement reports using aggregation","Implement search with facets and filters","Develop inventory management analytics"],codeExamples:[{title:"Sales Analytics Aggregation Pipeline",code:`const mongoose = require('mongoose');

// Sales aggregation for dashboard
async function getSalesAnalytics(startDate, endDate) {
  try {
    const pipeline = [
      // Stage 1: Filter by date range
      {
        $match: {
          createdAt: {
            $gte: new Date(startDate),
            $lte: new Date(endDate)
          },
          status: 'completed'
        }
      },
      // Stage 2: Group by date and calculate daily totals
      {
        $group: {
          _id: {
            $dateToString: {
              format: '%Y-%m-%d',
              date: '$createdAt'
            }
          },
          totalSales: { $sum: '$total' },
          orderCount: { $sum: 1 },
          averageOrderValue: { $avg: '$total' },
          totalItems: { $sum: { $size: '$items' } }
        }
      },
      // Stage 3: Sort by date
      {
        $sort: { '_id': 1 }
      },
      // Stage 4: Add running totals
      {
        $group: {
          _id: null,
          dailySales: {
            $push: {
              date: '$_id',
              sales: '$totalSales',
              orders: '$orderCount',
              aov: { $round: ['$averageOrderValue', 2] }
            }
          },
          totalSales: { $sum: '$totalSales' },
          totalOrders: { $sum: '$orderCount' },
          overallAOV: { $avg: '$averageOrderValue' }
        }
      }
    ];

    const result = await mongoose.connection.db
      .collection('orders')
      .aggregate(pipeline)
      .toArray();

    return result[0] || {
      dailySales: [],
      totalSales: 0,
      totalOrders: 0,
      overallAOV: 0
    };
  } catch (error) {
    console.error('Error in sales analytics:', error);
    throw error;
  }
}

// Product performance analysis
async function getProductPerformance() {
  try {
    const pipeline = [
      // Unwind items array to get individual product analysis
      { $unwind: '$items' },
      // Match only completed orders
      { $match: { status: 'completed' } },
      // Group by product
      {
        $group: {
          _id: '$items.productId',
          productName: { $first: '$items.name' },
          totalSold: { $sum: '$items.quantity' },
          totalRevenue: {
            $sum: {
              $multiply: ['$items.price', '$items.quantity']
            }
          },
          orderCount: { $addToSet: '$orderNumber' }
        }
      },
      // Calculate additional metrics
      {
        $project: {
          productName: 1,
          totalSold: 1,
          totalRevenue: 1,
          uniqueOrders: { $size: '$orderCount' },
          averageOrderValue: {
            $divide: ['$totalRevenue', { $size: '$orderCount' }]
          }
        }
      },
      // Sort by revenue
      { $sort: { totalRevenue: -1 } },
      // Limit to top 10
      { $limit: 10 }
    ];

    const products = await mongoose.connection.db
      .collection('orders')
      .aggregate(pipeline)
      .toArray();

    return products;
  } catch (error) {
    console.error('Error in product performance:', error);
    throw error;
  }
}

// User engagement analytics
async function getUserEngagementAnalytics() {
  try {
    const pipeline = [
      // Lookup user details
      {
        $lookup: {
          from: 'users',
          localField: 'userId',
          foreignField: '_id',
          as: 'user'
        }
      },
      { $unwind: '$user' },
      // Group by user
      {
        $group: {
          _id: '$userId',
          username: { $first: '$user.username' },
          totalOrders: { $sum: 1 },
          totalSpent: { $sum: '$total' },
          averageOrderValue: { $avg: '$total' },
          firstOrderDate: { $min: '$createdAt' },
          lastOrderDate: { $max: '$createdAt' },
          orderDates: { $push: '$createdAt' }
        }
      },
      // Calculate engagement metrics
      {
        $project: {
          username: 1,
          totalOrders: 1,
          totalSpent: 1,
          averageOrderValue: { $round: ['$averageOrderValue', 2] },
          firstOrderDate: 1,
          lastOrderDate: 1,
          customerLifetime: {
            $divide: [
              { $subtract: ['$lastOrderDate', '$firstOrderDate'] },
              1000 * 60 * 60 * 24 // Convert to days
            ]
          },
          orderFrequency: {
            $divide: [
              '$totalOrders',
              {
                $add: [
                  {
                    $divide: [
                      { $subtract: ['$lastOrderDate', '$firstOrderDate'] },
                      1000 * 60 * 60 * 24
                    ]
                  },
                  1 // Add 1 to avoid division by zero
                ]
              }
            ]
          }
        }
      },
      // Sort by total spent
      { $sort: { totalSpent: -1 } }
    ];

    const users = await mongoose.connection.db
      .collection('orders')
      .aggregate(pipeline)
      .toArray();

    return users;
  } catch (error) {
    console.error('Error in user engagement analytics:', error);
    throw error;
  }
}

// Faceted search for products
async function getProductFacets(searchQuery = '', category = '', priceRange = {}) {
  try {
    const pipeline = [
      // Match search criteria
      {
        $match: {
          ...(searchQuery && {
            $or: [
              { name: { $regex: searchQuery, $options: 'i' } },
              { description: { $regex: searchQuery, $options: 'i' } }
            ]
          }),
          ...(category && { category }),
          ...(priceRange.min !== undefined && {
            'price.current': { $gte: priceRange.min }
          }),
          ...(priceRange.max !== undefined && {
            'price.current': { $lte: priceRange.max }
          })
        }
      },
      // Facet for different aggregations
      {
        $facet: {
          // Category counts
          categories: [
            { $group: { _id: '$category', count: { $sum: 1 } } },
            { $sort: { count: -1 } }
          ],
          // Price ranges
          priceRanges: [
            {
              $bucket: {
                groupBy: '$price.current',
                boundaries: [0, 50, 100, 200, 500, 1000],
                default: '1000+',
                output: { count: { $sum: 1 } }
              }
            }
          ],
          // Brand counts
          brands: [
            { $group: { _id: '$brand', count: { $sum: 1 } } },
            { $sort: { count: -1 } },
            { $limit: 10 }
          ],
          // Products with pagination
          products: [
            {
              $project: {
                name: 1,
                price: 1,
                category: 1,
                brand: 1,
                rating: '$reviewsSummary.averageRating'
              }
            },
            { $sort: { 'price.current': 1 } },
            { $limit: 20 }
          ]
        }
      }
    ];

    const result = await mongoose.connection.db
      .collection('products')
      .aggregate(pipeline)
      .toArray();

    return result[0];
  } catch (error) {
    console.error('Error in faceted search:', error);
    throw error;
  }
}

module.exports = {
  getSalesAnalytics,
  getProductPerformance,
  getUserEngagementAnalytics,
  getProductFacets
};`},{title:"Advanced Aggregation Patterns",code:`const mongoose = require('mongoose');

// Time-series analytics with window functions
async function getTimeSeriesAnalytics(collection, dateField, metrics, interval = 'day') {
  const dateFormat = interval === 'hour' ? '%Y-%m-%d-%H' :
                    interval === 'day' ? '%Y-%m-%d' :
                    interval === 'month' ? '%Y-%m' : '%Y';

  const pipeline = [
    {
      $group: {
        _id: {
          $dateToString: {
            format: dateFormat,
            date: \`$\${dateField}\`
          }
        },
        ...metrics.reduce((acc, metric) => {
          acc[metric.name] = metric.operator;
          return acc;
        }, {}),
        count: { $sum: 1 }
      }
    },
    { $sort: { '_id': 1 } }
  ];

  return await mongoose.connection.db
    .collection(collection)
    .aggregate(pipeline)
    .toArray();
}

// Graph-like relationships with $graphLookup
async function getCommentThread(postId, maxDepth = 5) {
  const pipeline = [
    // Start with root comments (no parent)
    {
      $match: {
        postId: mongoose.Types.ObjectId(postId),
        parentId: { $exists: false }
      }
    },
    // Recursively find all replies
    {
      $graphLookup: {
        from: 'comments',
        startWith: '$_id',
        connectFromField: '_id',
        connectToField: 'parentId',
        as: 'replies',
        maxDepth: maxDepth,
        depthField: 'depth'
      }
    },
    // Sort replies by depth and creation date
    {
      $addFields: {
        replies: {
          $sortArray: {
            input: '$replies',
            sortBy: { depth: 1, createdAt: 1 }
          }
        }
      }
    }
  ];

  return await mongoose.connection.db
    .collection('comments')
    .aggregate(pipeline)
    .toArray();
}

// Bucket analysis for data distribution
async function getDataDistribution(collection, field, bucketCount = 10) {
  // First, get min and max values
  const stats = await mongoose.connection.db
    .collection(collection)
    .aggregate([
      {
        $group: {
          _id: null,
          min: { $min: \`$\${field}\` },
          max: { $max: \`$\${field}\` },
          count: { $sum: 1 }
        }
      }
    ])
    .toArray();

  if (stats.length === 0) return [];

  const { min, max, count } = stats[0];
  const bucketSize = (max - min) / bucketCount;

  const pipeline = [
    {
      $bucket: {
        groupBy: \`$\${field}\`,
        boundaries: Array.from({ length: bucketCount + 1 }, (_, i) => min + i * bucketSize),
        default: 'outliers',
        output: {
          count: { $sum: 1 },
          min: { $min: \`$\${field}\` },
          max: { $max: \`$\${field}\` },
          avg: { $avg: \`$\${field}\` }
        }
      }
    },
    { $sort: { _id: 1 } }
  ];

  return await mongoose.connection.db
    .collection(collection)
    .aggregate(pipeline)
    .toArray();
}

// Real-time analytics with change streams
function setupRealTimeAnalytics(collectionName) {
  const collection = mongoose.connection.db.collection(collectionName);

  const changeStream = collection.watch([
    {
      $match: {
        operationType: { $in: ['insert', 'update', 'delete'] }
      }
    }
  ]);

  changeStream.on('change', async (change) => {
    try {
      switch (change.operationType) {
        case 'insert':
          await updateAnalyticsOnInsert(change.fullDocument);
          break;
        case 'update':
          await updateAnalyticsOnUpdate(change.documentKey, change.updateDescription);
          break;
        case 'delete':
          await updateAnalyticsOnDelete(change.documentKey);
          break;
      }
    } catch (error) {
      console.error('Error processing change stream:', error);
    }
  });

  return changeStream;
}

// Incremental aggregation updates
async function updateAnalyticsOnInsert(document) {
  const analytics = mongoose.connection.db.collection('analytics');

  // Update counters based on document type
  if (document.collection === 'orders') {
    await analytics.updateOne(
      { type: 'orders' },
      {
        $inc: {
          totalCount: 1,
          totalValue: document.total || 0
        },
        $set: { lastUpdated: new Date() }
      },
      { upsert: true }
    );
  }
}

async function updateAnalyticsOnUpdate(documentId, updateDescription) {
  // Handle incremental updates for modified fields
  const updatedFields = updateDescription.updatedFields;

  if (updatedFields && updatedFields.total) {
    const analytics = mongoose.connection.db.collection('analytics');
    const oldOrder = await mongoose.connection.db
      .collection('orders')
      .findOne({ _id: documentId });

    if (oldOrder) {
      const difference = updatedFields.total - oldOrder.total;
      await analytics.updateOne(
        { type: 'orders' },
        {
          $inc: { totalValue: difference },
          $set: { lastUpdated: new Date() }
        }
      );
    }
  }
}

async function updateAnalyticsOnDelete(documentId) {
  // Decrement counters when documents are deleted
  const deletedDoc = await mongoose.connection.db
    .collection('orders')
    .findOne({ _id: documentId }, { total: 1 });

  if (deletedDoc) {
    const analytics = mongoose.connection.db.collection('analytics');
    await analytics.updateOne(
      { type: 'orders' },
      {
        $inc: {
          totalCount: -1,
          totalValue: -deletedDoc.total
        },
        $set: { lastUpdated: new Date() }
      }
    );
  }
}

// Complex multi-collection aggregation
async function getComprehensiveUserReport(userId) {
  const pipeline = [
    // Start with user
    { $match: { _id: mongoose.Types.ObjectId(userId) } },

    // Lookup orders
    {
      $lookup: {
        from: 'orders',
        localField: '_id',
        foreignField: 'userId',
        as: 'orders'
      }
    },

    // Lookup posts
    {
      $lookup: {
        from: 'posts',
        localField: '_id',
        foreignField: 'authorId',
        as: 'posts'
      }
    },

    // Lookup followers/following
    {
      $lookup: {
        from: 'users',
        localField: 'following',
        foreignField: '_id',
        as: 'followingUsers'
      }
    },

    // Calculate comprehensive metrics
    {
      $project: {
        username: 1,
        email: 1,
        profile: 1,
        stats: 1,
        orderMetrics: {
          totalOrders: { $size: '$orders' },
          totalSpent: { $sum: '$orders.total' },
          averageOrderValue: { $avg: '$orders.total' },
          lastOrderDate: { $max: '$orders.createdAt' }
        },
        contentMetrics: {
          totalPosts: { $size: '$posts' },
          totalLikes: { $sum: '$posts.stats.likes' },
          totalComments: { $sum: '$posts.stats.comments' }
        },
        socialMetrics: {
          followersCount: { $size: '$followers' },
          followingCount: { $size: '$following' }
        }
      }
    }
  ];

  const result = await mongoose.connection.db
    .collection('users')
    .aggregate(pipeline)
    .toArray();

  return result[0];
}

module.exports = {
  getTimeSeriesAnalytics,
  getCommentThread,
  getDataDistribution,
  setupRealTimeAnalytics,
  getComprehensiveUserReport
};`}]},{id:"mongodb-indexing-performance",title:"Indexing Strategies and Performance Optimization",content:`Indexes are critical for MongoDB performance, enabling fast query execution by providing efficient data access paths. Understanding different index types and their appropriate use cases is essential for optimizing database performance. MongoDB supports various index types including single field, compound, multikey, geospatial, and text indexes.

**Index Types**:
- **Single Field**: Index on a single field for equality matches
- **Compound**: Index on multiple fields for complex queries
- **Multikey**: Index on array fields for array element queries
- **Geospatial**: Index for location-based queries
- **Text**: Index for full-text search capabilities
- **Hashed**: Index for hash-based sharding
- **Wildcard**: Index for unknown or arbitrary fields

**Index Properties**:
- **Unique**: Ensures field values are unique across collection
- **Sparse**: Only indexes documents that contain the indexed field
- **TTL**: Automatically removes documents after specified time
- **Partial**: Only indexes documents matching specified filter

**Performance Analysis**:
- **Explain Plans**: Analyze query execution and index usage
- **Index Statistics**: Monitor index size and usage patterns
- **Slow Query Log**: Identify queries needing optimization
- **Index Coverage**: Ensure queries are covered by indexes

**Index Maintenance**:
- **Index Creation**: Creating indexes without blocking operations
- **Index Removal**: Removing unused indexes to free space
- **Index Rebuilding**: Rebuilding indexes for better performance
- **Index Monitoring**: Tracking index performance over time

**Best Practices**:
- Create indexes for frequently queried fields
- Use compound indexes for multi-field queries
- Avoid over-indexing which increases write overhead
- Monitor index usage and remove unused indexes
- Use covered queries when possible
- Consider index order for compound indexes
- Use partial indexes for selective data
- Regularly analyze and optimize slow queries`,keyTopics:["MongoDB index types and creation strategies","Query optimization and performance analysis","Index maintenance and monitoring","Advanced indexing patterns and techniques"],practicalExercises:["Analyze and optimize slow queries with indexes","Create compound indexes for complex query patterns","Implement text search with MongoDB text indexes","Monitor and maintain index performance over time"],codeExamples:[{title:"Index Creation and Management",code:`const mongoose = require('mongoose');

// User schema with indexes
const userSchema = new mongoose.Schema({
  username: {
    type: String,
    required: true,
    unique: true,
    index: true // Automatic index
  },
  email: {
    type: String,
    required: true,
    unique: true,
    index: true
  },
  createdAt: {
    type: Date,
    default: Date.now,
    index: true
  },
  profile: {
    location: {
      type: {
        type: String,
        enum: ['Point'],
        default: 'Point'
      },
      coordinates: [Number] // [longitude, latitude]
    },
    age: Number,
    interests: [String]
  },
  stats: {
    postsCount: { type: Number, default: 0 },
    followersCount: { type: Number, default: 0 }
  }
});

// Create compound indexes
userSchema.index({ 'stats.postsCount': -1, 'stats.followersCount': -1 });
userSchema.index({ 'profile.location': '2dsphere' }); // Geospatial index
userSchema.index({ 'profile.interests': 1 }); // Multikey index

// Text index for search
userSchema.index({
  username: 'text',
  'profile.bio': 'text'
}, {
  weights: {
    username: 10,
    'profile.bio': 1
  },
  name: 'user_text_search'
});

// Partial index
userSchema.index(
  { createdAt: 1 },
  {
    partialFilterExpression: { 'stats.postsCount': { $gte: 5 } },
    name: 'active_users_by_date'
  }
);

// TTL index for temporary data
const sessionSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  token: { type: String, required: true },
  createdAt: { type: Date, default: Date.now, expires: '24h' } // TTL index
});

const User = mongoose.model('User', userSchema);
const Session = mongoose.model('Session', sessionSchema);

// Index management utilities
class IndexManager {
  static async createIndexes() {
    try {
      console.log('Creating database indexes...');

      // Create indexes for posts collection
      await mongoose.connection.db.collection('posts').createIndexes([
        { key: { authorId: 1, createdAt: -1 }, name: 'posts_author_date' },
        { key: { tags: 1 }, name: 'posts_tags' },
        { key: { 'stats.likes': -1 }, name: 'posts_popularity' },
        {
          key: { title: 'text', content: 'text' },
          name: 'posts_text_search',
          weights: { title: 10, content: 1 }
        }
      ]);

      // Create indexes for orders collection
      await mongoose.connection.db.collection('orders').createIndexes([
        { key: { userId: 1, createdAt: -1 }, name: 'orders_user_date' },
        { key: { status: 1, createdAt: -1 }, name: 'orders_status_date' },
        { key: { 'items.productId': 1 }, name: 'orders_products' },
        { key: { total: -1 }, name: 'orders_total' }
      ]);

      console.log('All indexes created successfully');
    } catch (error) {
      console.error('Error creating indexes:', error);
      throw error;
    }
  }

  static async analyzeIndexUsage() {
    try {
      const collections = ['users', 'posts', 'orders'];

      for (const collectionName of collections) {
        console.log(\`\\nAnalyzing indexes for \${collectionName}:\`);

        const collection = mongoose.connection.db.collection(collectionName);
        const indexes = await collection.indexes();

        for (const index of indexes) {
          const stats = await collection.aggregate([
            { $indexStats: {} },
            { $match: { name: index.name } }
          ]).toArray();

          if (stats.length > 0) {
            const usage = stats[0];
            console.log(\`  Index: \${index.name}\`);
            console.log(\`    Usage count: \${usage.accesses?.ops || 0}\`);
            console.log(\`    Since: \${usage.accesses?.since || 'N/A'}\`);
          }
        }
      }
    } catch (error) {
      console.error('Error analyzing index usage:', error);
      throw error;
    }
  }

  static async removeUnusedIndexes() {
    try {
      const db = mongoose.connection.db;
      const collections = await db.collections();

      for (const collection of collections) {
        const indexes = await collection.indexes();
        const stats = await collection.aggregate([{ $indexStats: {} }]).toArray();

        const usedIndexes = new Set(stats.map(stat => stat.name));

        for (const index of indexes) {
          // Skip default _id index
          if (index.name === '_id_') continue;

          if (!usedIndexes.has(index.name)) {
            console.log(\`Dropping unused index: \${index.name} from \${collection.collectionName}\`);
            await collection.dropIndex(index.name);
          }
        }
      }
    } catch (error) {
      console.error('Error removing unused indexes:', error);
      throw error;
    }
  }

  static async optimizeQuery(query, collectionName) {
    try {
      const collection = mongoose.connection.db.collection(collectionName);

      // Explain the query
      const explanation = await collection.find(query).explain('executionStats');

      console.log('Query execution stats:');
      console.log(\`  Execution time: \${explanation.executionStats.executionTimeMillis}ms\`);
      console.log(\`  Documents examined: \${explanation.executionStats.totalDocsExamined}\`);
      console.log(\`  Documents returned: \${explanation.executionStats.totalDocsReturned}\`);

      // Check if index was used
      const winningPlan = explanation.executionStats.winningPlan;
      if (winningPlan.inputStage?.stage === 'IXSCAN') {
        console.log(\`  ✅ Index used: \${winningPlan.inputStage.indexName}\`);
      } else {
        console.log('  ⚠️  No index used - consider creating an index');
      }

      return explanation;
    } catch (error) {
      console.error('Error optimizing query:', error);
      throw error;
    }
  }
}

module.exports = {
  User,
  Session,
  IndexManager
};`},{title:"Query Optimization and Performance Monitoring",code:`const mongoose = require('mongoose');

// Query optimization utilities
class QueryOptimizer {
  static async analyzeSlowQueries(thresholdMs = 100) {
    try {
      // Enable profiling
      await mongoose.connection.db.setProfilingLevel(2, { slowms: thresholdMs });

      console.log(\`Profiling enabled for queries slower than \${thresholdMs}ms);

      // Get profiling data
      const profilingData = await mongoose.connection.db
        .collection('system.profile')
        .find({})
        .sort({ ts: -1 })
        .limit(10)
        .toArray();

      console.log('\\nRecent slow queries:');
      profilingData.forEach((query, index) => {
        console.log(\`\${index + 1}. \${query.op} on \${query.ns}\`);
        console.log(\`   Duration: \${query.millis}ms\`);
        console.log(\`   Query: \${JSON.stringify(query.query)}\`);
        if (query.planSummary) {
          console.log(\`   Plan: \${query.planSummary}\`);
        }
        console.log('');
      });

      return profilingData;
    } catch (error) {
      console.error('Error analyzing slow queries:', error);
      throw error;
    }
  }

  static async createOptimalIndexes() {
    try {
      const profilingData = await mongoose.connection.db
        .collection('system.profile')
        .find({ op: 'query' })
        .sort({ millis: -1 })
        .limit(20)
        .toArray();

      const suggestedIndexes = new Map();

      for (const query of profilingData) {
        if (query.query && Object.keys(query.query).length > 0) {
          const collection = query.ns.split('.')[1];
          const queryFields = Object.keys(query.query);

          // Suggest compound index for multi-field queries
          if (queryFields.length > 1) {
            const indexKey = queryFields.map(field => [field, 1]);
            const indexName = \`\${collection}_\${queryFields.join('_')}\`;

            if (!suggestedIndexes.has(indexName)) {
              suggestedIndexes.set(indexName, {
                collection,
                key: Object.fromEntries(indexKey)
              });
            }
          }
        }
      }

      // Create suggested indexes
      for (const [indexName, indexInfo] of suggestedIndexes) {
        try {
          await mongoose.connection.db
            .collection(indexInfo.collection)
            .createIndex(indexInfo.key, { name: indexName });

          console.log(\`Created index: \${indexName} on \${indexInfo.collection}\`);
        } catch (error) {
          console.log(\`Index \${indexName} already exists or error: \${error.message}\`);
        }
      }

      return Array.from(suggestedIndexes.keys());
    } catch (error) {
      console.error('Error creating optimal indexes:', error);
      throw error;
    }
  }

  static async monitorCollectionStats() {
    try {
      const collections = ['users', 'posts', 'orders'];
      const stats = {};

      for (const collectionName of collections) {
        const collection = mongoose.connection.db.collection(collectionName);

        // Get collection statistics
        const collStats = await mongoose.connection.db.command({
          collStats: collectionName
        });

        // Get index statistics
        const indexes = await collection.indexes();
        const indexStats = await collection.aggregate([
          { $indexStats: {} }
        ]).toArray();

        stats[collectionName] = {
          documentCount: collStats.count,
          size: collStats.size,
          storageSize: collStats.storageSize,
          indexCount: indexes.length,
          indexes: indexStats.map(stat => ({
            name: stat.name,
            usageCount: stat.accesses?.ops || 0
          }))
        };
      }

      console.log('\\nCollection Statistics:');
      Object.entries(stats).forEach(([collection, data]) => {
        console.log(\`\\n\${collection}:\`);
        console.log(\`  Documents: \${data.documentCount.toLocaleString()}\`);
        console.log(\`  Size: \${(data.size / 1024 / 1024).toFixed(2)} MB\`);
        console.log(\`  Storage: \${(data.storageSize / 1024 / 1024).toFixed(2)} MB\`);
        console.log(\`  Indexes: \${data.indexCount}\`);

        data.indexes.forEach(index => {
          console.log(\`    \${index.name}: \${index.usageCount} uses\`);
        });
      });

      return stats;
    } catch (error) {
      console.error('Error monitoring collection stats:', error);
      throw error;
    }
  }
}

// Performance monitoring middleware
const performanceMiddleware = (schema) => {
  // Pre-hook for find operations
  schema.pre('find', function(next) {
    this._startTime = Date.now();
    next();
  });

  schema.post('find', function(docs) {
    const duration = Date.now() - this._startTime;
    if (duration > 100) { // Log slow queries
      console.log(\`Slow find query on \${this.model.collection.name}: \${duration}ms\`);
      console.log('Query:', this.getQuery());
    }
  });

  // Pre-hook for save operations
  schema.pre('save', function(next) {
    this._startTime = Date.now();
    next();
  });

  schema.post('save', function(doc) {
    const duration = Date.now() - this._startTime;
    if (duration > 50) {
      console.log(\`Slow save operation on \${this.constructor.collection.name}: \${duration}ms\`);
    }
  });
};

// Connection pool monitoring
class ConnectionMonitor {
  static async getConnectionStats() {
    try {
      const adminDb = mongoose.connection.db.admin();
      const serverStatus = await adminDb.serverStatus();

      const connections = serverStatus.connections;
      const opcounters = serverStatus.opcounters;

      console.log('\\nConnection Pool Statistics:');
      console.log(\`Current connections: \${connections.current}\`);
      console.log(\`Available connections: \${connections.available}\`);
      console.log(\`Total created: \${connections.totalCreated}\`);

      console.log('\\nOperation Counters:');
      console.log(\`Insert: \${opcounters.insert}\`);
      console.log(\`Query: \${opcounters.query}\`);
      console.log(\`Update: \${opcounters.update}\`);
      console.log(\`Delete: \${opcounters.delete}\`);

      return { connections, opcounters };
    } catch (error) {
      console.error('Error getting connection stats:', error);
      throw error;
    }
  }

  static async monitorReplication() {
    try {
      const adminDb = mongoose.connection.db.admin();
      const replSetGetStatus = await adminDb.command({ replSetGetStatus: 1 });

      console.log('\\nReplication Status:');
      console.log(\`Set: \${replSetGetStatus.set}\`);

      replSetGetStatus.members.forEach(member => {
        console.log(\`  \${member.name}: \${member.stateStr} (\${member.state})\`);
        console.log(\`    Health: \${member.health}\`);
        console.log(\`    Last heartbeat: \${new Date(member.lastHeartbeat).toISOString()}\`);
      });

      return replSetGetStatus;
    } catch (error) {
      console.log('Not running in replica set mode');
      return null;
    }
  }
}

// Query result caching utility
class QueryCache {
  constructor(ttlMinutes = 60) {
    this.cache = new Map();
    this.ttl = ttlMinutes * 60 * 1000; // Convert to milliseconds
  }

  set(key, value) {
    this.cache.set(key, {
      value,
      timestamp: Date.now()
    });
  }

  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;

    if (Date.now() - item.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }

    return item.value;
  }

  clear() {
    this.cache.clear();
  }

  size() {
    return this.cache.size;
  }
}

// Cached query wrapper
const cachedQuery = (cache) => (queryFn) => async (...args) => {
  const key = JSON.stringify(args);

  // Check cache first
  const cached = cache.get(key);
  if (cached) {
    console.log('Returning cached result');
    return cached;
  }

  // Execute query
  const result = await queryFn(...args);

  // Cache result
  cache.set(key, result);

  return result;
};

module.exports = {
  QueryOptimizer,
  ConnectionMonitor,
  QueryCache,
  cachedQuery,
  performanceMiddleware
};`}]},{id:"mongodb-atlas-deployment",title:"MongoDB Atlas Cloud Deployment and Management",content:`MongoDB Atlas is a fully managed cloud database service that provides automated provisioning, patching, upgrades, backups, and scaling. It offers a user-friendly interface for database management and monitoring, making it easy to deploy and maintain MongoDB databases in the cloud.

**Atlas Features**:
- **Automated Deployment**: One-click database provisioning
- **Global Clusters**: Multi-region deployments for low latency
- **Auto-Scaling**: Automatic scaling based on workload demands
- **Backup & Recovery**: Automated backups with point-in-time recovery
- **Security**: Built-in encryption, network isolation, and access controls
- **Monitoring**: Real-time performance metrics and alerting
- **Integration**: Seamless integration with other cloud services

**Deployment Options**:
- **Free Tier**: Perfect for development and small applications
- **Dedicated Clusters**: Production-ready with dedicated resources
- **Serverless**: Pay-per-use model for variable workloads
- **Multi-Cloud**: Deploy across AWS, Google Cloud, and Azure

**Security Configuration**:
- **Network Access**: IP whitelisting and VPC peering
- **Authentication**: Database users and authentication methods
- **Encryption**: Data encryption at rest and in transit
- **Audit Logging**: Comprehensive logging for compliance

**Performance Optimization**:
- **Index Management**: Automated index suggestions
- **Query Optimization**: Performance advisor recommendations
- **Scaling**: Horizontal and vertical scaling options
- **Caching**: Integration with Redis for improved performance

**Best Practices**:
- Start with the free tier for development
- Use appropriate cluster tiers for production workloads
- Configure proper backup and recovery strategies
- Implement monitoring and alerting
- Use Atlas's built-in security features
- Regularly review and optimize performance
- Plan for scaling as your application grows`,keyTopics:["MongoDB Atlas setup and cluster configuration","Security configuration and access management","Backup and recovery strategies","Performance monitoring and optimization"],practicalExercises:["Deploy a MongoDB Atlas cluster and configure security","Set up automated backups and monitoring","Implement multi-region deployment for global applications","Configure performance monitoring and alerting"],codeExamples:[{title:"MongoDB Atlas Connection and Configuration",code:`const mongoose = require('mongoose');
const { MongoClient } = require('mongodb');

// Atlas connection configuration
const atlasConfig = {
  // Replace with your Atlas connection string
  connectionString: process.env.MONGODB_ATLAS_URI || 'mongodb+srv://username:password@cluster.mongodb.net/myapp',
  options: {
    useNewUrlParser: true,
    useUnifiedTopology: true,
    maxPoolSize: 10, // Maintain up to 10 socket connections
    serverSelectionTimeoutMS: 5000, // Keep trying to send operations for 5 seconds
    socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity
    bufferCommands: false, // Disable mongoose buffering
    bufferMaxEntries: 0, // Disable mongoose buffering
    retryWrites: true, // Retry writes on network errors
    retryReads: true, // Retry reads on network errors
    maxIdleTimeMS: 30000, // Close connections after 30 seconds of inactivity
    family: 4 // Use IPv4, skip trying IPv6
  }
};

// Connect to Atlas with Mongoose
async function connectToAtlas() {
  try {
    await mongoose.connect(atlasConfig.connectionString, atlasConfig.options);

    console.log('✅ Connected to MongoDB Atlas');

    // Connection event listeners
    mongoose.connection.on('connected', () => {
      console.log('Mongoose connected to MongoDB Atlas');
    });

    mongoose.connection.on('error', (err) => {
      console.error('Mongoose connection error:', err);
    });

    mongoose.connection.on('disconnected', () => {
      console.log('Mongoose disconnected from MongoDB Atlas');
    });

    // Graceful shutdown
    process.on('SIGINT', async () => {
      await mongoose.connection.close();
      console.log('MongoDB Atlas connection closed through app termination');
      process.exit(0);
    });

    return mongoose.connection;
  } catch (error) {
    console.error('❌ Failed to connect to MongoDB Atlas:', error);
    throw error;
  }
}

// Connect with native MongoDB driver
async function connectWithNativeDriver() {
  const client = new MongoClient(atlasConfig.connectionString, atlasConfig.options);

  try {
    await client.connect();
    console.log('✅ Connected to MongoDB Atlas with native driver');

    const db = client.db('myapp');

    // Test the connection
    const collections = await db.collections();
    console.log(\`Available collections: \${collections.map(c => c.collectionName).join(', ')}\`);

    return { client, db };
  } catch (error) {
    console.error('❌ Failed to connect with native driver:', error);
    throw error;
  }
}

// Connection health check
async function checkConnectionHealth() {
  try {
    const admin = mongoose.connection.db.admin();
    const info = await admin.serverInfo();

    const health = {
      status: 'healthy',
      version: info.version,
      uptime: info.uptime,
      connections: {
        current: info.connections?.current || 'N/A',
        available: info.connections?.available || 'N/A'
      },
      memory: {
        resident: info.mem?.resident || 'N/A',
        virtual: info.mem?.virtual || 'N/A'
      }
    };

    console.log('🏥 Connection Health:', JSON.stringify(health, null, 2));
    return health;
  } catch (error) {
    console.error('❌ Health check failed:', error);
    return { status: 'unhealthy', error: error.message };
  }
}

// Multi-region connection (for global clusters)
async function connectToMultiRegionCluster() {
  const regions = [
    'mongodb+srv://user:pass@cluster-us-east.mongodb.net/myapp',
    'mongodb+srv://user:pass@cluster-eu-west.mongodb.net/myapp',
    'mongodb+srv://user:pass@cluster-ap-southeast.mongodb.net/myapp'
  ];

  // Try to connect to the closest region first
  for (const uri of regions) {
    try {
      console.log(\`Attempting connection to: \${uri.split('@')[1].split('.')[0]}\`);
      await mongoose.connect(uri, atlasConfig.options);
      console.log('✅ Connected to multi-region cluster');
      return mongoose.connection;
    } catch (error) {
      console.log(\`Failed to connect to region, trying next...\`);
    }
  }

  throw new Error('Failed to connect to any region');
}

// Database migration utility
class DatabaseMigrator {
  constructor(sourceUri, targetUri) {
    this.sourceClient = new MongoClient(sourceUri);
    this.targetClient = new MongoClient(targetUri);
  }

  async migrateCollection(collectionName, batchSize = 1000) {
    try {
      await this.sourceClient.connect();
      await this.targetClient.connect();

      const sourceDb = this.sourceClient.db();
      const targetDb = this.targetClient.db();

      const sourceCollection = sourceDb.collection(collectionName);
      const targetCollection = targetDb.collection(collectionName);

      const totalDocs = await sourceCollection.countDocuments();
      console.log(\`Migrating \${totalDocs} documents from \${collectionName}\`);

      let migrated = 0;
      const cursor = sourceCollection.find({});

      while (await cursor.hasNext()) {
        const batch = [];
        for (let i = 0; i < batchSize && await cursor.hasNext(); i++) {
          batch.push(await cursor.next());
        }

        if (batch.length > 0) {
          await targetCollection.insertMany(batch);
          migrated += batch.length;
          console.log(\`Migrated \${migrated}/\${totalDocs} documents\`);
        }
      }

      console.log(\`✅ Migration completed for \${collectionName}\`);
      return migrated;
    } catch (error) {
      console.error(\`❌ Migration failed for \${collectionName}:\`, error);
      throw error;
    } finally {
      await this.sourceClient.close();
      await this.targetClient.close();
    }
  }

  async migrateAllCollections() {
    try {
      await this.sourceClient.connect();
      const sourceDb = this.sourceClient.db();
      const collections = await sourceDb.collections();

      const results = {};
      for (const collection of collections) {
        const count = await this.migrateCollection(collection.collectionName);
        results[collection.collectionName] = count;
      }

      console.log('✅ All collections migrated:', results);
      return results;
    } catch (error) {
      console.error('❌ Migration failed:', error);
      throw error;
    } finally {
      await this.sourceClient.close();
    }
  }
}

module.exports = {
  connectToAtlas,
  connectWithNativeDriver,
  checkConnectionHealth,
  connectToMultiRegionCluster,
  DatabaseMigrator
};`},{title:"Atlas Security Configuration and Monitoring",code:`const mongoose = require('mongoose');

// Security configuration for Atlas
const securityConfig = {
  // Database users
  users: [
    {
      username: 'app_user',
      password: process.env.DB_APP_PASSWORD,
      roles: ['readWrite'],
      database: 'myapp'
    },
    {
      username: 'analytics_user',
      password: process.env.DB_ANALYTICS_PASSWORD,
      roles: ['read'],
      database: 'myapp'
    },
    {
      username: 'admin_user',
      password: process.env.DB_ADMIN_PASSWORD,
      roles: ['dbAdmin', 'readWrite'],
      database: 'myapp'
    }
  ],

  // Network access rules
  networkAccess: {
    whitelist: [
      '203.0.113.0/24', // Office IP range
      '198.51.100.0/24' // Home IP range
    ],
    vpcPeering: true
  },

  // Encryption settings
  encryption: {
    atRest: true,
    inTransit: true,
    clientSideEncryption: false
  }
};

// User management utilities
class AtlasUserManager {
  static async createDatabaseUsers() {
    try {
      console.log('Creating database users...');

      for (const user of securityConfig.users) {
        const adminDb = mongoose.connection.db.admin();

        await adminDb.command({
          createUser: user.username,
          pwd: user.password,
          roles: user.roles.map(role => ({
            role: role,
            db: user.database
          }))
        });

        console.log(\`✅ Created user: \${user.username}\`);
      }
    } catch (error) {
      console.error('❌ Failed to create database users:', error);
      throw error;
    }
  }

  static async updateUserPassword(username, newPassword) {
    try {
      const adminDb = mongoose.connection.db.admin();

      await adminDb.command({
        updateUser: username,
        pwd: newPassword
      });

      console.log(\`✅ Updated password for user: \${username}\`);
    } catch (error) {
      console.error('❌ Failed to update user password:', error);
      throw error;
    }
  }

  static async grantUserRole(username, role, database) {
    try {
      const adminDb = mongoose.connection.db.admin();

      await adminDb.command({
        grantRolesToUser: username,
        roles: [{ role: role, db: database }]
      });

      console.log(\`✅ Granted role \${role} to user: \${username}\`);
    } catch (error) {
      console.error('❌ Failed to grant user role:', error);
      throw error;
    }
  }
}

// Audit logging
class AuditLogger {
  constructor() {
    this.auditCollection = 'audit_log';
  }

  async logOperation(operation, collection, user, details = {}) {
    try {
      const auditEntry = {
        timestamp: new Date(),
        operation: operation,
        collection: collection,
        user: user,
        details: details,
        ip: details.ip || 'unknown',
        userAgent: details.userAgent || 'unknown'
      };

      await mongoose.connection.db
        .collection(this.auditCollection)
        .insertOne(auditEntry);

      console.log(\`📝 Audit logged: \${operation} on \${collection} by \${user}\`);
    } catch (error) {
      console.error('❌ Failed to log audit entry:', error);
    }
  }

  async getAuditTrail(filter = {}, limit = 100) {
    try {
      const auditLog = await mongoose.connection.db
        .collection(this.auditCollection)
        .find(filter)
        .sort({ timestamp: -1 })
        .limit(limit)
        .toArray();

      return auditLog;
    } catch (error) {
      console.error('❌ Failed to retrieve audit trail:', error);
      throw error;
    }
  }
}

// Performance monitoring
class AtlasPerformanceMonitor {
  static async getClusterMetrics() {
    try {
      const adminDb = mongoose.connection.db.admin();

      // Get server status
      const serverStatus = await adminDb.serverStatus();

      const metrics = {
        connections: serverStatus.connections,
        opcounters: serverStatus.opcounters,
        memory: serverStatus.mem,
        uptime: serverStatus.uptime,
        assertions: serverStatus.assertions,
        network: serverStatus.network,
        timestamp: new Date()
      };

      console.log('📊 Cluster Metrics:', JSON.stringify(metrics, null, 2));
      return metrics;
    } catch (error) {
      console.error('❌ Failed to get cluster metrics:', error);
      throw error;
    }
  }

  static async getSlowQueries(thresholdMs = 100) {
    try {
      // Enable profiling temporarily
      await mongoose.connection.db.setProfilingLevel(2, { slowms: thresholdMs });

      // Wait a moment for some queries to be profiled
      await new Promise(resolve => setTimeout(resolve, 1000));

      const slowQueries = await mongoose.connection.db
        .collection('system.profile')
        .find({ millis: { $gte: thresholdMs } })
        .sort({ millis: -1 })
        .limit(10)
        .toArray();

      // Disable profiling
      await mongoose.connection.db.setProfilingLevel(0);

      console.log(\`🐌 Found \${slowQueries.length} slow queries (> \${thresholdMs}ms):\`);

      slowQueries.forEach((query, index) => {
        console.log(\`\${index + 1}. \${query.millis}ms - \${query.op} on \${query.ns}\`);
      });

      return slowQueries;
    } catch (error) {
      console.error('❌ Failed to get slow queries:', error);
      throw error;
    }
  }

  static async getIndexUsage() {
    try {
      const collections = await mongoose.connection.db.collections();
      const indexUsage = {};

      for (const collection of collections) {
        const collectionName = collection.collectionName;

        // Skip system collections
        if (collectionName.startsWith('system.')) continue;

        const indexes = await collection.aggregate([
          { $indexStats: {} }
        ]).toArray();

        indexUsage[collectionName] = indexes.map(index => ({
          name: index.name,
          usageCount: index.accesses?.ops || 0,
          since: index.accesses?.since
        }));
      }

      console.log('📈 Index Usage Report:');
      Object.entries(indexUsage).forEach(([collection, indexes]) => {
        console.log(\`\\n\${collection}:\`);
        indexes.forEach(index => {
          console.log(\`  \${index.name}: \${index.usageCount} uses\`);
        });
      });

      return indexUsage;
    } catch (error) {
      console.error('❌ Failed to get index usage:', error);
      throw error;
    }
  }
}

// Backup and recovery utilities
class BackupManager {
  static async createBackup(collectionName, backupName) {
    try {
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
      const backupCollection = \`backup_\${collectionName}_\${timestamp}\`;

      // Copy collection to backup
      await mongoose.connection.db.collection(collectionName).aggregate([
        { $out: backupCollection }
      ]).toArray();

      console.log(\`✅ Backup created: \${backupCollection}\`);

      // Log backup operation
      await mongoose.connection.db.collection('backup_log').insertOne({
        collection: collectionName,
        backupCollection: backupCollection,
        timestamp: new Date(),
        type: 'manual'
      });

      return backupCollection;
    } catch (error) {
      console.error('❌ Failed to create backup:', error);
      throw error;
    }
  }

  static async restoreFromBackup(backupCollection, targetCollection) {
    try {
      // Clear target collection
      await mongoose.connection.db.collection(targetCollection).deleteMany({});

      // Restore from backup
      await mongoose.connection.db.collection(backupCollection).aggregate([
        { $out: targetCollection }
      ]).toArray();

      console.log(\`✅ Restored \${targetCollection} from \${backupCollection}\`);

      // Log restore operation
      await mongoose.connection.db.collection('backup_log').insertOne({
        collection: targetCollection,
        backupCollection: backupCollection,
        timestamp: new Date(),
        type: 'restore'
      });

      return true;
    } catch (error) {
      console.error('❌ Failed to restore from backup:', error);
      throw error;
    }
  }

  static async listBackups(collectionName) {
    try {
      const backups = await mongoose.connection.db
        .collection('backup_log')
        .find({
          collection: collectionName,
          type: 'manual'
        })
        .sort({ timestamp: -1 })
        .toArray();

      console.log(\`📋 Available backups for \${collectionName}:\`);
      backups.forEach(backup => {
        console.log(\`  \${backup.backupCollection} - \${backup.timestamp}\`);
      });

      return backups;
    } catch (error) {
      console.error('❌ Failed to list backups:', error);
      throw error;
    }
  }
}

module.exports = {
  AtlasUserManager,
  AuditLogger,
  AtlasPerformanceMonitor,
  BackupManager
};`}]}],projects:[{title:"E-commerce Platform with MongoDB",description:"Build a complete e-commerce platform using MongoDB for product catalog, user management, orders, and analytics. Implement features like product search, shopping cart, order processing, and sales analytics with aggregation pipelines."},{title:"Social Media Analytics Dashboard",description:"Create a social media analytics platform using MongoDB to store and analyze user interactions, posts, and engagement metrics. Implement real-time analytics, trend analysis, and user behavior insights."},{title:"IoT Data Processing System",description:"Develop an IoT data processing system using MongoDB for storing sensor data, implementing time-series analytics, and creating real-time monitoring dashboards with aggregation frameworks."},{title:"Content Management System",description:"Build a flexible content management system with MongoDB, supporting multiple content types, user roles, workflow management, and advanced search capabilities using text indexes."},{title:"Financial Transaction System",description:"Create a financial transaction processing system with MongoDB, implementing ACID transactions, audit logging, compliance reporting, and real-time balance calculations."}],assessments:[{type:"quiz",questions:[{question:"What is the primary advantage of MongoDB's document model?",options:["Strict schema enforcement","Flexible schema design","SQL query compatibility","Automatic data normalization"],correctAnswer:"Flexible schema design"},{question:"Which MongoDB operation is used for complex data analysis?",options:["find()","insertOne()","aggregate()","updateMany()"],correctAnswer:"aggregate()"},{question:"What type of index is used for location-based queries in MongoDB?",options:["Text index","Geospatial index","Compound index","Hashed index"],correctAnswer:"Geospatial index"},{question:"Which MongoDB service provides managed cloud deployment?",options:["MongoDB Compass","MongoDB Atlas","MongoDB Shell","MongoDB Charts"],correctAnswer:"MongoDB Atlas"},{question:"What is the maximum document size in MongoDB?",options:["4MB","8MB","16MB","32MB"],correctAnswer:"16MB"}]},{type:"evaluation",questions:[{question:"Design a MongoDB schema for a blogging platform that supports users, posts, comments, and tags. Explain your embedding vs referencing decisions and indexing strategy.",options:[],correctAnswer:""},{question:"Create an aggregation pipeline that analyzes sales data to show top products, revenue trends, and customer behavior patterns. Explain each stage of your pipeline.",options:[],correctAnswer:""},{question:"Explain how you would implement a real-time chat system using MongoDB, including data modeling, indexing, and performance optimization strategies.",options:[],correctAnswer:""}]}],aiPrompts:["How do I design a MongoDB schema?","How do I use MongoDB aggregation pipelines?","How do I create indexes in MongoDB?","How do I connect to MongoDB Atlas?","How do I optimize MongoDB queries?","How do I use Mongoose with MongoDB?","How do I implement MongoDB transactions?","How do I backup MongoDB data?","How do I monitor MongoDB performance?","How do I use MongoDB with Node.js?","How do I implement MongoDB security?","How do I migrate data in MongoDB?","How do I use MongoDB geospatial queries?","How do I implement MongoDB text search?","How do I scale MongoDB applications?"],resources:[{name:"MongoDB Official Documentation",url:"https://docs.mongodb.com"},{name:"MongoDB University",url:"https://university.mongodb.com"},{name:"MongoDB Atlas Documentation",url:"https://docs.atlas.mongodb.com"},{name:"Mongoose Documentation",url:"https://mongoosejs.com/docs"},{name:"MongoDB Compass",url:"https://www.mongodb.com/products/compass"},{name:"MongoDB Charts",url:"https://www.mongodb.com/products/charts"},{name:"MongoDB Realm",url:"https://www.mongodb.com/realm"},{name:"MongoDB Stitch",url:"https://www.mongodb.com/cloud/stitch"}],toolsRequired:["Node.js (v14 or higher)","MongoDB (Community Server or Atlas)","MongoDB Compass (GUI tool)","Mongoose ODM","MongoDB Node.js Driver","Postman or similar API testing tool","Git for version control","Visual Studio Code or similar IDE"],bestPractices:["Design schemas based on application query patterns","Use embedding for frequently accessed related data","Create indexes for commonly queried fields","Use compound indexes for multi-field queries","Implement proper error handling for database operations","Use transactions for multi-document operations","Monitor query performance and optimize slow queries","Implement proper backup and recovery strategies","Use MongoDB Atlas for production deployments","Implement security best practices (authentication, authorization)","Use connection pooling for better performance","Validate data at application level","Use aggregation pipelines for complex data analysis","Implement proper logging and monitoring","Plan for horizontal scaling with sharding","Use appropriate data types for fields","Implement data archiving strategies for large datasets","Use MongoDB's built-in compression features","Regularly update MongoDB and drivers","Test database operations thoroughly"],commonPitfalls:["Designing schemas without considering query patterns","Over-embedding data leading to large documents","Not creating appropriate indexes","Ignoring connection pooling configuration","Not handling database connection errors properly","Using MongoDB for relational data without proper design","Not implementing proper backup strategies","Ignoring security configurations","Not monitoring database performance","Using outdated MongoDB drivers","Not implementing data validation","Ignoring aggregation pipeline optimization","Not planning for data growth","Using inappropriate data types","Not implementing proper error handling","Ignoring MongoDB's 16MB document size limit","Not using transactions when needed","Over-indexing leading to write performance issues","Not implementing proper logging","Ignoring MongoDB Atlas best practices"],careerRelevance:"MongoDB is one of the most popular NoSQL databases, used by companies like Netflix, Uber, and eBay. MongoDB developers are in high demand for modern web development, big data processing, and real-time applications. The flexible document model makes MongoDB ideal for agile development and rapid prototyping. MongoDB skills are highly valued in full-stack development roles, with competitive salaries and excellent career prospects in the growing NoSQL database market."},DM={id:"authentication",tier:3,name:"Authentication & Authorization",description:"Master modern authentication and authorization systems including JWT tokens, OAuth 2.0, session management, and security best practices. Learn to implement secure user authentication, role-based access control, and protect applications from common security vulnerabilities.",difficulty:"intermediate",estimatedHours:18,prerequisites:["nodejs","security"],learningObjectives:["Implement JWT token-based authentication with proper signing and verification","Configure OAuth 2.0 and OpenID Connect flows for third-party authentication","Design secure session management strategies with proper expiration and renewal","Apply password hashing techniques using bcrypt and salt generation","Implement multi-factor authentication (MFA) for enhanced security","Create role-based access control (RBAC) systems with permissions","Identify and prevent common authentication vulnerabilities (CSRF, XSS, injection)","Design secure password policies and validation rules","Implement proper logout and token revocation mechanisms","Configure HTTPS and secure cookie settings for production","Handle authentication errors gracefully with proper user feedback","Monitor and audit authentication events for security compliance"],sections:[{title:"JWT Token Implementation",content:`JSON Web Tokens (JWT) are a compact, URL-safe means of representing claims to be transferred between two parties. JWTs are commonly used for authentication and information exchange in web applications. A JWT consists of three parts: Header, Payload, and Signature, separated by dots.

**JWT Structure**: The header typically contains the token type and signing algorithm. The payload contains the claims (user information, expiration time, etc.). The signature ensures the token hasn't been tampered with.

**Token Lifecycle**: When a user logs in, the server creates a JWT and sends it to the client. The client stores this token (usually in localStorage or cookies) and includes it in subsequent requests. The server verifies the token on each request.

**Security Considerations**: Always use HTTPS to prevent token interception. Implement proper token expiration (exp claim) and consider token refresh mechanisms. Never store sensitive information in JWT payloads as they are base64 encoded, not encrypted.

**Best Practices**: Use strong signing algorithms like HS256 or RS256. Implement token blacklisting for logout functionality. Validate all claims on the server side. Consider token size limits for HTTP headers.`,keyTopics:["JWT structure (Header, Payload, Signature)","Token signing and verification algorithms","Token expiration and refresh mechanisms","Secure token storage strategies","Token validation and error handling"],practicalExercises:["Create a JWT utility module with sign and verify functions","Implement token-based authentication middleware","Build a token refresh mechanism with sliding expiration","Create a token blacklist for logout functionality","Implement role-based claims in JWT payloads"],codeExamples:[{title:"JWT Authentication Middleware",language:"javascript",code:`const jwt = require('jsonwebtoken');
const User = require('../models/User');

const authenticateToken = async (req, res, next) => {
  try {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

    if (!token) {
      return res.status(401).json({ error: 'Access token required' });
    }

    // Verify the token
    const decoded = jwt.verify(token, process.env.JWT_SECRET);

    // Get user from database (optional, depending on your needs)
    const user = await User.findById(decoded.userId);
    if (!user) {
      return res.status(401).json({ error: 'User not found' });
    }

    req.user = user;
    next();
  } catch (error) {
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({ error: 'Token expired' });
    }
    if (error.name === 'JsonWebTokenError') {
      return res.status(401).json({ error: 'Invalid token' });
    }
    res.status(500).json({ error: 'Authentication error' });
  }
};

module.exports = authenticateToken;`},{title:"JWT Token Generation",language:"javascript",code:`const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

class AuthService {
  constructor() {
    this.jwtSecret = process.env.JWT_SECRET;
    this.jwtExpiresIn = process.env.JWT_EXPIRES_IN || '24h';
  }

  // Generate JWT token
  generateToken(user) {
    const payload = {
      userId: user._id,
      email: user.email,
      role: user.role,
      iat: Math.floor(Date.now() / 1000),
      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours
    };

    return jwt.sign(payload, this.jwtSecret, {
      algorithm: 'HS256',
      expiresIn: this.jwtExpiresIn
    });
  }

  // Verify password
  async verifyPassword(plainPassword, hashedPassword) {
    return await bcrypt.compare(plainPassword, hashedPassword);
  }

  // Hash password
  async hashPassword(password) {
    const saltRounds = 12;
    return await bcrypt.hash(password, saltRounds);
  }
}

module.exports = new AuthService();`}]},{title:"OAuth 2.0 and OpenID Connect",content:`OAuth 2.0 is an authorization framework that enables applications to obtain limited access to user accounts on an HTTP service. OpenID Connect (OIDC) is an identity layer built on top of OAuth 2.0 that provides authentication capabilities.

**OAuth 2.0 Flows**: The most common flow is the Authorization Code flow, which is secure for server-side applications. Other flows include Implicit (for SPAs), Client Credentials (for service-to-service), and Resource Owner Password Credentials.

**OpenID Connect**: Extends OAuth 2.0 with an identity token (ID token) that contains user identity information. The ID token is a JWT that contains claims about the user's identity.

**Implementation Steps**: Register your application with the OAuth provider (Google, GitHub, etc.). Redirect users to the provider's authorization endpoint. Handle the authorization code callback. Exchange the code for access and ID tokens.

**Security Considerations**: Always validate the state parameter to prevent CSRF attacks. Verify the ID token signature and claims. Use PKCE (Proof Key for Code Exchange) for public clients. Implement proper token storage and refresh mechanisms.

**Provider Integration**: Popular providers include Google, GitHub, Facebook, and Auth0. Each has specific configuration requirements and scope definitions.`,keyTopics:["OAuth 2.0 authorization flows","OpenID Connect identity tokens","Provider registration and configuration","State parameter and CSRF protection","PKCE (Proof Key for Code Exchange)"],practicalExercises:["Implement Google OAuth 2.0 integration","Create OpenID Connect authentication flow","Build social login buttons for multiple providers","Implement PKCE for enhanced security","Create OAuth provider configuration module"],codeExamples:[{title:"Google OAuth 2.0 Integration",language:"javascript",code:`const passport = require('passport');
const GoogleStrategy = require('passport-google-oauth20').Strategy;
const User = require('../models/User');

passport.use(new GoogleStrategy({
    clientID: process.env.GOOGLE_CLIENT_ID,
    clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    callbackURL: '/auth/google/callback'
  },
  async (accessToken, refreshToken, profile, done) => {
    try {
      // Check if user already exists
      let user = await User.findOne({ googleId: profile.id });

      if (user) {
        return done(null, user);
      }

      // Create new user
      user = new User({
        googleId: profile.id,
        email: profile.emails[0].value,
        name: profile.displayName,
        avatar: profile.photos[0].value,
        provider: 'google'
      });

      await user.save();
      done(null, user);
    } catch (error) {
      done(error, null);
    }
  }
));

// Serialize user for session
passport.serializeUser((user, done) => {
  done(null, user.id);
});

passport.deserializeUser(async (id, done) => {
  try {
    const user = await User.findById(id);
    done(null, user);
  } catch (error) {
    done(error, null);
  }
});

module.exports = passport;`},{title:"OpenID Connect Token Validation",language:"javascript",code:`const jwt = require('jsonwebtoken');
const jwksClient = require('jwks-rsa');

class OIDCTokenValidator {
  constructor(issuer, jwksUri) {
    this.issuer = issuer;
    this.client = jwksClient({
      jwksUri: jwksUri,
      cache: true,
      rateLimit: true
    });
  }

  // Get signing key
  getKey(header, callback) {
    this.client.getSigningKey(header.kid, (err, key) => {
      if (err) {
        callback(err);
      } else {
        const signingKey = key.publicKey || key.rsaPublicKey;
        callback(null, signingKey);
      }
    });
  }

  // Validate ID token
  async validateIdToken(idToken) {
    try {
      const decoded = jwt.decode(idToken, { complete: true });

      if (!decoded) {
        throw new Error('Invalid ID token');
      }

      // Verify token structure
      if (decoded.payload.iss !== this.issuer) {
        throw new Error('Invalid issuer');
      }

      if (decoded.payload.aud !== process.env.OIDC_CLIENT_ID) {
        throw new Error('Invalid audience');
      }

      // Check expiration
      if (decoded.payload.exp < Math.floor(Date.now() / 1000)) {
        throw new Error('Token expired');
      }

      // Verify signature
      const verified = await new Promise((resolve, reject) => {
        jwt.verify(idToken, this.getKey.bind(this), {
          algorithms: ['RS256']
        }, (err, decoded) => {
          if (err) reject(err);
          else resolve(decoded);
        });
      });

      return verified;
    } catch (error) {
      throw new Error(\`ID token validation failed: \${error.message}\`);
    }
  }
}

module.exports = OIDCTokenValidator;`}]},{title:"Session Management and Security",content:`Session management is crucial for maintaining user state and security in web applications. Proper session handling prevents common attacks and ensures user data protection.

**Session Storage Options**: Server-side sessions store data on the server with a session ID sent to the client. Client-side sessions (like JWT) store data in the token itself. Hybrid approaches combine both methods.

**Security Best Practices**: Use secure, random session IDs. Implement proper session expiration and renewal. Store sessions securely (encrypted databases, not localStorage for sensitive data). Implement session fixation protection.

**Session Lifecycle**: Create sessions on successful authentication. Include essential user information and metadata. Handle session expiration gracefully. Provide secure logout mechanisms that destroy sessions properly.

**Advanced Features**: Implement sliding expiration where session lifetime extends on activity. Add session concurrency control to limit simultaneous sessions. Include device tracking for security monitoring.

**Common Vulnerabilities**: Session fixation attacks can be prevented by regenerating session IDs after login. Session hijacking can be mitigated with proper cookie settings and HTTPS.`,keyTopics:["Server-side vs client-side session storage","Session ID generation and security","Session expiration and renewal strategies","Secure cookie configuration","Session fixation and hijacking prevention"],practicalExercises:["Implement secure session middleware with Redis","Create session management utility functions","Build session cleanup and maintenance scripts","Implement sliding session expiration","Create session monitoring and analytics"],codeExamples:[{title:"Express Session Configuration",language:"javascript",code:`const session = require('express-session');
const RedisStore = require('connect-redis')(session);
const redis = require('redis');

const redisClient = redis.createClient({
  host: process.env.REDIS_HOST || 'localhost',
  port: process.env.REDIS_PORT || 6379,
  password: process.env.REDIS_PASSWORD
});

redisClient.on('error', (err) => {
  console.error('Redis connection error:', err);
});

const sessionConfig = {
  store: new RedisStore({ client: redisClient }),
  secret: process.env.SESSION_SECRET,
  name: 'sessionId', // Don't use default session name
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: process.env.NODE_ENV === 'production', // HTTPS only in production
    httpOnly: true, // Prevent XSS attacks
    maxAge: 24 * 60 * 60 * 1000, // 24 hours
    sameSite: 'strict' // CSRF protection
  }
};

// Regenerate session ID after login to prevent session fixation
const regenerateSession = (req) => {
  return new Promise((resolve, reject) => {
    req.session.regenerate((err) => {
      if (err) reject(err);
      else resolve();
    });
  });
};

// Destroy session on logout
const destroySession = (req) => {
  return new Promise((resolve, reject) => {
    req.session.destroy((err) => {
      if (err) reject(err);
      else resolve();
    });
  });
};

module.exports = { sessionConfig, regenerateSession, destroySession };`},{title:"Session Security Middleware",language:"javascript",code:`const crypto = require('crypto');

class SessionSecurity {
  // Generate secure session ID
  static generateSessionId() {
    return crypto.randomBytes(32).toString('hex');
  }

  // Validate session integrity
  static validateSession(session) {
    if (!session) return false;

    // Check required fields
    if (!session.userId || !session.createdAt) return false;

    // Check session age (max 24 hours)
    const maxAge = 24 * 60 * 60 * 1000; // 24 hours
    const sessionAge = Date.now() - new Date(session.createdAt).getTime();

    if (sessionAge > maxAge) return false;

    // Check for suspicious activity
    if (session.failedAttempts && session.failedAttempts > 5) {
      return false;
    }

    return true;
  }

  // Track session activity
  static trackActivity(session, action) {
    if (!session.activity) {
      session.activity = [];
    }

    session.activity.push({
      action,
      timestamp: new Date(),
      ip: session.ip,
      userAgent: session.userAgent
    });

    // Keep only last 10 activities
    if (session.activity.length > 10) {
      session.activity = session.activity.slice(-10);
    }

    session.lastActivity = new Date();
  }

  // Check for concurrent sessions
  static async checkConcurrentSessions(userId, currentSessionId, maxSessions = 3) {
    // This would typically query your session store
    const userSessions = await this.getUserSessions(userId);

    const activeSessions = userSessions.filter(session =>
      session.id !== currentSessionId &&
      this.validateSession(session)
    );

    if (activeSessions.length >= maxSessions) {
      // Terminate oldest session
      const oldestSession = activeSessions.sort((a, b) =>
        new Date(a.createdAt) - new Date(b.createdAt)
      )[0];

      await this.terminateSession(oldestSession.id);
    }
  }
}

module.exports = SessionSecurity;`}]},{title:"Password Security and Hashing",content:`Password security is fundamental to authentication systems. Proper password hashing prevents credential theft and protects user accounts.

**Hashing Algorithms**: Never store plain text passwords. Use strong, adaptive hashing functions like bcrypt, scrypt, or Argon2. These algorithms are designed to be slow and computationally expensive to prevent brute-force attacks.

**Salt Generation**: Always use unique salts for each password. Salts prevent rainbow table attacks and ensure identical passwords hash differently. Generate cryptographically secure random salts.

**Password Policies**: Implement strong password requirements (length, complexity, character sets). Consider passphrases for better security. Provide clear feedback on password strength.

**Additional Security**: Implement account lockout after failed attempts. Use pepper (additional secret) with salts. Regularly force password changes for sensitive accounts. Consider passwordless authentication options.

**Migration Strategies**: When upgrading hashing algorithms, implement gradual migration. Hash new passwords with the new algorithm while verifying old hashes with the legacy algorithm.`,keyTopics:["Password hashing algorithms (bcrypt, scrypt, Argon2)","Salt generation and usage","Password policy implementation","Account lockout mechanisms","Legacy password migration"],practicalExercises:["Create password hashing utility with bcrypt","Implement password strength validation","Build account lockout system","Create password reset functionality","Implement gradual password migration"],codeExamples:[{title:"Password Hashing Service",language:"javascript",code:`const bcrypt = require('bcryptjs');
const crypto = require('crypto');

class PasswordService {
  constructor() {
    this.saltRounds = 12; // Industry standard
    this.pepper = process.env.PASSWORD_PEPPER; // Additional secret
  }

  // Hash password with salt and pepper
  async hashPassword(password) {
    try {
      // Add pepper to password
      const pepperedPassword = password + this.pepper;

      // Generate salt and hash
      const salt = await bcrypt.genSalt(this.saltRounds);
      const hash = await bcrypt.hash(pepperedPassword, salt);

      return {
        hash,
        salt,
        algorithm: 'bcrypt',
        createdAt: new Date()
      };
    } catch (error) {
      throw new Error(\`Password hashing failed: \${error.message}\`);
    }
  }

  // Verify password
  async verifyPassword(password, storedHash) {
    try {
      const pepperedPassword = password + this.pepper;
      return await bcrypt.compare(pepperedPassword, storedHash);
    } catch (error) {
      throw new Error(\`Password verification failed: \${error.message}\`);
    }
  }

  // Generate secure random password
  static generateSecurePassword(length = 16) {
    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let password = '';

    for (let i = 0; i < length; i++) {
      const randomIndex = crypto.randomInt(0, charset.length);
      password += charset[randomIndex];
    }

    return password;
  }

  // Validate password strength
  static validatePasswordStrength(password) {
    const errors = [];

    if (password.length < 8) {
      errors.push('Password must be at least 8 characters long');
    }

    if (!/[A-Z]/.test(password)) {
      errors.push('Password must contain at least one uppercase letter');
    }

    if (!/[a-z]/.test(password)) {
      errors.push('Password must contain at least one lowercase letter');
    }

    if (!/d/.test(password)) {
      errors.push('Password must contain at least one number');
    }

    if (!/[!@#$%^&*()_+-=[]{};':"\\|,.<>/?]/.test(password)) {
      errors.push('Password must contain at least one special character');
    }

    return {
      isValid: errors.length === 0,
      errors,
      strength: this.calculateStrength(password)
    };
  }

  // Calculate password strength score
  static calculateStrength(password) {
    let score = 0;

    if (password.length >= 8) score += 1;
    if (password.length >= 12) score += 1;
    if (/[A-Z]/.test(password)) score += 1;
    if (/[a-z]/.test(password)) score += 1;
    if (/d/.test(password)) score += 1;
    if (/[!@#$%^&*()_+-=[]{};':"\\|,.<>/?]/.test(password)) score += 1;

    return score; // 0-6 scale
  }
}

module.exports = PasswordService;`},{title:"Account Lockout System",language:"javascript",code:`class AccountLockoutService {
  constructor() {
    this.maxFailedAttempts = 5;
    this.lockoutDuration = 15 * 60 * 1000; // 15 minutes
    this.resetAfter = 24 * 60 * 60 * 1000; // 24 hours
  }

  // Check if account is locked
  isAccountLocked(user) {
    if (!user.lockoutUntil) return false;

    const now = new Date();
    const lockoutUntil = new Date(user.lockoutUntil);

    if (now < lockoutUntil) {
      return true;
    }

    // Lockout period has expired, reset
    this.resetFailedAttempts(user);
    return false;
  }

  // Record failed login attempt
  async recordFailedAttempt(user) {
    try {
      user.failedAttempts = (user.failedAttempts || 0) + 1;
      user.lastFailedAttempt = new Date();

      // Lock account if max attempts reached
      if (user.failedAttempts >= this.maxFailedAttempts) {
        user.lockoutUntil = new Date(Date.now() + this.lockoutDuration);
        user.lockoutReason = 'Too many failed login attempts';
      }

      await user.save();
    } catch (error) {
      throw new Error(\`Failed to record login attempt: \${error.message}\`);
    }
  }

  // Reset failed attempts on successful login
  async resetFailedAttempts(user) {
    try {
      user.failedAttempts = 0;
      user.lastFailedAttempt = null;
      user.lockoutUntil = null;
      user.lockoutReason = null;
      await user.save();
    } catch (error) {
      throw new Error(\`Failed to reset attempts: \${error.message}\`);
    }
  }

  // Get remaining lockout time
  getRemainingLockoutTime(user) {
    if (!user.lockoutUntil) return 0;

    const now = new Date();
    const lockoutUntil = new Date(user.lockoutUntil);
    const remaining = lockoutUntil - now;

    return Math.max(0, remaining);
  }

  // Check if failed attempts should be reset (after reset window)
  shouldResetAttempts(user) {
    if (!user.lastFailedAttempt) return false;

    const now = new Date();
    const lastFailed = new Date(user.lastFailedAttempt);
    const timeSinceLastFailed = now - lastFailed;

    return timeSinceLastFailed > this.resetAfter;
  }

  // Progressive delay for failed attempts
  getProgressiveDelay(attemptNumber) {
    const baseDelay = 1000; // 1 second
    const multiplier = Math.pow(2, attemptNumber - 1);
    return Math.min(baseDelay * multiplier, 30000); // Max 30 seconds
  }
}

module.exports = AccountLockoutService;`}]},{title:"Multi-Factor Authentication (MFA)",content:`Multi-factor authentication adds an extra layer of security by requiring multiple forms of verification. MFA significantly reduces the risk of unauthorized access even if passwords are compromised.

**MFA Types**: Something you know (password), something you have (phone, hardware token), something you are (biometric). Common implementations include SMS codes, authenticator apps (TOTP), hardware security keys, and biometric authentication.

**TOTP Implementation**: Time-based One-Time Passwords use a shared secret and current time to generate codes. Popular apps like Google Authenticator, Authy, and Microsoft Authenticator support TOTP.

**Security Considerations**: Implement backup codes for account recovery. Allow users to register multiple MFA devices. Handle MFA fatigue attacks where attackers repeatedly request verification codes.

**User Experience**: Make MFA enrollment optional but strongly encouraged. Provide clear instructions for setup. Implement remember device functionality to reduce friction for trusted devices.

**Advanced Features**: Support for FIDO2/WebAuthn for passwordless authentication. Implement risk-based authentication that may skip MFA for low-risk logins. Provide analytics on MFA usage and security events.`,keyTopics:["MFA types and implementation methods","TOTP (Time-based One-Time Passwords)","Hardware security keys and WebAuthn","Backup codes and recovery options","MFA fatigue attack prevention"],practicalExercises:["Implement TOTP-based MFA with authenticator apps","Create MFA enrollment and management system","Build backup code generation and validation","Implement WebAuthn for passwordless authentication","Create MFA analytics and monitoring dashboard"],codeExamples:[{title:"TOTP MFA Implementation",language:"javascript",code:`const speakeasy = require('speakeasy');
const qrcode = require('qrcode');

class MFAService {
  constructor() {
    this.issuer = 'YourApp';
    this.algorithm = 'sha1';
    this.digits = 6;
    this.step = 30; // 30 seconds
  }

  // Generate MFA secret for user
  generateMFASecret(user) {
    const secret = speakeasy.generateSecret({
      name: \`\${this.issuer}:\${user.email}\`,
      issuer: this.issuer,
      length: 32
    });

    return {
      secret: secret.base32,
      otpauthUrl: secret.otpauth_url
    };
  }

  // Generate QR code for authenticator app
  async generateQRCode(otpauthUrl) {
    try {
      const qrCodeDataURL = await qrcode.toDataURL(otpauthUrl);
      return qrCodeDataURL;
    } catch (error) {
      throw new Error(\`QR code generation failed: \${error.message}\`);
    }
  }

  // Verify TOTP token
  verifyToken(secret, token, window = 1) {
    return speakeasy.totp.verify({
      secret: secret,
      encoding: 'base32',
      token: token,
      window: window, // Allow 1 step tolerance for clock skew
      algorithm: this.algorithm,
      digits: this.digits,
      step: this.step
    });
  }

  // Generate backup codes
  generateBackupCodes(count = 10) {
    const codes = [];
    for (let i = 0; i < count; i++) {
      const code = speakeasy.generateSecret({
        length: 10,
        symbols: false,
        otpauth_url: false
      }).base32;
      codes.push(code);
    }
    return codes;
  }

  // Verify backup code (one-time use)
  async verifyBackupCode(user, code) {
    if (!user.backupCodes || !user.backupCodes.includes(code)) {
      return false;
    }

    // Remove used backup code
    user.backupCodes = user.backupCodes.filter(c => c !== code);
    await user.save();

    return true;
  }
}

module.exports = MFAService;`},{title:"MFA Enrollment Controller",language:"javascript",code:`const MFAService = require('../services/MFAService');
const User = require('../models/User');

class MFAController {
  // Start MFA enrollment
  async startEnrollment(req, res) {
    try {
      const user = req.user;
      const mfaService = new MFAService();

      // Generate secret and QR code
      const { secret, otpauthUrl } = mfaService.generateMFASecret(user);
      const qrCode = await mfaService.generateQRCode(otpauthUrl);

      // Store temporary secret (don't save to user yet)
      req.session.mfaTempSecret = secret;

      res.json({
        secret: secret,
        qrCode: qrCode,
        message: 'Scan QR code with authenticator app, then verify with code'
      });
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  }

  // Verify and complete MFA enrollment
  async completeEnrollment(req, res) {
    try {
      const { token } = req.body;
      const user = req.user;
      const mfaService = new MFAService();

      if (!req.session.mfaTempSecret) {
        return res.status(400).json({ error: 'MFA enrollment not started' });
      }

      // Verify the token
      const isValid = mfaService.verifyToken(req.session.mfaTempSecret, token);

      if (!isValid) {
        return res.status(400).json({ error: 'Invalid verification code' });
      }

      // Save MFA settings to user
      user.mfaEnabled = true;
      user.mfaSecret = req.session.mfaTempSecret;
      user.backupCodes = mfaService.generateBackupCodes();

      await user.save();

      // Clear temporary secret
      delete req.session.mfaTempSecret;

      res.json({
        message: 'MFA enabled successfully',
        backupCodes: user.backupCodes
      });
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  }

  // Disable MFA
  async disableMFA(req, res) {
    try {
      const { password } = req.body;
      const user = req.user;

      // Verify password before disabling MFA
      const isValidPassword = await user.verifyPassword(password);
      if (!isValidPassword) {
        return res.status(400).json({ error: 'Invalid password' });
      }

      user.mfaEnabled = false;
      user.mfaSecret = null;
      user.backupCodes = null;

      await user.save();

      res.json({ message: 'MFA disabled successfully' });
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  }

  // Verify MFA token during login
  async verifyMFAToken(req, res) {
    try {
      const { token, backupCode } = req.body;
      const user = req.user;
      const mfaService = new MFAService();

      let isValid = false;

      if (token) {
        // Verify TOTP token
        isValid = mfaService.verifyToken(user.mfaSecret, token);
      } else if (backupCode) {
        // Verify backup code
        isValid = await mfaService.verifyBackupCode(user, backupCode);
      }

      if (!isValid) {
        return res.status(400).json({ error: 'Invalid MFA code' });
      }

      // Generate authentication token
      const authToken = user.generateAuthToken();

      res.json({
        token: authToken,
        message: 'MFA verification successful'
      });
    } catch (error) {
      res.status(500).json({ error: 'MFA verification failed' });
    }
  }
}

module.exports = new MFAController();`}]},{title:"Role-Based Access Control (RBAC)",content:`Role-Based Access Control (RBAC) is a security model that restricts system access based on user roles and permissions. RBAC simplifies permission management and ensures users only access resources they need.

**Core Components**: Users are assigned roles, roles have permissions, and permissions define what actions can be performed on resources. This creates a clear hierarchy of access control.

**Implementation Strategies**: Define roles clearly (admin, moderator, user, guest). Create permission matrices for different resources. Implement middleware to check permissions on each request.

**Advanced Features**: Support for role hierarchies where higher roles inherit lower role permissions. Implement resource-specific permissions. Add time-based restrictions and IP whitelisting.

**Best Practices**: Use the principle of least privilege. Regularly audit role assignments. Implement approval workflows for sensitive role changes. Provide clear documentation on role responsibilities.

**Common Patterns**: Admin roles with full access, moderator roles with content management permissions, user roles with basic functionality, and guest roles with minimal access.`,keyTopics:["RBAC model components (users, roles, permissions)","Role hierarchy and inheritance","Permission checking middleware","Resource-specific access control","Role audit and compliance"],practicalExercises:["Design and implement RBAC permission system","Create role-based middleware for API endpoints","Build role management interface","Implement permission inheritance hierarchy","Create role audit and reporting system"],codeExamples:[{title:"RBAC Permission System",language:"javascript",code:`class RBACService {
  constructor() {
    // Define permissions
    this.permissions = {
      // User management
      'users:create': 'Create new users',
      'users:read': 'View user information',
      'users:update': 'Update user information',
      'users:delete': 'Delete users',

      // Content management
      'content:create': 'Create content',
      'content:read': 'View content',
      'content:update': 'Update content',
      'content:delete': 'Delete content',
      'content:publish': 'Publish content',

      // System administration
      'admin:access': 'Access admin panel',
      'admin:config': 'Modify system configuration',
      'admin:logs': 'View system logs'
    };

    // Define roles and their permissions
    this.roles = {
      guest: [
        'content:read'
      ],
      user: [
        'users:read',
        'users:update', // Users can update their own profile
        'content:create',
        'content:read',
        'content:update' // Users can update their own content
      ],
      moderator: [
        'users:read',
        'content:create',
        'content:read',
        'content:update',
        'content:delete',
        'content:publish'
      ],
      admin: [
        'users:create',
        'users:read',
        'users:update',
        'users:delete',
        'content:create',
        'content:read',
        'content:update',
        'content:delete',
        'content:publish',
        'admin:access',
        'admin:config',
        'admin:logs'
      ]
    };
  }

  // Check if user has permission
  hasPermission(user, permission) {
    if (!user || !user.role) return false;

    const userPermissions = this.roles[user.role] || [];
    return userPermissions.includes(permission);
  }

  // Check multiple permissions (user must have ALL)
  hasAllPermissions(user, permissions) {
    return permissions.every(permission => this.hasPermission(user, permission));
  }

  // Check multiple permissions (user must have ANY)
  hasAnyPermission(user, permissions) {
    return permissions.some(permission => this.hasPermission(user, permission));
  }

  // Get all permissions for a role
  getRolePermissions(role) {
    return this.roles[role] || [];
  }

  // Add permission to role
  addPermissionToRole(role, permission) {
    if (!this.roles[role]) {
      this.roles[role] = [];
    }

    if (!this.roles[role].includes(permission)) {
      this.roles[role].push(permission);
    }
  }

  // Remove permission from role
  removePermissionFromRole(role, permission) {
    if (this.roles[role]) {
      this.roles[role] = this.roles[role].filter(p => p !== permission);
    }
  }

  // Create custom role
  createRole(roleName, permissions) {
    this.roles[roleName] = permissions;
  }

  // Get all available roles
  getAllRoles() {
    return Object.keys(this.roles);
  }

  // Validate role exists
  isValidRole(role) {
    return this.roles.hasOwnProperty(role);
  }
}

module.exports = new RBACService();`},{title:"RBAC Middleware",language:"javascript",code:`const RBACService = require('../services/RBACService');

class RBACMiddleware {
  // Create permission-checking middleware
  static requirePermission(permission) {
    return (req, res, next) => {
      try {
        if (!req.user) {
          return res.status(401).json({ error: 'Authentication required' });
        }

        if (!RBACService.hasPermission(req.user, permission)) {
          return res.status(403).json({
            error: 'Insufficient permissions',
            required: permission,
            userRole: req.user.role
          });
        }

        next();
      } catch (error) {
        res.status(500).json({ error: 'Permission check failed' });
      }
    };
  }

  // Require any of multiple permissions
  static requireAnyPermission(permissions) {
    return (req, res, next) => {
      try {
        if (!req.user) {
          return res.status(401).json({ error: 'Authentication required' });
        }

        if (!RBACService.hasAnyPermission(req.user, permissions)) {
          return res.status(403).json({
            error: 'Insufficient permissions',
            required: permissions,
            userRole: req.user.role
          });
        }

        next();
      } catch (error) {
        res.status(500).json({ error: 'Permission check failed' });
      }
    };
  }

  // Require all of multiple permissions
  static requireAllPermissions(permissions) {
    return (req, res, next) => {
      try {
        if (!req.user) {
          return res.status(401).json({ error: 'Authentication required' });
        }

        if (!RBACService.hasAllPermissions(req.user, permissions)) {
          return res.status(403).json({
            error: 'Insufficient permissions',
            required: permissions,
            userRole: req.user.role
          });
        }

        next();
      } catch (error) {
        res.status(500).json({ error: 'Permission check failed' });
      }
    };
  }

  // Resource ownership check
  static requireOwnership(resourceField = 'userId') {
    return (req, res, next) => {
      try {
        if (!req.user) {
          return res.status(401).json({ error: 'Authentication required' });
        }

        const resourceId = req.params.id || req.body[resourceField];
        const userId = req.user._id || req.user.id;

        if (resourceId !== userId && !RBACService.hasPermission(req.user, 'admin:access')) {
          return res.status(403).json({ error: 'Access denied: not resource owner' });
        }

        next();
      } catch (error) {
        res.status(500).json({ error: 'Ownership check failed' });
      }
    };
  }

  // Role-based middleware
  static requireRole(role) {
    return (req, res, next) => {
      try {
        if (!req.user) {
          return res.status(401).json({ error: 'Authentication required' });
        }

        if (req.user.role !== role && !RBACService.hasPermission(req.user, 'admin:access')) {
          return res.status(403).json({
            error: 'Insufficient role',
            required: role,
            userRole: req.user.role
          });
        }

        next();
      } catch (error) {
        res.status(500).json({ error: 'Role check failed' });
      }
    };
  }

  // Admin-only middleware
  static requireAdmin = this.requireRole('admin');
}

module.exports = RBACMiddleware;`}]}],projects:[{title:"Secure Authentication System",description:"Build a complete authentication system with JWT, OAuth 2.0, MFA, and RBAC",difficulty:"advanced",estimatedHours:40,technologies:["Node.js","Express","MongoDB","JWT","OAuth 2.0"],features:["User registration and login with JWT","Google OAuth 2.0 integration","TOTP-based multi-factor authentication","Role-based access control system","Password reset functionality","Session management with Redis","Security audit logging"]},{title:"Authentication Microservice",description:"Create a standalone authentication microservice with comprehensive security features",difficulty:"advanced",estimatedHours:35,technologies:["Node.js","Express","MongoDB","Redis","Docker"],features:["RESTful API for authentication","Multiple OAuth provider support","JWT token management","Rate limiting and DDoS protection","Comprehensive logging and monitoring","Database migration scripts","API documentation with Swagger"]},{title:"Enterprise Security Dashboard",description:"Build an admin dashboard for managing users, roles, and security policies",difficulty:"intermediate",estimatedHours:25,technologies:["React","Node.js","MongoDB","Chart.js"],features:["User management interface","Role and permission management","Security event monitoring","Login attempt analytics","MFA enrollment management","Audit log viewer","Security policy configuration"]}],assessments:{quiz:[{question:"What is the primary purpose of JWT tokens in authentication?",options:["To store user passwords securely","To transmit authentication claims between parties","To encrypt database connections","To generate random session IDs"],correctAnswer:1,explanation:"JWT tokens are used to securely transmit authentication claims and user information between parties in a compact, URL-safe format."},{question:"Which OAuth 2.0 flow is most secure for server-side web applications?",options:["Implicit Flow","Authorization Code Flow","Resource Owner Password Credentials Flow","Client Credentials Flow"],correctAnswer:1,explanation:"The Authorization Code Flow is the most secure for server-side applications as it doesn't expose tokens in the browser."},{question:"What is the main advantage of using bcrypt for password hashing?",options:["It's the fastest hashing algorithm","It uses adaptive complexity that can be increased over time","It produces shorter hash outputs","It doesn't require salt values"],correctAnswer:1,explanation:"bcrypt uses adaptive complexity, meaning you can increase the computational cost over time as hardware gets faster."},{question:"What does RBAC stand for in access control systems?",options:["Role-Based Access Control","Resource-Based Access Control","Rule-Based Access Control","Rights-Based Access Control"],correctAnswer:0,explanation:"RBAC stands for Role-Based Access Control, a security model that restricts access based on user roles."},{question:"Which of the following is NOT a common type of multi-factor authentication?",options:["Something you know (password)","Something you have (phone)","Something you are (biometric)","Something you think (opinion)"],correctAnswer:3,explanation:"The three main types of MFA factors are: something you know, something you have, and something you are."}],evaluation:[{scenario:"You are implementing authentication for a healthcare application that handles sensitive patient data. The application needs to support both traditional username/password login and integration with hospital SSO systems.",questions:["What authentication strategies would you recommend and why?","How would you handle the transition from password-based to SSO authentication?","What additional security measures would you implement for this sensitive data context?"]},{scenario:"Your e-commerce platform is experiencing frequent brute-force attacks on user accounts. Users are complaining about the security measures being too cumbersome.",questions:["How would you balance security with user experience in this scenario?","What specific anti-brute-force measures would you implement?","How would you communicate security changes to users effectively?"]}]},aiPrompts:["How do I implement JWT authentication in my Node.js application?","What's the difference between OAuth 2.0 and OpenID Connect?","How do I securely store user passwords in a database?","How do I implement multi-factor authentication with TOTP?","How do I create a role-based access control system?","How do I handle password reset functionality securely?","What's the best way to implement session management?","How do I prevent CSRF attacks in my web application?","How do I implement OAuth 2.0 with Google in my app?","How do I create backup codes for MFA recovery?","How do I audit authentication events for security compliance?","What's the difference between authentication and authorization?"],resources:[{title:"JWT.io - JSON Web Tokens",type:"documentation",url:"https://jwt.io",description:"Official JWT website with debugger, libraries, and documentation"},{title:"OAuth 2.0 Authorization Framework",type:"specification",url:"https://tools.ietf.org/html/rfc6749",description:"Official OAuth 2.0 specification document"},{title:"OWASP Authentication Cheat Sheet",type:"guide",url:"https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html",description:"Comprehensive security best practices for authentication"},{title:"bcrypt vs scrypt vs Argon2",type:"article",url:"https://security.stackexchange.com/questions/26245/is-bcrypt-better-than-scrypt",description:"Comparison of password hashing algorithms"},{title:"Google Authenticator",type:"tool",url:"https://github.com/google/google-authenticator",description:"TOTP implementation for multi-factor authentication"}],toolsRequired:["Node.js (v14+)","npm or yarn package manager","MongoDB database","Redis (optional, for session storage)","JWT library (jsonwebtoken)","bcrypt for password hashing","OAuth client libraries","TOTP library (speakeasy)","Express.js framework","Postman for API testing"],bestPractices:["Always use HTTPS in production to protect authentication data","Implement proper password policies with strength requirements","Use secure, random session IDs and JWT secrets","Implement account lockout after failed login attempts","Store passwords using strong hashing algorithms like bcrypt","Use multi-factor authentication for sensitive operations","Implement proper logout mechanisms that invalidate sessions","Regularly rotate JWT secrets and encryption keys","Log authentication events for security monitoring","Use the principle of least privilege in role assignments","Implement rate limiting to prevent brute force attacks","Validate and sanitize all user inputs","Use secure cookie settings (httpOnly, secure, sameSite)","Implement CSRF protection for state-changing operations","Regularly audit user roles and permissions","Provide clear error messages without revealing sensitive information"],commonPitfalls:["Storing passwords in plain text or weak encryption","Using short or predictable JWT secrets","Not implementing proper session expiration","Missing HTTPS configuration in production","Inadequate password strength requirements","Not handling token revocation properly","Exposing sensitive information in error messages","Using insecure random number generation","Not implementing rate limiting for authentication endpoints","Storing sensitive data in JWT payloads","Missing input validation and sanitization","Not implementing proper logout functionality","Using weak hashing algorithms for passwords","Not monitoring for suspicious authentication patterns","Implementing insecure password reset mechanisms","Not using secure cookie settings","Missing CSRF protection on authentication forms","Not implementing account lockout policies","Using predictable session IDs","Not auditing authentication and authorization events"],careerRelevance:["Security is a top priority for all software development roles","Authentication expertise is required for full-stack and backend positions","Security knowledge significantly increases salary potential","Many companies require security certifications and best practices knowledge","Authentication systems are critical components in enterprise applications","Understanding OAuth and SSO is essential for modern web development","Security vulnerabilities can have severe legal and financial consequences","DevSecOps roles specifically focus on security integration in development","Mobile app development requires secure authentication implementation","Cloud platforms demand knowledge of authentication and authorization","API development requires proper authentication and access control","Security expertise opens doors to specialized security consulting roles","Understanding authentication helps in building compliant applications","Security knowledge is valuable for startup security assessments","Authentication systems are fundamental to user trust and platform success"]},PM={id:"testing",tier:3,name:"Testing Strategies",description:"Master comprehensive testing methodologies including unit testing, integration testing, end-to-end testing, and test-driven development. Learn to write maintainable tests, implement testing best practices, and integrate automated testing into your development workflow.",difficulty:"intermediate",estimatedHours:20,prerequisites:["javascript","nodejs"],learningObjectives:["Write comprehensive unit tests using Jest with proper assertions and test organization","Implement integration tests to verify component interactions and data flow","Create end-to-end tests using Cypress for complete user workflow validation","Apply test-driven development (TDD) principles to guide code design and implementation","Use mocking and stubbing techniques to isolate code under test","Configure and interpret code coverage reports to ensure adequate test coverage","Set up continuous integration testing with automated test execution","Write testable code following SOLID principles and dependency injection","Implement testing best practices for maintainable and reliable test suites","Debug failing tests and identify root causes of test failures","Organize test files and structure test suites for large applications","Use testing utilities and libraries to improve test efficiency"],sections:[{title:"Unit Testing with Jest",content:`Unit testing is the foundation of a robust testing strategy. It involves testing individual units of code (functions, methods, classes) in isolation to ensure they work as expected. Jest is a popular JavaScript testing framework that provides a complete testing solution with built-in assertion library, mocking capabilities, and code coverage reporting.

**Test Structure**: A typical unit test follows the Arrange-Act-Assert pattern. First, you arrange the test setup (create objects, set up mocks). Then you act by calling the function under test. Finally, you assert that the expected behavior occurred.

**Jest Features**: Jest provides powerful features like automatic test discovery, parallel test execution, snapshot testing, and built-in code coverage. It works out of the box with most JavaScript projects and requires minimal configuration.

**Best Practices**: Write descriptive test names that explain what behavior is being tested. Keep tests focused on a single piece of functionality. Use beforeEach/afterEach hooks for test setup and cleanup. Avoid testing implementation details - focus on behavior.

**Test Organization**: Group related tests in describe blocks. Use meaningful test descriptions that read like documentation. Separate test files should mirror your source code structure.`,keyTopics:["Jest test framework fundamentals","Arrange-Act-Assert test pattern","Test organization and naming conventions","Jest configuration and setup","Test isolation and cleanup"],practicalExercises:["Create unit tests for utility functions with various input scenarios","Implement tests for class methods with different behaviors","Write tests for error handling and edge cases","Create parameterized tests for multiple input combinations","Set up Jest configuration for a new project"],codeExamples:[{title:"Basic Jest Unit Test",language:"javascript",code:`// mathUtils.js
function add(a, b) {
  if (typeof a !== 'number' || typeof b !== 'number') {
    throw new Error('Both arguments must be numbers');
  }
  return a + b;
}

function multiply(a, b) {
  return a * b;
}

function isEven(num) {
  return num % 2 === 0;
}

module.exports = { add, multiply, isEven };`},{title:"Jest Test Suite",language:"javascript",code:`// mathUtils.test.js
const { add, multiply, isEven } = require('./mathUtils');

describe('Math Utilities', () => {
  describe('add function', () => {
    test('should add two positive numbers correctly', () => {
      // Arrange
      const a = 5;
      const b = 3;

      // Act
      const result = add(a, b);

      // Assert
      expect(result).toBe(8);
    });

    test('should add negative numbers correctly', () => {
      expect(add(-2, -3)).toBe(-5);
      expect(add(5, -3)).toBe(2);
    });

    test('should throw error for non-number inputs', () => {
      expect(() => add('5', 3)).toThrow('Both arguments must be numbers');
      expect(() => add(5, null)).toThrow('Both arguments must be numbers');
    });

    test('should handle decimal numbers', () => {
      expect(add(1.5, 2.3)).toBe(3.8);
    });
  });

  describe('multiply function', () => {
    test('should multiply two numbers correctly', () => {
      expect(multiply(4, 3)).toBe(12);
      expect(multiply(-2, 5)).toBe(-10);
      expect(multiply(0, 100)).toBe(0);
    });
  });

  describe('isEven function', () => {
    test.each([
      [2, true],
      [4, true],
      [0, true],
      [1, false],
      [3, false],
      [-2, true],
      [-1, false]
    ])('should return %s for %i', (num, expected) => {
      expect(isEven(num)).toBe(expected);
    });
  });
});`}]},{title:"Integration Testing",content:`Integration testing verifies that different parts of your application work together correctly. Unlike unit tests that test isolated components, integration tests examine the interactions between components, modules, or services.

**Testing Scope**: Integration tests can test component interactions within a single application, API endpoints with databases, or communication between different services in a microservices architecture.

**Test Setup**: Integration tests often require more complex setup than unit tests. You may need to configure test databases, mock external services, or set up test fixtures with realistic data.

**Database Testing**: When testing with databases, consider using in-memory databases for faster tests or database transactions that roll back after each test. Avoid testing against production databases.

**API Testing**: Test API endpoints by making actual HTTP requests to your application. Verify response status codes, data structure, and error handling. Use test clients like Supertest for Express applications.

**Best Practices**: Keep integration tests focused but broader than unit tests. Use realistic test data. Clean up test data after tests complete. Consider test execution time - integration tests typically run slower than unit tests.`,keyTopics:["Integration test vs unit test differences","Database integration testing strategies","API endpoint testing with Supertest","Test data management and fixtures","Mocking external service dependencies"],practicalExercises:["Create integration tests for API endpoints with database operations","Test component interactions in a React application","Implement database transaction rollbacks in tests","Create test fixtures for complex data scenarios","Test error handling across component boundaries"],codeExamples:[{title:"API Integration Test with Supertest",language:"javascript",code:`// userRoutes.test.js
const request = require('supertest');
const express = require('express');
const mongoose = require('mongoose');
const { MongoMemoryServer } = require('mongodb-memory-server');
const User = require('../models/User');
const userRoutes = require('../routes/users');

const app = express();
app.use(express.json());
app.use('/api/users', userRoutes);

let mongoServer;

beforeAll(async () => {
  // Start in-memory MongoDB server
  mongoServer = await MongoMemoryServer.create();
  const mongoUri = mongoServer.getUri();
  await mongoose.connect(mongoUri);
});

afterAll(async () => {
  await mongoose.disconnect();
  await mongoServer.stop();
});

beforeEach(async () => {
  // Clear database before each test
  await User.deleteMany({});
});

describe('User API Integration Tests', () => {
  describe('POST /api/users', () => {
    test('should create a new user successfully', async () => {
      const userData = {
        name: 'John Doe',
        email: 'john@example.com',
        password: 'password123'
      };

      const response = await request(app)
        .post('/api/users')
        .send(userData)
        .expect(201);

      expect(response.body).toHaveProperty('_id');
      expect(response.body.name).toBe(userData.name);
      expect(response.body.email).toBe(userData.email);
      expect(response.body).not.toHaveProperty('password'); // Password should be hashed
    });

    test('should return 400 for invalid email', async () => {
      const userData = {
        name: 'John Doe',
        email: 'invalid-email',
        password: 'password123'
      };

      const response = await request(app)
        .post('/api/users')
        .send(userData)
        .expect(400);

      expect(response.body).toHaveProperty('error');
    });

    test('should return 409 for duplicate email', async () => {
      // Create first user
      await User.create({
        name: 'John Doe',
        email: 'john@example.com',
        password: 'hashedpassword'
      });

      // Try to create user with same email
      const userData = {
        name: 'Jane Doe',
        email: 'john@example.com',
        password: 'password123'
      };

      const response = await request(app)
        .post('/api/users')
        .send(userData)
        .expect(409);

      expect(response.body.error).toContain('email already exists');
    });
  });

  describe('GET /api/users/:id', () => {
    test('should return user by ID', async () => {
      const user = await User.create({
        name: 'John Doe',
        email: 'john@example.com',
        password: 'hashedpassword'
      });

      const response = await request(app)
        .get(\`/api/users/\${user._id}\`)
        .expect(200);

      expect(response.body.name).toBe(user.name);
      expect(response.body.email).toBe(user.email);
    });

    test('should return 404 for non-existent user', async () => {
      const fakeId = new mongoose.Types.ObjectId();

      const response = await request(app)
        .get(\`/api/users/\${fakeId}\`)
        .expect(404);

      expect(response.body.error).toBe('User not found');
    });
  });
});`},{title:"Database Integration Test Setup",language:"javascript",code:`// testHelpers.js
const mongoose = require('mongoose');
const { MongoMemoryServer } = require('mongodb-memory-server');

class TestDatabase {
  constructor() {
    this.mongoServer = null;
    this.connection = null;
  }

  async connect() {
    this.mongoServer = await MongoMemoryServer.create();
    const mongoUri = this.mongoServer.getUri();

    this.connection = await mongoose.connect(mongoUri, {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });

    return this.connection;
  }

  async disconnect() {
    if (this.connection) {
      await this.connection.disconnect();
    }
    if (this.mongoServer) {
      await this.mongoServer.stop();
    }
  }

  async clearDatabase() {
    if (this.connection) {
      const collections = this.connection.collections;
      for (const key in collections) {
        await collections[key].deleteMany({});
      }
    }
  }

  async createTestData(model, data) {
    return await model.create(data);
  }

  async createMultipleTestData(model, dataArray) {
    return await model.insertMany(dataArray);
  }
}

// Test data factories
class TestDataFactory {
  static createUser(overrides = {}) {
    return {
      name: 'Test User',
      email: \`test\${Date.now()}@example.com\`,
      password: 'hashedpassword123',
      role: 'user',
      ...overrides
    };
  }

  static createPost(userId, overrides = {}) {
    return {
      title: 'Test Post',
      content: 'This is a test post content',
      author: userId,
      tags: ['test', 'sample'],
      published: true,
      ...overrides
    };
  }

  static createComment(postId, userId, overrides = {}) {
    return {
      content: 'This is a test comment',
      post: postId,
      author: userId,
      ...overrides
    };
  }
}

module.exports = { TestDatabase, TestDataFactory };`}]},{title:"End-to-End Testing with Cypress",content:`End-to-end (E2E) testing verifies that your entire application works correctly from the user's perspective. Cypress is a modern E2E testing framework that runs in the browser and provides a complete testing experience for web applications.

**Cypress Advantages**: Unlike Selenium-based tools, Cypress runs directly in the browser with your application, providing faster test execution and more reliable results. It includes automatic waiting, real-time reloading, and excellent debugging capabilities.

**Test Structure**: E2E tests simulate real user interactions like clicking buttons, filling forms, and navigating between pages. Tests should cover complete user workflows and critical application paths.

**Best Practices**: Write tests that are resilient to UI changes. Use data-testid attributes for reliable element selection. Avoid testing third-party services directly. Keep tests focused on user-facing functionality.

**Test Organization**: Group related tests in describe blocks. Use beforeEach hooks for common setup like user login. Create custom commands for reusable actions like authentication.

**Debugging**: Cypress provides excellent debugging tools including DOM snapshots, console logs, and time-travel debugging. Use cy.pause() for interactive debugging during test development.`,keyTopics:["Cypress test runner and architecture","Writing reliable E2E test scenarios","Page object pattern for test organization","Custom Cypress commands","Debugging and troubleshooting E2E tests"],practicalExercises:["Create E2E tests for user registration and login flow","Implement tests for complex user workflows","Build custom Cypress commands for common actions","Test form validation and error handling","Create tests for responsive design across different viewports"],codeExamples:[{title:"Cypress E2E Test Suite",language:"javascript",code:`// cypress/integration/user-registration.spec.js
describe('User Registration and Authentication', () => {
  beforeEach(() => {
    // Visit the application
    cy.visit('/');

    // Clear any existing session
    cy.clearCookies();
    cy.clearLocalStorage();
  });

  it('should successfully register a new user', () => {
    // Navigate to registration page
    cy.contains('Sign Up').click();

    // Fill out registration form
    cy.get('[data-testid="name-input"]').type('John Doe');
    cy.get('[data-testid="email-input"]').type(\`john.doe.\${Date.now()}@example.com\`);
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="confirm-password-input"]').type('password123');

    // Submit the form
    cy.get('[data-testid="register-button"]').click();

    // Verify successful registration
    cy.url().should('include', '/dashboard');
    cy.contains('Welcome, John Doe').should('be.visible');

    // Verify user is logged in
    cy.get('[data-testid="user-menu"]').should('contain', 'John Doe');
  });

  it('should show validation errors for invalid registration data', () => {
    cy.contains('Sign Up').click();

    // Try to submit empty form
    cy.get('[data-testid="register-button"]').click();

    // Check for validation errors
    cy.contains('Name is required').should('be.visible');
    cy.contains('Email is required').should('be.visible');
    cy.contains('Password is required').should('be.visible');

    // Try invalid email
    cy.get('[data-testid="email-input"]').type('invalid-email');
    cy.get('[data-testid="name-input"]').type('John Doe');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="register-button"]').click();

    cy.contains('Please enter a valid email').should('be.visible');
  });

  it('should prevent registration with existing email', () => {
    // First, register a user
    cy.request('POST', '/api/auth/register', {
      name: 'Existing User',
      email: 'existing@example.com',
      password: 'password123'
    });

    // Now try to register with the same email
    cy.contains('Sign Up').click();
    cy.get('[data-testid="name-input"]').type('Another User');
    cy.get('[data-testid="email-input"]').type('existing@example.com');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="register-button"]').click();

    // Should show error message
    cy.contains('Email already exists').should('be.visible');
  });

  it('should successfully log in existing user', () => {
    // Create user via API
    cy.request('POST', '/api/auth/register', {
      name: 'Login Test User',
      email: 'login.test@example.com',
      password: 'password123'
    });

    // Navigate to login page
    cy.contains('Sign In').click();

    // Fill login form
    cy.get('[data-testid="email-input"]').type('login.test@example.com');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="login-button"]').click();

    // Verify successful login
    cy.url().should('include', '/dashboard');
    cy.contains('Welcome, Login Test User').should('be.visible');
  });

  it('should handle invalid login credentials', () => {
    cy.contains('Sign In').click();

    // Try wrong password
    cy.get('[data-testid="email-input"]').type('login.test@example.com');
    cy.get('[data-testid="password-input"]').type('wrongpassword');
    cy.get('[data-testid="login-button"]').click();

    cy.contains('Invalid email or password').should('be.visible');

    // Try non-existent email
    cy.get('[data-testid="email-input"]').clear().type('nonexistent@example.com');
    cy.get('[data-testid="password-input"]').clear().type('password123');
    cy.get('[data-testid="login-button"]').click();

    cy.contains('Invalid email or password').should('be.visible');
  });
});`},{title:"Cypress Custom Commands",language:"javascript",code:`// cypress/support/commands.js
Cypress.Commands.add('login', (email, password) => {
  cy.session([email, password], () => {
    cy.visit('/login');
    cy.get('[data-testid="email-input"]').type(email);
    cy.get('[data-testid="password-input"]').type(password);
    cy.get('[data-testid="login-button"]').click();
    cy.url().should('not.include', '/login');
  });
});

Cypress.Commands.add('register', (userData) => {
  cy.visit('/register');
  cy.get('[data-testid="name-input"]').type(userData.name);
  cy.get('[data-testid="email-input"]').type(userData.email);
  cy.get('[data-testid="password-input"]').type(userData.password);
  cy.get('[data-testid="confirm-password-input"]').type(userData.password);
  cy.get('[data-testid="register-button"]').click();
});

Cypress.Commands.add('createPost', (postData) => {
  cy.visit('/posts/new');
  cy.get('[data-testid="title-input"]').type(postData.title);
  cy.get('[data-testid="content-input"]').type(postData.content);

  if (postData.tags) {
    postData.tags.forEach(tag => {
      cy.get('[data-testid="tags-input"]').type(tag).type('{enter}');
    });
  }

  cy.get('[data-testid="publish-button"]').click();
  cy.contains('Post created successfully').should('be.visible');
});

Cypress.Commands.add('logout', () => {
  cy.get('[data-testid="user-menu"]').click();
  cy.contains('Logout').click();
  cy.url().should('include', '/login');
});

// cypress.config.js
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    baseUrl: 'http://localhost:3000',
    supportFile: 'cypress/support/e2e.js',
    specPattern: 'cypress/e2e/**/*.spec.js',
    viewportWidth: 1280,
    viewportHeight: 720,
    video: false,
    screenshotOnRunFailure: true,
    defaultCommandTimeout: 10000,
    requestTimeout: 15000,
    responseTimeout: 15000,
    setupNodeEvents(on, config) {
      // implement node event listeners here
    },
  },
});`}]},{title:"Test-Driven Development (TDD)",content:`Test-Driven Development (TDD) is a software development approach where you write tests before writing the actual code. This methodology ensures that your code is testable, follows good design principles, and meets the specified requirements.

**TDD Cycle**: The TDD process follows a simple cycle: Red-Green-Refactor. First, write a failing test (Red). Then write the minimal code to make the test pass (Green). Finally, refactor the code while keeping tests passing.

**Benefits**: TDD leads to better code design, higher test coverage, and more maintainable code. It helps catch bugs early and serves as living documentation of your code's behavior.

**TDD Principles**: Write tests for the behavior you want, not the implementation. Keep tests simple and focused. Run tests frequently. Use the tests to guide your design decisions.

**Common Patterns**: Start with the simplest case and build up complexity. Use mocks and stubs to isolate dependencies. Write tests for edge cases and error conditions.

**Challenges**: TDD requires discipline and can feel slower initially. However, it pays off in the long run with more reliable and maintainable code.`,keyTopics:["Red-Green-Refactor TDD cycle","Writing tests before implementation","Incremental development approach","TDD best practices and principles","Balancing TDD with development speed"],practicalExercises:["Implement a feature using TDD from start to finish","Refactor existing code using TDD principles","Create tests for complex business logic before implementation","Practice the TDD cycle with different types of functions","Apply TDD to fix bugs and add new features"],codeExamples:[{title:"TDD Example: String Calculator",language:"javascript",code:`// stringCalculator.js - Implementation following TDD

class StringCalculator {
  add(numbers) {
    if (!numbers) return 0;

    // Handle custom delimiters
    let delimiter = ',';
    if (numbers.startsWith('//')) {
      const delimiterLine = numbers.split('\\n')[0];
      delimiter = delimiterLine.substring(2);
      numbers = numbers.substring(delimiterLine.length + 1);
    }

    // Replace newlines with delimiter
    numbers = numbers.replace(/\\n/g, delimiter);

    // Split by delimiter and convert to numbers
    const numberArray = numbers.split(delimiter).map(num => {
      const parsed = parseInt(num, 10);
      if (isNaN(parsed)) throw new Error('Invalid number format');
      return parsed;
    });

    // Check for negative numbers
    const negatives = numberArray.filter(num => num < 0);
    if (negatives.length > 0) {
      throw new Error(\`Negative numbers not allowed: \${negatives.join(', ')}\`);
    }

    // Sum all numbers, ignoring numbers > 1000
    return numberArray
      .filter(num => num <= 1000)
      .reduce((sum, num) => sum + num, 0);
  }
}

module.exports = StringCalculator;`},{title:"TDD Test Suite for String Calculator",language:"javascript",code:`// stringCalculator.test.js - Tests written before implementation

const StringCalculator = require('./stringCalculator');

describe('String Calculator', () => {
  let calculator;

  beforeEach(() => {
    calculator = new StringCalculator();
  });

  describe('add method', () => {
    test('should return 0 for empty string', () => {
      expect(calculator.add('')).toBe(0);
    });

    test('should return the number itself for single number', () => {
      expect(calculator.add('1')).toBe(1);
      expect(calculator.add('5')).toBe(5);
    });

    test('should return sum of two numbers separated by comma', () => {
      expect(calculator.add('1,2')).toBe(3);
      expect(calculator.add('10,20')).toBe(30);
    });

    test('should handle multiple numbers', () => {
      expect(calculator.add('1,2,3')).toBe(6);
      expect(calculator.add('1,2,3,4,5')).toBe(15);
    });

    test('should handle newlines as delimiters', () => {
      expect(calculator.add('1\\n2,3')).toBe(6);
      expect(calculator.add('1\\n2\\n3')).toBe(6);
    });

    test('should support custom delimiters', () => {
      expect(calculator.add('//;\\n1;2')).toBe(3);
      expect(calculator.add('//|\\n1|2|3')).toBe(6);
    });

    test('should throw error for negative numbers', () => {
      expect(() => calculator.add('1,-2')).toThrow('Negative numbers not allowed: -2');
      expect(() => calculator.add('1,-2,-3')).toThrow('Negative numbers not allowed: -2, -3');
    });

    test('should ignore numbers greater than 1000', () => {
      expect(calculator.add('2,1001')).toBe(2);
      expect(calculator.add('1000,1001,2')).toBe(1002);
    });

    test('should handle custom delimiters of any length', () => {
      expect(calculator.add('//[***]\\n1***2***3')).toBe(6);
    });

    test('should throw error for invalid number format', () => {
      expect(() => calculator.add('1,abc')).toThrow('Invalid number format');
    });
  });
});`}]},{title:"Mocking and Code Coverage",content:`Mocking is essential for isolating code under test and creating reliable, fast tests. Code coverage helps ensure your tests adequately exercise your codebase.

**Mocking Types**: Unit tests often use mocks to simulate dependencies. Jest provides powerful mocking capabilities including function mocks, module mocks, and manual mocks.

**When to Mock**: Mock external dependencies, database calls, API requests, and time-sensitive operations. Don't mock the code you're actually testing.

**Code Coverage**: Coverage reports show which parts of your code are tested. Aim for high coverage but focus on meaningful tests rather than artificial coverage.

**Coverage Types**: Line coverage, branch coverage, function coverage, and statement coverage. Each provides different insights into your test effectiveness.

**Best Practices**: Use descriptive mock names. Reset mocks between tests. Test both success and error scenarios. Don't rely solely on coverage metrics - focus on testing behavior.

**Advanced Mocking**: Jest supports manual mocks, spy functions, and partial mocking. Use these for complex scenarios while keeping tests readable.`,keyTopics:["Jest mocking fundamentals and types","Manual mocks vs automatic mocks","Spy functions and their usage","Code coverage configuration and interpretation","Testing with mocked dependencies"],practicalExercises:["Create manual mocks for external API calls","Implement spy functions to verify function calls","Configure Jest code coverage reporting","Test error scenarios with mocked failures","Create reusable mock factories"],codeExamples:[{title:"Mocking External Dependencies",language:"javascript",code:`// userService.js
const axios = require('axios');
const User = require('../models/User');

class UserService {
  constructor() {
    this.apiBaseUrl = process.env.API_BASE_URL;
  }

  async getUserById(id) {
    try {
      const response = await axios.get(\`\${this.apiBaseUrl}/users/\${id}\`);
      return response.data;
    } catch (error) {
      throw new Error(\`Failed to fetch user: \${error.message}\`);
    }
  }

  async createUser(userData) {
    try {
      const response = await axios.post(\`\${this.apiBaseUrl}/users\`, userData);
      return response.data;
    } catch (error) {
      if (error.response && error.response.status === 409) {
        throw new Error('User already exists');
      }
      throw new Error(\`Failed to create user: \${error.message}\`);
    }
  }

  async updateUserProfile(id, profileData) {
    const user = await User.findById(id);
    if (!user) {
      throw new Error('User not found');
    }

    Object.assign(user, profileData);
    await user.save();
    return user;
  }
}

module.exports = UserService;`},{title:"Mocking Test Examples",language:"javascript",code:`// userService.test.js
const axios = require('axios');
const User = require('../models/User');
const UserService = require('./userService');

// Mock axios
jest.mock('axios');
const mockedAxios = axios;

// Mock User model
jest.mock('../models/User');
const mockedUser = User;

describe('UserService', () => {
  let userService;

  beforeEach(() => {
    userService = new UserService();
    // Clear all mocks before each test
    jest.clearAllMocks();
  });

  describe('getUserById', () => {
    test('should return user data on successful API call', async () => {
      // Arrange
      const mockUserData = { id: 1, name: 'John Doe', email: 'john@example.com' };
      mockedAxios.get.mockResolvedValue({ data: mockUserData });

      // Act
      const result = await userService.getUserById(1);

      // Assert
      expect(mockedAxios.get).toHaveBeenCalledWith('undefined/users/1');
      expect(result).toEqual(mockUserData);
    });

    test('should throw error on API failure', async () => {
      // Arrange
      const errorMessage = 'Network Error';
      mockedAxios.get.mockRejectedValue(new Error(errorMessage));

      // Act & Assert
      await expect(userService.getUserById(1)).rejects.toThrow(\`Failed to fetch user: \${errorMessage}\`);
    });
  });

  describe('createUser', () => {
    test('should create user successfully', async () => {
      // Arrange
      const userData = { name: 'Jane Doe', email: 'jane@example.com' };
      const createdUser = { id: 2, ...userData };
      mockedAxios.post.mockResolvedValue({ data: createdUser });

      // Act
      const result = await userService.createUser(userData);

      // Assert
      expect(mockedAxios.post).toHaveBeenCalledWith('undefined/users', userData);
      expect(result).toEqual(createdUser);
    });

    test('should handle duplicate user error', async () => {
      // Arrange
      const userData = { name: 'Jane Doe', email: 'jane@example.com' };
      const error = { response: { status: 409 } };
      mockedAxios.post.mockRejectedValue(error);

      // Act & Assert
      await expect(userService.createUser(userData)).rejects.toThrow('User already exists');
    });
  });

  describe('updateUserProfile', () => {
    test('should update user profile successfully', async () => {
      // Arrange
      const userId = 'user123';
      const profileData = { name: 'Updated Name' };
      const mockUser = {
        _id: userId,
        name: 'Old Name',
        save: jest.fn().mockResolvedValue()
      };

      mockedUser.findById.mockResolvedValue(mockUser);

      // Act
      const result = await userService.updateUserProfile(userId, profileData);

      // Assert
      expect(mockedUser.findById).toHaveBeenCalledWith(userId);
      expect(mockUser.save).toHaveBeenCalled();
      expect(result.name).toBe('Updated Name');
    });

    test('should throw error for non-existent user', async () => {
      // Arrange
      mockedUser.findById.mockResolvedValue(null);

      // Act & Assert
      await expect(userService.updateUserProfile('invalidId', {})).rejects.toThrow('User not found');
    });
  });
});`}]}],projects:[{title:"Complete Testing Suite for E-commerce API",description:"Build a comprehensive testing suite for an e-commerce REST API including unit tests, integration tests, and E2E tests",difficulty:"advanced",estimatedHours:35,technologies:["Node.js","Jest","Supertest","Cypress","MongoDB"],features:["Unit tests for all utility functions and business logic","Integration tests for API endpoints with database operations","E2E tests for complete user workflows (registration, shopping cart, checkout)","Mock implementations for external payment services","Code coverage reporting with minimum 80% coverage","CI/CD pipeline configuration with automated testing","Performance testing for API endpoints","Security testing for authentication and authorization"]},{title:"TDD React Component Library",description:"Develop a React component library using Test-Driven Development principles",difficulty:"intermediate",estimatedHours:25,technologies:["React","Jest","React Testing Library","TypeScript"],features:["Button, Input, Modal, and Form components","Complete test suite with 100% coverage","TDD approach for all component development","Accessibility testing with react-testing-library","Component documentation with Storybook","Custom hooks with comprehensive tests","Integration tests for component combinations"]},{title:"Automated Testing Framework",description:"Create a custom testing framework with utilities for web application testing",difficulty:"advanced",estimatedHours:40,technologies:["Node.js","Puppeteer","Jest","Docker"],features:["Custom test runner with parallel execution","Visual regression testing capabilities","API testing utilities with automatic retries","Database seeding and cleanup utilities","Cross-browser testing support","Test reporting with detailed metrics","Integration with popular CI/CD platforms","Performance monitoring and alerting"]}],assessments:{quiz:[{question:"What is the primary purpose of unit testing?",options:["To test the entire application from end to end","To test individual functions and methods in isolation","To test how different components interact with each other","To test the application's performance under load"],correctAnswer:1,explanation:"Unit testing focuses on testing individual units of code (functions, methods, classes) in isolation to ensure they work correctly."},{question:"Which testing framework is commonly used for end-to-end testing of web applications?",options:["Mocha","Jasmine","Cypress","Chai"],correctAnswer:2,explanation:"Cypress is a modern end-to-end testing framework that runs directly in the browser and provides excellent debugging capabilities."},{question:"What does TDD stand for?",options:["Test-Driven Design","Test-Driven Development","Test Data Definition","Test Documentation Drive"],correctAnswer:1,explanation:"TDD stands for Test-Driven Development, a methodology where tests are written before the actual implementation code."},{question:"What is the main benefit of using mocks in testing?",options:["To make tests run faster","To isolate the code under test from external dependencies","To reduce the amount of test code needed","To automatically generate test data"],correctAnswer:1,explanation:"Mocks isolate the code under test by simulating external dependencies, making tests more reliable and focused."},{question:"What code coverage metric indicates that all possible execution paths have been tested?",options:["Line coverage","Function coverage","Branch coverage","Statement coverage"],correctAnswer:2,explanation:"Branch coverage measures whether all possible execution paths (branches) in conditional statements have been tested."}],evaluation:[{scenario:"You are developing a financial application that handles sensitive user data and monetary transactions. The application needs to be thoroughly tested before deployment.",questions:["What types of tests would you prioritize for this application and why?","How would you ensure the testing covers security aspects?","What strategies would you use to test the monetary transaction logic?"]},{scenario:"Your team is working on a large-scale web application with multiple developers. The codebase is growing rapidly and you need to maintain code quality.",questions:["How would you implement automated testing in the development workflow?","What metrics would you track to ensure test effectiveness?","How would you handle testing for features that depend on third-party services?"]}]},aiPrompts:["How do I write effective unit tests with Jest?","What's the difference between unit, integration, and E2E tests?","How do I test React components with Jest?","How do I mock external API calls in my tests?","How do I set up Cypress for E2E testing?","What's the best way to organize test files?","How do I achieve good test coverage?","How do I test asynchronous code with Jest?","How do I test database operations in integration tests?","How do I implement TDD in my development process?","How do I debug failing tests effectively?","How do I test error handling and edge cases?"],resources:[{title:"Jest Documentation",type:"documentation",url:"https://jestjs.io/docs/getting-started",description:"Official Jest testing framework documentation with guides and API reference"},{title:"Cypress Documentation",type:"documentation",url:"https://docs.cypress.io",description:"Complete Cypress documentation for end-to-end testing"},{title:"Testing JavaScript Applications",type:"book",url:"https://www.manning.com/books/testing-javascript-applications",description:"Comprehensive guide to testing JavaScript applications"},{title:"Martin Fowler - TestPyramid",type:"article",url:"https://martinfowler.com/bliki/TestPyramid.html",description:"Classic article explaining the test pyramid concept"},{title:"Kent C. Dodds - Testing Trophy",type:"article",url:"https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications",description:"Modern approach to testing with the Testing Trophy model"}],toolsRequired:["Node.js (v14+)","npm or yarn package manager","Jest testing framework","Supertest for API testing","Cypress for E2E testing","MongoDB Memory Server for testing","React Testing Library (for React apps)","Code coverage tools (Istanbul/NYC)","CI/CD platforms (GitHub Actions, Jenkins)","Test reporting tools"],bestPractices:["Write tests before implementing features (TDD approach)","Keep tests focused on a single behavior or scenario","Use descriptive test names that explain what is being tested","Organize tests in a structure that mirrors your codebase","Mock external dependencies to isolate code under test","Use realistic test data that covers edge cases","Run tests frequently during development","Maintain high code coverage but focus on meaningful tests","Test both happy path and error scenarios","Use test doubles (mocks, stubs, spies) appropriately","Keep tests fast and reliable","Document test setup and teardown procedures","Review and refactor tests regularly","Use continuous integration to run tests automatically","Test accessibility and cross-browser compatibility","Include performance testing in your test suite","Test security features and vulnerability handling","Use version control for test code","Collaborate with team members on testing standards","Monitor test execution time and optimize slow tests","Keep test code clean and maintainable"],commonPitfalls:["Writing tests after implementation instead of using TDD","Testing implementation details instead of behavior","Creating brittle tests that break with minor code changes","Not mocking external dependencies properly","Writing slow tests that delay development feedback","Ignoring test failures or maintaining broken tests","Testing too many things in a single test","Using hardcoded test data that becomes outdated","Not testing error conditions and edge cases","Relying solely on code coverage metrics","Writing tests that are tightly coupled to implementation","Not maintaining test code quality","Skipping tests during development pressure","Not testing asynchronous code properly","Creating circular dependencies in test setup","Not cleaning up test data between tests","Writing tests that require specific execution order","Ignoring flaky tests instead of fixing them","Not testing user interface interactions","Over-mocking which hides integration issues","Not testing cross-browser compatibility","Writing tests that are hard to understand","Not updating tests when refactoring code","Running tests only locally, not in CI/CD","Not testing performance and scalability"],careerRelevance:["Testing skills are essential for all software development roles","TDD and automated testing are highly valued by employers","Quality assurance and testing expertise increases job opportunities","Testing knowledge is crucial for CI/CD and DevOps roles","Modern development teams require comprehensive testing skills","Testing expertise leads to better code quality and fewer bugs","Automated testing skills are valuable for agile development","Testing knowledge helps in code review and mentoring","Performance testing skills are needed for scalable applications","Security testing knowledge is essential for secure applications","Testing frameworks expertise opens specialized testing roles","TDD skills demonstrate professional development practices","Testing knowledge is valuable for technical leadership roles","Automated testing enables faster development cycles","Testing expertise helps in building reliable user experiences","Quality-focused development is a competitive advantage","Testing skills are transferable across programming languages","Comprehensive testing knowledge leads to higher salaries","Testing expertise is crucial for mission-critical applications","Modern software development requires testing as a core competency"]},NM={id:"typescript",tier:4,name:"TypeScript",description:"Master TypeScript for building scalable, type-safe JavaScript applications. Learn advanced type system features, generics, decorators, and integration with modern frameworks for robust enterprise-grade development.",difficulty:"intermediate",estimatedHours:22,prerequisites:["javascript","nodejs"],learningObjectives:["Master TypeScript's type system including primitive types, union types, and intersection types","Design and implement interfaces for object shapes and contracts","Apply generics for reusable, type-safe code patterns","Configure TypeScript compiler options for different project needs","Implement advanced types including conditional types, mapped types, and template literal types","Integrate TypeScript with React for type-safe component development","Use decorators for metadata and aspect-oriented programming","Migrate existing JavaScript projects to TypeScript incrementally","Implement type-safe API development with proper error handling","Configure TypeScript for Node.js backend development","Use utility types for common type transformations","Debug TypeScript compilation errors and type-related issues"],sections:[{title:"TypeScript Fundamentals",content:`TypeScript is a superset of JavaScript that adds static typing capabilities to the language. It provides compile-time type checking while maintaining full JavaScript compatibility. TypeScript helps catch errors early in development and improves code maintainability and developer experience.

**Type Annotations**: TypeScript allows you to explicitly declare the types of variables, function parameters, and return values. This provides better IDE support, documentation, and error detection.

**Type Inference**: TypeScript can automatically infer types based on context, reducing the need for explicit type annotations while still providing type safety.

**Compilation**: TypeScript code is compiled to JavaScript using the TypeScript compiler (tsc). The compiler can target different JavaScript versions and provides various configuration options.

**Benefits**: Better IDE support with autocomplete and refactoring, early error detection, improved code documentation, and enhanced maintainability for large codebases.

**Getting Started**: Install TypeScript globally with \`npm install -g typescript\`, then use \`tsc --init\` to create a \`tsconfig.json\` file in your project.`,keyTopics:["TypeScript vs JavaScript differences","Type annotations and declarations","Type inference capabilities","TypeScript compilation process","Basic type system concepts"],practicalExercises:["Set up a new TypeScript project with proper configuration","Convert existing JavaScript functions to TypeScript with type annotations","Implement type-safe data structures (stacks, queues, linked lists)","Create typed utility functions for common operations","Configure TypeScript for different JavaScript target versions"],codeExamples:[{title:"Basic TypeScript Types",language:"typescript",code:`// Primitive types
let isDone: boolean = false;
let decimal: number = 6;
let hex: number = 0xf00d;
let binary: number = 0b1010;
let octal: number = 0o744;
let color: string = "blue";
let list: number[] = [1, 2, 3];
let tuple: [string, number] = ["hello", 10];

// Union types
let union: string | number;
union = "hello";
union = 42;

// Type aliases
type Point = {
  x: number;
  y: number;
};

type ID = string | number;

// Functions with type annotations
function add(x: number, y: number): number {
  return x + y;
}

const multiply = (x: number, y: number): number => x * y;

// Optional parameters
function buildName(firstName: string, lastName?: string): string {
  if (lastName) {
    return firstName + " " + lastName;
  } else {
    return firstName;
  }
}

// Default parameters
function buildNameWithDefault(firstName: string, lastName = "Smith"): string {
  return firstName + " " + lastName;
}

// Rest parameters
function buildNameWithRest(firstName: string, ...restOfName: string[]): string {
  return firstName + " " + restOfName.join(" ");
}

// Void return type
function logMessage(message: string): void {
  console.log(message);
}

// Never type (function never returns)
function error(message: string): never {
  throw new Error(message);
}

// Type assertions
let someValue: any = "this is a string";
let strLength: number = (someValue as string).length;
let strLength2: number = (<string>someValue).length;`},{title:"TypeScript Configuration",language:"json",code:`{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "exactOptionalPropertyTypes": true
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts"
  ]
}`}]},{title:"Interfaces and Classes",content:`Interfaces in TypeScript define contracts for object shapes and are a powerful way to define custom types. Classes provide object-oriented programming capabilities with type safety.

**Interface Definition**: Interfaces describe the structure of objects, including properties, methods, and their types. They can be extended and implemented by classes.

**Class Implementation**: TypeScript classes support inheritance, access modifiers, abstract classes, and interfaces. They provide encapsulation and type safety for object-oriented programming.

**Access Modifiers**: TypeScript supports public, private, and protected access modifiers for class members, controlling their visibility and accessibility.

**Abstract Classes**: Abstract classes cannot be instantiated directly and serve as base classes for other classes. They can contain abstract methods that must be implemented by derived classes.

**Interface vs Classes**: Interfaces define contracts while classes provide implementations. A class can implement multiple interfaces but can only extend one class.

**Advanced Patterns**: Use interfaces for dependency injection, define optional properties, and create discriminated unions for type-safe state management.`,keyTopics:["Interface definition and usage","Class syntax and inheritance","Access modifiers (public, private, protected)","Abstract classes and methods","Interface segregation and composition"],practicalExercises:["Design interfaces for a user management system","Implement class hierarchies with inheritance","Create abstract classes for common functionality","Use interfaces for dependency injection","Build type-safe data models with interfaces"],codeExamples:[{title:"Interfaces and Classes",language:"typescript",code:`// Basic interface
interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;
}

// Interface with optional properties
interface Product {
  id: number;
  name: string;
  price: number;
  description?: string;
  category?: string;
}

// Interface with method signatures
interface DatabaseConnection {
  connect(): Promise<void>;
  disconnect(): Promise<void>;
  query<T>(sql: string, params?: any[]): Promise<T[]>;
}

// Interface extending another interface
interface AdminUser extends User {
  role: 'admin';
  permissions: string[];
}

// Class implementing interface
class UserService implements DatabaseConnection {
  private connectionString: string;

  constructor(connectionString: string) {
    this.connectionString = connectionString;
  }

  async connect(): Promise<void> {
    console.log('Connecting to database...');
    // Implementation here
  }

  async disconnect(): Promise<void> {
    console.log('Disconnecting from database...');
    // Implementation here
  }

  async query<T>(sql: string, params?: any[]): Promise<T[]> {
    console.log(\`Executing query: \${sql}\`);
    // Implementation here
    return [];
  }

  async getUserById(id: number): Promise<User | null> {
    const users = await this.query<User>('SELECT * FROM users WHERE id = ?', [id]);
    return users[0] || null;
  }
}

// Abstract class
abstract class Shape {
  abstract getArea(): number;
  abstract getPerimeter(): number;

  // Concrete method
  describe(): string {
    return \`Area: \${this.getArea()}, Perimeter: \${this.getPerimeter()}\`;
  }
}

class Rectangle extends Shape {
  constructor(private width: number, private height: number) {
    super();
  }

  getArea(): number {
    return this.width * this.height;
  }

  getPerimeter(): number {
    return 2 * (this.width + this.height);
  }
}

class Circle extends Shape {
  constructor(private radius: number) {
    super();
  }

  getArea(): number {
    return Math.PI * this.radius * this.radius;
  }

  getPerimeter(): number {
    return 2 * Math.PI * this.radius;
  }
}

// Generic interface
interface Repository<T> {
  findById(id: string): Promise<T | null>;
  findAll(): Promise<T[]>;
  create(entity: T): Promise<T>;
  update(id: string, entity: Partial<T>): Promise<T | null>;
  delete(id: string): Promise<boolean>;
}

// Implementation of generic interface
class UserRepository implements Repository<User> {
  private users: Map<string, User> = new Map();

  async findById(id: string): Promise<User | null> {
    return this.users.get(id) || null;
  }

  async findAll(): Promise<User[]> {
    return Array.from(this.users.values());
  }

  async create(user: User): Promise<User> {
    this.users.set(user.id.toString(), user);
    return user;
  }

  async update(id: string, updates: Partial<User>): Promise<User | null> {
    const user = this.users.get(id);
    if (!user) return null;

    const updatedUser = { ...user, ...updates };
    this.users.set(id, updatedUser);
    return updatedUser;
  }

  async delete(id: string): Promise<boolean> {
    return this.users.delete(id);
  }
}`},{title:"Advanced Interface Patterns",language:"typescript",code:`// Discriminated unions
interface Square {
  kind: 'square';
  size: number;
}

interface Rectangle {
  kind: 'rectangle';
  width: number;
  height: number;
}

interface Circle {
  kind: 'circle';
  radius: number;
}

type Shape = Square | Rectangle | Circle;

function getArea(shape: Shape): number {
  switch (shape.kind) {
    case 'square':
      return shape.size * shape.size;
    case 'rectangle':
      return shape.width * shape.height;
    case 'circle':
      return Math.PI * shape.radius * shape.radius;
  }
}

// Index signatures
interface StringDictionary {
  [key: string]: string;
}

interface NumberDictionary {
  [key: string]: number;
}

// Hybrid types (functions with properties)
interface Counter {
  (start: number): string;
  interval: number;
  reset(): void;
}

function createCounter(): Counter {
  let count = 0;

  const counter = function(start: number) {
    count = start;
    return \`Count set to \${count}\`;
  } as Counter;

  counter.interval = 1000;
  counter.reset = function() {
    count = 0;
  };

  return counter;
}

// Interface for constructor
interface ClockConstructor {
  new (hour: number, minute: number): ClockInterface;
}

interface ClockInterface {
  tick(): void;
  currentTime: Date;
}

function createClock(
  ctor: ClockConstructor,
  hour: number,
  minute: number
): ClockInterface {
  return new ctor(hour, minute);
}

// Interface merging
interface Box {
  height: number;
  width: number;
}

interface Box {
  scale: number;
}

let box: Box = { height: 5, width: 6, scale: 10 };

// Declaration merging with functions
function buildLabel(name: string): string {
  return buildLabel.prefix + name + buildLabel.suffix;
}

namespace buildLabel {
  export let suffix = "";
  export let prefix = "Hello, ";
}

buildLabel(buildLabel.prefix + "TypeScript");`}]},{title:"Generics and Advanced Types",content:`Generics provide a way to create reusable components that work with multiple types while maintaining type safety. Advanced types enable complex type transformations and conditional logic.

**Generic Functions**: Generic functions can work with parameters of different types while preserving type information. They use type parameters in angle brackets.

**Generic Classes**: Classes can be generic, allowing them to work with different types while maintaining type safety for their properties and methods.

**Generic Constraints**: You can constrain generic types to have certain properties or methods using the \`extends\` keyword.

**Advanced Types**: TypeScript provides utility types like \`Partial<T>\`, \`Required<T>\`, \`Pick<T, K>\`, and \`Omit<T, K>\` for common type transformations.

**Conditional Types**: Conditional types enable type logic based on conditions, similar to ternary operators but for types.

**Mapped Types**: Mapped types allow you to transform properties of existing types, creating new types based on existing ones.

**Template Literal Types**: Template literal types provide string manipulation at the type level, enabling type-safe string operations.`,keyTopics:["Generic functions and classes","Generic constraints and type bounds","Utility types (Partial, Required, Pick, Omit)","Conditional types and type guards","Mapped types and keyof operator","Template literal types"],practicalExercises:["Create generic data structures (stacks, queues, linked lists)","Implement generic utility functions for type transformations","Build type-safe API clients with generics","Create conditional types for complex business logic","Use mapped types for form validation schemas"],codeExamples:[{title:"Generic Functions and Classes",language:"typescript",code:`// Generic function
function identity<T>(arg: T): T {
  return arg;
}

// Generic function with constraints
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key];
}

// Generic class
class GenericStack<T> {
  private items: T[] = [];

  push(item: T): void {
    this.items.push(item);
  }

  pop(): T | undefined {
    return this.items.pop();
  }

  peek(): T | undefined {
    return this.items[this.items.length - 1];
  }

  isEmpty(): boolean {
    return this.items.length === 0;
  }

  size(): number {
    return this.items.length;
  }
}

// Usage
const numberStack = new GenericStack<number>();
numberStack.push(1);
numberStack.push(2);
console.log(numberStack.pop()); // 2

const stringStack = new GenericStack<string>();
stringStack.push("hello");
stringStack.push("world");
console.log(stringStack.pop()); // "world"

// Generic interface
interface ApiResponse<T> {
  data: T;
  status: number;
  message: string;
  timestamp: Date;
}

// Generic type alias
type Result<T, E = Error> = { success: true; data: T } | { success: false; error: E };

// Generic factory function
function createApiResponse<T>(data: T, status: number = 200): ApiResponse<T> {
  return {
    data,
    status,
    message: status === 200 ? 'Success' : 'Error',
    timestamp: new Date()
  };
}

// Generic constraint with interface
interface HasId {
  id: string | number;
}

function findById<T extends HasId>(items: T[], id: string | number): T | undefined {
  return items.find(item => item.id === id);
}

// Multiple type parameters
function mergeObjects<T, U>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 };
}

// Default generic parameters
interface PaginationOptions<T = any> {
  page: number;
  limit: number;
  sortBy?: keyof T;
  sortOrder?: 'asc' | 'desc';
}

function paginate<T>(
  items: T[],
  options: PaginationOptions<T> = { page: 1, limit: 10 }
): { data: T[]; total: number; page: number; limit: number } {
  const { page, limit, sortBy, sortOrder = 'asc' } = options;
  const startIndex = (page - 1) * limit;
  const endIndex = startIndex + limit;

  let sortedItems = [...items];
  if (sortBy) {
    sortedItems.sort((a, b) => {
      const aValue = a[sortBy];
      const bValue = b[sortBy];

      if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;
      if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;
      return 0;
    });
  }

  return {
    data: sortedItems.slice(startIndex, endIndex),
    total: items.length,
    page,
    limit
  };
}`},{title:"Advanced Types and Utility Types",language:"typescript",code:`// Utility Types
interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;
  isActive: boolean;
}

// Partial<T> - makes all properties optional
type PartialUser = Partial<User>;
// Equivalent to:
// type PartialUser = {
//   id?: number;
//   name?: string;
//   email?: string;
//   createdAt?: Date;
//   isActive?: boolean;
// }

// Required<T> - makes all properties required
type RequiredUser = Required<PartialUser>;

// Pick<T, K> - picks specific properties
type UserBasicInfo = Pick<User, 'id' | 'name' | 'email'>;

// Omit<T, K> - omits specific properties
type UserWithoutTimestamps = Omit<User, 'createdAt'>;

// Record<K, T> - creates an object type with keys of type K and values of type T
type UserRoles = Record<string, 'admin' | 'user' | 'moderator'>;
const roles: UserRoles = {
  'user1': 'admin',
  'user2': 'user'
};

// Extract<T, U> - extracts types that are assignable to U
type AdminOrModerator = Extract<'admin' | 'user' | 'moderator', 'admin' | 'moderator'>;

// Exclude<T, U> - excludes types that are assignable to U
type RegularUser = Exclude<'admin' | 'user' | 'moderator', 'admin'>;

// NonNullable<T> - excludes null and undefined
type NonNullableUser = NonNullable<User | null | undefined>;

// Parameters<T> - extracts parameter types from function type
function createUser(name: string, email: string, age?: number): User {
  return { id: 1, name, email, createdAt: new Date(), isActive: true };
}
type CreateUserParams = Parameters<typeof createUser>;
// Equivalent to: [name: string, email: string, age?: number | undefined]

// ReturnType<T> - extracts return type from function type
type CreateUserReturn = ReturnType<typeof createUser>;

// Conditional Types
type IsString<T> = T extends string ? 'yes' : 'no';
type Test1 = IsString<string>;  // 'yes'
type Test2 = IsString<number>;  // 'no'

// Nested conditional types
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P];
};

type ReadonlyUser = DeepReadonly<User>;

// Template Literal Types
type EventName = 'click' | 'hover' | 'focus';
type ElementType = 'button' | 'input' | 'div';

type EventHandler = \`on\${Capitalize<EventName>}\`;
type ElementEvent = \`\${ElementType}\${EventHandler}\`;

// Mapped Types
type OptionalUser = {
  [K in keyof User]?: User[K];
};

type ReadonlyUser2 = {
  readonly [K in keyof User]: User[K];
};

// Using keyof with mapped types
type UserKeys = keyof User; // 'id' | 'name' | 'email' | 'createdAt' | 'isActive'

type UserFields = {
  [K in UserKeys]: User[K];
};

// Advanced mapped type with template literals
type EventHandlers<T> = {
  [K in keyof T as \`on\${Capitalize<string & K>}\`]: (value: T[K]) => void;
};

type UserEventHandlers = EventHandlers<User>;
// Creates: {
//   onId: (value: number) => void;
//   onName: (value: string) => void;
//   onEmail: (value: string) => void;
//   onCreatedAt: (value: Date) => void;
//   onIsActive: (value: boolean) => void;
// }

// Type Guards
function isString(value: any): value is string {
  return typeof value === 'string';
}

function isUser(obj: any): obj is User {
  return obj && typeof obj.id === 'number' && typeof obj.name === 'string';
}

// Usage with type guards
function processValue(value: string | number | User) {
  if (isString(value)) {
    console.log('String:', value.toUpperCase());
  } else if (typeof value === 'number') {
    console.log('Number:', value.toFixed(2));
  } else if (isUser(value)) {
    console.log('User:', value.name);
  }
}`}]},{title:"TypeScript with React",content:`TypeScript provides excellent support for React development, offering type safety for components, props, state, and event handlers. This combination helps catch errors early and improves the developer experience.

**Component Props**: Define interfaces for component props to ensure type safety and provide better IDE support with autocomplete and error detection.

**State Management**: TypeScript works seamlessly with React's useState, useReducer, and context APIs, providing type safety for state and actions.

**Event Handlers**: TypeScript provides specific types for DOM events, form events, and custom events, ensuring proper event handling.

**Hooks**: All React hooks can be used with TypeScript, with proper typing for parameters and return values.

**Generic Components**: Create reusable components that work with different data types while maintaining type safety.

**Custom Hooks**: TypeScript enables better typing for custom hooks, ensuring proper usage and return types.

**Error Boundaries**: Implement error boundaries with proper TypeScript typing for error handling.`,keyTopics:["Typed React components and props","TypeScript with React hooks","Event handling with proper types","Generic React components","Type-safe state management","Custom hooks with TypeScript"],practicalExercises:["Convert existing React components to TypeScript","Implement type-safe form handling with React Hook Form","Create generic table components with TypeScript","Build type-safe context providers","Implement error boundaries with proper typing"],codeExamples:[{title:"Typed React Components",language:"typescript",code:`import React, { useState, useEffect } from 'react';

// Interface for component props
interface UserCardProps {
  user: User;
  onEdit?: (user: User) => void;
  onDelete?: (id: number) => void;
  isLoading?: boolean;
}

// Functional component with typed props
const UserCard: React.FC<UserCardProps> = ({
  user,
  onEdit,
  onDelete,
  isLoading = false
}) => {
  const handleEdit = () => {
    onEdit?.(user);
  };

  const handleDelete = () => {
    onDelete?.(user.id);
  };

  if (isLoading) {
    return <div className="user-card loading">Loading...</div>;
  }

  return (
    <div className="user-card">
      <h3>{user.name}</h3>
      <p>{user.email}</p>
      <p>Status: {user.isActive ? 'Active' : 'Inactive'}</p>
      <div className="actions">
        {onEdit && (
          <button onClick={handleEdit}>Edit</button>
        )}
        {onDelete && (
          <button onClick={handleDelete}>Delete</button>
        )}
      </div>
    </div>
  );
};

// Generic component
interface ListProps<T> {
  items: T[];
  renderItem: (item: T, index: number) => React.ReactNode;
  keyExtractor: (item: T, index: number) => string | number;
  emptyMessage?: string;
}

function List<T>({
  items,
  renderItem,
  keyExtractor,
  emptyMessage = 'No items found'
}: ListProps<T>) {
  if (items.length === 0) {
    return <div className="empty-list">{emptyMessage}</div>;
  }

  return (
    <ul className="list">
      {items.map((item, index) => (
        <li key={keyExtractor(item, index)}>
          {renderItem(item, index)}
        </li>
      ))}
    </ul>
  );
}

// Usage of generic component
const UserList: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);

  return (
    <List
      items={users}
      renderItem={(user) => <UserCard user={user} />}
      keyExtractor={(user) => user.id}
      emptyMessage="No users found"
    />
  );
};

// Form component with typed events
interface LoginFormProps {
  onSubmit: (credentials: { email: string; password: string }) => void;
  isLoading?: boolean;
}

const LoginForm: React.FC<LoginFormProps> = ({ onSubmit, isLoading }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    onSubmit({ email, password });
  };

  const handleEmailChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setEmail(e.target.value);
  };

  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setPassword(e.target.value);
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label htmlFor="email">Email:</label>
        <input
          id="email"
          type="email"
          value={email}
          onChange={handleEmailChange}
          required
        />
      </div>
      <div>
        <label htmlFor="password">Password:</label>
        <input
          id="password"
          type="password"
          value={password}
          onChange={handlePasswordChange}
          required
        />
      </div>
      <button type="submit" disabled={isLoading}>
        {isLoading ? 'Logging in...' : 'Login'}
      </button>
    </form>
  );
};

// Custom hook with TypeScript
function useLocalStorage<T>(
  key: string,
  initialValue: T
): [T, (value: T | ((prev: T) => T)) => void] {
  const [storedValue, setStoredValue] = useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(\`Error reading localStorage key "\${key}":\`, error);
      return initialValue;
    }
  });

  const setValue = (value: T | ((prev: T) => T)) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(\`Error setting localStorage key "\${key}":\`, error);
    }
  };

  return [storedValue, setValue];
}

// Usage of custom hook
const App: React.FC = () => {
  const [user, setUser] = useLocalStorage<User | null>('user', null);

  return (
    <div>
      {user ? (
        <div>
          <h1>Welcome, {user.name}!</h1>
          <button onClick={() => setUser(null)}>Logout</button>
        </div>
      ) : (
        <LoginForm
          onSubmit={(credentials) => {
            // Simulate login
            setUser({
              id: 1,
              name: 'John Doe',
              email: credentials.email,
              createdAt: new Date(),
              isActive: true
            });
          }}
        />
      )}
    </div>
  );
};

export default App;`},{title:"TypeScript with React Context",language:"typescript",code:`import React, { createContext, useContext, useReducer, ReactNode } from 'react';

// Types for state
interface AppState {
  user: User | null;
  theme: 'light' | 'dark';
  isLoading: boolean;
  error: string | null;
}

// Action types
type AppAction =
  | { type: 'SET_USER'; payload: User | null }
  | { type: 'SET_THEME'; payload: 'light' | 'dark' }
  | { type: 'SET_LOADING'; payload: boolean }
  | { type: 'SET_ERROR'; payload: string | null }
  | { type: 'CLEAR_ERROR' };

// Context type
interface AppContextType {
  state: AppState;
  dispatch: React.Dispatch<AppAction>;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  toggleTheme: () => void;
}

// Create context with undefined as default
const AppContext = createContext<AppContextType | undefined>(undefined);

// Reducer function
const appReducer = (state: AppState, action: AppAction): AppState => {
  switch (action.type) {
    case 'SET_USER':
      return { ...state, user: action.payload, error: null };
    case 'SET_THEME':
      return { ...state, theme: action.payload };
    case 'SET_LOADING':
      return { ...state, isLoading: action.payload };
    case 'SET_ERROR':
      return { ...state, error: action.payload, isLoading: false };
    case 'CLEAR_ERROR':
      return { ...state, error: null };
    default:
      return state;
  }
};

// Initial state
const initialState: AppState = {
  user: null,
  theme: 'light',
  isLoading: false,
  error: null
};

// Provider component
interface AppProviderProps {
  children: ReactNode;
}

export const AppProvider: React.FC<AppProviderProps> = ({ children }) => {
  const [state, dispatch] = useReducer(appReducer, initialState);

  const login = async (email: string, password: string): Promise<void> => {
    dispatch({ type: 'SET_LOADING', payload: true });
    dispatch({ type: 'CLEAR_ERROR' });

    try {
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 1000));

      // Simulate successful login
      const user: User = {
        id: 1,
        name: 'John Doe',
        email,
        createdAt: new Date(),
        isActive: true
      };

      dispatch({ type: 'SET_USER', payload: user });
    } catch (error) {
      dispatch({ type: 'SET_ERROR', payload: 'Login failed. Please try again.' });
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false });
    }
  };

  const logout = (): void => {
    dispatch({ type: 'SET_USER', payload: null });
  };

  const toggleTheme = (): void => {
    const newTheme = state.theme === 'light' ? 'dark' : 'light';
    dispatch({ type: 'SET_THEME', payload: newTheme });
  };

  const contextValue: AppContextType = {
    state,
    dispatch,
    login,
    logout,
    toggleTheme
  };

  return (
    <AppContext.Provider value={contextValue}>
      {children}
    </AppContext.Provider>
  );
};

// Custom hook to use the context
export const useApp = (): AppContextType => {
  const context = useContext(AppContext);
  if (context === undefined) {
    throw new Error('useApp must be used within an AppProvider');
  }
  return context;
};

// Usage in components
const Header: React.FC = () => {
  const { state, logout, toggleTheme } = useApp();

  return (
    <header>
      <h1>My App</h1>
      <div>
        <button onClick={toggleTheme}>
          Switch to {state.theme === 'light' ? 'Dark' : 'Light'} Mode
        </button>
        {state.user && (
          <button onClick={logout}>Logout</button>
        )}
      </div>
    </header>
  );
};

const LoginForm: React.FC = () => {
  const { login, state } = useApp();
  const [email, setEmail] = React.useState('');
  const [password, setPassword] = React.useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    await login(email, password);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Email"
        required
      />
      <input
        type="password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        placeholder="Password"
        required
      />
      <button type="submit" disabled={state.isLoading}>
        {state.isLoading ? 'Logging in...' : 'Login'}
      </button>
      {state.error && <p style={{ color: 'red' }}>{state.error}</p>}
    </form>
  );
};

const App: React.FC = () => {
  const { state } = useApp();

  return (
    <div className={state.theme}>
      <Header />
      {state.user ? (
        <div>
          <h2>Welcome, {state.user.name}!</h2>
          <p>Email: {state.user.email}</p>
        </div>
      ) : (
        <LoginForm />
      )}
    </div>
  );
};

export default App;`}]},{title:"TypeScript with Node.js",content:`TypeScript provides excellent support for Node.js development, offering type safety for backend APIs, database operations, and server-side logic. This combination improves code quality and developer productivity.

**Express with TypeScript**: TypeScript enhances Express.js development with typed request/response objects, middleware functions, and route handlers.

**API Development**: Create type-safe REST APIs with proper request/response typing, validation, and error handling.

**Database Integration**: TypeScript works seamlessly with database ORMs like TypeORM, Mongoose, and Prisma, providing type safety for database operations.

**Configuration Management**: Use TypeScript for configuration files with proper typing and validation.

**Error Handling**: Implement comprehensive error handling with custom error types and proper TypeScript typing.

**Middleware**: Create typed middleware functions for authentication, validation, and logging.

**Testing**: TypeScript integrates well with testing frameworks like Jest, providing type safety for test code.`,keyTopics:["Express.js with TypeScript","Type-safe API development","Database integration with TypeScript","Configuration management","Error handling patterns","Middleware typing"],practicalExercises:["Build a REST API with Express and TypeScript","Implement database models with TypeORM","Create typed middleware for authentication","Build configuration management with validation","Implement comprehensive error handling","Create type-safe database queries"],codeExamples:[{title:"Express API with TypeScript",language:"typescript",code:`import express, { Request, Response, NextFunction } from 'express';
import cors from 'cors';
import helmet from 'helmet';

// Types
interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;
  isActive: boolean;
}

interface CreateUserRequest {
  name: string;
  email: string;
}

interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  timestamp: Date;
}

// Custom error class
class ApiError extends Error {
  constructor(
    public statusCode: number,
    message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

// Middleware for error handling
const errorHandler = (
  error: Error,
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  if (error instanceof ApiError) {
    res.status(error.statusCode).json({
      success: false,
      error: error.message,
      timestamp: new Date()
    });
  } else {
    console.error('Unexpected error:', error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date()
    });
  }
};

// Middleware for request validation
const validateUserData = (
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  const { name, email } = req.body as CreateUserRequest;

  if (!name || typeof name !== 'string' || name.trim().length === 0) {
    throw new ApiError(400, 'Name is required and must be a non-empty string');
  }

  if (!email || typeof email !== 'string' || !email.includes('@')) {
    throw new ApiError(400, 'Valid email is required');
  }

  next();
};

// Generic response helper
const sendResponse = <T>(
  res: Response,
  statusCode: number,
  data?: T,
  error?: string
): void => {
  const response: ApiResponse<T> = {
    success: !error,
    timestamp: new Date()
  };

  if (data !== undefined) {
    response.data = data;
  }

  if (error) {
    response.error = error;
  }

  res.status(statusCode).json(response);
};

// In-memory user store (replace with database in production)
let users: User[] = [
  {
    id: 1,
    name: 'John Doe',
    email: 'john@example.com',
    createdAt: new Date(),
    isActive: true
  }
];

const app = express();

// Middleware
app.use(helmet());
app.use(cors());
app.use(express.json());

// Routes
app.get('/api/users', (req: Request, res: Response): void => {
  sendResponse(res, 200, users);
});

app.get('/api/users/:id', (req: Request, res: Response): void => {
  const id = parseInt(req.params.id);

  if (isNaN(id)) {
    throw new ApiError(400, 'Invalid user ID');
  }

  const user = users.find(u => u.id === id);

  if (!user) {
    throw new ApiError(404, 'User not found');
  }

  sendResponse(res, 200, user);
});

app.post('/api/users', validateUserData, (req: Request, res: Response): void => {
  const { name, email } = req.body as CreateUserRequest;

  // Check if email already exists
  const existingUser = users.find(u => u.email === email);
  if (existingUser) {
    throw new ApiError(409, 'Email already exists');
  }

  const newUser: User = {
    id: Math.max(...users.map(u => u.id), 0) + 1,
    name: name.trim(),
    email: email.toLowerCase().trim(),
    createdAt: new Date(),
    isActive: true
  };

  users.push(newUser);
  sendResponse(res, 201, newUser);
});

app.put('/api/users/:id', validateUserData, (req: Request, res: Response): void => {
  const id = parseInt(req.params.id);

  if (isNaN(id)) {
    throw new ApiError(400, 'Invalid user ID');
  }

  const userIndex = users.findIndex(u => u.id === id);

  if (userIndex === -1) {
    throw new ApiError(404, 'User not found');
  }

  const { name, email } = req.body as CreateUserRequest;

  // Check if email already exists (excluding current user)
  const existingUser = users.find(u => u.email === email && u.id !== id);
  if (existingUser) {
    throw new ApiError(409, 'Email already exists');
  }

  users[userIndex] = {
    ...users[userIndex],
    name: name.trim(),
    email: email.toLowerCase().trim()
  };

  sendResponse(res, 200, users[userIndex]);
});

app.delete('/api/users/:id', (req: Request, res: Response): void => {
  const id = parseInt(req.params.id);

  if (isNaN(id)) {
    throw new ApiError(400, 'Invalid user ID');
  }

  const userIndex = users.findIndex(u => u.id === id);

  if (userIndex === -1) {
    throw new ApiError(404, 'User not found');
  }

  const deletedUser = users.splice(userIndex, 1)[0];
  sendResponse(res, 200, deletedUser);
});

// Health check endpoint
app.get('/api/health', (req: Request, res: Response): void => {
  sendResponse(res, 200, { status: 'OK', timestamp: new Date() });
});

// Error handling middleware (must be last)
app.use(errorHandler);

// 404 handler
app.use((req: Request, res: Response): void => {
  throw new ApiError(404, 'Route not found');
});

const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}\`);
});

export default app;`},{title:"TypeScript with Database Integration",language:"typescript",code:`import mongoose, { Document, Schema, Model } from 'mongoose';

// Interface for the document
interface IUser extends Document {
  name: string;
  email: string;
  password: string;
  role: 'user' | 'admin';
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
  comparePassword(candidatePassword: string): Promise<boolean>;
}

// Interface for the model
interface IUserModel extends Model<IUser> {
  findByEmail(email: string): Promise<IUser | null>;
}

// Schema definition
const userSchema = new Schema<IUser, IUserModel>({
  name: {
    type: String,
    required: [true, 'Name is required'],
    trim: true,
    maxlength: [50, 'Name cannot exceed 50 characters']
  },
  email: {
    type: String,
    required: [true, 'Email is required'],
    unique: true,
    lowercase: true,
    trim: true,
    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']
  },
  password: {
    type: String,
    required: [true, 'Password is required'],
    minlength: [6, 'Password must be at least 6 characters'],
    select: false // Don't include password in queries by default
  },
  role: {
    type: String,
    enum: ['user', 'admin'],
    default: 'user'
  },
  isActive: {
    type: Boolean,
    default: true
  }
}, {
  timestamps: true,
  toJSON: { virtuals: true },
  toObject: { virtuals: true }
});

// Virtual for full name
userSchema.virtual('fullName').get(function(this: IUser) {
  return this.name;
});

// Instance method
userSchema.methods.comparePassword = async function(candidatePassword: string): Promise<boolean> {
  return candidatePassword === this.password; // In real app, use bcrypt
};

// Static method
userSchema.statics.findByEmail = function(email: string): Promise<IUser | null> {
  return this.findOne({ email: email.toLowerCase() });
};

// Pre-save middleware
userSchema.pre<IUser>('save', async function(next) {
  if (!this.isModified('password')) return next();

  // Hash password here in real implementation
  // this.password = await bcrypt.hash(this.password, 12);
  next();
});

// Create and export the model
const User = mongoose.model<IUser, IUserModel>('User', userSchema);

// Generic repository pattern
class Repository<T extends Document> {
  constructor(private model: Model<T>) {}

  async findById(id: string): Promise<T | null> {
    return this.model.findById(id);
  }

  async findAll(filter: Partial<T> = {}): Promise<T[]> {
    return this.model.find(filter);
  }

  async create(data: Partial<T>): Promise<T> {
    const document = new this.model(data);
    return document.save();
  }

  async update(id: string, data: Partial<T>): Promise<T | null> {
    return this.model.findByIdAndUpdate(id, data, { new: true });
  }

  async delete(id: string): Promise<boolean> {
    const result = await this.model.findByIdAndDelete(id);
    return !!result;
  }
}

// Service layer
class UserService {
  private repository: Repository<IUser>;

  constructor() {
    this.repository = new Repository(User);
  }

  async getUserById(id: string): Promise<IUser | null> {
    return this.repository.findById(id);
  }

  async getUserByEmail(email: string): Promise<IUser | null> {
    return User.findByEmail(email);
  }

  async createUser(userData: {
    name: string;
    email: string;
    password: string;
    role?: 'user' | 'admin';
  }): Promise<IUser> {
    // Check if user already exists
    const existingUser = await this.getUserByEmail(userData.email);
    if (existingUser) {
      throw new Error('User with this email already exists');
    }

    return this.repository.create(userData);
  }

  async updateUser(id: string, updateData: Partial<IUser>): Promise<IUser | null> {
    return this.repository.update(id, updateData);
  }

  async deleteUser(id: string): Promise<boolean> {
    return this.repository.delete(id);
  }

  async getAllUsers(): Promise<IUser[]> {
    return this.repository.findAll();
  }
}

// Controller with proper typing
interface AuthenticatedRequest extends Request {
  user?: IUser;
}

class UserController {
  private userService: UserService;

  constructor() {
    this.userService = new UserService();
  }

  getUser = async (req: Request, res: Response): Promise<void> => {
    try {
      const { id } = req.params;

      if (!id) {
        res.status(400).json({ error: 'User ID is required' });
        return;
      }

      const user = await this.userService.getUserById(id);

      if (!user) {
        res.status(404).json({ error: 'User not found' });
        return;
      }

      res.json({ user });
    } catch (error) {
      res.status(500).json({ error: 'Internal server error' });
    }
  };

  createUser = async (req: Request, res: Response): Promise<void> => {
    try {
      const userData = req.body;

      const user = await this.userService.createUser(userData);
      res.status(201).json({ user });
    } catch (error) {
      if (error.message.includes('already exists')) {
        res.status(409).json({ error: error.message });
      } else {
        res.status(500).json({ error: 'Internal server error' });
      }
    }
  };

  updateUser = async (req: AuthenticatedRequest, res: Response): Promise<void> => {
    try {
      const { id } = req.params;
      const updateData = req.body;

      const user = await this.userService.updateUser(id, updateData);

      if (!user) {
        res.status(404).json({ error: 'User not found' });
        return;
      }

      res.json({ user });
    } catch (error) {
      res.status(500).json({ error: 'Internal server error' });
    }
  };

  deleteUser = async (req: AuthenticatedRequest, res: Response): Promise<void> => {
    try {
      const { id } = req.params;

      const deleted = await this.userService.deleteUser(id);

      if (!deleted) {
        res.status(404).json({ error: 'User not found' });
        return;
      }

      res.status(204).send();
    } catch (error) {
      res.status(500).json({ error: 'Internal server error' });
    }
  };
}

export { User, UserService, UserController };
export type { IUser };`}]}],projects:[{title:"Type-Safe E-commerce Platform",description:"Build a complete e-commerce platform using TypeScript with React frontend and Node.js backend, emphasizing type safety throughout the application",difficulty:"advanced",estimatedHours:45,technologies:["TypeScript","React","Node.js","Express","MongoDB","TypeORM"],features:["Type-safe React components with proper prop validation","Express API with comprehensive TypeScript typing","Database models with TypeORM and type safety","Generic utility functions for common operations","Custom hooks with proper TypeScript support","Error handling with typed error classes","Configuration management with validation","Unit and integration tests with type safety","API documentation generation from TypeScript types"]},{title:"TypeScript Design System",description:"Create a comprehensive design system library with TypeScript, including components, utilities, and type definitions",difficulty:"intermediate",estimatedHours:30,technologies:["TypeScript","React","Storybook","Styled Components"],features:["Reusable React components with TypeScript","Theme system with type-safe theming","Utility functions with generic type support","Component variants using discriminated unions","Form components with validation typing","Icon system with type-safe icon names","Animation utilities with TypeScript","Documentation with Storybook and TypeScript"]},{title:"Type-Safe GraphQL API",description:"Build a GraphQL API with TypeScript, implementing type safety from database to client",difficulty:"advanced",estimatedHours:40,technologies:["TypeScript","Node.js","GraphQL","Apollo Server","TypeORM"],features:["GraphQL schema with TypeScript type generation","Type-safe resolvers with automatic type checking","Database integration with type-safe queries","Custom scalars with TypeScript support","Authentication and authorization with types","Error handling with typed GraphQL errors","Testing with type-safe mock data","Code generation for client-side TypeScript types"]}],assessments:{quiz:[{question:"What is the primary benefit of using TypeScript over JavaScript?",options:["Faster runtime performance","Static type checking and better IDE support","Smaller bundle size","Automatic code optimization"],correctAnswer:1,explanation:"TypeScript provides static type checking, which helps catch errors at compile time and provides better IDE support with autocomplete and refactoring."},{question:"Which TypeScript feature allows creating reusable components that work with multiple types?",options:["Interfaces","Classes","Generics","Enums"],correctAnswer:2,explanation:"Generics allow you to create reusable components that can work with multiple types while maintaining type safety."},{question:"What does the 'extends' keyword do in TypeScript generics?",options:["Creates a new class that inherits from another","Constrains the generic type to have certain properties","Extends the functionality of an existing type","Creates a union type"],correctAnswer:1,explanation:"In generics, 'extends' is used to constrain the generic type to have certain properties or methods."},{question:"Which utility type makes all properties of a type optional?",options:["Required<T>","Partial<T>","Pick<T, K>","Omit<T, K>"],correctAnswer:1,explanation:"Partial<T> makes all properties of type T optional."},{question:"What is a discriminated union in TypeScript?",options:["A union type with a common property that can be used to discriminate between types","A type that can be either discriminated or not","A union of primitive types only","A type used for mathematical operations"],correctAnswer:0,explanation:"A discriminated union is a union type where each type has a common property (discriminant) that can be used to determine which type it is."}],evaluation:[{scenario:"You're migrating a large JavaScript codebase to TypeScript. The team is concerned about the migration process and maintaining productivity during the transition.",questions:["What strategy would you recommend for migrating the codebase incrementally?","How would you handle existing JavaScript files during the migration?","What tools and configurations would you set up to support the migration?"]},{scenario:"Your team is building a complex React application with multiple developers. You want to ensure type safety and consistency across the codebase.",questions:["What TypeScript configurations would you implement for a large React project?","How would you establish coding standards and type definitions for the team?","What strategies would you use to handle third-party libraries without TypeScript support?"]}]},aiPrompts:["How do I set up TypeScript in a new project?","What's the difference between interface and type in TypeScript?","How do I use generics in TypeScript?","How do I type React components with TypeScript?","How do I handle async operations with TypeScript?","What's the best way to organize TypeScript code?","How do I migrate from JavaScript to TypeScript?","How do I use utility types in TypeScript?","How do I create custom types in TypeScript?","How do I handle errors with TypeScript?","How do I configure TypeScript for different environments?","How do I use decorators in TypeScript?"],resources:[{title:"TypeScript Handbook",type:"documentation",url:"https://www.typescriptlang.org/docs/",description:"Official TypeScript documentation with comprehensive guides and reference"},{title:"TypeScript Deep Dive",type:"book",url:"https://basarat.gitbook.io/typescript/",description:"Free online book covering advanced TypeScript concepts"},{title:"React TypeScript Cheatsheet",type:"guide",url:"https://react-typescript-cheatsheet.netlify.app/",description:"Comprehensive guide for using TypeScript with React"},{title:"TypeScript Utility Types",type:"article",url:"https://www.typescriptlang.org/docs/handbook/utility-types.html",description:"Official documentation for built-in utility types"},{title:"DefinitelyTyped",type:"repository",url:"https://github.com/DefinitelyTyped/DefinitelyTyped",description:"Repository of TypeScript type definitions for JavaScript libraries"}],toolsRequired:["Node.js (v14+)","npm or yarn package manager","TypeScript compiler (tsc)","Visual Studio Code with TypeScript extensions","ts-node for running TypeScript in development","TypeScript ESLint for code linting","Prettier for code formatting","@types packages for JavaScript libraries","ts-jest for testing TypeScript code","TypeScript declaration files (.d.ts)","Webpack or other bundlers with TypeScript support"],bestPractices:["Enable strict type checking in tsconfig.json","Use interfaces for object shapes and contracts","Prefer const assertions for literal types","Use union types instead of any when possible","Leverage utility types for common transformations","Create specific types for API responses and requests","Use generics for reusable components and functions","Implement proper error handling with custom error types","Use discriminated unions for complex state management","Keep type definitions close to their usage","Use barrel exports (index.ts) for clean imports","Configure path mapping for absolute imports","Use type guards for runtime type checking","Document complex types with JSDoc comments","Use the satisfies operator for type validation","Implement gradual migration strategies for large codebases","Use TypeScript's module augmentation for extending libraries","Configure declaration files for better IDE support","Use conditional types for advanced type logic","Implement proper access modifiers in classes","Use readonly modifiers for immutable properties","Leverage template literal types for string manipulation","Configure TypeScript for different build environments","Use project references for monorepo setups","Implement proper type testing strategies"],commonPitfalls:["Using any type instead of proper type definitions","Not enabling strict mode in TypeScript configuration","Overusing type assertions instead of proper typing","Creating circular type dependencies","Not handling null and undefined properly","Using classes when interfaces would suffice","Not using utility types for common transformations","Creating overly complex generic constraints","Not updating type definitions when code changes","Using type assertions to bypass type errors","Not configuring proper module resolution","Ignoring TypeScript compiler errors","Using outdated TypeScript versions","Not using declaration merging properly","Creating types that are too specific or too generic","Not using type guards for union types","Overusing function overloads instead of union types","Not configuring proper source maps","Using type comments instead of proper type annotations","Not leveraging TypeScript's advanced type features","Creating unnecessary type complexity","Not using the latest TypeScript features","Ignoring performance implications of complex types","Not using TypeScript with popular frameworks properly","Creating inconsistent naming conventions for types","Not using TypeScript's error reporting effectively","Over-relying on type inference instead of explicit types","Not using conditional types when appropriate","Creating types without considering their usage patterns","Not using TypeScript's built-in utility types"],careerRelevance:["TypeScript is the most requested skill in JavaScript job postings","Type safety reduces bugs and improves code maintainability","TypeScript is used by major companies like Google, Microsoft, and Facebook","Strong typing leads to better developer experience and productivity","TypeScript enables better code documentation and API design","Type-safe code is easier to refactor and maintain at scale","TypeScript integration with modern frameworks is essential","Type safety improves team collaboration and code reviews","TypeScript enables better testing and debugging capabilities","Type-safe APIs provide better developer experience","TypeScript is crucial for large-scale enterprise applications","Type safety reduces runtime errors and improves reliability","TypeScript enables advanced IDE features and tooling","Type-safe code is more secure and less prone to vulnerabilities","TypeScript is the standard for modern JavaScript development","Type safety improves code reusability and modularity","TypeScript enables better performance optimization","Type-safe code is easier to understand and onboard new developers","TypeScript is essential for cloud-native and microservices development","Type safety enables better integration with other typed languages","TypeScript improves the overall software development lifecycle","Type-safe code enables better automated testing and CI/CD","TypeScript is crucial for building scalable web applications","Type safety enables better error handling and recovery","TypeScript is the future of JavaScript development"]},OM={id:"docker",tier:4,name:"Docker",description:"Master containerization with Docker for consistent application deployment across environments. Learn container fundamentals, Dockerfile optimization, multi-container orchestration with Docker Compose, and security best practices for production deployments.",difficulty:"intermediate",estimatedHours:20,prerequisites:["nodejs","linux"],learningObjectives:["Understand Docker architecture and containerization concepts","Create optimized Dockerfiles for different application types","Implement multi-container applications with Docker Compose","Manage persistent data with Docker volumes and bind mounts","Configure container networking and service discovery","Optimize Docker images using multi-stage builds","Implement Docker security best practices","Deploy containerized applications to production","Debug and troubleshoot containerized applications","Use Docker registries for image management","Implement container orchestration patterns","Monitor and log containerized applications"],sections:[{title:"Docker Fundamentals and Architecture",content:"Docker is a platform for developing, shipping, and running applications in containers. Containers are lightweight, portable, and self-sufficient units that package application code along with all its dependencies, ensuring consistent execution across different environments.\n\n**Containerization Benefits**: Containers solve the 'works on my machine' problem by packaging applications with their runtime environment. This ensures consistency from development to production and simplifies deployment processes.\n\n**Docker Architecture**: Docker uses a client-server architecture with the Docker daemon managing containers, images, networks, and volumes. The Docker client communicates with the daemon via REST API.\n\n**Core Components**:\n- **Images**: Read-only templates containing application code and dependencies\n- **Containers**: Running instances of Docker images\n- **Dockerfile**: Instructions for building Docker images\n- **Registry**: Repository for storing and distributing Docker images\n\n**Installation**: Install Docker Desktop for Windows/macOS or Docker Engine for Linux. Verify installation with `docker --version` and `docker run hello-world`.\n\n**Basic Commands**: Learn essential Docker commands like `docker build`, `docker run`, `docker ps`, `docker images`, and `docker logs` for container management.",keyTopics:["Containerization concepts and benefits","Docker architecture and components","Installation and setup procedures","Basic Docker commands and operations","Image vs container differences"],practicalExercises:["Install Docker and verify installation with hello-world container","Explore Docker Hub and pull popular images (nginx, redis, postgres)","Create and manage basic containers with different run options","Inspect container processes and resource usage","Clean up unused Docker resources (containers, images, volumes)"],codeExamples:[{title:"Basic Docker Commands",language:"bash",code:`# Check Docker version and status
docker --version
docker info

# Pull an image from Docker Hub
docker pull nginx:latest

# List all images
docker images

# Run a container in detached mode
docker run -d --name my-nginx -p 8080:80 nginx

# List running containers
docker ps

# List all containers (including stopped)
docker ps -a

# View container logs
docker logs my-nginx

# Execute commands in running container
docker exec -it my-nginx /bin/bash

# Stop and remove containers
docker stop my-nginx
docker rm my-nginx

# Remove unused images
docker image prune -a`},{title:"Docker Container Lifecycle",language:"bash",code:`# Create and start a container
docker run --name my-app -d -p 3000:3000 node-app

# Pause and unpause container
docker pause my-app
docker unpause my-app

# Restart container
docker restart my-app

# View container resource usage
docker stats my-app

# Inspect container configuration
docker inspect my-app

# Copy files to/from container
docker cp my-app:/app/logs/app.log ./logs/

# Create container without starting it
docker create --name my-redis redis:alpine

# Start existing container
docker start my-redis

# Stop all running containers
docker stop $(docker ps -q)`}]},{title:"Dockerfile Creation and Optimization",content:`A Dockerfile is a text file containing instructions for building Docker images. It defines the environment, dependencies, and commands needed to run your application in a container.

**Dockerfile Structure**: Dockerfiles follow a specific format with instructions like FROM, COPY, RUN, CMD, etc. Each instruction creates a new layer in the image.

**Best Practices**:
- Use specific base image versions (avoid 'latest')
- Minimize the number of layers by combining RUN commands
- Use .dockerignore to exclude unnecessary files
- Leverage build cache for faster builds
- Use multi-stage builds for smaller production images

**Common Instructions**:
- **FROM**: Specifies the base image
- **COPY/ADD**: Copies files from host to container
- **RUN**: Executes commands during build
- **CMD/ENTRYPOINT**: Defines container startup command
- **EXPOSE**: Documents container ports
- **ENV**: Sets environment variables

**Image Optimization**: Reduce image size by using smaller base images (alpine variants), removing unnecessary packages, and implementing multi-stage builds.

**Build Context**: The build context is the set of files sent to the Docker daemon for building. Use .dockerignore to exclude unnecessary files and reduce build time.`,keyTopics:["Dockerfile syntax and instructions","Layer optimization strategies","Multi-stage build patterns","Base image selection criteria","Build context management"],practicalExercises:["Create Dockerfile for a Node.js application with proper layer optimization","Implement multi-stage build to reduce final image size","Configure .dockerignore file to exclude unnecessary files","Build and compare different base image options (ubuntu vs alpine)","Debug Dockerfile build failures and optimize build time"],codeExamples:[{title:"Basic Node.js Dockerfile",language:"dockerfile",code:`# Use specific Node.js version
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Copy package files first for better caching
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy application code
COPY . .

# Create non-root user
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# Change ownership of app directory
RUN chown -R nextjs:nodejs /app

# Switch to non-root user
USER nextjs

# Expose port
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3   CMD curl -f http://localhost:3000/health || exit 1

# Start application
CMD ["npm", "start"]`},{title:"Multi-Stage Dockerfile",language:"dockerfile",code:`# Build stage
FROM node:18-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including dev dependencies)
RUN npm ci

# Copy source code
COPY . .

# Build application
RUN npm run build

# Production stage
FROM node:18-alpine AS production

# Install dumb-init for proper signal handling
RUN apk add --no-cache dumb-init

# Create app directory
WORKDIR /app

# Create non-root user
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# Copy built application from builder stage
COPY --from=builder --chown=nextjs:nodejs /app/dist ./dist
COPY --from=builder --chown=nextjs:nodejs /app/package*.json ./

# Install only production dependencies
RUN npm ci --only=production && npm cache clean --force

# Switch to non-root user
USER nextjs

# Expose port
EXPOSE 3000

# Use dumb-init to handle signals properly
ENTRYPOINT ["dumb-init", "--"]
CMD ["npm", "start"]`},{title:"Python Flask Dockerfile",language:"dockerfile",code:`# Use Python slim image for smaller size
FROM python:3.11-slim

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update     && apt-get install -y --no-install-recommends         gcc         libpq-dev     && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY requirements.txt .

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Create non-root user
RUN useradd --create-home --shell /bin/bash app     && chown -R app:app /app

# Switch to non-root user
USER app

# Expose port
EXPOSE 5000

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3   CMD curl -f http://localhost:5000/health || exit 1

# Start application
CMD ["python", "app.py"]`}]},{title:"Docker Compose for Multi-Container Applications",content:`Docker Compose is a tool for defining and running multi-container Docker applications. It uses YAML files to configure application services, networks, and volumes, making it easy to manage complex applications.

**Compose File Structure**: The docker-compose.yml file defines services, networks, and volumes. Each service can specify its own Dockerfile, image, environment variables, and dependencies.

**Service Dependencies**: Use the \`depends_on\` directive to control service startup order. Compose will wait for dependencies to be healthy before starting dependent services.

**Networking**: Compose automatically creates a default network for services to communicate. Services can reach each other using their service names as hostnames.

**Environment Management**: Use .env files and environment variables to manage configuration across different environments (development, staging, production).

**Scaling**: Scale services horizontally using \`docker-compose up --scale\` or by specifying replica counts in the compose file.

**Development Workflow**: Use Compose for local development with features like hot reloading, volume mounting, and service orchestration.

**Production Deployment**: Compose can be used in production with Docker Swarm or Kubernetes, though it's more commonly used for development and testing.`,keyTopics:["Docker Compose YAML syntax","Service configuration and dependencies","Multi-container networking","Environment variable management","Volume and data persistence"],practicalExercises:["Create docker-compose.yml for full-stack application (frontend, backend, database)","Configure environment-specific compose files for dev/staging/production","Implement health checks and dependency management","Set up development workflow with hot reloading and debugging","Deploy multi-container application to production environment"],codeExamples:[{title:"Full-Stack Application Compose",language:"yaml",code:`version: '3.8'

services:
  # Frontend React application
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:8000
    volumes:
      - ./frontend:/app
      - /app/node_modules
    depends_on:
      - backend
    networks:
      - app-network

  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/app_db
      - REDIS_URL=redis://redis:6379
    volumes:
      - ./backend:/app
      - /app/__pycache__
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started
    networks:
      - app-network

  # PostgreSQL database
  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=app_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d app_db"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - app-network

  # Redis cache
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - app-network

  # Nginx reverse proxy
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - frontend
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  postgres_data:
  redis_data:`},{title:"Development Environment Compose",language:"yaml",code:`version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
    command: npm run dev

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=dev_db
      - POSTGRES_USER=dev_user
      - POSTGRES_PASSWORD=dev_password
    volumes:
      - dev_db_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - dev_redis_data:/data

  # Database management tool
  adminer:
    image: adminer
    ports:
      - "8080:8080"
    depends_on:
      - db

volumes:
  dev_db_data:
  dev_redis_data:`},{title:"Production Environment Compose",language:"yaml",code:`version: '3.8'

services:
  web:
    image: myapp:latest
    ports:
      - "80:80"
    environment:
      - NODE_ENV=production
    deploy:
      replicas: 3
      restart_policy:
        condition: on-failure
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    depends_on:
      - api
      - db

  api:
    image: myapi:latest
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/prod_db
    deploy:
      replicas: 2
      restart_policy:
        condition: on-failure
    depends_on:
      - db

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=prod_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=\${DB_PASSWORD}
    volumes:
      - prod_db_data:/var/lib/postgresql/data
    deploy:
      placement:
        constraints:
          - node.role == manager

volumes:
  prod_db_data:
    driver: local`}]},{title:"Volume Management and Data Persistence",content:`Docker volumes provide persistent data storage for containers. Unlike container filesystems that are ephemeral, volumes persist data across container restarts and can be shared between containers.

**Volume Types**:
- **Named Volumes**: Managed by Docker, stored in Docker's storage area
- **Bind Mounts**: Mount host directories into containers
- **tmpfs Mounts**: In-memory storage for temporary data

**Data Persistence**: Use volumes for databases, configuration files, and application data that needs to survive container restarts.

**Volume Management**: Create, list, inspect, and remove volumes using Docker CLI commands. Use \`docker volume prune\` to clean up unused volumes.

**Backup and Restore**: Implement backup strategies for volume data using \`docker run\` with volume mounts or third-party backup tools.

**Performance Considerations**: Named volumes generally perform better than bind mounts. Consider storage driver and filesystem type for optimal performance.

**Security**: Be cautious with bind mounts as they give containers access to host filesystem. Use read-only mounts when possible.

**Volume Plugins**: Extend Docker's volume capabilities with plugins for cloud storage, network storage, or specialized storage systems.`,keyTopics:["Docker volume types and use cases","Data persistence strategies","Volume backup and recovery","Performance optimization","Security considerations"],practicalExercises:["Create and manage named volumes for database persistence","Implement bind mounts for development file sharing","Set up automated backup strategy for volume data","Configure volume permissions and ownership","Migrate data between different volume types"],codeExamples:[{title:"Volume Management Commands",language:"bash",code:`# Create a named volume
docker volume create my-volume

# List all volumes
docker volume ls

# Inspect volume details
docker volume inspect my-volume

# Remove a volume
docker volume rm my-volume

# Remove all unused volumes
docker volume prune

# Use volume with container
docker run -d --name my-app -v my-volume:/app/data nginx

# Use bind mount
docker run -d --name dev-app -v /host/path:/container/path nginx

# Create volume with specific driver
docker volume create --driver local --opt type=tmpfs --opt device=tmpfs my-tmpfs-volume

# Backup volume data
docker run --rm -v my-volume:/source -v /host/backup:/backup alpine tar czf /backup/volume-backup.tar.gz -C /source .

# Restore volume data
docker run --rm -v my-volume:/dest -v /host/backup:/backup alpine tar xzf /backup/volume-backup.tar.gz -C /dest`},{title:"Database with Persistent Volume",language:"yaml",code:`version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=myapp
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      # Named volume for data persistence
      - postgres_data:/var/lib/postgresql/data
      # Bind mount for initialization scripts
      - ./db/init:/docker-entrypoint-initdb.d
      # Bind mount for custom configuration
      - ./db/postgresql.conf:/etc/postgresql/postgresql.conf
    ports:
      - "5432:5432"
    command: postgres -c config_file=/etc/postgresql/postgresql.conf
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d myapp"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Backup service
  backup:
    image: postgres:15-alpine
    depends_on:
      - postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data:ro
      - ./backups:/backups
    command: >
      bash -c "
        while true; do
          pg_dump -h postgres -U user myapp > /backups/backup_$(date +%Y%m%d_%H%M%S).sql
          sleep 86400
        done
      "
    profiles:
      - backup

volumes:
  postgres_data:
    driver: local`},{title:"Development Volume Configuration",language:"yaml",code:`version: '3.8'

services:
  app:
    build: .
    volumes:
      # Bind mount for hot reloading
      - .:/app:cached
      # Anonymous volume for node_modules
      - /app/node_modules
      # Named volume for logs
      - app_logs:/app/logs
    environment:
      - NODE_ENV=development

  # File watcher for development
  file-watcher:
    image: alpine
    volumes:
      - .:/watch:ro
    command: sh -c "while inotifywait -r -e modify /watch; do echo 'Files changed'; done"
    profiles:
      - dev

  # Log aggregation
  log-collector:
    image: fluent/fluent-bit
    volumes:
      - app_logs:/var/log/app:ro
      - ./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro
    ports:
      - "24224:24224"

volumes:
  app_logs:`}]},{title:"Networking and Service Discovery",content:`Docker networking enables communication between containers and external networks. Understanding Docker's networking model is crucial for building distributed applications.

**Network Types**:
- **Bridge**: Default network for single-host container communication
- **Host**: Container uses host's network stack (no isolation)
- **Overlay**: Multi-host networking for Swarm clusters
- **Macvlan**: Containers get MAC addresses for direct network access
- **None**: Isolated containers with no network access

**Service Discovery**: Containers can communicate using service names as hostnames in user-defined networks. Docker's embedded DNS server resolves service names to container IPs.

**Port Mapping**: Map container ports to host ports using \`-p\` flag or EXPOSE instruction in Dockerfile.

**Network Security**: Implement network segmentation, use internal networks for sensitive services, and configure firewall rules.

**Load Balancing**: Use Docker's built-in load balancing for services in Swarm mode or external load balancers like NGINX or HAProxy.

**DNS Configuration**: Customize DNS settings for containers using \`--dns\` flag or configuring Docker daemon DNS options.

**Network Troubleshooting**: Use \`docker network inspect\`, \`docker exec\` with network tools, and container logs for debugging network issues.`,keyTopics:["Docker network types and drivers","Service discovery mechanisms","Port mapping and exposure","Network security practices","Load balancing strategies"],practicalExercises:["Create custom bridge networks for application isolation","Implement service discovery between microservices","Configure load balancing with NGINX reverse proxy","Set up secure inter-container communication","Debug network connectivity issues between containers"],codeExamples:[{title:"Docker Network Management",language:"bash",code:`# List all networks
docker network ls

# Create a custom bridge network
docker network create --driver bridge my-network

# Inspect network configuration
docker network inspect my-network

# Connect container to network
docker network connect my-network my-container

# Disconnect container from network
docker network disconnect my-network my-container

# Create network with custom subnet
docker network create --driver bridge --subnet 172.20.0.0/16 my-custom-network

# Remove network
docker network rm my-network

# Remove all unused networks
docker network prune

# Run container on specific network
docker run -d --name web --network my-network -p 8080:80 nginx

# Connect running container to network
docker network connect my-network web

# Test connectivity between containers
docker exec web ping db`},{title:"Microservices Network Configuration",language:"yaml",code:`version: '3.8'

services:
  # API Gateway
  gateway:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - auth-service
      - user-service
      - product-service
    networks:
      - frontend
      - backend

  # Authentication Service
  auth-service:
    build: ./auth-service
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/auth_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    networks:
      - backend
      - database

  # User Management Service
  user-service:
    build: ./user-service
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/user_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    networks:
      - backend
      - database

  # Product Service
  product-service:
    build: ./product-service
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/product_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    networks:
      - backend
      - database

  # Shared Database
  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=shared_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - database

  # Redis Cache
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    networks:
      - backend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true
  database:
    driver: bridge
    internal: true

volumes:
  db_data:
  redis_data:`},{title:"Load Balancing with Docker",language:"yaml",code:`version: '3.8'

services:
  # Load Balancer
  loadbalancer:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx-loadbalancer.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web1
      - web2
      - web3
    networks:
      - web

  # Web Application Instances
  web1:
    image: mywebapp:latest
    environment:
      - INSTANCE_ID=1
    networks:
      - web

  web2:
    image: mywebapp:latest
    environment:
      - INSTANCE_ID=2
    networks:
      - web

  web3:
    image: mywebapp:latest
    environment:
      - INSTANCE_ID=3
    networks:
      - web

  # Monitoring
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus_data:/prometheus
    networks:
      - monitoring

  # Metrics Exporter
  node-exporter:
    image: prom/node-exporter
    ports:
      - "9100:9100"
    networks:
      - monitoring
    deploy:
      mode: global

networks:
  web:
    driver: bridge
  monitoring:
    driver: bridge

volumes:
  prometheus_data:`}]},{title:"Docker Security Best Practices",content:`Container security is crucial for production deployments. Docker provides several security features and best practices to protect containerized applications.

**Image Security**:
- Use trusted base images from verified publishers
- Scan images for vulnerabilities using tools like Docker Scan or Trivy
- Keep images up-to-date with security patches
- Use minimal base images (distroless, scratch) when possible

**Container Security**:
- Run containers as non-root users
- Use read-only filesystems where possible
- Limit container capabilities with --cap-drop and --cap-add
- Implement resource limits (CPU, memory, disk)
- Use secrets management for sensitive data

**Network Security**:
- Use internal networks for sensitive services
- Implement proper firewall rules
- Use TLS/SSL for inter-service communication
- Avoid exposing unnecessary ports

**Runtime Security**:
- Enable Docker Content Trust for image verification
- Use AppArmor or SELinux for additional security
- Implement logging and monitoring
- Regular security audits and vulnerability assessments

**Secret Management**: Never store secrets in Docker images. Use Docker secrets, environment variables, or external secret management systems.

**Compliance**: Implement security policies, regular updates, and audit logging to meet compliance requirements.`,keyTopics:["Container image security","Runtime security configurations","Network security practices","Secret management strategies","Compliance and auditing"],practicalExercises:["Scan Docker images for security vulnerabilities","Implement non-root container execution","Configure resource limits and constraints","Set up secure inter-container communication","Implement secrets management for sensitive data"],codeExamples:[{title:"Security Best Practices Dockerfile",language:"dockerfile",code:`# Use specific, trusted base image
FROM node:18-alpine3.17

# Add security updates
RUN apk update && apk upgrade &&     apk add --no-cache dumb-init curl &&     rm -rf /var/cache/apk/*

# Create non-root user
RUN addgroup -g 1001 -S appuser &&     adduser -S -D -H -u 1001 -h /app -s /sbin/nologin -G appuser -g appuser appuser

# Set working directory with proper permissions
WORKDIR /app
RUN chown -R appuser:appuser /app

# Copy package files first
COPY --chown=appuser:appuser package*.json ./

# Install dependencies as non-root user
USER appuser
RUN npm ci --only=production && npm cache clean --force

# Copy application code
COPY --chown=appuser:appuser . .

# Switch back to root for final setup
USER root

# Remove unnecessary packages and create minimal environment
RUN apk del curl &&     rm -rf /usr/local/share/.cache /tmp/*

# Create necessary directories with proper permissions
RUN mkdir -p /app/logs &&     chown -R appuser:appuser /app/logs

# Switch to non-root user
USER appuser

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3   CMD node healthcheck.js

# Use dumb-init for proper signal handling
ENTRYPOINT ["dumb-init", "--"]
CMD ["node", "server.js"]`},{title:"Secure Docker Compose Configuration",language:"yaml",code:`version: '3.8'

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile.secure
    ports:
      - "443:443"
    environment:
      - NODE_ENV=production
    # Security constraints
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    # Health checks
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # Secrets
    secrets:
      - db_password
      - api_key
    networks:
      - secure_network

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=prod_db
      - POSTGRES_USER=app_user
    # Database security
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - db_network

  # Reverse proxy with SSL termination
  proxy:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web
    networks:
      - secure_network
      - public_network

networks:
  secure_network:
    internal: true
  db_network:
    internal: true
  public_network:
    driver: bridge

volumes:
  db_data:

secrets:
  db_password:
    file: ./secrets/db_password.txt
  api_key:
    file: ./secrets/api_key.txt`},{title:"Docker Security Scanning",language:"bash",code:`# Scan image for vulnerabilities
docker scan myapp:latest

# Use Trivy for comprehensive scanning
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock   aquasec/trivy:latest image myapp:latest

# Scan running containers
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock   aquasec/trivy:latest container my-container

# Generate SBOM (Software Bill of Materials)
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock   aquasec/trivy:latest image --format spdx-json --output sbom.json myapp:latest

# Scan with Clair
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock   -p 6060:6060 clair-scanner --ip 127.0.0.1 myapp:latest

# Check for outdated packages
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock   wagoodman/dive:latest myapp:latest

# Security audit with Docker Bench
docker run --rm --net host --pid host --userns host --cap-add audit_control   -e DOCKER_CONTENT_TRUST=$DOCKER_CONTENT_TRUST   -v /var/lib:/var/lib   -v /var/run/docker.sock:/var/run/docker.sock   -v /usr/lib/systemd:/usr/lib/systemd   -v /etc:/etc --label docker_bench_security   docker/docker-bench-security

# Enable Docker Content Trust
export DOCKER_CONTENT_TRUST=1

# Sign and push trusted image
docker trust sign myapp:latest
docker push myapp:latest`}]}],projects:[{title:"Containerized Microservices Application",description:"Build a complete microservices application with Docker, including API gateway, multiple services, database, and monitoring",technologies:["Docker","Docker Compose","Node.js","PostgreSQL","Redis","NGINX"],difficulty:"Advanced",estimatedHours:40,deliverables:["Multi-service Docker Compose configuration","Optimized Dockerfiles for each service","Service discovery and load balancing setup","Database persistence with volumes","Monitoring and logging configuration","Security hardening implementation"]},{title:"CI/CD Pipeline with Docker",description:"Create a complete CI/CD pipeline using Docker for building, testing, and deploying applications",technologies:["Docker","GitHub Actions","Node.js","Jest","SonarQube","Kubernetes"],difficulty:"Advanced",estimatedHours:35,deliverables:["Docker-based build environment","Automated testing in containers","Multi-stage Docker builds for optimization","Container registry integration","Deployment automation scripts","Security scanning integration"]},{title:"Docker-based Development Environment",description:"Set up a complete development environment using Docker for a full-stack application",technologies:["Docker","Docker Compose","Node.js","React","PostgreSQL","Redis"],difficulty:"Intermediate",estimatedHours:25,deliverables:["Development Docker Compose setup","Hot reloading configuration","Database seeding and migration","Development tools integration","Testing environment setup","Documentation and setup scripts"]},{title:"Production-Ready Container Deployment",description:"Deploy a containerized application to production with security, monitoring, and scalability",technologies:["Docker","Docker Swarm","Traefik","Prometheus","Grafana","ELK Stack"],difficulty:"Advanced",estimatedHours:45,deliverables:["Production Docker Compose configuration","Load balancing and service discovery","Monitoring and alerting setup","Security hardening and secrets management","Backup and disaster recovery","Performance optimization and scaling"]},{title:"Docker Image Optimization Challenge",description:"Optimize Docker images for size, security, and performance across different application types",technologies:["Docker","Dockerfile","Multi-stage builds","Security scanning","Performance testing"],difficulty:"Intermediate",estimatedHours:20,deliverables:["Before/after image size comparison","Security vulnerability assessment","Build time optimization","Runtime performance analysis","Best practices documentation","Automated optimization scripts"]}],assessments:{quiz:[{question:"What is the primary benefit of using Docker containers?",options:["Faster application startup times","Consistent deployment across environments","Automatic code generation","Built-in database management"],correctAnswer:1,explanation:"Docker containers ensure consistent deployment by packaging applications with all their dependencies, solving the 'works on my machine' problem."},{question:"Which Dockerfile instruction creates a new layer in the image?",options:["FROM","EXPOSE","RUN","USER"],correctAnswer:2,explanation:"The RUN instruction executes commands and creates a new layer in the Docker image, while FROM, EXPOSE, and USER do not create layers."},{question:"What is the purpose of Docker Compose?",options:["To build individual Docker images","To define and run multi-container applications","To scan images for security vulnerabilities","To manage Docker volumes only"],correctAnswer:1,explanation:"Docker Compose is used to define and run multi-container Docker applications using YAML configuration files."},{question:"Which volume type provides the best performance for Docker containers?",options:["Bind mounts","Named volumes","tmpfs mounts","Anonymous volumes"],correctAnswer:1,explanation:"Named volumes generally provide better performance than bind mounts because Docker manages them directly in its storage area."},{question:"What is the most secure way to handle secrets in Docker containers?",options:["Store them in environment variables","Hardcode them in the Dockerfile","Use Docker secrets or external secret management","Pass them as command-line arguments"],correctAnswer:2,explanation:"Docker secrets or external secret management systems provide the most secure way to handle sensitive data in containers."}],evaluation:[{question:"Design a secure, production-ready Docker setup for a Node.js web application that includes a PostgreSQL database and Redis cache. Include considerations for security, monitoring, and scalability.",rubric:["Comprehensive security implementation (non-root users, minimal base images, secrets management)","Proper networking configuration with service isolation","Monitoring and logging setup","Scalability considerations and resource limits","Backup and disaster recovery planning"]},{question:"Compare and contrast different Docker networking modes and explain when to use each type for various application architectures.",rubric:["Accurate explanation of bridge, host, overlay, macvlan, and none networks","Appropriate use cases for each network type","Security implications of different networking modes","Performance considerations","Real-world application examples"]}]},aiPrompts:["How do I optimize my Docker image size for a Node.js application?","What's the best way to handle database migrations in Docker containers?","How can I debug a container that's not starting properly?","What's the difference between Docker Compose and Docker Swarm?","How do I implement zero-downtime deployments with Docker?","What's the best practice for logging in containerized applications?","How can I secure my Docker containers for production deployment?","What's the difference between bind mounts and volumes in Docker?","How do I set up monitoring for Docker containers?","What's the best way to handle environment-specific configurations in Docker?","How can I implement health checks for my Docker containers?","What's the difference between CMD and ENTRYPOINT in Dockerfiles?"],resources:[{title:"Docker Documentation",type:"Official Documentation",url:"https://docs.docker.com/",description:"Comprehensive official documentation for Docker"},{title:"Docker Best Practices Guide",type:"Guide",url:"https://docs.docker.com/develop/dev-best-practices/",description:"Official Docker development best practices"},{title:"Docker Compose Documentation",type:"Official Documentation",url:"https://docs.docker.com/compose/",description:"Complete guide to Docker Compose"},{title:"Docker Security Best Practices",type:"Guide",url:"https://docs.docker.com/engine/security/",description:"Docker security guidelines and best practices"},{title:"Awesome Docker",type:"Resource Collection",url:"https://github.com/veggiemonk/awesome-docker",description:"Curated list of Docker resources and tools"}],toolsRequired:[{name:"Docker Desktop",description:"Docker development environment for Windows, macOS, and Linux",installation:"Download from docker.com and follow platform-specific installation instructions",purpose:"Container runtime and development tools"},{name:"Docker Compose",description:"Tool for defining and running multi-container Docker applications",installation:"Included with Docker Desktop or install separately on Linux",purpose:"Multi-container application orchestration"},{name:"Docker Hub",description:"Cloud-based registry for Docker images",installation:"Create account at hub.docker.com",purpose:"Image storage and distribution"},{name:"Docker Scout",description:"Security scanning tool for Docker images",installation:"docker scout enable",purpose:"Image vulnerability scanning"},{name:"Portainer",description:"Web-based Docker management interface",installation:"docker run -d -p 9000:9000 portainer/portainer",purpose:"Container management and monitoring"}],bestPractices:["Use specific image versions instead of 'latest' tags","Run containers as non-root users for security","Implement multi-stage builds to reduce image size","Use .dockerignore files to exclude unnecessary files","Implement health checks for container monitoring","Use named volumes for persistent data storage","Scan images regularly for security vulnerabilities","Limit container resources to prevent resource exhaustion","Use environment variables for configuration management","Implement proper logging and monitoring strategies","Keep base images updated with security patches","Use Docker Content Trust for image verification"],commonPitfalls:["Using 'latest' tags leading to unpredictable deployments","Running containers as root user creating security risks","Not using .dockerignore causing large image sizes","Storing secrets in Docker images instead of using secrets management","Not implementing resource limits leading to resource exhaustion","Using bind mounts in production instead of named volumes","Not scanning images for security vulnerabilities","Hardcoding configuration values instead of using environment variables","Not implementing health checks for container monitoring","Using single-stage builds for applications with build dependencies","Not cleaning up unused Docker resources (images, containers, volumes)","Ignoring Docker security best practices in production deployments"],careerRelevance:["Docker skills are essential for modern DevOps and cloud-native development roles","Containerization expertise is highly valued in microservices architecture positions","Docker proficiency is required for Kubernetes and cloud platform certifications","Container orchestration skills are critical for site reliability engineering (SRE) roles","Docker knowledge is fundamental for CI/CD pipeline development and management","Container security expertise is increasingly important for application security roles","Docker skills enhance employability in full-stack and backend development positions","Containerization knowledge is valuable for cloud migration and modernization projects","Docker expertise supports career advancement in platform engineering and infrastructure roles","Container orchestration skills are essential for managing scalable, distributed systems","Docker knowledge is beneficial for freelance and consulting opportunities in modern development","Containerization proficiency supports career transitions to DevOps and cloud engineering roles"]},UM={id:"cloudservices",tier:4,name:"Cloud Services",description:"Master cloud computing platforms and serverless architecture for scalable, cost-effective application deployment. Learn AWS, GCP, and Azure core services, Infrastructure as Code, microservices design, and cloud optimization strategies.",difficulty:"advanced",estimatedHours:25,prerequisites:["docker","monitoring"],learningObjectives:["Understand core services across major cloud platforms (AWS, GCP, Azure)","Implement serverless computing with Lambda, Cloud Functions, and Azure Functions","Design scalable cloud storage and database solutions","Configure CDN and edge computing for global performance","Architect microservices applications for cloud deployment","Implement Infrastructure as Code using Terraform and CloudFormation","Optimize cloud costs through monitoring and resource management","Deploy applications using cloud-native deployment strategies","Implement cloud security best practices and compliance","Monitor and troubleshoot cloud applications","Design multi-region and multi-cloud architectures","Automate cloud infrastructure and deployments"],sections:[{title:"Cloud Platform Fundamentals",content:`Cloud computing provides on-demand access to computing resources, storage, and services over the internet. Major cloud providers (AWS, Google Cloud Platform, and Microsoft Azure) offer comprehensive suites of services for building, deploying, and managing applications at scale.

**Cloud Service Models**:
- **IaaS (Infrastructure as a Service)**: Virtual machines, storage, networking
- **PaaS (Platform as a Service)**: Application development and deployment platforms
- **SaaS (Software as a Service)**: Ready-to-use applications
- **FaaS (Functions as a Service)**: Serverless computing

**Cloud Deployment Models**:
- **Public Cloud**: Services offered by third-party providers
- **Private Cloud**: Dedicated infrastructure for single organization
- **Hybrid Cloud**: Combination of public and private clouds
- **Multi-Cloud**: Using multiple cloud providers simultaneously

**Core Cloud Concepts**: Scalability, elasticity, high availability, fault tolerance, and pay-as-you-go pricing models.

**Getting Started**: Choose a cloud provider based on your needs, create an account, set up billing alerts, and configure security settings.

**Cloud Console**: Each provider offers web-based consoles for managing resources, monitoring usage, and accessing services.`,keyTopics:["Cloud service and deployment models","Major cloud providers comparison","Cloud economics and pricing models","Cloud security fundamentals","Getting started with cloud platforms"],practicalExercises:["Create accounts on AWS, GCP, and Azure with proper security setup","Configure billing alerts and cost monitoring","Explore cloud console interfaces and navigation","Set up multi-factor authentication and access controls","Create and manage basic cloud resources (VMs, storage)"],codeExamples:[{title:"AWS CLI Setup and Basic Commands",language:"bash",code:`# Install AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# Configure AWS CLI
aws configure
# Enter: Access Key ID, Secret Access Key, Default region, Default output format

# Basic AWS commands
aws ec2 describe-instances
aws s3 ls
aws iam list-users
aws cloudformation list-stacks

# Create S3 bucket
aws s3 mb s3://my-unique-bucket-name

# Upload file to S3
aws s3 cp myfile.txt s3://my-bucket/

# List EC2 instances with tags
aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId,State.Name,Tags[?Key==\`Name\`].Value|[0]]' --output table

# Get account information
aws sts get-caller-identity

# List all regions
aws ec2 describe-regions --output table`},{title:"Google Cloud SDK Setup",language:"bash",code:`# Install Google Cloud SDK
curl https://sdk.cloud.google.com | bash
exec -l $SHELL

# Initialize gcloud
gcloud init

# Set project
gcloud config set project my-project-id

# Authenticate
gcloud auth login
gcloud auth application-default login

# Basic gcloud commands
gcloud compute instances list
gcloud storage buckets list
gcloud projects list
gcloud services list --available

# Create storage bucket
gsutil mb gs://my-unique-bucket-name

# Upload file to GCS
gsutil cp myfile.txt gs://my-bucket/

# List compute instances
gcloud compute instances list --format="table(name,status,zone,machine_type)"

# Get project information
gcloud config list

# Enable APIs
gcloud services enable compute.googleapis.com
gcloud services enable storage-api.googleapis.com`},{title:"Azure CLI Setup and Commands",language:"bash",code:`# Install Azure CLI
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

# Login to Azure
az login

# Set subscription
az account set --subscription "My Subscription"

# List available subscriptions
az account list --output table

# Basic Azure commands
az vm list
az storage account list
az group list
az webapp list

# Create resource group
az group create --name myResourceGroup --location eastus

# Create storage account
az storage account create --name mystorageaccount --resource-group myResourceGroup --location eastus --sku Standard_LRS

# Upload blob to storage
az storage blob upload --account-name mystorageaccount --container-name mycontainer --name myblob --file myfile.txt

# List virtual machines
az vm list --output table

# Get account information
az account show

# List available locations
az account list-locations --output table`}]},{title:"Serverless Computing and Functions",content:`Serverless computing allows you to run code without managing servers. Functions as a Service (FaaS) platforms automatically scale, handle infrastructure, and charge only for actual execution time.

**Serverless Benefits**:
- **No Server Management**: Focus on code, not infrastructure
- **Automatic Scaling**: Handle any load automatically
- **Cost Efficiency**: Pay only for execution time
- **Built-in High Availability**: Fault tolerance and redundancy
- **Event-Driven**: Respond to events from various sources

**Function Platforms**:
- **AWS Lambda**: Supports multiple languages, integrates with all AWS services
- **Google Cloud Functions**: Built on Google infrastructure, supports HTTP and event triggers
- **Azure Functions**: Supports multiple languages, integrates with Azure ecosystem

**Function Triggers**: HTTP requests, database changes, file uploads, scheduled events, message queues, and custom events.

**Cold Starts**: Initial execution delay when a function hasn't been used recently. Mitigate with provisioned concurrency and optimized packages.

**Best Practices**: Keep functions small and focused, use appropriate memory allocation, implement proper error handling, and monitor performance.

**Limitations**: Execution time limits, cold start latency, vendor lock-in considerations, and debugging challenges.`,keyTopics:["Serverless computing concepts and benefits","Function platforms and capabilities","Event-driven architecture patterns","Cold start optimization strategies","Serverless security considerations"],practicalExercises:["Create and deploy serverless functions on AWS Lambda, Google Cloud Functions, and Azure Functions","Implement HTTP API endpoints with serverless functions","Set up event triggers for file uploads and database changes","Configure scheduled functions for automated tasks","Optimize function performance and reduce cold starts","Implement proper error handling and logging"],codeExamples:[{title:"AWS Lambda Function (Node.js)",language:"javascript",code:`// index.js
const AWS = require('aws-sdk');
const dynamoDb = new AWS.DynamoDB.DocumentClient();

exports.handler = async (event, context) => {
  console.log('Event:', JSON.stringify(event, null, 2));

  try {
    // Handle different HTTP methods
    switch (event.httpMethod) {
      case 'GET':
        return await getItems();
      case 'POST':
        return await createItem(event.body);
      case 'PUT':
        return await updateItem(event.pathParameters.id, event.body);
      case 'DELETE':
        return await deleteItem(event.pathParameters.id);
      default:
        return {
          statusCode: 405,
          headers: {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Headers': 'Content-Type',
            'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE'
          },
          body: JSON.stringify({ message: 'Method not allowed' })
        };
    }
  } catch (error) {
    console.error('Error:', error);
    return {
      statusCode: 500,
      headers: {
        'Access-Control-Allow-Origin': '*'
      },
      body: JSON.stringify({ message: 'Internal server error' })
    };
  }
};

async function getItems() {
  const params = {
    TableName: process.env.TABLE_NAME
  };

  const result = await dynamoDb.scan(params).promise();

  return {
    statusCode: 200,
    headers: {
      'Access-Control-Allow-Origin': '*'
    },
    body: JSON.stringify(result.Items)
  };
}

async function createItem(body) {
  const data = JSON.parse(body);
  const params = {
    TableName: process.env.TABLE_NAME,
    Item: {
      id: Date.now().toString(),
      ...data,
      createdAt: new Date().toISOString()
    }
  };

  await dynamoDb.put(params).promise();

  return {
    statusCode: 201,
    headers: {
      'Access-Control-Allow-Origin': '*'
    },
    body: JSON.stringify(params.Item)
  };
}

async function updateItem(id, body) {
  const data = JSON.parse(body);
  const params = {
    TableName: process.env.TABLE_NAME,
    Key: { id },
    UpdateExpression: 'set #name = :name, updatedAt = :updatedAt',
    ExpressionAttributeNames: {
      '#name': 'name'
    },
    ExpressionAttributeValues: {
      ':name': data.name,
      ':updatedAt': new Date().toISOString()
    },
    ReturnValues: 'ALL_NEW'
  };

  const result = await dynamoDb.update(params).promise();

  return {
    statusCode: 200,
    headers: {
      'Access-Control-Allow-Origin': '*'
    },
    body: JSON.stringify(result.Attributes)
  };
}

async function deleteItem(id) {
  const params = {
    TableName: process.env.TABLE_NAME,
    Key: { id }
  };

  await dynamoDb.delete(params).promise();

  return {
    statusCode: 204,
    headers: {
      'Access-Control-Allow-Origin': '*'
    },
    body: JSON.stringify({ message: 'Item deleted successfully' })
  };
}`},{title:"Google Cloud Function (Python)",language:"python",code:`# main.py
import functions_framework
from google.cloud import firestore
import json
from datetime import datetime

db = firestore.Client()

@functions_framework.http
def api_handler(request):
    """HTTP Cloud Function for CRUD operations."""

    if request.method == 'OPTIONS':
        # Handle CORS preflight request
        headers = {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
            'Access-Control-Allow-Headers': 'Content-Type',
            'Access-Control-Max-Age': '3600'
        }
        return ('', 204, headers)

    try:
        if request.method == 'GET':
            return get_items(request)
        elif request.method == 'POST':
            return create_item(request)
        elif request.method == 'PUT':
            return update_item(request)
        elif request.method == 'DELETE':
            return delete_item(request)
        else:
            return (json.dumps({'error': 'Method not allowed'}), 405,
                   {'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'})

    except Exception as e:
        print(f'Error: {str(e)}')
        return (json.dumps({'error': 'Internal server error'}), 500,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

def get_items(request):
    """Get all items from Firestore."""
    items_ref = db.collection('items')
    docs = items_ref.stream()

    items = []
    for doc in docs:
        item = doc.to_dict()
        item['id'] = doc.id
        items.append(item)

    return (json.dumps(items), 200,
           {'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'})

def create_item(request):
    """Create a new item in Firestore."""
    data = request.get_json()

    if not data or 'name' not in data:
        return (json.dumps({'error': 'Name is required'}), 400,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    item_data = {
        'name': data['name'],
        'description': data.get('description', ''),
        'created_at': datetime.utcnow(),
        'updated_at': datetime.utcnow()
    }

    doc_ref = db.collection('items').document()
    doc_ref.set(item_data)

    item_data['id'] = doc_ref.id

    return (json.dumps(item_data), 201,
           {'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'})

def update_item(request):
    """Update an existing item in Firestore."""
    item_id = request.args.get('id')
    if not item_id:
        return (json.dumps({'error': 'Item ID is required'}), 400,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    data = request.get_json()
    if not data:
        return (json.dumps({'error': 'Request body is required'}), 400,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    doc_ref = db.collection('items').document(item_id)
    doc = doc_ref.get()

    if not doc.exists:
        return (json.dumps({'error': 'Item not found'}), 404,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    update_data = {
        'updated_at': datetime.utcnow()
    }

    if 'name' in data:
        update_data['name'] = data['name']
    if 'description' in data:
        update_data['description'] = data['description']

    doc_ref.update(update_data)

    updated_doc = doc_ref.get()
    item = updated_doc.to_dict()
    item['id'] = updated_doc.id

    return (json.dumps(item), 200,
           {'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'})

def delete_item(request):
    """Delete an item from Firestore."""
    item_id = request.args.get('id')
    if not item_id:
        return (json.dumps({'error': 'Item ID is required'}), 400,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    doc_ref = db.collection('items').document(item_id)
    doc = doc_ref.get()

    if not doc.exists:
        return (json.dumps({'error': 'Item not found'}), 404,
               {'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'})

    doc_ref.delete()

    return (json.dumps({'message': 'Item deleted successfully'}), 204,
           {'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'})`},{title:"Azure Function (C#)",language:"csharp",code:`// Function1.cs
using System;
using System.IO;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Extensions.Http;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using Newtonsoft.Json;
using System.Collections.Generic;
using Microsoft.Azure.Cosmos;

public static class Function1
{
    private static readonly string EndpointUri = Environment.GetEnvironmentVariable("CosmosDBEndpoint");
    private static readonly string PrimaryKey = Environment.GetEnvironmentVariable("CosmosDBKey");
    private static readonly string DatabaseId = Environment.GetEnvironmentVariable("CosmosDBDatabase");
    private static readonly string ContainerId = Environment.GetEnvironmentVariable("CosmosDBContainer");

    private static CosmosClient cosmosClient = new CosmosClient(EndpointUri, PrimaryKey);
    private static Database database;
    private static Container container;

    static Function1()
    {
        database = cosmosClient.GetDatabase(DatabaseId);
        container = database.GetContainer(ContainerId);
    }

    [FunctionName("ItemsAPI")]
    public static async Task<IActionResult> Run(
        [HttpTrigger(AuthorizationLevel.Function, "get", "post", "put", "delete", Route = "items/{id?}")] HttpRequest req,
        string id,
        ILogger log)
    {
        log.LogInformation("C# HTTP trigger function processed a request.");

        try
        {
            switch (req.Method.ToUpper())
            {
                case "GET":
                    return await GetItems(req, id);
                case "POST":
                    return await CreateItem(req);
                case "PUT":
                    return await UpdateItem(req, id);
                case "DELETE":
                    return await DeleteItem(id);
                default:
                    return new BadRequestObjectResult("Method not supported");
            }
        }
        catch (Exception ex)
        {
            log.LogError($"Error processing request: {ex.Message}");
            return new StatusCodeResult(500);
        }
    }

    private static async Task<IActionResult> GetItems(HttpRequest req, string id)
    {
        if (!string.IsNullOrEmpty(id))
        {
            // Get single item
            try
            {
                ItemResponse<Item> response = await container.ReadItemAsync<Item>(id, new PartitionKey(id));
                return new OkObjectResult(response.Resource);
            }
            catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
            {
                return new NotFoundResult();
            }
        }
        else
        {
            // Get all items
            var query = new QueryDefinition("SELECT * FROM c");
            var results = new List<Item>();

            using (FeedIterator<Item> resultSet = container.GetItemQueryIterator<Item>(query))
            {
                while (resultSet.HasMoreResults)
                {
                    FeedResponse<Item> response = await resultSet.ReadNextAsync();
                    results.AddRange(response);
                }
            }

            return new OkObjectResult(results);
        }
    }

    private static async Task<IActionResult> CreateItem(HttpRequest req)
    {
        string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
        var data = JsonConvert.DeserializeObject<Item>(requestBody);

        if (data == null || string.IsNullOrEmpty(data.Name))
        {
            return new BadRequestObjectResult("Name is required");
        }

        data.Id = Guid.NewGuid().ToString();
        data.CreatedAt = DateTime.UtcNow;
        data.UpdatedAt = DateTime.UtcNow;

        ItemResponse<Item> response = await container.CreateItemAsync(data, new PartitionKey(data.Id));

        return new CreatedResult($"/api/items/{data.Id}", response.Resource);
    }

    private static async Task<IActionResult> UpdateItem(HttpRequest req, string id)
    {
        if (string.IsNullOrEmpty(id))
        {
            return new BadRequestObjectResult("ID is required");
        }

        string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
        var data = JsonConvert.DeserializeObject<Item>(requestBody);

        if (data == null)
        {
            return new BadRequestObjectResult("Request body is required");
        }

        try
        {
            ItemResponse<Item> readResponse = await container.ReadItemAsync<Item>(id, new PartitionKey(id));
            var existingItem = readResponse.Resource;

            // Update fields
            if (!string.IsNullOrEmpty(data.Name))
                existingItem.Name = data.Name;
            if (!string.IsNullOrEmpty(data.Description))
                existingItem.Description = data.Description;
            existingItem.UpdatedAt = DateTime.UtcNow;

            ItemResponse<Item> updateResponse = await container.ReplaceItemAsync(existingItem, id, new PartitionKey(id));

            return new OkObjectResult(updateResponse.Resource);
        }
        catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
        {
            return new NotFoundResult();
        }
    }

    private static async Task<IActionResult> DeleteItem(string id)
    {
        if (string.IsNullOrEmpty(id))
        {
            return new BadRequestObjectResult("ID is required");
        }

        try
        {
            ItemResponse<Item> response = await container.DeleteItemAsync<Item>(id, new PartitionKey(id));
            return new NoContentResult();
        }
        catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
        {
            return new NotFoundResult();
        }
    }
}

public class Item
{
    [JsonProperty("id")]
    public string Id { get; set; }

    [JsonProperty("name")]
    public string Name { get; set; }

    [JsonProperty("description")]
    public string Description { get; set; }

    [JsonProperty("createdAt")]
    public DateTime CreatedAt { get; set; }

    [JsonProperty("updatedAt")]
    public DateTime UpdatedAt { get; set; }
}`}]},{title:"Cloud Storage and Databases",content:`Cloud storage and database services provide scalable, durable, and highly available data storage solutions. These services eliminate the need to manage physical storage infrastructure and offer automatic scaling, backup, and disaster recovery.

**Cloud Storage Services**:
- **AWS S3**: Object storage with high durability and availability
- **Google Cloud Storage**: Unified object storage with strong consistency
- **Azure Blob Storage**: Scalable object storage with multiple access tiers

**Cloud Database Services**:
- **Relational**: AWS RDS, Google Cloud SQL, Azure Database
- **NoSQL**: AWS DynamoDB, Google Firestore, Azure Cosmos DB
- **Data Warehousing**: AWS Redshift, Google BigQuery, Azure Synapse

**Storage Classes and Tiers**: Different storage classes for different access patterns and cost optimization (Standard, Infrequent Access, Archive, Cold).

**Data Consistency Models**: Strong consistency, eventual consistency, and read-after-write consistency patterns.

**Backup and Disaster Recovery**: Automated backups, cross-region replication, and point-in-time recovery capabilities.

**Security Features**: Encryption at rest and in transit, access control policies, audit logging, and compliance certifications.

**Performance Optimization**: Database indexing, query optimization, connection pooling, and caching strategies.`,keyTopics:["Cloud storage services and features","Cloud database types and use cases","Data consistency and replication","Backup and disaster recovery strategies","Storage security and compliance"],practicalExercises:["Set up cloud storage buckets with proper access controls","Configure cloud databases with high availability","Implement automated backup and recovery procedures","Set up cross-region replication for disaster recovery","Optimize storage costs with lifecycle policies","Implement database indexing and query optimization"],codeExamples:[{title:"AWS S3 Operations with SDK",language:"javascript",code:`const AWS = require('aws-sdk');
const fs = require('fs');
const path = require('path');

// Configure AWS SDK
AWS.config.update({
  region: process.env.AWS_REGION || 'us-east-1'
});

const s3 = new AWS.S3();

// Upload file to S3
async function uploadFile(filePath, bucketName, key) {
  try {
    const fileContent = fs.readFileSync(filePath);

    const params = {
      Bucket: bucketName,
      Key: key,
      Body: fileContent,
      ContentType: getContentType(filePath),
      // Enable server-side encryption
      ServerSideEncryption: 'AES256',
      // Set ACL for public read (use carefully)
      ACL: 'private'
    };

    const result = await s3.upload(params).promise();
    console.log('File uploaded successfully:', result.Location);
    return result;
  } catch (error) {
    console.error('Error uploading file:', error);
    throw error;
  }
}

// Download file from S3
async function downloadFile(bucketName, key, downloadPath) {
  try {
    const params = {
      Bucket: bucketName,
      Key: key
    };

    const result = await s3.getObject(params).promise();

    fs.writeFileSync(downloadPath, result.Body);
    console.log('File downloaded successfully');
    return result;
  } catch (error) {
    console.error('Error downloading file:', error);
    throw error;
  }
}

// List objects in bucket
async function listObjects(bucketName, prefix = '') {
  try {
    const params = {
      Bucket: bucketName,
      Prefix: prefix,
      MaxKeys: 100
    };

    const result = await s3.listObjectsV2(params).promise();

    console.log('Objects in bucket:');
    result.Contents.forEach(obj => {
      console.log(\` - \${obj.Key} (\${obj.Size} bytes)\`);
    });

    return result.Contents;
  } catch (error) {
    console.error('Error listing objects:', error);
    throw error;
  }
}

// Generate presigned URL for temporary access
async function generatePresignedUrl(bucketName, key, expiresIn = 3600) {
  try {
    const params = {
      Bucket: bucketName,
      Key: key,
      Expires: expiresIn
    };

    const url = s3.getSignedUrl('getObject', params);
    console.log('Presigned URL generated:', url);
    return url;
  } catch (error) {
    console.error('Error generating presigned URL:', error);
    throw error;
  }
}

// Delete object from S3
async function deleteObject(bucketName, key) {
  try {
    const params = {
      Bucket: bucketName,
      Key: key
    };

    await s3.deleteObject(params).promise();
    console.log('Object deleted successfully');
  } catch (error) {
    console.error('Error deleting object:', error);
    throw error;
  }
}

// Set up lifecycle policy for cost optimization
async function setLifecyclePolicy(bucketName) {
  try {
    const params = {
      Bucket: bucketName,
      LifecycleConfiguration: {
        Rules: [
          {
            ID: 'Move to IA after 30 days',
            Status: 'Enabled',
            Prefix: '',
            Transitions: [
              {
                Days: 30,
                StorageClass: 'STANDARD_IA'
              },
              {
                Days: 90,
                StorageClass: 'GLACIER'
              }
            ]
          },
          {
            ID: 'Delete old versions after 7 days',
            Status: 'Enabled',
            Prefix: '',
            NoncurrentVersionExpiration: {
              NoncurrentDays: 7
            }
          }
        ]
      }
    };

    await s3.putBucketLifecycleConfiguration(params).promise();
    console.log('Lifecycle policy set successfully');
  } catch (error) {
    console.error('Error setting lifecycle policy:', error);
    throw error;
  }
}

// Helper function to get content type
function getContentType(filePath) {
  const ext = path.extname(filePath).toLowerCase();
  const contentTypes = {
    '.jpg': 'image/jpeg',
    '.jpeg': 'image/jpeg',
    '.png': 'image/png',
    '.gif': 'image/gif',
    '.pdf': 'application/pdf',
    '.txt': 'text/plain',
    '.json': 'application/json',
    '.html': 'text/html',
    '.css': 'text/css',
    '.js': 'application/javascript'
  };

  return contentTypes[ext] || 'application/octet-stream';
}

module.exports = {
  uploadFile,
  downloadFile,
  listObjects,
  generatePresignedUrl,
  deleteObject,
  setLifecyclePolicy
};`},{title:"Google Cloud Storage Operations",language:"python",code:`from google.cloud import storage
from google.oauth2 import service_account
import os
from datetime import datetime, timedelta

class CloudStorageManager:
    def __init__(self, project_id, credentials_path=None):
        if credentials_path:
            credentials = service_account.Credentials.from_service_account_file(credentials_path)
            self.client = storage.Client(project=project_id, credentials=credentials)
        else:
            self.client = storage.Client(project=project_id)

    def create_bucket(self, bucket_name, location='US'):
        """Create a new bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            bucket.location = location
            bucket.storage_class = 'STANDARD'

            # Set lifecycle rules
            bucket.lifecycle_rules = [
                {
                    'action': {'type': 'SetStorageClass', 'storageClass': 'NEARLINE'},
                    'condition': {'age': 30}
                },
                {
                    'action': {'type': 'SetStorageClass', 'storageClass': 'COLDLINE'},
                    'condition': {'age': 90}
                },
                {
                    'action': {'type': 'Delete'},
                    'condition': {'age': 365}
                }
            ]

            bucket.create()
            print(f'Bucket {bucket_name} created successfully')
            return bucket
        except Exception as e:
            print(f'Error creating bucket: {e}')
            raise

    def upload_file(self, bucket_name, source_file_path, destination_blob_name):
        """Upload a file to the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            blob = bucket.blob(destination_blob_name)

            # Set metadata
            blob.metadata = {
                'uploaded_at': datetime.utcnow().isoformat(),
                'source': 'cloud-storage-manager'
            }

            blob.upload_from_filename(source_file_path)

            # Make the blob publicly accessible (use with caution)
            # blob.make_public()

            print(f'File {source_file_path} uploaded to {destination_blob_name}')
            return blob
        except Exception as e:
            print(f'Error uploading file: {e}')
            raise

    def download_file(self, bucket_name, source_blob_name, destination_file_path):
        """Download a file from the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            blob = bucket.blob(source_blob_name)

            blob.download_to_filename(destination_file_path)
            print(f'File {source_blob_name} downloaded to {destination_file_path}')
        except Exception as e:
            print(f'Error downloading file: {e}')
            raise

    def list_files(self, bucket_name, prefix=None):
        """List all files in the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            blobs = bucket.list_blobs(prefix=prefix)

            files = []
            for blob in blobs:
                files.append({
                    'name': blob.name,
                    'size': blob.size,
                    'created': blob.time_created,
                    'updated': blob.updated,
                    'content_type': blob.content_type
                })

            return files
        except Exception as e:
            print(f'Error listing files: {e}')
            raise

    def generate_signed_url(self, bucket_name, blob_name, expiration_minutes=60):
        """Generate a signed URL for temporary access"""
        try:
            bucket = self.client.bucket(bucket_name)
            blob = bucket.blob(blob_name)

            expiration = datetime.utcnow() + timedelta(minutes=expiration_minutes)
            url = blob.generate_signed_url(expiration=expiration)

            print(f'Signed URL generated for {blob_name}')
            return url
        except Exception as e:
            print(f'Error generating signed URL: {e}')
            raise

    def delete_file(self, bucket_name, blob_name):
        """Delete a file from the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            blob = bucket.blob(blob_name)

            blob.delete()
            print(f'File {blob_name} deleted successfully')
        except Exception as e:
            print(f'Error deleting file: {e}')
            raise

    def set_cors_policy(self, bucket_name):
        """Set CORS policy for the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)

            cors = [
                {
                    'origin': ['*'],
                    'method': ['GET', 'POST', 'PUT', 'DELETE'],
                    'responseHeader': ['Content-Type'],
                    'maxAgeSeconds': 3600
                }
            ]

            bucket.cors = cors
            bucket.update()

            print(f'CORS policy set for bucket {bucket_name}')
        except Exception as e:
            print(f'Error setting CORS policy: {e}')
            raise

    def enable_versioning(self, bucket_name):
        """Enable versioning for the bucket"""
        try:
            bucket = self.client.bucket(bucket_name)
            bucket.versioning_enabled = True
            bucket.update()

            print(f'Versioning enabled for bucket {bucket_name}')
        except Exception as e:
            print(f'Error enabling versioning: {e}')
            raise

# Usage example
if __name__ == '__main__':
    # Initialize the manager
    manager = CloudStorageManager('your-project-id', 'credentials.json')

    # Create a bucket
    bucket = manager.create_bucket('my-unique-bucket-name')

    # Upload a file
    manager.upload_file('my-unique-bucket-name', 'local-file.txt', 'remote-file.txt')

    # List files
    files = manager.list_files('my-unique-bucket-name')
    for file in files:
        print(file)

    # Generate signed URL
    signed_url = manager.generate_signed_url('my-unique-bucket-name', 'remote-file.txt')
    print(f'Signed URL: {signed_url}')`},{title:"Azure Blob Storage Operations",language:"csharp",code:`using Azure.Storage.Blobs;
using Azure.Storage.Blobs.Models;
using Azure.Storage.Sas;
using System;
using System.IO;
using System.Threading.Tasks;
using System.Collections.Generic;

namespace CloudStorageManager
{
    public class BlobStorageManager
    {
        private readonly BlobServiceClient _blobServiceClient;

        public BlobStorageManager(string connectionString)
        {
            _blobServiceClient = new BlobServiceClient(connectionString);
        }

        public async Task CreateContainerAsync(string containerName)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);

                await containerClient.CreateIfNotExistsAsync(PublicAccessType.None);

                // Set metadata
                var metadata = new Dictionary<string, string>
                {
                    { "created", DateTime.UtcNow.ToString("o") },
                    { "purpose", "data-storage" }
                };

                await containerClient.SetMetadataAsync(metadata);

                Console.WriteLine($"Container '{containerName}' created successfully");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error creating container: {ex.Message}");
                throw;
            }
        }

        public async Task UploadBlobAsync(string containerName, string localFilePath, string blobName)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);
                var blobClient = containerClient.GetBlobClient(blobName);

                // Set blob properties
                var blobHttpHeaders = new BlobHttpHeaders
                {
                    ContentType = GetContentType(localFilePath)
                };

                // Set metadata
                var metadata = new Dictionary<string, string>
                {
                    { "uploaded_at", DateTime.UtcNow.ToString("o") },
                    { "original_filename", Path.GetFileName(localFilePath) }
                };

                using (var fileStream = File.OpenRead(localFilePath))
                {
                    await blobClient.UploadAsync(fileStream, new BlobUploadOptions
                    {
                        HttpHeaders = blobHttpHeaders,
                        Metadata = metadata,
                        AccessTier = AccessTier.Hot
                    });
                }

                Console.WriteLine($"File '{localFilePath}' uploaded as '{blobName}'");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error uploading blob: {ex.Message}");
                throw;
            }
        }

        public async Task DownloadBlobAsync(string containerName, string blobName, string downloadPath)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);
                var blobClient = containerClient.GetBlobClient(blobName);

                using (var downloadStream = File.OpenWrite(downloadPath))
                {
                    var response = await blobClient.DownloadToAsync(downloadStream);
                    Console.WriteLine($"Blob '{blobName}' downloaded to '{downloadPath}'");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error downloading blob: {ex.Message}");
                throw;
            }
        }

        public async Task<List<BlobItem>> ListBlobsAsync(string containerName, string prefix = null)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);
                var blobs = new List<BlobItem>();

                await foreach (var blobItem in containerClient.GetBlobsAsync(prefix: prefix))
                {
                    blobs.Add(blobItem);
                    Console.WriteLine($"Blob: {blobItem.Name}, Size: {blobItem.Properties.ContentLength}");
                }

                return blobs;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error listing blobs: {ex.Message}");
                throw;
            }
        }

        public async Task<string> GenerateSasUriAsync(string containerName, string blobName, int expirationMinutes = 60)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);
                var blobClient = containerClient.GetBlobClient(blobName);

                var sasBuilder = new BlobSasBuilder
                {
                    BlobContainerName = containerName,
                    BlobName = blobName,
                    Resource = "b",
                    StartsOn = DateTimeOffset.UtcNow,
                    ExpiresOn = DateTimeOffset.UtcNow.AddMinutes(expirationMinutes)
                };

                sasBuilder.SetPermissions(BlobSasPermissions.Read);

                var sasToken = sasBuilder.ToSasQueryParameters(
                    new Azure.Storage.StorageSharedKeyCredential(
                        _blobServiceClient.AccountName,
                        Environment.GetEnvironmentVariable("AZURE_STORAGE_KEY"))).ToString();

                var sasUri = $"{blobClient.Uri}?{sasToken}";

                Console.WriteLine($"SAS URI generated for '{blobName}'");
                return sasUri;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error generating SAS URI: {ex.Message}");
                throw;
            }
        }

        public async Task DeleteBlobAsync(string containerName, string blobName)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);
                var blobClient = containerClient.GetBlobClient(blobName);

                await blobClient.DeleteIfExistsAsync();
                Console.WriteLine($"Blob '{blobName}' deleted successfully");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error deleting blob: {ex.Message}");
                throw;
            }
        }

        public async Task SetBlobLifecycleAsync(string containerName)
        {
            try
            {
                var containerClient = _blobServiceClient.GetBlobContainerClient(containerName);

                var lifecycleRules = new List<BlobLifecycleRule>
                {
                    new BlobLifecycleRule
                    {
                        Name = "MoveToCool",
                        Enabled = true,
                        Definition = new BlobLifecycleRuleDefinition
                        {
                            Filters = new BlobLifecycleRuleFilter
                            {
                                PrefixMatch = new List<string> { "" }
                            },
                            Actions = new BlobLifecycleRuleActions
                            {
                                BaseBlob = new BlobLifecycleRuleBaseBlob
                                {
                                    TierToCool = new DateAfterModification
                                    {
                                        DaysAfterModificationGreaterThan = 30
                                    },
                                    TierToArchive = new DateAfterModification
                                    {
                                        DaysAfterModificationGreaterThan = 90
                                    },
                                    Delete = new DateAfterModification
                                    {
                                        DaysAfterModificationGreaterThan = 365
                                    }
                                }
                            }
                        }
                    }
                };

                // Note: Azure SDK doesn't directly support lifecycle management via API
                // This would typically be done via Azure Resource Manager or CLI
                Console.WriteLine("Lifecycle rules should be configured via Azure Portal or CLI");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error setting lifecycle: {ex.Message}");
                throw;
            }
        }

        private string GetContentType(string filePath)
        {
            var extension = Path.GetExtension(filePath).ToLowerCase();
            return extension switch
            {
                ".jpg" or ".jpeg" => "image/jpeg",
                ".png" => "image/png",
                ".gif" => "image/gif",
                ".pdf" => "application/pdf",
                ".txt" => "text/plain",
                ".json" => "application/json",
                ".html" => "text/html",
                ".css" => "text/css",
                ".js" => "application/javascript",
                _ => "application/octet-stream"
            };
        }
    }
}`}]},{title:"Infrastructure as Code and Deployment",content:`Infrastructure as Code (IaC) enables you to manage and provision cloud infrastructure using declarative configuration files. This approach provides version control, repeatability, and automated deployment capabilities.

**IaC Tools**:
- **Terraform**: Multi-cloud infrastructure provisioning
- **AWS CloudFormation**: AWS-specific infrastructure management
- **Azure Resource Manager**: Azure infrastructure templates
- **Google Cloud Deployment Manager**: GCP infrastructure management

**Benefits of IaC**:
- **Version Control**: Track infrastructure changes like code
- **Consistency**: Ensure identical environments across stages
- **Scalability**: Easily replicate and scale infrastructure
- **Collaboration**: Team members can work on infrastructure changes
- **Automation**: Integrate with CI/CD pipelines

**Deployment Strategies**:
- **Blue-Green**: Maintain two identical environments
- **Canary**: Gradually roll out changes to subset of users
- **Rolling**: Update instances incrementally
- **Immutable**: Replace entire infrastructure instead of modifying

**Configuration Management**: Use tools like Ansible, Puppet, or Chef for software configuration on provisioned infrastructure.

**State Management**: Track infrastructure state to detect drift and ensure consistency between desired and actual configurations.

**Security in IaC**: Implement least privilege, encrypt sensitive data, and use secure credential management.`,keyTopics:["Infrastructure as Code principles","IaC tools and frameworks","Deployment strategies and patterns","Configuration management","State management and drift detection"],practicalExercises:["Create infrastructure templates with Terraform for multi-cloud deployments","Implement automated deployment pipelines with CI/CD integration","Set up blue-green deployment strategy for zero-downtime updates","Configure monitoring and alerting for infrastructure changes","Implement security best practices in IaC templates","Manage infrastructure state and handle configuration drift"],codeExamples:[{title:"Terraform Multi-Cloud Infrastructure",language:"hcl",code:`# main.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    google = {
      source  = "hashicorp/google"
      version = "~> 4.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.0"
    }
  }

  backend "s3" {
    bucket = "my-terraform-state"
    key    = "infrastructure/terraform.tfstate"
    region = "us-east-1"
  }
}

# AWS Provider
provider "aws" {
  region = var.aws_region
}

# Google Cloud Provider
provider "google" {
  project = var.gcp_project
  region  = var.gcp_region
}

# Azure Provider
provider "azurerm" {
  features {}
}

# Variables
variable "aws_region" {
  description = "AWS region"
  default     = "us-east-1"
}

variable "gcp_project" {
  description = "GCP project ID"
  type        = string
}

variable "gcp_region" {
  description = "GCP region"
  default     = "us-central1"
}

variable "environment" {
  description = "Environment name"
  default     = "dev"
}

# AWS Resources
resource "aws_vpc" "main" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name        = "\${var.environment}-vpc"
    Environment = var.environment
  }
}

resource "aws_subnet" "public" {
  count             = 2
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.0.\${count.index + 1}.0/24"
  availability_zone = data.aws_availability_zones.available.names[count.index]

  tags = {
    Name        = "\${var.environment}-public-subnet-\${count.index + 1}"
    Environment = var.environment
  }
}

resource "aws_security_group" "web" {
  name_prefix = "\${var.environment}-web-sg"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name        = "\${var.environment}-web-sg"
    Environment = var.environment
  }
}

resource "aws_instance" "web" {
  count         = 2
  ami           = data.aws_ami.ubuntu.id
  instance_type = "t3.micro"
  subnet_id     = aws_subnet.public[count.index].id
  vpc_security_group_ids = [aws_security_group.web.id]

  user_data = <<-EOF
              #!/bin/bash
              apt-get update
              apt-get install -y nginx
              systemctl start nginx
              systemctl enable nginx
              EOF

  tags = {
    Name        = "\${var.environment}-web-server-\${count.index + 1}"
    Environment = var.environment
  }
}

# Google Cloud Resources
resource "google_compute_network" "vpc" {
  name                    = "\${var.environment}-vpc"
  auto_create_subnetworks = false
}

resource "google_compute_subnetwork" "subnet" {
  name          = "\${var.environment}-subnet"
  ip_cidr_range = "10.1.0.0/24"
  region        = var.gcp_region
  network       = google_compute_network.vpc.id
}

resource "google_compute_instance" "web" {
  count        = 2
  name         = "\${var.environment}-web-\${count.index + 1}"
  machine_type = "e2-micro"
  zone         = "\${var.gcp_region}-a"

  boot_disk {
    initialize_params {
      image = "debian-cloud/debian-11"
    }
  }

  network_interface {
    subnetwork = google_compute_subnetwork.subnet.id

    access_config {
      // Ephemeral public IP
    }
  }

  metadata_startup_script = <<-EOF
                            #!/bin/bash
                            apt-get update
                            apt-get install -y nginx
                            systemctl start nginx
                            systemctl enable nginx
                            EOF

  tags = ["web-server"]
}

# Azure Resources
resource "azurerm_resource_group" "main" {
  name     = "\${var.environment}-rg"
  location = "East US"
}

resource "azurerm_virtual_network" "main" {
  name                = "\${var.environment}-vnet"
  address_space       = ["10.2.0.0/16"]
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
}

resource "azurerm_subnet" "internal" {
  name                 = "internal"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.2.1.0/24"]
}

resource "azurerm_linux_virtual_machine" "web" {
  count               = 2
  name                = "\${var.environment}-web-\${count.index + 1}"
  resource_group_name = azurerm_resource_group.main.name
  location            = azurerm_resource_group.main.location
  size                = "Standard_B1s"
  admin_username      = "adminuser"

  network_interface_ids = [
    azurerm_network_interface.main[count.index].id,
  ]

  admin_ssh_key {
    username   = "adminuser"
    public_key = file("~/.ssh/id_rsa.pub")
  }

  os_disk {
    caching              = "ReadWrite"
    storage_account_type = "Standard_LRS"
  }

  source_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "18.04-LTS"
    version   = "latest"
  }

  custom_data = base64encode(<<-EOF
                #!/bin/bash
                apt-get update
                apt-get install -y nginx
                systemctl start nginx
                systemctl enable nginx
                EOF
  )
}

# Data sources
data "aws_availability_zones" "available" {
  state = "available"
}

data "aws_ami" "ubuntu" {
  most_recent = true

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }

  owners = ["099720109477"] # Canonical
}

# Outputs
output "aws_web_server_ips" {
  description = "Public IPs of AWS web servers"
  value       = aws_instance.web[*].public_ip
}

output "gcp_web_server_ips" {
  description = "Public IPs of GCP web servers"
  value       = google_compute_instance.web[*].network_interface[0].access_config[0].nat_ip
}

output "azure_web_server_ids" {
  description = "IDs of Azure web servers"
  value       = azurerm_linux_virtual_machine.web[*].id
}`},{title:"AWS CloudFormation Template",language:"yaml",code:`AWSTemplateFormatVersion: '2010-09-09'
Description: 'Multi-tier web application infrastructure'

Parameters:
  EnvironmentName:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - staging
      - prod
    Description: Environment name

  InstanceType:
    Type: String
    Default: t3.micro
    AllowedValues:
      - t3.micro
      - t3.small
      - t3.medium
    Description: EC2 instance type

  KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Name of an existing EC2 KeyPair

Resources:
  # VPC and Networking
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-vpc
        - Key: Environment
          Value: !Ref EnvironmentName

  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-igw

  VPCGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway

  PublicSubnet:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.1.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-public-subnet

  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-public-rt

  PublicRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  PublicSubnetRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet
      RouteTableId: !Ref PublicRouteTable

  # Security Groups
  WebSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Enable HTTP and SSH access
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 443
          ToPort: 443
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-web-sg

  # EC2 Instance
  WebInstance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      ImageId: ami-0c55b159cbfafe1d0  # Amazon Linux 2
      NetworkInterfaces:
        - DeviceIndex: 0
          SubnetId: !Ref PublicSubnet
          GroupSet:
            - !Ref WebSecurityGroup
          AssociatePublicIpAddress: true
      UserData:
        Fn::Base64: |
          #!/bin/bash
          yum update -y
          yum install -y httpd
          systemctl start httpd
          systemctl enable httpd
          echo "<h1>Hello from \${EnvironmentName} environment</h1>" > /var/www/html/index.html
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-web-server

  # S3 Bucket
  S3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub \${EnvironmentName}-my-app-bucket-\${AWS::AccountId}
      VersioningConfiguration:
        Status: Enabled
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      LifecycleConfiguration:
        Rules:
          - Id: MoveToIA
            Status: Enabled
            Transitions:
              - StorageClass: STANDARD_IA
                TransitionInDays: 30
              - StorageClass: GLACIER
                TransitionInDays: 90
            ExpirationInDays: 365

  # RDS Database
  DBSubnetGroup:
    Type: AWS::RDS::DBSubnetGroup
    Properties:
      DBSubnetGroupDescription: Subnet group for RDS
      SubnetIds:
        - !Ref PublicSubnet
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-db-subnet-group

  DBInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceClass: db.t3.micro
      Engine: mysql
      EngineVersion: '8.0'
      MasterUsername: admin
      MasterUserPassword: !Ref DBPassword
      AllocatedStorage: '20'
      DBSubnetGroupName: !Ref DBSubnetGroup
      VPCSecurityGroups:
        - !Ref WebSecurityGroup
      PubliclyAccessible: true
      BackupRetentionPeriod: 7
      MultiAZ: false
      Tags:
        - Key: Name
          Value: !Sub \${EnvironmentName}-database

  # CloudWatch Alarms
  HighCPUAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub \${EnvironmentName}-high-cpu
      AlarmDescription: CPU utilization is high
      MetricName: CPUUtilization
      Namespace: AWS/EC2
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 80
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: InstanceId
          Value: !Ref WebInstance

Outputs:
  WebsiteURL:
    Description: URL of the website
    Value: !Sub http://\${WebInstance.PublicIp}
    Export:
      Name: !Sub \${EnvironmentName}-website-url

  S3BucketName:
    Description: Name of the S3 bucket
    Value: !Ref S3Bucket
    Export:
      Name: !Sub \${EnvironmentName}-s3-bucket

  DatabaseEndpoint:
    Description: Database endpoint
    Value: !GetAtt DBInstance.Endpoint.Address
    Export:
      Name: !Sub \${EnvironmentName}-db-endpoint`},{title:"CI/CD Pipeline with Cloud Deployment",language:"yaml",code:`# .github/workflows/deploy.yml
name: Deploy to Cloud

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  AWS_REGION: us-east-1
  GCP_PROJECT: my-gcp-project
  AZURE_LOCATION: eastus

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build application
        run: npm run build

  deploy-aws:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: \${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: \${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: \${{ env.AWS_REGION }}

      - name: Deploy to AWS
        run: |
          # Update CloudFormation stack
          aws cloudformation deploy \\
            --template-file infrastructure/aws-template.yml \\
            --stack-name my-app-stack \\
            --parameter-overrides EnvironmentName=prod \\
            --capabilities CAPABILITY_IAM

  deploy-gcp:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v1
        with:
          credentials_json: \${{ secrets.GCP_SA_KEY }}

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v1

      - name: Deploy to GCP
        run: |
          # Deploy using gcloud
          gcloud app deploy app.yaml --quiet

  deploy-azure:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3

      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: \${{ secrets.AZURE_CREDENTIALS }}

      - name: Deploy to Azure
        uses: azure/arm-deploy@v1
        with:
          subscriptionId: \${{ secrets.AZURE_SUBSCRIPTION }}
          resourceGroupName: my-resource-group
          template: infrastructure/azure-template.json
          parameters: environment=prod`}]},{title:"Cost Optimization and Monitoring",content:`Cloud cost optimization involves monitoring usage, implementing cost controls, and using resources efficiently. Effective monitoring ensures application performance and helps identify cost-saving opportunities.

**Cost Optimization Strategies**:
- **Right-sizing**: Match instance types to actual workload requirements
- **Reserved Instances**: Commit to longer terms for significant discounts
- **Spot Instances**: Use spare capacity for non-critical workloads
- **Auto Scaling**: Automatically adjust capacity based on demand
- **Storage Optimization**: Use appropriate storage classes and lifecycle policies

**Monitoring and Observability**:
- **Metrics**: CPU, memory, disk, network utilization
- **Logs**: Application and system logs for troubleshooting
- **Traces**: Request tracing for performance analysis
- **Alerts**: Automated notifications for issues and anomalies

**Cost Monitoring Tools**:
- **AWS Cost Explorer**: Analyze and forecast costs
- **Google Cloud Billing**: Cost monitoring and budgeting
- **Azure Cost Management**: Cost analysis and optimization

**Performance Optimization**:
- **Caching**: Use CDN, in-memory caches, and database query optimization
- **Load Balancing**: Distribute traffic efficiently
- **Database Optimization**: Indexing, query optimization, and connection pooling
- **Resource Optimization**: Use serverless when appropriate

**Budgeting and Governance**: Set budgets, implement cost controls, and establish governance policies for cloud spending.`,keyTopics:["Cloud cost optimization strategies","Resource monitoring and alerting","Performance optimization techniques","Budgeting and cost governance","Cloud financial management"],practicalExercises:["Set up comprehensive monitoring and alerting for cloud applications","Implement auto-scaling policies for cost and performance optimization","Configure budget alerts and cost anomaly detection","Optimize storage costs with lifecycle policies and data tiering","Analyze and forecast cloud costs using native tools","Implement resource tagging and cost allocation strategies"],codeExamples:[{title:"AWS Cost Optimization with Lambda",language:"javascript",code:`const AWS = require('aws-sdk');

// Initialize AWS services
const ec2 = new AWS.EC2();
const cloudwatch = new AWS.CloudWatch();
const costExplorer = new AWS.CostExplorer();

class CloudCostOptimizer {
  constructor() {
    this.costExplorer = new AWS.CostExplorer();
    this.cloudwatch = new AWS.CloudWatch();
  }

  // Get cost and usage data
  async getCostAndUsage(startDate, endDate, granularity = 'DAILY') {
    try {
      const params = {
        TimePeriod: {
          Start: startDate,
          End: endDate
        },
        Granularity: granularity,
        Metrics: ['BlendedCost', 'UsageQuantity'],
        GroupBy: [
          {
            Type: 'DIMENSION',
            Key: 'SERVICE'
          }
        ]
      };

      const result = await this.costExplorer.getCostAndUsage(params).promise();

      console.log('Cost and Usage Data:');
      result.ResultsByTime.forEach(period => {
        console.log(\`Period: \${period.TimePeriod.Start} to \${period.TimePeriod.End}\`);
        period.Groups.forEach(group => {
          const service = group.Keys[0];
          const cost = group.Metrics.BlendedCost.Amount;
          const unit = group.Metrics.BlendedCost.Unit;
          console.log(\`  \${service}: $\${cost} \${unit}\`);
        });
      });

      return result;
    } catch (error) {
      console.error('Error getting cost data:', error);
      throw error;
    }
  }

  // Identify underutilized EC2 instances
  async findUnderutilizedInstances() {
    try {
      // Get all running instances
      const instances = await ec2.describeInstances({
        Filters: [
          {
            Name: 'instance-state-name',
            Values: ['running']
          }
        ]
      }).promise();

      const underutilized = [];

      for (const reservation of instances.Reservations) {
        for (const instance of reservation.Instances) {
          const instanceId = instance.InstanceId;

          // Check CPU utilization for the last 7 days
          const cpuParams = {
            Namespace: 'AWS/EC2',
            MetricName: 'CPUUtilization',
            Dimensions: [
              {
                Name: 'InstanceId',
                Value: instanceId
              }
            ],
            StartTime: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
            EndTime: new Date(),
            Statistics: ['Average'],
            Period: 3600 // 1 hour
          };

          const cpuData = await cloudwatch.getMetricStatistics(cpuParams).promise();

          if (cpuData.Datapoints.length > 0) {
            const avgCpu = cpuData.Datapoints.reduce((sum, point) => sum + point.Average, 0) / cpuData.Datapoints.length;

            if (avgCpu < 20) { // Less than 20% average CPU
              underutilized.push({
                instanceId,
                instanceType: instance.InstanceType,
                averageCpu: avgCpu.toFixed(2),
                launchTime: instance.LaunchTime
              });
            }
          }
        }
      }

      console.log('Underutilized Instances:');
      underutilized.forEach(instance => {
        console.log(\`Instance \${instance.instanceId} (\${instance.instanceType}): \${instance.averageCpu}% avg CPU\`);
      });

      return underutilized;
    } catch (error) {
      console.error('Error finding underutilized instances:', error);
      throw error;
    }
  }

  // Set up cost allocation tags
  async setupCostAllocationTags() {
    try {
      const tags = [
        {
          Key: 'Environment',
          Values: ['dev', 'staging', 'prod']
        },
        {
          Key: 'Project',
          Values: ['web-app', 'api', 'database']
        },
        {
          Key: 'Owner',
          Values: ['team-a', 'team-b', 'team-c']
        }
      ];

      // Note: Cost allocation tags are typically set via AWS Console or CLI
      // This is a conceptual example
      console.log('Cost allocation tags should be configured via AWS Console or CLI');
      console.log('Recommended tags:', JSON.stringify(tags, null, 2));

      return tags;
    } catch (error) {
      console.error('Error setting up cost allocation tags:', error);
      throw error;
    }
  }

  // Create budget and alerts
  async createBudget(budgetName, budgetAmount, emailNotifications) {
    try {
      const budgets = new AWS.Budgets();

      const params = {
        Budget: {
          BudgetName: budgetName,
          BudgetLimit: {
            Amount: budgetAmount.toString(),
            Unit: 'USD'
          },
          TimeUnit: 'MONTHLY',
          BudgetType: 'COST'
        },
        NotificationsWithSubscribers: [
          {
            Notification: {
              NotificationType: 'ACTUAL',
              ComparisonOperator: 'GREATER_THAN',
              Threshold: 80,
              ThresholdType: 'PERCENTAGE'
            },
            Subscribers: emailNotifications.map(email => ({
              SubscriptionType: 'EMAIL',
              Address: email
            }))
          }
        ]
      };

      await budgets.createBudget(params).promise();
      console.log(\`Budget '\${budgetName}' created with limit of $\${budgetAmount}\`);

      return params;
    } catch (error) {
      console.error('Error creating budget:', error);
      throw error;
    }
  }

  // Generate cost optimization recommendations
  async generateOptimizationRecommendations() {
    try {
      const recommendations = [];

      // Check for underutilized instances
      const underutilized = await this.findUnderutilizedInstances();
      if (underutilized.length > 0) {
        recommendations.push({
          type: 'UNDERUTILIZED_INSTANCES',
          description: 'Consider downsizing or stopping underutilized EC2 instances',
          instances: underutilized,
          potentialSavings: 'Up to 50% cost reduction'
        });
      }

      // Check for unattached EBS volumes
      const ebsParams = {
        Filters: [
          {
            Name: 'status',
            Values: ['available']
          }
        ]
      };

      const ebsVolumes = await new AWS.EC2().describeVolumes(ebsParams).promise();
      if (ebsVolumes.Volumes.length > 0) {
        recommendations.push({
          type: 'UNATTACHED_VOLUMES',
          description: 'Delete or attach unused EBS volumes',
          volumes: ebsVolumes.Volumes.map(v => v.VolumeId),
          potentialSavings: 'EBS storage costs'
        });
      }

      // Check for unused load balancers
      const elbParams = {
        LoadBalancerArns: []
      };

      const elbs = await new AWS.ELBv2().describeLoadBalancers(elbParams).promise();
      // Additional logic would be needed to check if ELBs are actually in use

      console.log('Optimization Recommendations:');
      recommendations.forEach((rec, index) => {
        console.log(\`\${index + 1}. \${rec.type}: \${rec.description}\`);
        console.log(\`   Potential Savings: \${rec.potentialSavings}\`);
      });

      return recommendations;
    } catch (error) {
      console.error('Error generating recommendations:', error);
      throw error;
    }
  }
}

// Usage example
async function main() {
  const optimizer = new CloudCostOptimizer();

  try {
    // Get cost data for last 30 days
    const endDate = new Date();
    const startDate = new Date(endDate.getTime() - 30 * 24 * 60 * 60 * 1000);

    await optimizer.getCostAndUsage(
      startDate.toISOString().split('T')[0],
      endDate.toISOString().split('T')[0]
    );

    // Find underutilized instances
    await optimizer.findUnderutilizedInstances();

    // Generate optimization recommendations
    await optimizer.generateOptimizationRecommendations();

    // Create a budget
    await optimizer.createBudget('monthly-budget', 1000, ['admin@example.com']);

  } catch (error) {
    console.error('Optimization process failed:', error);
  }
}

module.exports = CloudCostOptimizer;

// Uncomment to run directly
// main();`},{title:"Google Cloud Cost Monitoring",language:"python",code:`from google.cloud import billing_v1, monitoring_v3
from google.oauth2 import service_account
import datetime
import json

class GoogleCloudCostOptimizer:
    def __init__(self, project_id, credentials_path=None):
        if credentials_path:
            self.credentials = service_account.Credentials.from_service_account_file(credentials_path)
        else:
            self.credentials = None

        self.project_id = project_id
        self.billing_client = billing_v1.CloudBillingClient(credentials=self.credentials)
        self.monitoring_client = monitoring_v3.MetricServiceClient(credentials=self.credentials)

    def get_cost_data(self, start_date, end_date):
        """Get cost data for the specified period"""
        try:
            # Note: This is a simplified example
            # Actual cost data retrieval would require BigQuery integration
            print(f"Retrieving cost data from {start_date} to {end_date}")

            # In a real implementation, you would query BigQuery billing export
            # SELECT * FROM \`project.billing_dataset.gcp_billing_export\` WHERE date BETWEEN start_date AND end_date

            cost_data = {
                'total_cost': 1250.50,
                'services': {
                    'Compute Engine': 450.25,
                    'Cloud Storage': 125.75,
                    'BigQuery': 89.30,
                    'Cloud Functions': 45.20
                },
                'period': f"{start_date} to {end_date}"
            }

            print(f"Total cost: \${cost_data['total_cost']}")
            print("Cost by service:")
            for service, cost in cost_data['services'].items():
                print(f"  {service}: \${cost}")

            return cost_data

        except Exception as e:
            print(f"Error retrieving cost data: {e}")
            raise

    def monitor_resource_utilization(self, days=7):
        """Monitor resource utilization for optimization opportunities"""
        try:
            end_time = datetime.datetime.utcnow()
            start_time = end_time - datetime.timedelta(days=days)

            # CPU utilization query
            cpu_query = f"""
            fetch gce_instance
            | metric 'compute.googleapis.com/instance/cpu/utilization'
            | filter (resource.project_id == '{self.project_id}')
            | group_by 1d, [value_utilization_mean: mean(value.utilization)]
            | every 1d
            | group_by [resource.instance_name],
                [value_utilization_mean_aggregate: aggregate(value_utilization_mean)]
            """

            # Memory utilization query
            memory_query = f"""
            fetch gce_instance
            | metric 'compute.googleapis.com/instance/memory/balloon/ram_used'
            | filter (resource.project_id == '{self.project_id}')
            | group_by 1d, [value_ram_used_mean: mean(value.ram_used)]
            | every 1d
            | group_by [resource.instance_name],
                [value_ram_used_mean_aggregate: aggregate(value_ram_used_mean)]
            """

            print(f"Analyzing resource utilization for the last {days} days...")

            # In a real implementation, you would execute these queries
            # and analyze the results for optimization opportunities

            optimization_opportunities = [
                {
                    'resource': 'instance-1',
                    'type': 'UNDERUTILIZED',
                    'avg_cpu': 15.2,
                    'avg_memory': 25.8,
                    'recommendation': 'Consider downsizing to e2-micro'
                },
                {
                    'resource': 'instance-2',
                    'type': 'OVERPROVISIONED',
                    'avg_cpu': 85.5,
                    'avg_memory': 92.1,
                    'recommendation': 'Consider upgrading instance type'
                }
            ]

            print("Optimization Opportunities:")
            for opp in optimization_opportunities:
                print(f"  {opp['resource']}: {opp['recommendation']}")
                print(f"    CPU: {opp['avg_cpu']}%, Memory: {opp['avg_memory']}%")

            return optimization_opportunities

        except Exception as e:
            print(f"Error monitoring resources: {e}")
            raise

    def setup_budget_alerts(self, budget_amount, alert_thresholds=[50, 75, 90]):
        """Set up budget alerts"""
        try:
            print(f"Setting up budget alerts for \${budget_amount}")

            # In a real implementation, you would use the Cloud Billing API
            # to create budget alerts programmatically

            alerts = []
            for threshold in alert_thresholds:
                alert = {
                    'threshold': threshold,
                    'amount': budget_amount * threshold / 100,
                    'notification_channels': ['email', 'slack']
                }
                alerts.append(alert)
                print(f"  Alert at {threshold}%: \${alert['amount']}")

            return alerts

        except Exception as e:
            print(f"Error setting up budget alerts: {e}")
            raise

    def optimize_storage_costs(self):
        """Analyze and optimize storage costs"""
        try:
            print("Analyzing storage costs and optimization opportunities...")

            # In a real implementation, you would query storage usage
            # and analyze access patterns

            storage_analysis = {
                'total_storage': '500 GB',
                'monthly_cost': 45.50,
                'recommendations': [
                    {
                        'bucket': 'old-data-bucket',
                        'size': '200 GB',
                        'last_accessed': '6 months ago',
                        'recommendation': 'Move to Coldline storage',
                        'potential_savings': '$15/month'
                    },
                    {
                        'bucket': 'temp-files-bucket',
                        'size': '50 GB',
                        'recommendation': 'Implement lifecycle policy',
                        'potential_savings': '$8/month'
                    }
                ]
            }

            print(f"Total storage: {storage_analysis['total_storage']}")
            print(f"Monthly cost: \${storage_analysis['monthly_cost']}")
            print("Optimization recommendations:")
            for rec in storage_analysis['recommendations']:
                print(f"  {rec['bucket']}: {rec['recommendation']}")
                print(f"    Potential savings: {rec['potential_savings']}")

            return storage_analysis

        except Exception as e:
            print(f"Error optimizing storage costs: {e}")
            raise

    def create_cost_allocation_tags(self):
        """Set up cost allocation tags"""
        try:
            recommended_tags = {
                'environment': ['development', 'staging', 'production'],
                'team': ['frontend', 'backend', 'devops'],
                'project': ['web-app', 'mobile-app', 'api'],
                'cost-center': ['engineering', 'marketing', 'sales']
            }

            print("Recommended cost allocation tags:")
            for tag_key, tag_values in recommended_tags.items():
                print(f"  {tag_key}: {', '.join(tag_values)}")

            # In a real implementation, you would apply these tags
            # to resources using the Resource Manager API

            return recommended_tags

        except Exception as e:
            print(f"Error creating cost allocation tags: {e}")
            raise

# Usage example
def main():
    optimizer = GoogleCloudCostOptimizer('my-gcp-project', 'credentials.json')

    try:
        # Get cost data
        cost_data = optimizer.get_cost_data('2024-01-01', '2024-01-31')

        # Monitor resource utilization
        optimization_opps = optimizer.monitor_resource_utilization(days=7)

        # Set up budget alerts
        alerts = optimizer.setup_budget_alerts(1000)

        # Optimize storage costs
        storage_analysis = optimizer.optimize_storage_costs()

        # Create cost allocation tags
        tags = optimizer.create_cost_allocation_tags()

    except Exception as e:
        print(f"Cost optimization process failed: {e}")

if __name__ == '__main__':
    main()`},{title:"Azure Cost Management",language:"powershell",code:`# Azure Cost Optimization Script
param(
    [string]$SubscriptionId,
    [string]$ResourceGroupName = "cost-optimization-rg",
    [int]$BudgetAmount = 1000,
    [array]$AlertThresholds = @(50, 75, 90)
)

# Connect to Azure
Connect-AzAccount
Set-AzContext -SubscriptionId $SubscriptionId

class AzureCostOptimizer {
    [string]$SubscriptionId
    [string]$ResourceGroupName

    AzureCostOptimizer([string]$subId, [string]$rgName) {
        $this.SubscriptionId = $subId
        $this.ResourceGroupName = $rgName
    }

    [object] GetCostData([DateTime]$startDate, [DateTime]$endDate) {
        try {
            Write-Host "Retrieving cost data from $($startDate.ToString('yyyy-MM-dd')) to $($endDate.ToString('yyyy-MM-dd'))"

            $costData = Get-AzConsumptionUsageDetail -StartDate $startDate -EndDate $endDate

            $totalCost = ($costData | Measure-Object -Property PretaxCost -Sum).Sum

            $costByService = $costData | Group-Object -Property ConsumedService | ForEach-Object {
                [PSCustomObject]@{
                    Service = $_.Name
                    Cost = ($_.Group | Measure-Object -Property PretaxCost -Sum).Sum
                }
            } | Sort-Object -Property Cost -Descending

            $result = [PSCustomObject]@{
                TotalCost = $totalCost
                CostByService = $costByService
                Period = "$($startDate.ToString('yyyy-MM-dd')) to $($endDate.ToString('yyyy-MM-dd'))"
            }

            Write-Host "Total cost: $($result.TotalCost.ToString('C2'))"
            Write-Host "Cost by service:"
            $result.CostByService | ForEach-Object {
                Write-Host "  $($_.Service): $($_.Cost.ToString('C2'))"
            }

            return $result
        }
        catch {
            Write-Error "Error retrieving cost data: $($_.Exception.Message)"
            throw
        }
    }

    [array] FindUnderutilizedVMs() {
        try {
            Write-Host "Finding underutilized virtual machines..."

            $vms = Get-AzVM
            $underutilizedVMs = @()

            foreach ($vm in $vms) {
                $vmName = $vm.Name
                $resourceGroup = $vm.ResourceGroupName

                # Get CPU metrics for the last 7 days
                $cpuMetrics = Get-AzMetric -ResourceId $vm.Id -MetricName "Percentage CPU" -TimeGrain 01:00:00 -StartTime (Get-Date).AddDays(-7)

                if ($cpuMetrics.Data.Count -gt 0) {
                    $avgCpu = ($cpuMetrics.Data | Measure-Object -Property Average -Average).Average

                    if ($avgCpu -lt 20) {
                        $underutilizedVM = [PSCustomObject]@{
                            VMName = $vmName
                            ResourceGroup = $resourceGroup
                            VMSize = $vm.HardwareProfile.VmSize
                            AverageCPU = [math]::Round($avgCpu, 2)
                            Recommendation = "Consider downsizing or deallocating"
                        }
                        $underutilizedVMs += $underutilizedVM
                    }
                }
            }

            Write-Host "Underutilized VMs found: $($underutilizedVMs.Count)"
            $underutilizedVMs | ForEach-Object {
                Write-Host "  $($_.VMName) ($($_.VMSize)): $($_.AverageCPU)% avg CPU"
            }

            return $underutilizedVMs
        }
        catch {
            Write-Error "Error finding underutilized VMs: $($_.Exception.Message)"
            throw
        }
    }

    [void] CreateBudget([int]$budgetAmount, [array]$alertThresholds) {
        try {
            Write-Host "Creating budget of $($budgetAmount.ToString('C0'))"

            $budgetParams = @{
                Name = "monthly-budget"
                Amount = $budgetAmount
                Category = "Cost"
                TimeGrain = "Monthly"
                StartDate = Get-Date
                EndDate = (Get-Date).AddMonths(12)
            }

            $budget = New-AzConsumptionBudget @budgetParams

            # Create alerts
            foreach ($threshold in $alertThresholds) {
                $alertAmount = $budgetAmount * $threshold / 100

                $alertParams = @{
                    BudgetObject = $budget
                    Name = "budget-alert-$threshold-percent"
                    Threshold = $threshold
                    Operator = "GreaterThan"
                    NotificationEmail = "admin@example.com"
                    ContactGroup = "/subscriptions/$($this.SubscriptionId)/resourceGroups/$($this.ResourceGroupName)/providers/microsoft.insights/actionGroups/cost-alerts"
                }

                New-AzConsumptionBudgetAlert @alertParams
                Write-Host "  Alert created at $($threshold)% threshold: $($alertAmount.ToString('C0'))"
            }

            Write-Host "Budget and alerts created successfully"
        }
        catch {
            Write-Error "Error creating budget: $($_.Exception.Message)"
            throw
        }
    }

    [array] GenerateOptimizationRecommendations() {
        try {
            $recommendations = @()

            # Check for underutilized VMs
            $underutilizedVMs = $this.FindUnderutilizedVMs()
            if ($underutilizedVMs.Count -gt 0) {
                $recommendations += [PSCustomObject]@{
                    Type = "UNDERUTILIZED_VMS"
                    Description = "Consider downsizing or stopping underutilized VMs"
                    Resources = $underutilizedVMs
                    PotentialSavings = "Up to 50% cost reduction"
                }
            }

            # Check for unattached disks
            $unattachedDisks = Get-AzDisk | Where-Object { $_.DiskState -eq "Unattached" }
            if ($unattachedDisks.Count -gt 0) {
                $recommendations += [PSCustomObject]@{
                    Type = "UNATTACHED_DISKS"
                    Description = "Delete or attach unused managed disks"
                    Resources = $unattachedDisks.Name
                    PotentialSavings = "Disk storage costs"
                }
            }

            # Check for unused public IPs
            $unusedPublicIPs = Get-AzPublicIpAddress | Where-Object { $null -eq $_.IpConfiguration }
            if ($unusedPublicIPs.Count -gt 0) {
                $recommendations += [PSCustomObject]@{
                    Type = "UNUSED_PUBLIC_IPS"
                    Description = "Delete unused public IP addresses"
                    Resources = $unusedPublicIPs.Name
                    PotentialSavings = "Public IP costs"
                }
            }

            Write-Host "Optimization Recommendations:"
            for ($i = 0; $i -lt $recommendations.Count; $i++) {
                $rec = $recommendations[$i]
                Write-Host "$($i + 1). $($rec.Type): $($rec.Description)"
                Write-Host "   Potential Savings: $($rec.PotentialSavings)"
            }

            return $recommendations
        }
        catch {
            Write-Error "Error generating recommendations: $($_.Exception.Message)"
            throw
        }
    }

    [void] SetupCostTags() {
        try {
            $tags = @{
                "Environment" = @("Development", "Staging", "Production")
                "Team" = @("Frontend", "Backend", "DevOps")
                "Project" = @("WebApp", "MobileApp", "API")
                "CostCenter" = @("Engineering", "Marketing", "Sales")
            }

            Write-Host "Recommended cost allocation tags:"
            foreach ($tagKey in $tags.Keys) {
            Write-Host "  $tagKey\`: $($tags[$tagKey] -join ', ')"
            }

            Write-Host "Apply these tags to resources using Azure Policy or manually"
        }
        catch {
            Write-Error "Error setting up cost tags: $($_.Exception.Message)"
            throw
        }
    }
}

# Main execution
try {
    $optimizer = [AzureCostOptimizer]::new($SubscriptionId, $ResourceGroupName)

    # Get cost data for last 30 days
    $endDate = Get-Date
    $startDate = $endDate.AddDays(-30)

    $costData = $optimizer.GetCostData($startDate, $endDate)

    # Generate optimization recommendations
    $recommendations = $optimizer.GenerateOptimizationRecommendations()

    # Create budget and alerts
    $optimizer.CreateBudget($BudgetAmount, $AlertThresholds)

    # Setup cost tags
    $optimizer.SetupCostTags()

    Write-Host "Azure cost optimization completed successfully"
}
catch {
    Write-Error "Azure cost optimization failed: $($_.Exception.Message)"
    exit 1
}`}]}],projects:[{title:"Multi-Cloud Web Application",description:"Build a scalable web application deployed across AWS, GCP, and Azure with automated deployment and monitoring",technologies:["AWS","Google Cloud","Azure","Terraform","Docker","Kubernetes"],difficulty:"Advanced",estimatedHours:60,deliverables:["Infrastructure as Code for all three clouds","Multi-cloud deployment pipeline","Load balancing and auto-scaling setup","Monitoring and alerting configuration","Cost optimization and budget management","Disaster recovery and backup strategy"]},{title:"Serverless Microservices Platform",description:"Create a serverless microservices architecture using cloud functions, API Gateway, and managed databases",technologies:["AWS Lambda","Google Cloud Functions","Azure Functions","API Gateway","DynamoDB","Cloud SQL"],difficulty:"Advanced",estimatedHours:45,deliverables:["Serverless function implementations","API Gateway configuration","Database integration and optimization","Authentication and authorization","Monitoring and performance optimization","Cost analysis and optimization"]},{title:"Cloud-Native CI/CD Pipeline",description:"Implement a complete CI/CD pipeline using cloud-native services with automated testing and deployment",technologies:["GitHub Actions","AWS CodePipeline","Google Cloud Build","Azure DevOps","Docker","Kubernetes"],difficulty:"Intermediate",estimatedHours:35,deliverables:["Automated build and test pipeline","Multi-environment deployment strategy","Security scanning integration","Performance testing and monitoring","Rollback and recovery procedures","Cost monitoring and optimization"]},{title:"Cloud Cost Optimization Dashboard",description:"Build a comprehensive dashboard for monitoring and optimizing cloud costs across multiple providers",technologies:["React","Node.js","AWS Cost Explorer","Google Cloud Billing","Azure Cost Management","Chart.js"],difficulty:"Intermediate",estimatedHours:30,deliverables:["Multi-cloud cost visualization","Budget tracking and alerts","Resource utilization analysis","Cost optimization recommendations","Historical cost analysis","Automated report generation"]},{title:"Global Content Delivery Network",description:"Implement a global CDN solution with edge computing for improved performance and reduced latency",technologies:["AWS CloudFront","Google Cloud CDN","Azure CDN","Cloudflare","Edge Functions","Performance Monitoring"],difficulty:"Advanced",estimatedHours:40,deliverables:["CDN configuration and optimization","Edge computing implementation","Performance monitoring setup","Global traffic analysis","Security and DDoS protection","Cost-benefit analysis"]}],assessments:{quiz:[{question:"Which cloud service model provides the most control over infrastructure?",options:["Software as a Service (SaaS)","Platform as a Service (PaaS)","Infrastructure as a Service (IaaS)","Functions as a Service (FaaS)"],correctAnswer:2,explanation:"Infrastructure as a Service (IaaS) provides the most control over infrastructure, allowing users to manage virtual machines, storage, and networking resources."},{question:"What is the primary benefit of serverless computing?",options:["Complete control over server configuration","Automatic scaling and pay-per-use pricing","Physical server maintenance","Long-term resource commitments"],correctAnswer:1,explanation:"Serverless computing automatically scales based on demand and charges only for actual execution time, eliminating the need to manage servers."},{question:"Which tool is commonly used for Infrastructure as Code across multiple cloud providers?",options:["Docker Compose","Terraform","Kubernetes","Jenkins"],correctAnswer:1,explanation:"Terraform is a popular Infrastructure as Code tool that supports multiple cloud providers and enables declarative infrastructure management."},{question:"What is the main purpose of a Content Delivery Network (CDN)?",options:["Store large amounts of data","Process complex computations","Distribute content globally with low latency","Manage user authentication"],correctAnswer:2,explanation:"CDNs distribute content across multiple geographic locations to reduce latency and improve performance for end users."},{question:"Which storage class is typically used for frequently accessed data with the lowest latency?",options:["Archive storage","Cold storage","Standard storage","Deep archive"],correctAnswer:2,explanation:"Standard storage provides the lowest latency and highest availability for frequently accessed data."}],evaluation:[{question:"Design a cost-optimized, highly available web application architecture using cloud services. Include considerations for scalability, security, and disaster recovery.",rubric:["Appropriate service selection for cost optimization","High availability and fault tolerance implementation","Security best practices and compliance","Scalability and performance considerations","Disaster recovery and backup strategy","Monitoring and cost management"]},{question:"Compare serverless functions across AWS Lambda, Google Cloud Functions, and Azure Functions. Discuss use cases, limitations, and cost implications for each platform.",rubric:["Accurate comparison of features and capabilities","Appropriate use case identification","Limitation analysis and workarounds","Cost structure understanding","Performance and scaling considerations","Vendor lock-in assessment"]}]},aiPrompts:["How do I choose between AWS, GCP, and Azure for my project?","What's the best way to optimize cloud costs?","How can I implement multi-cloud architecture?","What's the difference between serverless and containers?","How do I set up monitoring and alerting in the cloud?","What's Infrastructure as Code and why is it important?","How can I implement disaster recovery in the cloud?","What's the best storage solution for my use case?","How do I secure my cloud applications?","What's the difference between CDN and edge computing?","How can I implement auto-scaling in the cloud?","What's the best way to manage cloud resources?"],resources:[{title:"AWS Documentation",type:"Official Documentation",url:"https://docs.aws.amazon.com/",description:"Comprehensive AWS service documentation and guides"},{title:"Google Cloud Documentation",type:"Official Documentation",url:"https://cloud.google.com/docs",description:"Google Cloud Platform documentation and tutorials"},{title:"Microsoft Azure Documentation",type:"Official Documentation",url:"https://docs.microsoft.com/en-us/azure/",description:"Azure cloud services documentation"},{title:"Terraform Documentation",type:"Official Documentation",url:"https://www.terraform.io/docs/",description:"Infrastructure as Code with Terraform"},{title:"Cloud Cost Optimization Guide",type:"Guide",url:"https://cloud.google.com/docs/cost-optimization",description:"Best practices for optimizing cloud costs"}],toolsRequired:[{name:"AWS CLI",description:"Command-line interface for AWS services",installation:"Download from aws.amazon.com/cli",purpose:"Manage AWS resources from command line"},{name:"Google Cloud SDK",description:"Command-line tools for Google Cloud Platform",installation:"Install from cloud.google.com/sdk",purpose:"Manage GCP resources and deployments"},{name:"Azure CLI",description:"Command-line interface for Azure services",installation:"Install from docs.microsoft.com/en-us/cli/azure/",purpose:"Manage Azure resources from command line"},{name:"Terraform",description:"Infrastructure as Code tool for multi-cloud deployments",installation:"Download from terraform.io/downloads",purpose:"Provision and manage cloud infrastructure"},{name:"Cloud Cost Management Tools",description:"Tools for monitoring and optimizing cloud costs",installation:"Use native cloud provider tools or third-party solutions",purpose:"Track and optimize cloud spending"}],bestPractices:["Use Infrastructure as Code for consistent deployments","Implement proper security groups and network segmentation","Enable monitoring and alerting for all critical resources","Use managed services to reduce operational overhead","Implement backup and disaster recovery strategies","Tag resources for cost allocation and management","Use auto-scaling to match capacity with demand","Implement least privilege access controls","Regularly review and optimize resource utilization","Use CDN for global content distribution","Implement proper logging and audit trails","Regularly update and patch systems and applications"],commonPitfalls:["Not monitoring costs leading to unexpected bills","Using single cloud provider causing vendor lock-in","Not implementing proper backup and recovery","Over-provisioning resources leading to wasted costs","Not securing cloud resources properly","Not tagging resources for cost tracking","Ignoring serverless cold start performance","Not implementing proper logging and monitoring","Using development configurations in production","Not planning for data transfer costs","Ignoring compliance and regulatory requirements","Not implementing proper access controls"],careerRelevance:["Cloud expertise is essential for modern software development roles","Multi-cloud skills are highly valued by employers","Cloud architecture knowledge supports senior developer positions","Cost optimization skills are valuable for technical leadership roles","Infrastructure as Code proficiency supports DevOps career paths","Serverless expertise enables modern application development","Cloud security knowledge is critical for enterprise environments","Monitoring and observability skills support SRE roles","Global infrastructure design supports international companies","Cloud migration expertise is in high demand","Cost management skills support business-focused technical roles","Multi-cloud orchestration supports complex enterprise architectures"]},MM={id:"cicd",tier:4,name:"CI/CD",description:"Continuous Integration and Continuous Deployment (CI/CD) is a methodology that automates the process of integrating code changes, running tests, and deploying applications to production environments. CI/CD pipelines ensure code quality, reduce manual errors, and enable rapid, reliable software delivery through automated workflows that integrate development, testing, and deployment processes.",difficulty:"advanced",estimatedHours:25,prerequisites:["git","docker","testing"],learningObjectives:["Design and implement comprehensive CI/CD pipelines using GitHub Actions and GitLab CI","Configure automated testing integration within CI/CD workflows","Implement various deployment strategies including blue-green and canary deployments","Set up multi-environment deployment pipelines (development, staging, production)","Integrate security scanning and vulnerability assessments into CI/CD pipelines","Manage artifacts, versioning, and release management in CI/CD processes","Monitor and troubleshoot CI/CD pipeline failures and performance issues","Implement infrastructure as code deployment using CI/CD tools","Configure automated rollback procedures and failure recovery mechanisms","Optimize CI/CD pipeline performance and reduce build times","Integrate third-party tools and services into CI/CD workflows","Implement compliance and audit trails in CI/CD processes"],sections:[{title:"CI/CD Fundamentals and Pipeline Design",content:`Continuous Integration and Continuous Deployment (CI/CD) represents a fundamental shift in software development practices, moving from manual, error-prone deployment processes to automated, reliable delivery pipelines. CI/CD pipelines automate the entire software delivery lifecycle, from code integration through testing, building, and deployment to production environments.

**Core CI/CD Concepts**:
- **Continuous Integration (CI)**: Automatically building and testing code changes as they are committed
- **Continuous Deployment (CD)**: Automatically deploying tested code to production environments
- **Continuous Delivery**: Ensuring code is always in a deployable state with manual approval gates
- **Pipeline Orchestration**: Coordinating complex workflows across multiple stages and environments

**Pipeline Architecture**:
Modern CI/CD pipelines follow a structured approach with distinct stages that ensure quality and reliability. Each stage serves a specific purpose in the delivery process, from initial code validation through final production deployment. The pipeline acts as a quality gate, preventing problematic code from progressing to later stages.

**Key Pipeline Components**:
- **Triggers**: Events that initiate pipeline execution (push, pull request, schedule)
- **Stages**: Logical groupings of related jobs (build, test, deploy)
- **Jobs**: Individual units of work within a stage
- **Steps**: Specific actions within a job (run command, use action, deploy)
- **Artifacts**: Build outputs that can be passed between jobs or stored
- **Environments**: Target deployment locations with specific configurations

**Pipeline Design Principles**:
Effective CI/CD pipelines follow several key design principles that ensure reliability, maintainability, and scalability. These principles guide the creation of robust automation workflows that can handle complex deployment scenarios while maintaining code quality and system stability.`,keyTopics:["CI/CD pipeline architecture and components","Continuous Integration vs Continuous Deployment","Pipeline triggers and event-driven automation","Stage-based workflow design","Artifact management and versioning"],practicalExercises:["Design a basic CI/CD pipeline for a Node.js application with build and test stages","Create a multi-stage pipeline with separate environments for development and production","Implement automated triggers for different types of code changes (feature branches, main branch)","Configure artifact storage and retrieval between pipeline stages","Set up pipeline notifications and status reporting"],codeExamples:[{title:"Basic GitHub Actions Pipeline",language:"yaml",code:`name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: \${{ matrix.node-version }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linting
        run: npm run lint

      - name: Run tests
        run: npm test -- --coverage

      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  build:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-files
          path: dist/
          retention-days: 30`},{title:"GitLab CI Pipeline Configuration",language:"yaml",code:`stages:
  - test
  - build
  - deploy

variables:
  DOCKER_IMAGE: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

cache:
  paths:
    - node_modules/
    - .npm/

test:
  stage: test
  image: node:18-alpine
  before_script:
    - npm ci --cache .npm --prefer-offline
  script:
    - npm run lint
    - npm test -- --coverage
  coverage: '/All files[^|]*\\|([^|]*)\\|[^|]*\\|[^|]*$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml
    expire_in: 1 week

build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build -t $DOCKER_IMAGE .
    - docker push $DOCKER_IMAGE
  only:
    - main
    - develop

deploy_staging:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan -H $STAGING_HOST >> ~/.ssh/known_hosts
  script:
    - ssh $STAGING_USER@$STAGING_HOST "docker pull $DOCKER_IMAGE"
    - ssh $STAGING_USER@$STAGING_HOST "docker-compose up -d"
  environment:
    name: staging
    url: https://staging.example.com
  only:
    - develop

deploy_production:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan -H $PRODUCTION_HOST >> ~/.ssh/known_hosts
  script:
    - ssh $PRODUCTION_USER@$PRODUCTION_HOST "docker pull $DOCKER_IMAGE"
    - ssh $PRODUCTION_USER@$PRODUCTION_HOST "docker-compose up -d"
  environment:
    name: production
    url: https://example.com
  when: manual
  only:
    - main`}]},{title:"Automated Testing Integration",content:`Automated testing is the cornerstone of effective CI/CD pipelines, ensuring that code changes don't introduce regressions or break existing functionality. CI/CD platforms provide seamless integration with various testing frameworks and tools, enabling comprehensive test automation across different levels.

**Testing Pyramid in CI/CD**:
The testing pyramid represents different levels of testing that should be integrated into CI/CD pipelines. Each level serves a specific purpose in ensuring code quality and preventing issues from reaching production.

**Unit Testing Integration**:
Unit tests are the foundation of the testing pyramid, providing fast feedback on individual code components. CI/CD pipelines can run unit tests on every commit, ensuring that basic functionality remains intact.

**Integration Testing**:
Integration tests verify that different components work together correctly. These tests are crucial for microservices architectures and complex applications with multiple interacting parts.

**End-to-End Testing**:
E2E tests simulate real user scenarios, testing the entire application from the user's perspective. While slower to execute, they provide confidence that the application works as expected in production-like environments.

**Test Automation Best Practices**:
- **Parallel Execution**: Run tests in parallel to reduce pipeline execution time
- **Test Selection**: Run only relevant tests based on code changes
- **Flaky Test Management**: Identify and fix unreliable tests
- **Test Data Management**: Use appropriate test data for different environments
- **Test Reporting**: Generate comprehensive test reports and coverage metrics

**Performance Testing Integration**:
Performance tests ensure that applications meet performance requirements under various load conditions. CI/CD pipelines can include automated performance testing to catch performance regressions early.

**Security Testing Integration**:
Security testing should be integrated into CI/CD pipelines to identify vulnerabilities early in the development process. Automated security scans can check for common vulnerabilities and ensure compliance with security standards.`,keyTopics:["Testing pyramid and test automation strategies","Unit testing integration in CI/CD pipelines","Integration and end-to-end testing automation","Test parallelization and optimization","Performance and security testing in CI/CD"],practicalExercises:["Integrate Jest unit tests into a GitHub Actions pipeline with coverage reporting","Set up Cypress end-to-end tests in a CI/CD pipeline with video recording","Configure parallel test execution to reduce pipeline run time","Implement test result reporting and notifications in CI/CD","Set up automated performance testing using Lighthouse CI"],codeExamples:[{title:"Jest Testing with GitHub Actions",language:"yaml",code:`name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: \${{ matrix.node-version }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run unit tests
        run: npm test -- --coverage --watchAll=false

      - name: Run integration tests
        run: npm run test:integration

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella
          fail_ci_if_error: false

  e2e:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Run E2E tests
        uses: cypress-io/github-action@v5
        with:
          build: npm run build
          start: npm start
          wait-on: 'http://localhost:3000'
          record: true
        env:
          CYPRESS_RECORD_KEY: \${{ secrets.CYPRESS_RECORD_KEY }}

      - name: Upload E2E screenshots
        uses: actions/upload-artifact@v3
        if: failure()
        with:
          name: cypress-screenshots
          path: cypress/screenshots/
          retention-days: 7`},{title:"Performance Testing with Lighthouse",language:"yaml",code:`name: Performance Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lighthouse:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Start application
        run: npm start &
        env:
          PORT: 3000

      - name: Wait for app to be ready
        run: |
          timeout 60 bash -c 'until curl -f http://localhost:3000 > /dev/null 2>&1; do sleep 1; done'

      - name: Run Lighthouse audit
        uses: treosh/lighthouse-ci-action@v10
        with:
          urls: http://localhost:3000
          configPath: .lighthouserc.json
          uploadArtifacts: true
          temporaryPublicStorage: true

      - name: Stop application
        run: pkill -f "npm start"

  load-test:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Start application
        run: npm start &
        env:
          PORT: 3000

      - name: Wait for app to be ready
        run: |
          timeout 60 bash -c 'until curl -f http://localhost:3000 > /dev/null 2>&1; do sleep 1; done'

      - name: Run load test
        uses: artilleryio/action-cli@v1
        with:
          command: run --output report.json artillery-config.yml

      - name: Upload load test results
        uses: actions/upload-artifact@v3
        with:
          name: load-test-report
          path: report.json
          retention-days: 30

      - name: Stop application
        run: pkill -f "npm start"`}]},{title:"Deployment Strategies and Environments",content:`Deployment strategies determine how new versions of applications are rolled out to production environments while minimizing risk and ensuring high availability. CI/CD pipelines support various deployment patterns that can be automated and orchestrated to meet different business requirements.

**Blue-Green Deployment**:
Blue-green deployment involves maintaining two identical production environments. One environment (blue) serves live traffic while the other (green) is updated with the new version. Once testing is complete, traffic is switched from blue to green, providing zero-downtime deployments.

**Canary Deployment**:
Canary deployments gradually roll out new versions to a small subset of users before full deployment. This approach allows for testing in production with real traffic while minimizing the impact of potential issues.

**Rolling Deployment**:
Rolling deployments update instances incrementally, replacing old versions with new ones in small batches. This strategy provides a balance between speed and safety, allowing for gradual rollout with the ability to rollback if issues are detected.

**Feature Flags**:
Feature flags (or feature toggles) allow enabling or disabling features without deploying new code. This approach enables dark launches, A/B testing, and gradual feature rollouts independent of deployment schedules.

**Environment Management**:
Multi-environment setups are crucial for maintaining code quality throughout the development lifecycle. Each environment serves a specific purpose and has different configurations and access controls.

**Database Deployment Strategies**:
Database changes require special consideration in deployment strategies. Techniques like database migrations, schema versioning, and backward compatibility ensure safe database updates.

**Rollback Procedures**:
Automated rollback procedures are essential for quickly recovering from failed deployments. CI/CD pipelines should include rollback strategies that can be triggered automatically or manually when issues are detected.`,keyTopics:["Blue-green and canary deployment strategies","Rolling deployments and feature flags","Multi-environment management","Database deployment and migration strategies","Automated rollback procedures"],practicalExercises:["Implement blue-green deployment using Kubernetes and CI/CD","Set up canary deployment with traffic splitting using service mesh","Configure rolling deployment strategy with health checks","Implement feature flags for gradual feature rollouts","Create automated rollback procedures for failed deployments"],codeExamples:[{title:"Blue-Green Deployment with Kubernetes",language:"yaml",code:`# Blue-Green Deployment Pipeline
name: Blue-Green Deployment

on:
  push:
    branches: [ main ]

env:
  BLUE_ENV: production-blue
  GREEN_ENV: production-green

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'v1.28.0'

      - name: Configure kubectl
        run: |
          echo "\${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
          export KUBECONFIG=kubeconfig

      - name: Determine target environment
        id: target
        run: |
          # Check which environment is currently active
          BLUE_STATUS=$(kubectl get deployment myapp-blue -n default -o jsonpath='{.status.availableReplicas}' 2>/dev/null || echo "0")
          GREEN_STATUS=$(kubectl get deployment myapp-green -n default -o jsonpath='{.status.availableReplicas}' 2>/dev/null || echo "0")

          if [ "$BLUE_STATUS" -gt 0 ] && [ "$GREEN_STATUS" -eq 0 ]; then
            echo "target=green" >> $GITHUB_OUTPUT
            echo "source=blue" >> $GITHUB_OUTPUT
          elif [ "$GREEN_STATUS" -gt 0 ] && [ "$BLUE_STATUS" -eq 0 ]; then
            echo "target=blue" >> $GITHUB_OUTPUT
            echo "source=green" >> $GITHUB_OUTPUT
          else
            echo "target=blue" >> $GITHUB_OUTPUT
            echo "source=green" >> $GITHUB_OUTPUT
          fi

      - name: Deploy to target environment
        run: |
          TARGET_ENV=\${{ steps.target.outputs.target }}
          SOURCE_ENV=\${{ steps.target.outputs.source }}

          echo "Deploying to $TARGET_ENV environment"

          # Update deployment with new image
          kubectl set image deployment/myapp-$TARGET_ENV app=myapp:\${{ github.sha }} -n default

          # Wait for deployment to be ready
          kubectl rollout status deployment/myapp-$TARGET_ENV -n default --timeout=300s

      - name: Run smoke tests
        run: |
          TARGET_ENV=\${{ steps.target.outputs.target }}
          echo "Running smoke tests on $TARGET_ENV environment"

          # Wait for service to be ready
          kubectl wait --for=condition=available --timeout=300s deployment/myapp-$TARGET_ENV -n default

          # Get service URL
          SERVICE_IP=$(kubectl get svc myapp -n default -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

          # Run smoke tests
          curl -f http://$SERVICE_IP/health || exit 1

      - name: Switch traffic (manual approval)
        if: success()
        run: |
          TARGET_ENV=\${{ steps.target.outputs.target }}
          SOURCE_ENV=\${{ steps.target.outputs.source }}

          echo "Switching traffic to $TARGET_ENV environment"

          # Update service selector to point to new deployment
          kubectl patch svc myapp -n default -p "{\\"spec\\": {\\"selector\\": {\\"app\\": \\"myapp\\", \\"version\\": \\"$TARGET_ENV\\"}}}"
        environment:
          name: production
          url: https://myapp.example.com

      - name: Cleanup old deployment
        if: success()
        run: |
          SOURCE_ENV=\${{ steps.target.outputs.source }}
          echo "Cleaning up $SOURCE_ENV environment"

          # Scale down old deployment
          kubectl scale deployment myapp-$SOURCE_ENV --replicas=0 -n default`},{title:"Canary Deployment with Istio",language:"yaml",code:`# Canary Deployment with Istio
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp-canary
spec:
  http:
  - route:
    - destination:
        host: myapp
        subset: v1
      weight: 90
    - destination:
        host: myapp
        subset: v2
      weight: 10
---
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: myapp-canary
spec:
  host: myapp
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
---
# GitHub Actions Pipeline for Canary Deployment
name: Canary Deployment

on:
  push:
    branches: [ main ]

jobs:
  canary-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'v1.28.0'

      - name: Configure kubectl
        run: |
          echo "\${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
          export KUBECONFIG=kubeconfig

      - name: Deploy canary version
        run: |
          # Deploy new version with canary label
          kubectl apply -f k8s/canary-deployment.yml

          # Update image
          kubectl set image deployment/myapp-canary app=myapp:\${{ github.sha }} -n default

          # Wait for deployment
          kubectl rollout status deployment/myapp-canary -n default --timeout=300s

      - name: Update Istio VirtualService
        run: |
          # Gradually increase traffic to canary (10% -> 25% -> 50% -> 100%)
          kubectl apply -f k8s/virtualservice-25.yml
          sleep 300  # Wait 5 minutes for monitoring

          kubectl apply -f k8s/virtualservice-50.yml
          sleep 300  # Wait 5 minutes for monitoring

          kubectl apply -f k8s/virtualservice-100.yml

      - name: Monitor canary deployment
        run: |
          # Check error rates, latency, etc.
          # This would integrate with monitoring tools
          echo "Monitoring canary deployment..."

          # If metrics are good, proceed
          # If issues detected, rollback automatically

      - name: Promote or rollback
        run: |
          # Based on monitoring results, either:
          # 1. Promote canary to stable (update stable deployment)
          # 2. Rollback canary (scale down and redirect traffic)

          if [ "\${{ steps.monitor.outputs.status }}" = "healthy" ]; then
            echo "Promoting canary to stable"
            kubectl set image deployment/myapp-stable app=myapp:\${{ github.sha }} -n default
            kubectl scale deployment/myapp-canary --replicas=0 -n default
          else
            echo "Rolling back canary deployment"
            kubectl scale deployment/myapp-canary --replicas=0 -n default
            kubectl apply -f k8s/virtualservice-stable.yml
          fi`}]},{title:"Security Scanning and Compliance",content:`Security scanning and compliance integration in CI/CD pipelines is essential for maintaining secure software delivery practices. Automated security checks help identify vulnerabilities early in the development process, reducing the risk of security incidents in production.

**Static Application Security Testing (SAST)**:
SAST analyzes source code to identify security vulnerabilities without executing the code. It can detect issues like SQL injection, cross-site scripting (XSS), and other common security flaws.

**Dynamic Application Security Testing (DAST)**:
DAST tests running applications by simulating attacks and analyzing responses. It identifies runtime vulnerabilities that SAST might miss, such as authentication bypasses and session management issues.

**Software Composition Analysis (SCA)**:
SCA scans third-party dependencies for known vulnerabilities. With the proliferation of open-source components, SCA is crucial for maintaining secure software supply chains.

**Container Security Scanning**:
Container images should be scanned for vulnerabilities before deployment. This includes checking base images, installed packages, and application dependencies for known security issues.

**Infrastructure as Code Security**:
IaC templates and configurations should be scanned for security misconfigurations. Tools like Checkov and Terrascan can identify insecure configurations in Terraform, CloudFormation, and Kubernetes manifests.

**Secrets Management**:
Automated detection of hardcoded secrets, API keys, and other sensitive information prevents accidental exposure of credentials in source code.

**Compliance Automation**:
CI/CD pipelines can automate compliance checks for industry standards like PCI-DSS, HIPAA, and SOC 2. Automated compliance testing ensures that deployments meet regulatory requirements.

**Security Gate Implementation**:
Security gates prevent insecure code from progressing through the pipeline. Failed security checks can block deployments or require manual approval for exceptions.`,keyTopics:["SAST, DAST, and SCA integration in CI/CD","Container and IaC security scanning","Secrets detection and management","Compliance automation and security gates","Vulnerability management workflows"],practicalExercises:["Integrate SAST scanning using SonarQube in CI/CD pipeline","Set up dependency vulnerability scanning with OWASP Dependency-Check","Configure container image scanning with Trivy or Clair","Implement secrets detection using GitLeaks","Create security gates that block deployments on high-severity findings"],codeExamples:[{title:"Security Scanning Pipeline",language:"yaml",code:`name: Security Scan

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          format: 'sarif'
          output: 'trivy-results.sarif'

      - name: Upload Trivy scan results to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'trivy-results.sarif'

      - name: Run OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: 'MyApp'
          path: '.'
          format: 'ALL'
          args: >
            --enableRetired
            --enableExperimental
            --nvdValidForHours 24

      - name: Upload Dependency Check results
        uses: actions/upload-artifact@v3
        with:
          name: dependency-check-report
          path: reports/

      - name: Run GitLeaks secrets scan
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
          GITLEAKS_CONFIG: .gitleaks.toml

      - name: Run Snyk security scan
        uses: snyk/actions/node@master
        continue-on-error: true
        env:
          SNYK_TOKEN: \${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

      - name: Run CodeQL Analysis
        uses: github/codeql-action/init@v2
        with:
          languages: javascript

      - name: Autobuild
        uses: github/codeql-action/autobuild@v2

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2

  container-scan:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build Docker image
        run: docker build -t myapp:\${{ github.sha }} .

      - name: Scan Docker image
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'image'
          scan-ref: 'myapp:\${{ github.sha }}'
          format: 'sarif'
          output: 'trivy-image-results.sarif'

      - name: Upload image scan results
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'trivy-image-results.sarif'

      - name: Check for critical vulnerabilities
        run: |
          CRITICAL_VULNS=$(cat trivy-image-results.sarif | jq '.runs[0].results | length')
          if [ "$CRITICAL_VULNS" -gt 0 ]; then
            echo "Critical vulnerabilities found! Failing build."
            exit 1
          fi

  compliance-check:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Open Policy Agent (OPA) checks
        uses: open-policy-agent/setup-opa@v2
        with:
          version: latest

      - name: Check Kubernetes manifests
        run: |
          opa eval --data policy.rego --input k8s/ --format pretty data

      - name: Run license compliance check
        uses: licensee/licensee-action@v2
        with:
          path: '.'
          threshold: 80`},{title:"Infrastructure Security Scanning",language:"yaml",code:`# Infrastructure Security with Checkov
name: Infrastructure Security

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  terraform-security:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: '1.5.0'

      - name: Terraform Format
        run: terraform fmt -check
        continue-on-error: true

      - name: Terraform Validate
        run: terraform validate

      - name: Checkov Security Scan
        uses: bridgecrewio/checkov-action@v12
        with:
          directory: infrastructure/
          framework: terraform
          output_format: cli
          output_file_path: checkov-results.txt

      - name: Upload Checkov results
        uses: actions/upload-artifact@v3
        with:
          name: checkov-results
          path: checkov-results.txt
          retention-days: 30

      - name: Fail on high severity issues
        run: |
          if grep -q "FAILED" checkov-results.txt; then
            echo "Security issues found in infrastructure code"
            cat checkov-results.txt
            exit 1
          fi

  kubernetes-security:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup kubectl
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: '1.5.0'

      - name: KubeSec Security Scan
        uses: controlplaneio/kubesec-action@v1.1.0
        with:
          path: k8s/
          format: text
          exit-zero: false

      - name: Trivy Kubernetes Scan
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'config'
          scan-ref: 'k8s/'
          format: 'sarif'
          output: 'trivy-k8s-results.sarif'

      - name: Upload K8s security results
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'trivy-k8s-results.sarif'

  secrets-detection:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run GitLeaks
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}

      - name: Run TruffleHog
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: main
          head: HEAD
          extra_args: --debug --only-verified

      - name: Check for exposed secrets
        run: |
          if [ -f gitleaks-report.json ]; then
            SECRET_COUNT=$(jq '.[] | length' gitleaks-report.json 2>/dev/null || echo "0")
            if [ "$SECRET_COUNT" -gt 0 ]; then
              echo "Secrets detected in code! Failing build."
              cat gitleaks-report.json
              exit 1
            fi
          fi`}]},{title:"Artifact Management and Release Automation",content:`Artifact management and release automation are critical components of mature CI/CD pipelines. Effective artifact management ensures that build outputs are properly versioned, stored, and distributed across different environments.

**Artifact Types and Management**:
Artifacts are the outputs of build processes that need to be preserved and distributed. This includes compiled binaries, Docker images, documentation, and test reports.

**Semantic Versioning**:
Semantic versioning (semver) provides a standardized way to version software releases. Following semver conventions helps users understand the nature of changes in each release.

**Release Automation**:
Automated release processes ensure consistent and reliable software releases. This includes creating release branches, tagging commits, generating release notes, and publishing artifacts.

**Package Registries**:
Package registries provide centralized storage for artifacts and dependencies. Popular registries include npm, PyPI, Docker Hub, and Artifactory.

**Release Channels**:
Release channels allow different versions of software to be distributed to different user groups. Common channels include stable, beta, alpha, and nightly builds.

**Automated Changelog Generation**:
Automated changelog generation creates release notes from commit messages and pull request descriptions. Tools like conventional-changelog automate this process.

**Release Promotion**:
Release promotion moves artifacts through different environments automatically. This ensures that tested and approved versions progress from development to production.

**Artifact Signing and Verification**:
Digital signatures ensure the authenticity and integrity of released artifacts. This prevents tampering and provides trust in distributed software.`,keyTopics:["Artifact versioning and semantic versioning","Package registries and artifact storage","Automated release processes and changelogs","Release channels and promotion strategies","Artifact signing and verification"],practicalExercises:["Set up automated semantic versioning using git tags and GitHub releases","Configure artifact publishing to package registries (npm, Docker Hub)","Implement automated changelog generation from conventional commits","Create release promotion workflows between environments","Set up artifact signing and verification for secure releases"],codeExamples:[{title:"Automated Release Pipeline",language:"yaml",code:`name: Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build application
        run: npm run build

      - name: Generate changelog
        id: changelog
        run: |
          # Get the latest tag
          LATEST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
          echo "latest_tag=$LATEST_TAG" >> $GITHUB_OUTPUT

          # Generate changelog using conventional-changelog
          npx conventional-changelog -p angular -i CHANGELOG.md -s -r 0
          echo "changelog<<EOF" >> $GITHUB_OUTPUT
          cat CHANGELOG.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Create GitHub release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: \${{ github.ref_name }}
          release_name: Release \${{ github.ref_name }}
          body: \${{ steps.changelog.outputs.changelog }}
          draft: false
          prerelease: false

      - name: Build and push Docker image
        run: |
          # Build Docker image
          docker build -t myapp:\${{ github.ref_name }} .
          docker tag myapp:\${{ github.ref_name }} myapp:latest

          # Login to Docker Hub
          echo "\${{ secrets.DOCKER_PASSWORD }}" | docker login -u "\${{ secrets.DOCKER_USERNAME }}" --password-stdin

          # Push images
          docker push myapp:\${{ github.ref_name }}
          docker push myapp:latest

      - name: Publish to npm
        run: |
          # Update package version
          npm version \${{ github.ref_name }} --no-git-tag-version

          # Publish to npm
          npm publish
        env:
          NODE_AUTH_TOKEN: \${{ secrets.NPM_TOKEN }}

      - name: Deploy to production
        run: |
          # Deploy to production environment
          echo "Deploying \${{ github.ref_name }} to production"

          # Add deployment commands here
          # kubectl set image deployment/myapp app=myapp:\${{ github.ref_name }}

      - name: Notify stakeholders
        uses: 8398a7/action-slack@v3
        with:
          status: success
          text: "New release \${{ github.ref_name }} has been deployed to production!"
        env:
          SLACK_WEBHOOK_URL: \${{ secrets.SLACK_WEBHOOK_URL }}
        if: success()`},{title:"Semantic Versioning Automation",language:"yaml",code:`# Semantic Versioning with GitHub Actions
name: Semantic Release

on:
  push:
    branches: [ main ]

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: \${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build application
        run: npm run build

      - name: Semantic Release
        uses: cycjimmy/semantic-release-action@v3
        with:
          semantic_version: 19.0.5
          extra_plugins: |
            @semantic-release/changelog
            @semantic-release/git
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: \${{ secrets.NPM_TOKEN }}

  publish-artifacts:
    needs: release
    runs-on: ubuntu-latest
    if: needs.release.outputs.new_release_published == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download release assets
        uses: actions/download-artifact@v3
        with:
          name: release-assets

      - name: Publish to Artifactory
        run: |
          # Publish artifacts to Artifactory or other repository
          echo "Publishing artifacts to Artifactory"

      - name: Update documentation
        run: |
          # Update version in documentation
          sed -i "s/version:.*/version: \${{ needs.release.outputs.new_release_version }}/g" docs/config.yml

          # Commit documentation changes
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/
          git commit -m "docs: update version to \${{ needs.release.outputs.new_release_version }}" || true
          git push

      - name: Create deployment manifest
        run: |
          # Create deployment manifest for CD systems
          cat > deployment.yml << EOF
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: myapp
            labels:
              app: myapp
              version: \${{ needs.release.outputs.new_release_version }}
          spec:
            replicas: 3
            selector:
              matchLabels:
                app: myapp
            template:
              metadata:
                labels:
                  app: myapp
                  version: \${{ needs.release.outputs.new_release_version }}
              spec:
                containers:
                - name: myapp
                  image: myapp:\${{ needs.release.outputs.new_release_version }}
                  ports:
                  - containerPort: 3000
          EOF

      - name: Upload deployment manifest
        uses: actions/upload-artifact@v3
        with:
          name: deployment-manifest
          path: deployment.yml
          retention-days: 30`}]}],projects:[{title:"Complete CI/CD Pipeline for Microservices",description:"Build a comprehensive CI/CD pipeline for a microservices architecture with automated testing, security scanning, and multi-environment deployment",technologies:["GitHub Actions","Docker","Kubernetes","Jenkins","ArgoCD","Prometheus"],difficulty:"advanced",estimatedHours:50,deliverables:["Multi-stage CI/CD pipeline with automated testing","Security scanning integration (SAST, DAST, SCA)","Container orchestration with Kubernetes","GitOps deployment with ArgoCD","Monitoring and alerting setup","Rollback and disaster recovery procedures","Documentation and runbooks"]},{title:"Automated Release Management System",description:"Create an automated release management system with semantic versioning, changelog generation, and multi-channel distribution",technologies:["GitHub Actions","Semantic Release","Docker","Artifactory","Conventional Commits"],difficulty:"intermediate",estimatedHours:35,deliverables:["Automated semantic versioning system","Conventional commit integration","Automated changelog generation","Multi-channel release distribution","Artifact management and storage","Release promotion workflows","Integration with package registries"]},{title:"Security-First CI/CD Pipeline",description:"Implement a security-focused CI/CD pipeline with comprehensive scanning, compliance checks, and automated remediation",technologies:["GitHub Actions","SonarQube","OWASP ZAP","Trivy","Checkov","GitLeaks"],difficulty:"advanced",estimatedHours:40,deliverables:["Complete security scanning suite integration","Automated vulnerability management","Compliance automation and reporting","Security gates and approval workflows","Secrets detection and management","Security monitoring and alerting","Remediation automation and workflows"]},{title:"Multi-Cloud Deployment Pipeline",description:"Build a CI/CD pipeline that deploys applications across multiple cloud providers with automated failover and cost optimization",technologies:["GitHub Actions","Terraform","AWS","Google Cloud","Azure","Kubernetes"],difficulty:"advanced",estimatedHours:45,deliverables:["Multi-cloud infrastructure provisioning","Automated deployment across cloud providers","Load balancing and traffic management","Automated failover and disaster recovery","Cost monitoring and optimization","Multi-region deployment strategy","Cloud-agnostic application architecture"]},{title:"CI/CD Pipeline Optimization Framework",description:"Create a framework for optimizing CI/CD pipeline performance, reliability, and developer experience",technologies:["GitHub Actions","Docker","Kubernetes","Prometheus","Grafana","Elasticsearch"],difficulty:"intermediate",estimatedHours:30,deliverables:["Pipeline performance monitoring and analytics","Automated pipeline optimization recommendations","Caching strategies and artifact management","Parallel execution optimization","Pipeline reliability and error handling","Developer experience improvements","Cost optimization for CI/CD resources"]}],assessments:{quiz:[{question:"What is the primary purpose of Continuous Integration (CI) in a CI/CD pipeline?",options:["To deploy applications to production servers","To automatically build and test code changes","To monitor application performance in production","To manage infrastructure as code"],correctAnswer:1,explanation:"Continuous Integration focuses on automatically building and testing code changes as they are committed, ensuring that integration issues are caught early."},{question:"Which deployment strategy involves maintaining two identical production environments?",options:["Rolling deployment","Canary deployment","Blue-green deployment","Feature flag deployment"],correctAnswer:2,explanation:"Blue-green deployment maintains two identical production environments, allowing zero-downtime deployments by switching traffic between them."},{question:"What type of security testing analyzes source code without executing it?",options:["Dynamic Application Security Testing (DAST)","Software Composition Analysis (SCA)","Static Application Security Testing (SAST)","Interactive Application Security Testing (IAST)"],correctAnswer:2,explanation:"Static Application Security Testing (SAST) analyzes source code to identify security vulnerabilities without executing the code."},{question:"What is the main benefit of using semantic versioning in CI/CD?",options:["It reduces the size of Docker images","It provides a standardized way to communicate version changes","It automatically generates documentation","It improves application performance"],correctAnswer:1,explanation:"Semantic versioning provides a standardized way to communicate the nature and impact of version changes to users and automated systems."},{question:"Which tool is commonly used for Infrastructure as Code security scanning?",options:["SonarQube","Checkov","OWASP ZAP","GitLeaks"],correctAnswer:1,explanation:"Checkov is a popular tool for scanning Infrastructure as Code (IaC) files for security and compliance issues."}],evaluation:[{question:"Design a comprehensive CI/CD pipeline for a Node.js web application that includes automated testing, security scanning, and deployment to multiple environments. Include specific tools, stages, and rollback procedures.",rubric:["Complete pipeline architecture with all necessary stages","Appropriate tool selection for each pipeline component","Comprehensive testing strategy including unit, integration, and E2E tests","Security scanning integration (SAST, DAST, SCA)","Multi-environment deployment strategy","Automated rollback and failure recovery procedures","Monitoring and alerting integration","Artifact management and versioning strategy"]},{question:"Compare GitHub Actions and GitLab CI/CD for implementing a CI/CD pipeline. Discuss their features, limitations, use cases, and integration capabilities.",rubric:["Accurate comparison of core features and capabilities","Analysis of platform-specific advantages and limitations","Appropriate use case identification for each platform","Integration capabilities with third-party tools and services","Scalability and performance considerations","Cost and licensing model comparison","Migration strategies and considerations"]}]},aiPrompts:["How do I set up a basic CI/CD pipeline?","What's the difference between CI and CD?","How can I implement automated testing in CI/CD?","What are the best practices for CI/CD security?","How do I handle database migrations in CI/CD?","What's the best way to manage secrets in CI/CD pipelines?","How can I optimize CI/CD pipeline performance?","What are deployment strategies and when to use them?","How do I implement blue-green deployment?","What's the role of containers in CI/CD?","How can I monitor CI/CD pipeline health?","What's the difference between GitOps and traditional CI/CD?"],resources:[{title:"GitHub Actions Documentation",type:"Official Documentation",url:"https://docs.github.com/en/actions",description:"Comprehensive guide to GitHub Actions for CI/CD automation"},{title:"GitLab CI/CD Documentation",type:"Official Documentation",url:"https://docs.gitlab.com/ee/ci/",description:"Complete documentation for GitLab CI/CD pipelines"},{title:"Jenkins Documentation",type:"Official Documentation",url:"https://www.jenkins.io/doc/",description:"Jenkins CI/CD server documentation and guides"},{title:"CircleCI Documentation",type:"Official Documentation",url:"https://circleci.com/docs/",description:"CircleCI platform documentation and best practices"},{title:"CI/CD Best Practices Guide",type:"Guide",url:"https://cloud.google.com/architecture/devops/devops-tech-continuous-integration",description:"Google Cloud's comprehensive CI/CD best practices"}],toolsRequired:[{name:"GitHub Actions",description:"GitHub's built-in CI/CD platform for automation",installation:"Built into GitHub repositories",purpose:"Automate workflows, testing, and deployments"},{name:"GitLab CI/CD",description:"GitLab's integrated CI/CD solution",installation:"Available in GitLab SaaS or self-hosted",purpose:"Complete DevOps platform with CI/CD capabilities"},{name:"Jenkins",description:"Open-source automation server for CI/CD",installation:"Download from jenkins.io or use Docker",purpose:"Highly customizable CI/CD server with extensive plugins"},{name:"Docker",description:"Container platform for consistent deployments",installation:"Download from docker.com",purpose:"Containerize applications for consistent CI/CD deployments"},{name:"Kubernetes",description:"Container orchestration platform",installation:"Install via cloud providers or k3s for local development",purpose:"Orchestrate container deployments in CI/CD pipelines"}],bestPractices:["Use declarative pipeline configurations for better maintainability","Implement comprehensive automated testing at every stage","Use semantic versioning for consistent release management","Implement security scanning in every pipeline run","Use infrastructure as code for environment consistency","Implement proper artifact management and versioning","Set up monitoring and alerting for pipeline health","Use feature flags for gradual feature rollouts","Implement automated rollback procedures","Regularly review and optimize pipeline performance","Use secrets management for secure credential handling","Document pipeline processes and runbooks"],commonPitfalls:["Not implementing proper testing in CI/CD pipelines","Using hardcoded secrets in pipeline configurations","Not having automated rollback procedures","Ignoring security scanning in CI/CD processes","Not monitoring pipeline performance and reliability","Using single environment for all testing and deployment","Not versioning artifacts properly","Ignoring pipeline security and access controls","Not documenting pipeline processes and procedures","Using outdated or unmaintained CI/CD tools","Not implementing proper error handling and notifications","Ignoring compliance and regulatory requirements in CI/CD"],careerRelevance:["CI/CD expertise is essential for modern DevOps roles","Pipeline automation skills are highly valued by employers","Cloud-native CI/CD knowledge supports platform engineering careers","Security integration in CI/CD supports DevSecOps positions","Multi-cloud deployment skills enable cloud architect roles","GitOps and infrastructure as code support SRE careers","Performance optimization skills support site reliability engineering","Release management expertise supports technical leadership roles","Compliance automation supports regulated industry careers","Container orchestration skills support Kubernetes and cloud-native roles","Monitoring and observability support full-stack DevOps positions","Toolchain integration supports automation engineering careers"]},LM={id:"monitoring",tier:4,name:"Monitoring & Observability",description:"Master application and infrastructure monitoring with comprehensive observability practices. Learn metrics collection, logging strategies, alerting systems, and modern monitoring tools for building reliable, production-ready applications.",difficulty:"intermediate",estimatedHours:25,prerequisites:["nodejs","docker","cloudservices"],learningObjectives:["Understand the fundamentals of application and infrastructure monitoring","Implement comprehensive logging strategies with structured logging","Set up metrics collection using Prometheus and monitoring best practices","Configure alerting systems for proactive issue detection","Build dashboards with Grafana for data visualization","Implement distributed tracing for microservices observability","Use monitoring tools like ELK stack, Jaeger, and OpenTelemetry","Design monitoring architectures for scalability and reliability","Implement health checks and service discovery","Create custom metrics and monitoring solutions","Handle log aggregation and analysis at scale","Set up monitoring for cloud-native applications","Implement security monitoring and anomaly detection","Use APM (Application Performance Monitoring) tools effectively","Design monitoring strategies for different deployment environments","Implement cost-effective monitoring solutions"],sections:[{title:"Monitoring Fundamentals",content:`Monitoring is the practice of observing and tracking the performance, health, and behavior of applications and infrastructure. It involves collecting metrics, logs, and traces to gain insights into system behavior and detect issues before they impact users.

**Key Concepts**: Monitoring focuses on understanding system state through data collection and analysis. Observability extends this by providing the ability to ask arbitrary questions about system behavior.

**Monitoring Types**: Infrastructure monitoring tracks servers, networks, and system resources. Application monitoring focuses on application performance, errors, and user experience. Business monitoring tracks KPIs and user behavior.

**Metrics vs Logs vs Traces**: Metrics are numerical measurements collected over time. Logs are timestamped records of events. Traces track requests across distributed systems.

**Monitoring Goals**: Detect issues early, understand system behavior, optimize performance, ensure reliability, and support debugging and troubleshooting.

**Best Practices**: Monitor everything that matters, collect the right data, set appropriate thresholds, automate responses, and continuously improve monitoring strategies.`,keyTopics:["Monitoring vs Observability concepts","Types of monitoring (infrastructure, application, business)","Key monitoring metrics and KPIs","Monitoring data types (metrics, logs, traces)","Monitoring best practices and principles"],practicalExercises:["Set up basic system monitoring on a Linux server","Configure monitoring for a simple web application","Create custom metrics for application performance","Implement health check endpoints","Set up log collection and basic analysis","Configure basic alerting for critical metrics"],codeExamples:[{title:"Basic System Monitoring Script",language:"bash",code:`#!/bin/bash

# System monitoring script
echo "=== System Monitoring Report ==="
echo "Timestamp: $(date)"

# CPU Usage
echo "CPU Usage:"
top -bn1 | grep "Cpu(s)" | sed "s/.*, *\\([0-9.]*\\)%* id.*/\\1/" | awk '{print 100 - $1"%"}'

# Memory Usage
echo -e "
Memory Usage:"
free -h | grep "^Mem:" | awk '{print "Total: "$2", Used: "$3", Free: "$4", Usage: "int($3/$2*100)"%"}'

# Disk Usage
echo -e "
Disk Usage:"
df -h | grep "^/dev/" | awk '{print $1": "$5" used ("$3"/"$2")"}'

# Network Statistics
echo -e "
Network Statistics:"
echo "Active connections: $(netstat -tun | grep ESTABLISHED | wc -l)"
echo "Listening ports: $(netstat -tln | grep LISTEN | wc -l)"

# Process Monitoring
echo -e "
Top 5 Memory-consuming processes:"
ps aux --sort=-%mem | head -6 | awk '{print $1,$2,$4,$11}'

echo -e "
Top 5 CPU-consuming processes:"
ps aux --sort=-%cpu | head -6 | awk '{print $1,$2,$3,$11}'

echo "=== End Report ==="`},{title:"Node.js Application Health Check",language:"javascript",code:`const express = require('express');
const os = require('os');
const app = express();

// Health check endpoint
app.get('/health', (req, res) => {
  const healthCheck = {
    uptime: process.uptime(),
    message: 'OK',
    timestamp: Date.now(),
    services: {
      database: 'connected', // Check actual DB connection
      cache: 'connected',    // Check cache connection
      external_api: 'available' // Check external services
    }
  };

  // Check if all services are healthy
  const allHealthy = Object.values(healthCheck.services).every(
    status => status === 'connected' || status === 'available'
  );

  if (!allHealthy) {
    healthCheck.message = 'Degraded';
    return res.status(503).json(healthCheck);
  }

  res.status(200).json(healthCheck);
});

// Detailed health check
app.get('/health/detailed', (req, res) => {
  const detailedHealth = {
    uptime: process.uptime(),
    timestamp: Date.now(),
    version: process.version,
    environment: process.env.NODE_ENV || 'development',
    memory: {
      used: Math.round(process.memoryUsage().heapUsed / 1024 / 1024),
      total: Math.round(process.memoryUsage().heapTotal / 1024 / 1024),
      external: Math.round(process.memoryUsage().external / 1024 / 1024),
      rss: Math.round(process.memoryUsage().rss / 1024 / 1024)
    },
    system: {
      platform: os.platform(),
      arch: os.arch(),
      cpus: os.cpus().length,
      totalMemory: Math.round(os.totalmem() / 1024 / 1024),
      freeMemory: Math.round(os.freemem() / 1024 / 1024),
      loadAverage: os.loadavg()
    },
    services: {
      database: {
        status: 'connected',
        responseTime: 45, // ms
        connectionPool: {
          used: 3,
          available: 7,
          pending: 0
        }
      },
      redis: {
        status: 'connected',
        responseTime: 12,
        memoryUsage: '45%'
      },
      externalAPI: {
        status: 'available',
        responseTime: 234,
        lastCheck: Date.now() - 30000 // 30 seconds ago
      }
    }
  };

  // Determine overall health status
  const serviceStatuses = Object.values(detailedHealth.services).map(s => s.status);
  const allHealthy = serviceStatuses.every(status =>
    status === 'connected' || status === 'available'
  );

  detailedHealth.status = allHealthy ? 'healthy' : 'degraded';

  const statusCode = allHealthy ? 200 : 503;
  res.status(statusCode).json(detailedHealth);
});

// Readiness check (for Kubernetes)
app.get('/ready', (req, res) => {
  // Check if application is ready to serve traffic
  // This might include database connections, cache warmup, etc.

  const isReady = true; // Implement actual readiness logic

  if (isReady) {
    res.status(200).json({ status: 'ready', timestamp: Date.now() });
  } else {
    res.status(503).json({ status: 'not ready', timestamp: Date.now() });
  }
});

// Liveness check (for Kubernetes)
app.get('/live', (req, res) => {
  // Simple liveness check - if server is responding, it's alive
  res.status(200).json({ status: 'alive', timestamp: Date.now() });
});

// Metrics endpoint (for Prometheus)
app.get('/metrics', (req, res) => {
  const metrics = \`# HELP http_requests_total Total number of HTTP requests
# TYPE http_requests_total counter
http_requests_total{method="GET",endpoint="/health"} 1256
http_requests_total{method="GET",endpoint="/health/detailed"} 89
http_requests_total{method="GET",endpoint="/ready"} 2341
http_requests_total{method="GET",endpoint="/live"} 5678

# HELP http_request_duration_seconds HTTP request duration in seconds
# TYPE http_request_duration_seconds histogram
http_request_duration_seconds_bucket{le="0.1"} 2345
http_request_duration_seconds_bucket{le="0.5"} 3456
http_request_duration_seconds_bucket{le="1.0"} 4567
http_request_duration_seconds_bucket{le="+Inf"} 5678
http_request_duration_seconds_sum 1234.56
http_request_duration_seconds_count 5678

# HELP memory_usage_bytes Current memory usage in bytes
# TYPE memory_usage_bytes gauge
memory_usage_bytes \${process.memoryUsage().heapUsed}

# HELP uptime_seconds Application uptime in seconds
# TYPE uptime_seconds counter
uptime_seconds_total \${process.uptime()}
\`;

  res.set('Content-Type', 'text/plain; charset=utf-8');
  res.send(metrics);
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`Health check server running on port \${PORT}\`);
});`}]},{title:"Logging Strategies",content:`Effective logging is crucial for monitoring, debugging, and maintaining applications. Structured logging provides consistent, machine-readable log data that can be easily searched, filtered, and analyzed.

**Log Levels**: DEBUG (detailed information), INFO (general information), WARN (warning messages), ERROR (error conditions), FATAL (severe errors).

**Structured Logging**: Use consistent formats with key-value pairs instead of plain text messages. Include context like user ID, request ID, and timestamps.

**Log Aggregation**: Collect logs from multiple sources into a central system for analysis. Tools like ELK stack (Elasticsearch, Logstash, Kibana) provide powerful log aggregation capabilities.

**Log Rotation**: Implement log rotation to prevent log files from consuming too much disk space. Configure appropriate retention policies.

**Security Considerations**: Avoid logging sensitive information like passwords, API keys, or personal data. Implement log sanitization.

**Performance Impact**: Logging can impact application performance. Use asynchronous logging and appropriate log levels in production.`,keyTopics:["Log levels and their appropriate usage","Structured logging formats and best practices","Log aggregation and centralization","Log analysis and search capabilities","Security considerations in logging","Performance implications of logging"],practicalExercises:["Implement structured logging in a Node.js application","Set up ELK stack for log aggregation","Create custom log parsers and filters","Implement log rotation and retention policies","Build log analysis dashboards","Set up log alerting and notifications"],codeExamples:[{title:"Structured Logging with Winston",language:"javascript",code:`const winston = require('winston');
const path = require('path');

// Custom log format
const customFormat = winston.format.combine(
  winston.format.timestamp({
    format: 'YYYY-MM-DD HH:mm:ss'
  }),
  winston.format.errors({ stack: true }),
  winston.format.json(),
  winston.format.printf((info) => {
    const { timestamp, level, message, ...meta } = info;
    return JSON.stringify({
      timestamp,
      level: level.toUpperCase(),
      message,
      service: 'user-service',
      version: '1.0.0',
      ...meta
    });
  })
);

// Create logger instance
const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: customFormat,
  defaultMeta: { service: 'user-service' },
  transports: [
    // Console transport for development
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),

    // File transport for all logs
    new winston.transports.File({
      filename: path.join(__dirname, 'logs', 'app.log'),
      maxsize: 5242880, // 5MB
      maxFiles: 5,
      tailable: true
    }),

    // Separate file for errors
    new winston.transports.File({
      filename: path.join(__dirname, 'logs', 'error.log'),
      level: 'error',
      maxsize: 5242880,
      maxFiles: 5,
      tailable: true
    })
  ]
});

// Add request ID to all logs in this context
const addRequestId = winston.format((info, opts) => {
  if (opts.requestId) {
    info.requestId = opts.requestId;
  }
  return info;
});

// Create child logger with request context
function createRequestLogger(requestId) {
  return logger.child({
    format: winston.format.combine(
      addRequestId({ requestId }),
      customFormat
    )
  });
}

// Usage examples
logger.info('Application started', {
  port: 3000,
  environment: process.env.NODE_ENV
});

logger.warn('High memory usage detected', {
  memoryUsage: '85%',
  threshold: '80%'
});

logger.error('Database connection failed', {
  error: 'Connection timeout',
  database: 'postgresql',
  host: 'localhost:5432',
  retryCount: 3
});

// HTTP request logging middleware
function requestLogger(req, res, next) {
  const start = Date.now();
  const requestId = req.headers['x-request-id'] || generateRequestId();

  // Add request ID to response header
  res.setHeader('x-request-id', requestId);

  const reqLogger = createRequestLogger(requestId);

  reqLogger.info('Request started', {
    method: req.method,
    url: req.url,
    userAgent: req.get('User-Agent'),
    ip: req.ip,
    headers: sanitizeHeaders(req.headers)
  });

  // Log response
  res.on('finish', () => {
    const duration = Date.now() - start;
    const logLevel = res.statusCode >= 400 ? 'warn' : 'info';

    reqLogger.log(logLevel, 'Request completed', {
      method: req.method,
      url: req.url,
      statusCode: res.statusCode,
      duration: \`\${duration}ms\`,
      contentLength: res.get('Content-Length')
    });
  });

  next();
}

// Error logging middleware
function errorLogger(err, req, res, next) {
  const requestId = req.headers['x-request-id'] || 'unknown';
  const errLogger = createRequestLogger(requestId);

  errLogger.error('Unhandled error', {
    error: err.message,
    stack: err.stack,
    method: req.method,
    url: req.url,
    userAgent: req.get('User-Agent'),
    ip: req.ip
  });

  next(err);
}

// Sanitize sensitive headers
function sanitizeHeaders(headers) {
  const sensitiveHeaders = ['authorization', 'cookie', 'x-api-key'];
  const sanitized = { ...headers };

  sensitiveHeaders.forEach(header => {
    if (sanitized[header]) {
      sanitized[header] = '[REDACTED]';
    }
  });

  return sanitized;
}

// Generate unique request ID
function generateRequestId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

module.exports = {
  logger,
  createRequestLogger,
  requestLogger,
  errorLogger
};`},{title:"ELK Stack Configuration",language:"yaml",code:`# docker-compose.yml for ELK Stack
version: '3.8'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.5.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
      - xpack.monitoring.enabled=false
    ports:
      - "9200:9200"
      - "9300:9300"
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
      - elk

  logstash:
    image: docker.elastic.co/logstash/logstash:8.5.0
    container_name: logstash
    ports:
      - "5044:5044"
      - "5000:5000"
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    depends_on:
      - elasticsearch
    networks:
      - elk

  kibana:
    image: docker.elastic.co/kibana/kibana:8.5.0
    container_name: kibana
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    depends_on:
      - elasticsearch
    networks:
      - elk

volumes:
  elasticsearch-data:

networks:
  elk:
    driver: bridge

# logstash.conf
input {
  tcp {
    port => 5000
    codec => json
  }

  beats {
    port => 5044
  }
}

filter {
  # Parse JSON logs
  json {
    source => "message"
  }

  # Add geoip information
  geoip {
    source => "client_ip"
    target => "geoip"
  }

  # Parse timestamps
  date {
    match => ["timestamp", "ISO8601", "YYYY-MM-DD HH:mm:ss"]
    target => "@timestamp"
  }

  # Add custom fields
  mutate {
    add_field => {
      "service" => "%{[@metadata][beat]}"
      "environment" => "production"
    }
  }

  # Filter out unwanted logs
  if [level] == "DEBUG" {
    drop {}
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "logs-%{+YYYY.MM.dd}"
    document_type => "_doc"
  }

  stdout {
    codec => rubydebug
  }
}`}]},{title:"Metrics and Monitoring with Prometheus",content:`Prometheus is a powerful monitoring and alerting toolkit that collects metrics from configured targets at specified intervals. It provides a multidimensional data model and a powerful query language for analyzing metrics.

**Metrics Types**: Counter (monotonically increasing), Gauge (can go up and down), Histogram (samples observations and counts them in buckets), Summary (similar to histogram but calculates quantiles).

**Exporters**: Prometheus uses exporters to collect metrics from various systems. Node.js applications can use the prom-client library to expose metrics.

**PromQL**: Prometheus Query Language allows complex queries and aggregations of metrics data.

**Alerting**: Prometheus Alertmanager handles alerts from Prometheus and routes them to various notification channels.

**Service Discovery**: Automatically discover targets to monitor using service discovery mechanisms.

**Storage**: Time-series database optimized for metrics with efficient compression and querying.`,keyTopics:["Prometheus architecture and components","Metrics types and collection strategies","PromQL query language and functions","Alerting rules and Alertmanager configuration","Service discovery and target configuration","Prometheus storage and retention policies"],practicalExercises:["Set up Prometheus monitoring for a Node.js application","Create custom metrics and exporters","Write PromQL queries for monitoring dashboards","Configure alerting rules and notifications","Implement service discovery for dynamic environments","Set up Prometheus federation for multi-region monitoring"],codeExamples:[{title:"Prometheus Metrics in Node.js",language:"javascript",code:`const express = require('express');
const promClient = require('prom-client');
const app = express();

// Create a Registry which registers the metrics
const register = new promClient.Registry();

// Add a default label which is added to all metrics
register.setDefaultLabels({
  app: 'my-app',
  environment: 'production'
});

// Enable the collection of default metrics
promClient.collectDefaultMetrics({ register });

// Create custom metrics
const httpRequestDuration = new promClient.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status_code'],
  buckets: [0.1, 0.5, 1, 2, 5, 10]
});

const httpRequestsTotal = new promClient.Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status_code']
});

const activeConnections = new promClient.Gauge({
  name: 'active_connections',
  help: 'Number of active connections'
});

const userRegistrations = new promClient.Counter({
  name: 'user_registrations_total',
  help: 'Total number of user registrations',
  labelNames: ['source', 'plan']
});

// Register custom metrics
register.registerMetric(httpRequestDuration);
register.registerMetric(httpRequestsTotal);
register.registerMetric(activeConnections);
register.registerMetric(userRegistrations);

// Middleware to track HTTP metrics
app.use((req, res, next) => {
  const start = Date.now();

  // Increment active connections
  activeConnections.inc();

  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;

    // Record request duration
    httpRequestDuration
      .labels(req.method, req.route?.path || req.path, res.statusCode.toString())
      .observe(duration);

    // Increment request counter
    httpRequestsTotal
      .labels(req.method, req.route?.path || req.path, res.statusCode.toString())
      .inc();

    // Decrement active connections
    activeConnections.dec();
  });

  next();
});

// Metrics endpoint for Prometheus
app.get('/metrics', async (req, res) => {
  try {
    res.set('Content-Type', register.contentType);
    res.end(await register.metrics());
  } catch (ex) {
    res.status(500).end(ex);
  }
});

// Example routes with custom metrics
app.post('/users/register', (req, res) => {
  const { source = 'web', plan = 'free' } = req.body;

  // Simulate user registration
  setTimeout(() => {
    // Increment user registration counter
    userRegistrations.labels(source, plan).inc();

    res.json({
      message: 'User registered successfully',
      userId: Math.random().toString(36).substr(2, 9)
    });
  }, Math.random() * 1000);
});

// Business logic metrics
class OrderService {
  constructor() {
    this.orderProcessingTime = new promClient.Histogram({
      name: 'order_processing_duration_seconds',
      help: 'Time taken to process orders',
      labelNames: ['order_type', 'payment_method'],
      buckets: [1, 5, 10, 30, 60, 300]
    });

    this.ordersTotal = new promClient.Counter({
      name: 'orders_total',
      help: 'Total number of orders processed',
      labelNames: ['status', 'order_type']
    });

    this.activeOrders = new promClient.Gauge({
      name: 'active_orders',
      help: 'Number of currently active orders'
    });

    register.registerMetric(this.orderProcessingTime);
    register.registerMetric(this.ordersTotal);
    register.registerMetric(this.activeOrders);
  }

  async processOrder(orderData) {
    const start = Date.now();
    this.activeOrders.inc();

    try {
      // Simulate order processing
      await new Promise(resolve => setTimeout(resolve, Math.random() * 5000));

      const duration = (Date.now() - start) / 1000;

      // Record processing time
      this.orderProcessingTime
        .labels(orderData.type, orderData.paymentMethod)
        .observe(duration);

      // Increment successful orders
      this.ordersTotal.labels('completed', orderData.type).inc();

      return { success: true, orderId: Math.random().toString(36).substr(2, 9) };
    } catch (error) {
      // Increment failed orders
      this.ordersTotal.labels('failed', orderData.type).inc();
      throw error;
    } finally {
      this.activeOrders.dec();
    }
  }
}

const orderService = new OrderService();

app.post('/orders', async (req, res) => {
  try {
    const result = await orderService.processOrder(req.body);
    res.json(result);
  } catch (error) {
    res.status(500).json({ error: 'Order processing failed' });
  }
});

// Health check with metrics
app.get('/health', (req, res) => {
  // Simulate health check
  const isHealthy = Math.random() > 0.1; // 90% healthy

  if (isHealthy) {
    res.json({
      status: 'healthy',
      uptime: process.uptime(),
      timestamp: Date.now()
    });
  } else {
    res.status(503).json({
      status: 'unhealthy',
      timestamp: Date.now()
    });
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}\`);
  console.log(\`Metrics available at http://localhost:\${PORT}/metrics\`);
});`},{title:"Prometheus Configuration",language:"yaml",code:`# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node-app'
    static_configs:
      - targets: ['app:3000']
    scrape_interval: 5s
    metrics_path: '/metrics'

  - job_name: 'database'
    static_configs:
      - targets: ['postgres:9187']
    scrape_interval: 30s

  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:9113']

  - job_name: 'docker'
    static_configs:
      - targets: ['docker:9323']

  # Service discovery for Kubernetes
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\\d+)?;(\\d+)
        replacement: $1:$2
        target_label: __address__
      - action: labelmap
        regex: __meta_kubernetes_pod_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        action: replace
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_pod_name]
        action: replace
        target_label: kubernetes_pod_name

# alert_rules.yml
groups:
  - name: example
    rules:
      - alert: HighRequestLatency
        expr: http_request_duration_seconds{quantile="0.5"} > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High request latency detected"
          description: "Request latency is {{ $value }}s for {{ $labels.route }}"

      - alert: HighErrorRate
        expr: rate(http_requests_total{status_code=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }}"

      - alert: LowMemory
        expr: (1 - system_memory_usage / system_memory_total) < 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low memory warning"
          description: "Memory usage is above 90%"

      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service is down"
          description: "{{ $labels.job }} service is down"`}]},{title:"Distributed Tracing with Jaeger",content:`Distributed tracing tracks requests as they flow through distributed systems, providing visibility into the performance and behavior of complex microservices architectures.

**Trace Context**: Each trace represents a single request and contains multiple spans. Spans represent individual operations within the request.

**OpenTelemetry**: Open standard for observability that provides APIs for tracing, metrics, and logging.

**Jaeger**: Open-source distributed tracing system that can receive traces from multiple sources and provide visualization and analysis.

**Sampling**: Strategy for deciding which traces to collect to balance observability with performance impact.

**Context Propagation**: Mechanism for passing trace context between services in a distributed system.

**Span Tags and Logs**: Additional metadata attached to spans for better analysis and debugging.`,keyTopics:["Distributed tracing concepts and architecture","OpenTelemetry standards and implementation","Jaeger setup and configuration","Sampling strategies and configuration","Context propagation in microservices","Trace analysis and debugging techniques"],practicalExercises:["Implement distributed tracing in a microservices application","Set up Jaeger for trace collection and visualization","Configure OpenTelemetry instrumentation","Implement custom spans and tags","Set up trace sampling strategies","Analyze traces for performance bottlenecks"],codeExamples:[{title:"OpenTelemetry Tracing in Node.js",language:"javascript",code:`const express = require('express');
const { NodeTracerProvider } = require('@opentelemetry/sdk-trace-node');
const { SimpleSpanProcessor } = require('@opentelemetry/sdk-trace-base');
const { JaegerExporter } = require('@opentelemetry/exporter-jaeger');
const { registerInstrumentations } = require('@opentelemetry/instrumentation');
const { HttpInstrumentation } = require('@opentelemetry/instrumentation-http');
const { ExpressInstrumentation } = require('@opentelemetry/instrumentation-express');
const opentelemetry = require('@opentelemetry/api');

// Initialize tracer provider
const tracerProvider = new NodeTracerProvider();

// Configure Jaeger exporter
const jaegerExporter = new JaegerExporter({
  endpoint: 'http://jaeger:14268/api/traces',
  serviceName: 'user-service'
});

// Add span processor
tracerProvider.addSpanProcessor(new SimpleSpanProcessor(jaegerExporter));

// Register the tracer provider
tracerProvider.register();

// Register instrumentations
registerInstrumentations({
  instrumentations: [
    new HttpInstrumentation(),
    new ExpressInstrumentation()
  ]
});

// Get tracer
const tracer = opentelemetry.trace.getTracer('user-service', '1.0.0');

const app = express();
app.use(express.json());

// Middleware to extract trace context from headers
app.use((req, res, next) => {
  // Extract trace context from incoming headers
  const spanContext = opentelemetry.propagation.extract(
    opentelemetry.context.active(),
    req.headers
  );

  // Create child span for this request
  const span = tracer.startSpan('http_request', {
    kind: opentelemetry.SpanKind.SERVER,
    attributes: {
      'http.method': req.method,
      'http.url': req.url,
      'http.user_agent': req.get('User-Agent'),
      'net.peer.ip': req.ip
    }
  }, spanContext);

  // Set span on context
  const ctx = opentelemetry.trace.setSpan(opentelemetry.context.active(), span);

  // Add span to request object for use in route handlers
  req.span = span;

  // End span when response finishes
  res.on('finish', () => {
    span.setAttributes({
      'http.status_code': res.statusCode,
      'http.response_length': res.get('Content-Length')
    });

    if (res.statusCode >= 400) {
      span.setStatus({
        code: opentelemetry.SpanStatusCode.ERROR,
        message: res.statusMessage
      });
    }

    span.end();
  });

  // Continue with next middleware
  opentelemetry.context.with(ctx, next);
});

// Database operation with tracing
async function getUserFromDatabase(userId) {
  const span = tracer.startSpan('get_user_from_db', {
    kind: opentelemetry.SpanKind.INTERNAL,
    attributes: {
      'db.system': 'postgresql',
      'db.operation': 'select',
      'db.table': 'users',
      'user.id': userId
    }
  });

  try {
    // Simulate database operation
    span.addEvent('Starting database query');
    await new Promise(resolve => setTimeout(resolve, Math.random() * 100));

    // Simulate successful query
    const user = {
      id: userId,
      name: 'John Doe',
      email: 'john@example.com'
    };

    span.addEvent('Database query completed', {
      'db.rows_returned': 1
    });

    span.setAttributes({
      'db.rows_affected': 1
    });

    return user;
  } catch (error) {
    span.recordException(error);
    span.setStatus({
      code: opentelemetry.SpanStatusCode.ERROR,
      message: error.message
    });
    throw error;
  } finally {
    span.end();
  }
}

// External API call with tracing
async function callExternalAPI(userId) {
  const span = tracer.startSpan('call_external_api', {
    kind: opentelemetry.SpanKind.CLIENT,
    attributes: {
      'http.method': 'GET',
      'http.url': 'https://api.example.com/users/' + userId,
      'peer.service': 'user-api'
    }
  });

  try {
    span.addEvent('Making HTTP request');

    // Simulate HTTP request
    const response = await new Promise(resolve => {
      setTimeout(() => resolve({
        status: 200,
        data: { id: userId, profile: 'User profile data' }
      }), Math.random() * 500);
    });

    span.setAttributes({
      'http.status_code': response.status,
      'http.response_length': JSON.stringify(response.data).length
    });

    span.addEvent('HTTP request completed');

    return response.data;
  } catch (error) {
    span.recordException(error);
    span.setStatus({
      code: opentelemetry.SpanStatusCode.ERROR,
      message: error.message
    });
    throw error;
  } finally {
    span.end();
  }
}

// Route handler with custom spans
app.get('/users/:id', async (req, res) => {
  const userId = req.params.id;
  const span = req.span;

  try {
    span.addEvent('Processing user request', {
      'user.id': userId
    });

    // Get user from database
    const user = await getUserFromDatabase(userId);

    // Call external API
    const profile = await callExternalAPI(userId);

    // Combine data
    const result = {
      ...user,
      profile
    };

    span.addEvent('User data retrieved successfully', {
      'user.found': true
    });

    res.json(result);
  } catch (error) {
    span.recordException(error);
    span.setStatus({
      code: opentelemetry.SpanStatusCode.ERROR,
      message: error.message
    });

    res.status(500).json({ error: 'Internal server error' });
  }
});

// Route with custom attributes and events
app.post('/users', async (req, res) => {
  const span = req.span;
  const { name, email } = req.body;

  span.setAttributes({
    'user.name': name,
    'user.email': email,
    'operation.type': 'create'
  });

  span.addEvent('Validating user data');

  // Simulate validation
  if (!name || !email) {
    span.addEvent('Validation failed', {
      'validation.errors': ['name and email are required']
    });

    span.setStatus({
      code: opentelemetry.SpanStatusCode.ERROR,
      message: 'Validation failed'
    });

    return res.status(400).json({ error: 'Name and email are required' });
  }

  span.addEvent('Creating user in database');

  try {
    // Simulate user creation
    const newUser = {
      id: Math.random().toString(36).substr(2, 9),
      name,
      email,
      createdAt: new Date().toISOString()
    };

    span.setAttributes({
      'user.id': newUser.id,
      'db.rows_affected': 1
    });

    span.addEvent('User created successfully');

    res.status(201).json(newUser);
  } catch (error) {
    span.recordException(error);
    span.setStatus({
      code: opentelemetry.SpanStatusCode.ERROR,
      message: error.message
    });

    res.status(500).json({ error: 'Failed to create user' });
  }
});

// Graceful shutdown
process.on('SIGTERM', () => {
  tracerProvider.shutdown().then(() => {
    console.log('Tracing provider shut down');
    process.exit(0);
  });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`User service running on port \${PORT}\`);
  console.log('Tracing enabled with Jaeger exporter');
});`},{title:"Jaeger Configuration",language:"yaml",code:`# docker-compose.yml for Jaeger
version: '3.8'

services:
  jaeger:
    image: jaegertracing/all-in-one:latest
    container_name: jaeger
    ports:
      - "16686:16686"  # Jaeger UI
      - "14268:14268"  # Accept jaeger.thrift over HTTP
      - "14250:14250"  # Accept jaeger.thrift over gRPC
    environment:
      - COLLECTOR_OTLP_ENABLED=true
      - COLLECTOR_ZIPKIN_HOST_PORT=:9411
    networks:
      - tracing

  # Optional: Elasticsearch for persistent storage
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.0
    container_name: jaeger-elasticsearch
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
      - tracing

  # Optional: Cassandra for persistent storage
  cassandra:
    image: cassandra:3.11
    container_name: jaeger-cassandra
    ports:
      - "9042:9042"
    volumes:
      - cassandra-data:/var/lib/cassandra
    networks:
      - tracing

volumes:
  elasticsearch-data:
  cassandra-data:

networks:
  tracing:
    driver: bridge

# Jaeger configuration with sampling
# jaeger-config.yml
service:
  name: jaeger
  version: 1.0.0

sampling:
  strategies:
    # Default sampling strategy
    default_strategy:
      type: probabilistic
      param: 0.1  # Sample 10% of traces

    # Service-specific sampling
    service_strategies:
      - service: "user-service"
        type: probabilistic
        param: 0.5  # Sample 50% of user-service traces

      - service: "payment-service"
        type: rateLimiting
        param: 100  # Sample 100 traces per second

      - service: "notification-service"
        type: probabilistic
        param: 0.01  # Sample 1% of notification traces

# OpenTelemetry Collector configuration
# otel-collector-config.yml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

  jaeger:
    protocols:
      grpc:
        endpoint: 0.0.0.0:14250
      thrift_http:
        endpoint: 0.0.0.0:14268

processors:
  batch:
    timeout: 1s
    send_batch_size: 1024

  # Add service name and version
  resource:
    attributes:
      - key: service.name
        value: "unknown_service"
        action: insert
      - key: service.version
        value: "1.0.0"
        action: insert

exporters:
  jaeger:
    endpoint: "jaeger:14268"
    tls:
      insecure: true

  logging:
    loglevel: debug

service:
  pipelines:
    traces:
      receivers: [otlp, jaeger]
      processors: [resource, batch]
      exporters: [jaeger, logging]`}]}],projects:[{title:"Full-Stack Monitoring Solution",description:"Build a comprehensive monitoring solution for a microservices application using Prometheus, Grafana, ELK stack, and Jaeger",difficulty:"advanced",estimatedHours:50,technologies:["Prometheus","Grafana","Elasticsearch","Logstash","Kibana","Jaeger","Node.js","Docker"],features:["Complete metrics collection with Prometheus","Custom dashboards in Grafana","Centralized logging with ELK stack","Distributed tracing with Jaeger","Alerting and notification system","Health checks and service discovery","Performance monitoring and analysis","Log aggregation and analysis","Custom exporters and instrumentation","Monitoring for multiple environments"]},{title:"Cloud-Native Observability Platform",description:"Create an observability platform for cloud-native applications with Kubernetes integration and multi-region support",difficulty:"advanced",estimatedHours:45,technologies:["Kubernetes","Prometheus","Grafana","Jaeger","OpenTelemetry","Helm"],features:["Kubernetes-native monitoring setup","Service mesh integration","Multi-region observability","Auto-scaling monitoring","Cost optimization for monitoring","Security monitoring and compliance","Custom metrics for business KPIs","Real-time alerting and incident response","Performance profiling and optimization","Integration with cloud provider monitoring"]},{title:"Real-Time Analytics Dashboard",description:"Build a real-time analytics dashboard with streaming data processing and interactive visualizations",difficulty:"intermediate",estimatedHours:35,technologies:["Node.js","WebSocket","D3.js","Redis","Kafka","InfluxDB"],features:["Real-time data streaming","Interactive data visualizations","Custom metrics and KPIs","Real-time alerting system","Data aggregation and processing","Historical data analysis","Custom dashboard builder","Multi-tenant support","API for third-party integrations","Performance optimization for large datasets"]}],assessments:{quiz:[{question:"What is the primary difference between monitoring and observability?",options:["Monitoring is reactive, observability is proactive","Monitoring collects data, observability provides insights","Monitoring is for infrastructure, observability is for applications","Monitoring uses logs, observability uses metrics"],correctAnswer:1,explanation:"Monitoring focuses on collecting data about system state, while observability provides the ability to understand and explain system behavior through that data."},{question:"Which Prometheus metric type is used for values that can increase and decrease?",options:["Counter","Gauge","Histogram","Summary"],correctAnswer:1,explanation:"Gauge metrics are used for values that can go up and down, such as memory usage, CPU utilization, or queue length."},{question:"What is the purpose of distributed tracing in microservices?",options:["To track individual service performance","To monitor network traffic between services","To trace requests across multiple services","To debug database queries"],correctAnswer:2,explanation:"Distributed tracing tracks requests as they flow through multiple services in a microservices architecture, providing visibility into the entire request path."},{question:"Which log level should be used for non-critical information that helps with debugging?",options:["ERROR","WARN","INFO","DEBUG"],correctAnswer:3,explanation:"DEBUG level is used for detailed information that helps with debugging and troubleshooting, typically not shown in production."},{question:"What is the main purpose of service discovery in monitoring?",options:["To find available services in a dynamic environment","To discover security vulnerabilities","To monitor service dependencies","To track service versions"],correctAnswer:0,explanation:"Service discovery automatically finds and monitors services in dynamic environments where services can be created, destroyed, or moved."}],evaluation:[{scenario:"Your team is responsible for monitoring a critical e-commerce application that processes thousands of transactions per minute. The application consists of multiple microservices running on Kubernetes.",questions:["What monitoring strategy would you implement for this application?","How would you handle monitoring in a high-traffic environment?","What alerting strategy would you use for different types of incidents?","How would you ensure monitoring doesn't impact application performance?"]},{scenario:"You're tasked with improving the observability of a legacy monolithic application that's being migrated to microservices. The application currently has minimal monitoring in place.",questions:["What steps would you take to implement comprehensive monitoring?","How would you approach the migration from minimal to full observability?","What tools and technologies would you recommend for this scenario?","How would you measure the success of your monitoring implementation?"]}]},aiPrompts:["How do I set up Prometheus monitoring for a Node.js application?","What's the difference between logs, metrics, and traces?","How do I create custom Grafana dashboards?","How do I implement distributed tracing in microservices?","What's the best way to handle log aggregation at scale?","How do I set up alerting in Prometheus?","How do I monitor Kubernetes applications?","What's the difference between white-box and black-box monitoring?","How do I implement custom metrics in my application?","How do I optimize monitoring costs in the cloud?","How do I set up monitoring for serverless applications?","What's the best practice for log retention and rotation?","How do I monitor database performance?","How do I implement health checks for microservices?","What's the role of service mesh in observability?"],resources:[{title:"Prometheus Documentation",type:"documentation",url:"https://prometheus.io/docs/",description:"Official Prometheus documentation with guides and best practices"},{title:"Grafana Documentation",type:"documentation",url:"https://grafana.com/docs/",description:"Complete Grafana documentation for dashboard creation and configuration"},{title:"OpenTelemetry Documentation",type:"documentation",url:"https://opentelemetry.io/docs/",description:"OpenTelemetry standards and implementation guides"},{title:"ELK Stack Guide",type:"guide",url:"https://www.elastic.co/guide/index.html",description:"Comprehensive guide for Elasticsearch, Logstash, and Kibana"},{title:"Jaeger Tracing",type:"documentation",url:"https://www.jaegertracing.io/docs/",description:"Jaeger documentation for distributed tracing setup"},{title:"Monitoring Best Practices",type:"article",url:"https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/",description:"Google SRE book chapter on monitoring distributed systems"}],toolsRequired:["Prometheus - Metrics collection and alerting","Grafana - Dashboard and visualization","Elasticsearch - Log storage and search","Logstash - Log processing and aggregation","Kibana - Log visualization and analysis","Jaeger - Distributed tracing","OpenTelemetry - Observability standards","Node.js prom-client - Prometheus metrics client","Winston - Structured logging for Node.js","Docker - Container monitoring","Kubernetes - Orchestration monitoring","Alertmanager - Alert routing and notification","cAdvisor - Container metrics","Fluentd - Log collection and forwarding","Zipkin - Alternative distributed tracing","InfluxDB - Time-series database","VictoriaMetrics - Prometheus long-term storage","Thanos - Prometheus high availability","Loki - Log aggregation system","Tempo - Distributed tracing backend"],bestPractices:["Monitor everything that matters, not everything possible","Use structured logging with consistent formats","Implement proper health checks for all services","Set up appropriate alerting with clear escalation paths","Use distributed tracing for microservices debugging","Implement proper log levels and filtering","Use service discovery for dynamic environments","Implement proper metrics naming conventions","Set up monitoring before deploying to production","Use sampling for high-volume tracing","Implement proper retention policies for logs and metrics","Use correlation IDs for request tracing","Monitor business metrics, not just technical metrics","Implement proper error tracking and analysis","Use monitoring to drive performance optimizations","Implement proper backup and disaster recovery monitoring","Use monitoring for capacity planning","Implement proper security monitoring","Use monitoring for compliance and audit requirements","Regularly review and update monitoring configurations","Implement proper alerting fatigue prevention","Use monitoring for incident response and postmortems","Implement proper cost monitoring for cloud resources","Use monitoring for user experience tracking","Implement proper data privacy in monitoring","Use monitoring for A/B testing and feature validation","Implement proper monitoring for third-party services","Use monitoring for performance regression detection","Implement proper monitoring documentation","Use monitoring for service level objective (SLO) tracking"],commonPitfalls:["Monitoring too many metrics leading to alert fatigue","Not implementing proper log levels and filtering","Ignoring monitoring in development environments","Not setting up proper alerting thresholds","Using inconsistent metric naming conventions","Not implementing proper health checks","Ignoring security considerations in monitoring","Not setting up proper log retention policies","Using monitoring tools without proper training","Not correlating logs, metrics, and traces","Implementing monitoring as an afterthought","Not monitoring business-critical user journeys","Using default monitoring configurations without tuning","Not implementing proper backup monitoring","Ignoring monitoring costs in cloud environments","Not implementing proper access controls for monitoring","Using outdated monitoring tools and versions","Not implementing proper monitoring for databases","Ignoring monitoring for third-party dependencies","Not implementing proper monitoring documentation","Using monitoring for debugging instead of proper tools","Not implementing proper monitoring for CI/CD pipelines","Ignoring monitoring for serverless functions","Not implementing proper monitoring for mobile applications","Using monitoring without proper alerting channels","Not implementing proper monitoring for APIs","Ignoring monitoring for legacy systems","Not implementing proper monitoring for containers","Using monitoring without proper data visualization","Not implementing proper monitoring for micro-frontends"],careerRelevance:["Monitoring skills are essential for DevOps and SRE roles","Observability expertise is highly valued in cloud-native development","Distributed tracing knowledge is crucial for microservices architecture","Prometheus and Grafana are industry-standard monitoring tools","ELK stack skills are in high demand for log analysis","OpenTelemetry knowledge is becoming essential for modern applications","Monitoring expertise helps with incident response and reliability","Observability skills are critical for large-scale system design","Cloud monitoring knowledge is essential for cloud-native careers","Performance monitoring skills help optimize application efficiency","Security monitoring expertise is crucial for cybersecurity roles","Business monitoring skills help align technical metrics with business goals","Monitoring automation skills are valuable for infrastructure as code","Real-time analytics knowledge is essential for data-driven decisions","Cost monitoring expertise helps optimize cloud spending","Compliance monitoring skills are important for regulated industries","User experience monitoring helps improve product quality","Synthetic monitoring knowledge helps ensure service availability","Log analysis skills are crucial for debugging and troubleshooting","Metrics collection expertise enables data-driven development","Alerting system knowledge helps with proactive issue resolution","Dashboard creation skills help communicate system health","Monitoring strategy design helps build reliable systems","Observability culture promotion helps improve team collaboration","Monitoring tool integration skills help build comprehensive solutions","Performance profiling expertise helps optimize application speed","Anomaly detection knowledge helps identify unusual system behavior","Capacity planning skills help ensure system scalability","Incident response monitoring helps minimize downtime impact","Post-mortem analysis skills help prevent future incidents","Monitoring best practices knowledge helps maintain system reliability"]},qM={id:"reactnative",tier:5,name:"React Native",description:"Master cross-platform mobile development with React Native. Build native iOS and Android applications using JavaScript and React, with comprehensive coverage of navigation, state management, native modules, and performance optimization for mobile platforms.",difficulty:"advanced",estimatedHours:35,prerequisites:["react","javascript","nodejs"],learningObjectives:["Master React Native fundamentals and component architecture","Implement cross-platform navigation with React Navigation","Manage application state with Redux, Context API, and Zustand","Create and integrate native modules for platform-specific functionality","Optimize React Native applications for performance and user experience","Handle platform differences and write platform-specific code","Implement proper error handling and crash reporting","Use React Native testing frameworks and best practices","Integrate with device features (camera, location, sensors)","Implement push notifications and background processing","Manage app store deployment and over-the-air updates","Use React Native with TypeScript for type safety","Implement proper security practices for mobile applications","Handle offline functionality and data synchronization","Optimize bundle size and app startup time","Use React Native with popular backend services"],sections:[{title:"React Native Fundamentals",content:`React Native is a framework for building native mobile applications using JavaScript and React. It allows developers to create truly native apps for iOS and Android using a single codebase, with platform-specific optimizations handled automatically.

**Core Concepts**: React Native uses the same fundamental UI building blocks as regular React, but instead of rendering to the DOM, it renders native mobile components. This provides better performance and a more authentic user experience.

**Bridge Communication**: React Native communicates between JavaScript and native threads through a bridge. Understanding this architecture is crucial for performance optimization and debugging.

**Component Lifecycle**: React Native components follow React's lifecycle patterns, but with additional considerations for mobile-specific events like app state changes and memory management.

**Platform Detection**: React Native provides Platform module to detect the current platform and implement platform-specific behavior.

**Styling**: Uses a subset of CSS with Flexbox for layout, but with some differences from web CSS. Styles are converted to native platform styles at runtime.`,keyTopics:["React Native vs React Web differences","Native component architecture","Bridge communication and threading","Platform-specific code implementation","React Native styling system"],practicalExercises:["Set up a new React Native project with Expo CLI","Create basic UI components using React Native primitives","Implement platform-specific styling and behavior","Build a simple multi-screen application","Debug React Native applications using developer tools","Handle different screen sizes and orientations"],codeExamples:[{title:"React Native App Setup and Basic Components",language:"javascript",code:`import React from 'react';
import {
  View,
  Text,
  StyleSheet,
  SafeAreaView,
  StatusBar,
  Platform,
  Dimensions
} from 'react-native';

const { width, height } = Dimensions.get('window');

const App = () => {
  return (
    <SafeAreaView style={styles.container}>
      <StatusBar
        barStyle={Platform.OS === 'ios' ? 'dark-content' : 'light-content'}
        backgroundColor={Platform.OS === 'android' ? '#007AFF' : undefined}
      />

      <View style={styles.header}>
        <Text style={styles.title}>Welcome to React Native</Text>
        <Text style={styles.subtitle}>
          Running on {Platform.OS} {Platform.Version}
        </Text>
      </View>

      <View style={styles.content}>
        <View style={styles.card}>
          <Text style={styles.cardTitle}>Platform Information</Text>
          <Text style={styles.cardText}>
            Screen: {width.toFixed(0)} x {height.toFixed(0)}
          </Text>
          <Text style={styles.cardText}>
            Platform: {Platform.OS}
          </Text>
          <Text style={styles.cardText}>
            Version: {Platform.Version}
          </Text>
          {Platform.OS === 'ios' && (
            <Text style={styles.cardText}>
              iOS Version: {Platform.Version}
            </Text>
          )}
          {Platform.OS === 'android' && (
            <Text style={styles.cardText}>
              API Level: {Platform.Version}
            </Text>
          )}
        </View>
      </View>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  header: {
    padding: 20,
    backgroundColor: '#007AFF',
    alignItems: 'center',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 8,
  },
  subtitle: {
    fontSize: 16,
    color: 'rgba(255, 255, 255, 0.8)',
  },
  content: {
    flex: 1,
    padding: 20,
  },
  card: {
    backgroundColor: 'white',
    borderRadius: 12,
    padding: 20,
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  cardTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: '#333',
    marginBottom: 16,
  },
  cardText: {
    fontSize: 16,
    color: '#666',
    marginBottom: 8,
    lineHeight: 22,
  },
});

export default App;`},{title:"Platform-Specific Code Implementation",language:"javascript",code:`import React from 'react';
import {
  View,
  Text,
  StyleSheet,
  Platform,
  TouchableOpacity,
  Alert,
  Linking
} from 'react-native';

// Platform-specific file extensions
// Component.android.js / Component.ios.js
// Component.native.js / Component.web.js

const PlatformSpecificComponent = () => {
  const handlePlatformAction = () => {
    if (Platform.OS === 'ios') {
      // iOS specific action
      Alert.alert(
        'iOS Action',
        'This is an iOS-specific feature',
        [
          { text: 'Cancel', style: 'cancel' },
          { text: 'Open Settings', onPress: () => Linking.openSettings() }
        ]
      );
    } else if (Platform.OS === 'android') {
      // Android specific action
      Alert.alert(
        'Android Action',
        'This is an Android-specific feature',
        [
          { text: 'OK' }
        ]
      );
    }
  };

  const getPlatformStyles = () => {
    return Platform.select({
      ios: {
        button: {
          backgroundColor: '#007AFF',
          borderRadius: 8,
        },
        text: {
          color: 'white',
          fontSize: 16,
          fontWeight: '600',
        }
      },
      android: {
        button: {
          backgroundColor: '#3F51B5',
          borderRadius: 4,
          elevation: 2,
        },
        text: {
          color: 'white',
          fontSize: 16,
          fontWeight: '500',
        }
      },
      default: {
        button: {
          backgroundColor: '#666',
          borderRadius: 4,
        },
        text: {
          color: 'white',
          fontSize: 16,
        }
      }
    });
  };

  const styles = getPlatformStyles();

  return (
    <View style={containerStyles.container}>
      <Text style={containerStyles.title}>
        Platform: {Platform.OS.toUpperCase()}
      </Text>

      <Text style={containerStyles.info}>
        Version: {Platform.Version}
      </Text>

      <Text style={containerStyles.info}>
        isPad: {Platform.isPad ? 'Yes' : 'No'}
      </Text>

      <Text style={containerStyles.info}>
        isTV: {Platform.isTV ? 'Yes' : 'No'}
      </Text>

      <TouchableOpacity
        style={[buttonStyles.button, styles.button]}
        onPress={handlePlatformAction}
      >
        <Text style={[buttonStyles.text, styles.text]}>
          Platform Action
        </Text>
      </TouchableOpacity>
    </View>
  );
};

// Separate style objects for better organization
const containerStyles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 20,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 20,
    color: '#333',
  },
  info: {
    fontSize: 16,
    marginBottom: 10,
    color: '#666',
  },
});

const buttonStyles = StyleSheet.create({
  button: {
    paddingHorizontal: 30,
    paddingVertical: 15,
    marginTop: 20,
    minWidth: 200,
    alignItems: 'center',
  },
  text: {
    textAlign: 'center',
  },
});

// Platform-specific component using file extensions
// File: PlatformButton.ios.js
/*
import React from 'react';
import { TouchableOpacity, Text, StyleSheet } from 'react-native';

const PlatformButton = ({ title, onPress }) => (
  <TouchableOpacity style={styles.button} onPress={onPress}>
    <Text style={styles.text}>{title}</Text>
  </TouchableOpacity>
);

const styles = StyleSheet.create({
  button: {
    backgroundColor: '#007AFF',
    borderRadius: 8,
    padding: 12,
  },
  text: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
});

export default PlatformButton;
*/

// File: PlatformButton.android.js
/*
import React from 'react';
import { TouchableOpacity, Text, StyleSheet } from 'react-native';

const PlatformButton = ({ title, onPress }) => (
  <TouchableOpacity style={styles.button} onPress={onPress}>
    <Text style={styles.text}>{title}</Text>
  </TouchableOpacity>
);

const styles = StyleSheet.create({
  button: {
    backgroundColor: '#3F51B5',
    borderRadius: 4,
    padding: 12,
    elevation: 2,
  },
  text: {
    color: 'white',
    fontSize: 16,
    fontWeight: '500',
  },
});

export default PlatformButton;
*/

// Usage in main component
/*
import PlatformButton from './PlatformButton'; // Automatically picks platform-specific file

const App = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <PlatformButton
      title="Click Me"
      onPress={() => console.log('Button pressed')}
    />
  </View>
);
*/

export default PlatformSpecificComponent;`}]},{title:"Navigation in React Native",content:`Navigation is a crucial aspect of mobile applications. React Native provides several navigation solutions, with React Navigation being the most popular and feature-rich library for handling navigation between screens.

**Navigation Types**: Stack navigation for hierarchical navigation, tab navigation for bottom tabs, drawer navigation for side menus, and nested navigation for complex app structures.

**Navigation Container**: The root component that manages the navigation state and provides the navigation context to child components.

**Screen Options**: Configure screen-specific options like headers, tab bars, and transition animations.

**Navigation Props**: Each screen component receives navigation and route props for programmatic navigation and accessing route parameters.

**Deep Linking**: Handle deep links from external sources to navigate to specific screens within the app.

**Navigation State**: Persist and restore navigation state for better user experience across app restarts.`,keyTopics:["React Navigation library and architecture","Stack, tab, and drawer navigation patterns","Screen options and customization","Programmatic navigation and route parameters","Deep linking and URL handling","Navigation state persistence"],practicalExercises:["Implement stack navigation for a multi-screen app","Create tab-based navigation with custom icons","Build a drawer navigation menu","Handle deep links from external sources","Implement authentication flow navigation","Create nested navigation structures"],codeExamples:[{title:"React Navigation Setup and Stack Navigation",language:"javascript",code:`import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  FlatList,
  Image
} from 'react-native';

// Create stack navigator
const Stack = createStackNavigator();

// Home Screen
const HomeScreen = ({ navigation }) => {
  const menuItems = [
    { id: '1', title: 'Profile', screen: 'Profile' },
    { id: '2', title: 'Settings', screen: 'Settings' },
    { id: '3', title: 'About', screen: 'About' },
  ];

  const navigateToScreen = (screenName) => {
    navigation.navigate(screenName);
  };

  const renderMenuItem = ({ item }) => (
    <TouchableOpacity
      style={styles.menuItem}
      onPress={() => navigateToScreen(item.screen)}
    >
      <Text style={styles.menuItemText}>{item.title}</Text>
      <Text style={styles.arrow}>→</Text>
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Home Screen</Text>
      <FlatList
        data={menuItems}
        renderItem={renderMenuItem}
        keyExtractor={(item) => item.id}
        style={styles.menuList}
      />
    </View>
  );
};

// Profile Screen with parameters
const ProfileScreen = ({ navigation, route }) => {
  const { userId, userName } = route.params || {};

  React.useEffect(() => {
    // Set header title dynamically
    navigation.setOptions({
      title: userName ? \`\${userName}'s Profile\` : 'Profile',
    });
  }, [navigation, userName]);

  const goToEditProfile = () => {
    navigation.navigate('EditProfile', {
      userId,
      userName,
      onProfileUpdate: (updatedData) => {
        console.log('Profile updated:', updatedData);
        // Handle profile update
      }
    });
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Profile Screen</Text>
      {userId && (
        <Text style={styles.info}>User ID: {userId}</Text>
      )}
      {userName && (
        <Text style={styles.info}>Name: {userName}</Text>
      )}

      <TouchableOpacity
        style={styles.button}
        onPress={goToEditProfile}
      >
        <Text style={styles.buttonText}>Edit Profile</Text>
      </TouchableOpacity>

      <TouchableOpacity
        style={[styles.button, styles.secondaryButton]}
        onPress={() => navigation.goBack()}
      >
        <Text style={[styles.buttonText, styles.secondaryButtonText]}>
          Go Back
        </Text>
      </TouchableOpacity>
    </View>
  );
};

// Settings Screen
const SettingsScreen = ({ navigation }) => {
  const settings = [
    { id: '1', title: 'Notifications', action: 'Notifications' },
    { id: '2', title: 'Privacy', action: 'Privacy' },
    { id: '3', title: 'Account', action: 'Account' },
  ];

  const handleSettingPress = (action) => {
    // Navigate to specific settings screen
    navigation.navigate(action);
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Settings</Text>
      {settings.map((setting) => (
        <TouchableOpacity
          key={setting.id}
          style={styles.settingItem}
          onPress={() => handleSettingPress(setting.action)}
        >
          <Text style={styles.settingText}>{setting.title}</Text>
        </TouchableOpacity>
      ))}
    </View>
  );
};

// Main App Navigator
const AppNavigator = () => {
  return (
    <NavigationContainer>
      <Stack.Navigator
        initialRouteName="Home"
        screenOptions={{
          headerStyle: {
            backgroundColor: '#007AFF',
          },
          headerTintColor: '#fff',
          headerTitleStyle: {
            fontWeight: 'bold',
          },
        }}
      >
        <Stack.Screen
          name="Home"
          component={HomeScreen}
          options={{
            title: 'My App',
            headerRight: () => (
              <TouchableOpacity
                onPress={() => console.log('Menu pressed')}
                style={{ marginRight: 15 }}
              >
                <Text style={{ color: 'white', fontSize: 16 }}>☰</Text>
              </TouchableOpacity>
            ),
          }}
        />
        <Stack.Screen
          name="Profile"
          component={ProfileScreen}
          initialParams={{
            userId: '123',
            userName: 'John Doe'
          }}
          options={({ route }) => ({
            title: route.params?.userName
              ? \`\${route.params.userName}'s Profile\`
              : 'Profile',
          })}
        />
        <Stack.Screen
          name="Settings"
          component={SettingsScreen}
          options={{
            title: 'Settings',
            headerBackTitle: 'Back',
          }}
        />
        <Stack.Screen
          name="EditProfile"
          component={ProfileScreen} // Reusing component
          options={{
            title: 'Edit Profile',
            presentation: 'modal',
          }}
        />
      </Stack.Navigator>
    </NavigationContainer>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#f5f5f5',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 20,
    textAlign: 'center',
    color: '#333',
  },
  menuList: {
    flex: 1,
  },
  menuItem: {
    backgroundColor: 'white',
    padding: 20,
    marginBottom: 10,
    borderRadius: 8,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  menuItemText: {
    fontSize: 18,
    color: '#333',
  },
  arrow: {
    fontSize: 18,
    color: '#007AFF',
  },
  info: {
    fontSize: 16,
    marginBottom: 10,
    color: '#666',
  },
  button: {
    backgroundColor: '#007AFF',
    padding: 15,
    borderRadius: 8,
    alignItems: 'center',
    marginBottom: 10,
  },
  buttonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
  secondaryButton: {
    backgroundColor: 'transparent',
    borderWidth: 1,
    borderColor: '#007AFF',
  },
  secondaryButtonText: {
    color: '#007AFF',
  },
  settingItem: {
    backgroundColor: 'white',
    padding: 15,
    marginBottom: 10,
    borderRadius: 8,
  },
  settingText: {
    fontSize: 16,
    color: '#333',
  },
});

export default AppNavigator;`},{title:"Tab Navigation and Drawer Navigation",language:"javascript",code:`import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { createDrawerNavigator } from '@react-navigation/drawer';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  ScrollView
} from 'react-native';

// Create navigators
const Tab = createBottomTabNavigator();
const Drawer = createDrawerNavigator();

// Tab Screens
const HomeTab = ({ navigation }) => (
  <View style={styles.container}>
    <Text style={styles.title}>Home Tab</Text>
    <TouchableOpacity
      style={styles.button}
      onPress={() => navigation.navigate('Profile')}
    >
      <Text style={styles.buttonText}>Go to Profile</Text>
    </TouchableOpacity>
  </View>
);

const SearchTab = ({ navigation }) => (
  <View style={styles.container}>
    <Text style={styles.title}>Search Tab</Text>
    <TouchableOpacity
      style={styles.button}
      onPress={() => navigation.navigate('Notifications')}
    >
      <Text style={styles.buttonText}>Go to Notifications</Text>
    </TouchableOpacity>
  </View>
);

const ProfileTab = ({ navigation }) => (
  <View style={styles.container}>
    <Text style={styles.title}>Profile Tab</Text>
    <TouchableOpacity
      style={styles.button}
      onPress={() => navigation.openDrawer()}
    >
      <Text style={styles.buttonText}>Open Drawer</Text>
    </TouchableOpacity>
  </View>
);

// Drawer Screens
const NotificationsScreen = ({ navigation }) => (
  <View style={styles.container}>
    <Text style={styles.title}>Notifications</Text>
    <TouchableOpacity
      style={styles.button}
      onPress={() => navigation.goBack()}
    >
      <Text style={styles.buttonText}>Go Back</Text>
    </TouchableOpacity>
  </View>
);

const SettingsScreen = ({ navigation }) => (
  <View style={styles.container}>
    <Text style={styles.title}>Settings</Text>
    <TouchableOpacity
      style={styles.button}
      onPress={() => navigation.goBack()}
    >
      <Text style={styles.buttonText}>Go Back</Text>
    </TouchableOpacity>
  </View>
);

// Custom Tab Bar Component
const CustomTabBar = ({ state, descriptors, navigation }) => {
  return (
    <View style={tabStyles.tabBar}>
      {state.routes.map((route, index) => {
        const { options } = descriptors[route.key];
        const label =
          options.tabBarLabel !== undefined
            ? options.tabBarLabel
            : options.title !== undefined
            ? options.title
            : route.name;

        const isFocused = state.index === index;

        const onPress = () => {
          const event = navigation.emit({
            type: 'tabPress',
            target: route.key,
            canPreventDefault: true,
          });

          if (!isFocused && !event.defaultPrevented) {
            navigation.navigate(route.name);
          }
        };

        const onLongPress = () => {
          navigation.emit({
            type: 'tabLongPress',
            target: route.key,
          });
        };

        return (
          <TouchableOpacity
            key={route.key}
            accessibilityRole="button"
            accessibilityState={isFocused ? { selected: true } : {}}
            accessibilityLabel={options.tabBarAccessibilityLabel}
            testID={options.tabBarTestID}
            onPress={onPress}
            onLongPress={onLongPress}
            style={tabStyles.tabItem}
          >
            <Text style={{
              color: isFocused ? '#007AFF' : '#666',
              fontSize: 12,
              fontWeight: isFocused ? '600' : '400'
            }}>
              {label}
            </Text>
          </TouchableOpacity>
        );
      })}
    </View>
  );
};

// Tab Navigator
const TabNavigator = () => {
  return (
    <Tab.Navigator
      tabBar={CustomTabBar}
      screenOptions={{
        headerShown: false,
      }}
    >
      <Tab.Screen
        name="Home"
        component={HomeTab}
        options={{
          tabBarLabel: 'Home',
          tabBarIcon: ({ focused, color, size }) => (
            <Text style={{ fontSize: 20 }}>
              {focused ? '🏠' : '🏡'}
            </Text>
          ),
        }}
      />
      <Tab.Screen
        name="Search"
        component={SearchTab}
        options={{
          tabBarLabel: 'Search',
          tabBarIcon: ({ focused, color, size }) => (
            <Text style={{ fontSize: 20 }}>
              {focused ? '🔍' : '🔎'}
            </Text>
          ),
        }}
      />
      <Tab.Screen
        name="Profile"
        component={ProfileTab}
        options={{
          tabBarLabel: 'Profile',
          tabBarIcon: ({ focused, color, size }) => (
            <Text style={{ fontSize: 20 }}>
              {focused ? '👤' : '👥'}
            </Text>
          ),
        }}
      />
    </Tab.Navigator>
  );
};

// Custom Drawer Content
const CustomDrawerContent = ({ navigation }) => {
  const menuItems = [
    { name: 'Home', label: 'Home', icon: '🏠' },
    { name: 'Profile', label: 'Profile', icon: '👤' },
    { name: 'Settings', label: 'Settings', icon: '⚙️' },
    { name: 'Notifications', label: 'Notifications', icon: '🔔' },
  ];

  return (
    <ScrollView style={drawerStyles.container}>
      <View style={drawerStyles.header}>
        <Text style={drawerStyles.headerTitle}>My App</Text>
        <Text style={drawerStyles.headerSubtitle}>Navigation Menu</Text>
      </View>

      {menuItems.map((item) => (
        <TouchableOpacity
          key={item.name}
          style={drawerStyles.menuItem}
          onPress={() => navigation.navigate(item.name)}
        >
          <Text style={drawerStyles.menuIcon}>{item.icon}</Text>
          <Text style={drawerStyles.menuText}>{item.label}</Text>
        </TouchableOpacity>
      ))}

      <View style={drawerStyles.footer}>
        <TouchableOpacity
          style={drawerStyles.logoutButton}
          onPress={() => {
            // Handle logout
            navigation.closeDrawer();
          }}
        >
          <Text style={drawerStyles.logoutText}>Logout</Text>
        </TouchableOpacity>
      </View>
    </ScrollView>
  );
};

// Main App with Drawer Navigator
const App = () => {
  return (
    <NavigationContainer>
      <Drawer.Navigator
        drawerContent={CustomDrawerContent}
        screenOptions={{
          headerStyle: {
            backgroundColor: '#007AFF',
          },
          headerTintColor: '#fff',
          headerTitleStyle: {
            fontWeight: 'bold',
          },
        }}
      >
        <Drawer.Screen
          name="MainTabs"
          component={TabNavigator}
          options={{
            title: 'Home',
            drawerIcon: ({ focused, size }) => (
              <Text style={{ fontSize: 20 }}>🏠</Text>
            ),
          }}
        />
        <Drawer.Screen
          name="Notifications"
          component={NotificationsScreen}
          options={{
            title: 'Notifications',
            drawerIcon: ({ focused, size }) => (
              <Text style={{ fontSize: 20 }}>🔔</Text>
            ),
          }}
        />
        <Drawer.Screen
          name="Settings"
          component={SettingsScreen}
          options={{
            title: 'Settings',
            drawerIcon: ({ focused, size }) => (
              <Text style={{ fontSize: 20 }}>⚙️</Text>
            ),
          }}
        />
      </Drawer.Navigator>
    </NavigationContainer>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#f5f5f5',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 20,
    color: '#333',
  },
  button: {
    backgroundColor: '#007AFF',
    paddingHorizontal: 30,
    paddingVertical: 15,
    borderRadius: 8,
    alignItems: 'center',
  },
  buttonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
});

const tabStyles = StyleSheet.create({
  tabBar: {
    flexDirection: 'row',
    backgroundColor: 'white',
    borderTopWidth: 1,
    borderTopColor: '#e0e0e0',
    paddingBottom: 5, // For iPhone home indicator
  },
  tabItem: {
    flex: 1,
    alignItems: 'center',
    paddingVertical: 10,
  },
});

const drawerStyles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'white',
  },
  header: {
    padding: 20,
    backgroundColor: '#007AFF',
    alignItems: 'center',
  },
  headerTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 5,
  },
  headerSubtitle: {
    fontSize: 14,
    color: 'rgba(255, 255, 255, 0.8)',
  },
  menuItem: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 15,
    borderBottomWidth: 1,
    borderBottomColor: '#f0f0f0',
  },
  menuIcon: {
    fontSize: 20,
    marginRight: 15,
    width: 30,
    textAlign: 'center',
  },
  menuText: {
    fontSize: 16,
    color: '#333',
  },
  footer: {
    marginTop: 'auto',
    padding: 20,
    borderTopWidth: 1,
    borderTopColor: '#f0f0f0',
  },
  logoutButton: {
    backgroundColor: '#FF3B30',
    padding: 15,
    borderRadius: 8,
    alignItems: 'center',
  },
  logoutText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
});

export default App;`}]},{title:"State Management in React Native",content:`State management is crucial for React Native applications, especially as they grow in complexity. React Native supports multiple state management solutions, from built-in React hooks to external libraries like Redux and Zustand.

**Local State**: UseState and useReducer for component-level state management.

**Context API**: React's built-in solution for sharing state across component trees without prop drilling.

**Redux**: Predictable state container with actions, reducers, and middleware support.

**Zustand**: Lightweight state management library with a simple API and TypeScript support.

**Async Storage**: Persistent storage for user preferences and app data.

**State Persistence**: Strategies for persisting and rehydrating application state.

**Performance Optimization**: Techniques to prevent unnecessary re-renders and optimize state updates.`,keyTopics:["React hooks for state management (useState, useReducer)","Context API for global state","Redux architecture and implementation","Zustand for lightweight state management","AsyncStorage for data persistence","State persistence and rehydration"],practicalExercises:["Implement local state management with hooks","Create a global state store with Context API","Set up Redux with actions and reducers","Build a Zustand store for state management","Implement data persistence with AsyncStorage","Optimize state updates for performance"],codeExamples:[{title:"Local State Management with Hooks",language:"javascript",code:`import React, { useState, useReducer, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  TextInput,
  FlatList
} from 'react-native';

// Counter component with useState
const Counter = () => {
  const [count, setCount] = useState(0);
  const [step, setStep] = useState(1);

  const increment = () => setCount(prev => prev + step);
  const decrement = () => setCount(prev => prev - step);
  const reset = () => setCount(0);

  return (
    <View style={styles.section}>
      <Text style={styles.title}>Counter with useState</Text>
      <Text style={styles.count}>Count: {count}</Text>

      <View style={styles.inputContainer}>
        <Text style={styles.label}>Step:</Text>
        <TextInput
          style={styles.input}
          value={step.toString()}
          onChangeText={(text) => setStep(parseInt(text) || 1)}
          keyboardType="numeric"
        />
      </View>

      <View style={styles.buttonRow}>
        <TouchableOpacity style={[styles.button, styles.decrement]} onPress={decrement}>
          <Text style={styles.buttonText}>-</Text>
        </TouchableOpacity>

        <TouchableOpacity style={[styles.button, styles.reset]} onPress={reset}>
          <Text style={styles.buttonText}>Reset</Text>
        </TouchableOpacity>

        <TouchableOpacity style={[styles.button, styles.increment]} onPress={increment}>
          <Text style={styles.buttonText}>+</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

// Todo reducer
const todoReducer = (state, action) => {
  switch (action.type) {
    case 'ADD_TODO':
      return [...state, {
        id: Date.now().toString(),
        text: action.payload,
        completed: false
      }];
    case 'TOGGLE_TODO':
      return state.map(todo =>
        todo.id === action.payload
          ? { ...todo, completed: !todo.completed }
          : todo
      );
    case 'DELETE_TODO':
      return state.filter(todo => todo.id !== action.payload);
    case 'CLEAR_COMPLETED':
      return state.filter(todo => !todo.completed);
    default:
      return state;
  }
};

// Todo list component with useReducer
const TodoList = () => {
  const [todos, dispatch] = useReducer(todoReducer, []);
  const [inputText, setInputText] = useState('');

  const addTodo = () => {
    if (inputText.trim()) {
      dispatch({ type: 'ADD_TODO', payload: inputText.trim() });
      setInputText('');
    }
  };

  const toggleTodo = (id) => {
    dispatch({ type: 'TOGGLE_TODO', payload: id });
  };

  const deleteTodo = (id) => {
    dispatch({ type: 'DELETE_TODO', payload: id });
  };

  const clearCompleted = () => {
    dispatch({ type: 'CLEAR_COMPLETED' });
  };

  const renderTodo = ({ item }) => (
    <View style={styles.todoItem}>
      <TouchableOpacity
        style={styles.todoCheckbox}
        onPress={() => toggleTodo(item.id)}
      >
        <Text style={styles.checkbox}>
          {item.completed ? '☑' : '☐'}
        </Text>
      </TouchableOpacity>

      <Text style={[
        styles.todoText,
        item.completed && styles.completedText
      ]}>
        {item.text}
      </Text>

      <TouchableOpacity
        style={styles.deleteButton}
        onPress={() => deleteTodo(item.id)}
      >
        <Text style={styles.deleteText}>🗑</Text>
      </TouchableOpacity>
    </View>
  );

  return (
    <View style={styles.section}>
      <Text style={styles.title}>Todo List with useReducer</Text>

      <View style={styles.inputContainer}>
        <TextInput
          style={styles.input}
          value={inputText}
          onChangeText={setInputText}
          placeholder="Add a new todo..."
          onSubmitEditing={addTodo}
        />
        <TouchableOpacity style={styles.addButton} onPress={addTodo}>
          <Text style={styles.addButtonText}>Add</Text>
        </TouchableOpacity>
      </View>

      <FlatList
        data={todos}
        renderItem={renderTodo}
        keyExtractor={(item) => item.id}
        style={styles.todoList}
        ListEmptyComponent={
          <Text style={styles.emptyText}>No todos yet. Add one above!</Text>
        }
      />

      {todos.length > 0 && (
        <TouchableOpacity
          style={styles.clearButton}
          onPress={clearCompleted}
        >
          <Text style={styles.clearButtonText}>
            Clear Completed ({todos.filter(t => t.completed).length})
          </Text>
        </TouchableOpacity>
      )}
    </View>
  );
};

// Form component with complex state
const UserForm = () => {
  const [formData, setFormData] = useState({
    firstName: '',
    lastName: '',
    email: '',
    age: '',
    interests: [] as string[]
  });

  const [errors, setErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const updateField = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    // Clear error when user starts typing
    if (errors[field]) {
      setErrors(prev => ({ ...prev, [field]: null }));
    }
  };

  const toggleInterest = (interest) => {
    setFormData(prev => ({
      ...prev,
      interests: prev.interests.includes(interest)
        ? prev.interests.filter(i => i !== interest)
        : [...prev.interests, interest]
    }));
  };

  const validateForm = () => {
    const newErrors = {};

    if (!formData.firstName.trim()) newErrors.firstName = 'First name is required';
    if (!formData.lastName.trim()) newErrors.lastName = 'Last name is required';
    if (!formData.email.trim()) newErrors.email = 'Email is required';
    else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) newErrors.email = 'Email is invalid';

    if (!formData.age) newErrors.age = 'Age is required';
    else if (isNaN(formData.age) || formData.age < 18) newErrors.age = 'Must be 18 or older';

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async () => {
    if (!validateForm()) return;

    setIsSubmitting(true);

    try {
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 2000));
      console.log('Form submitted:', formData);
      alert('Form submitted successfully!');
    } catch (error) {
      alert('Submission failed. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  const interests = ['React', 'React Native', 'Node.js', 'Python', 'DevOps'];

  return (
    <View style={styles.section}>
      <Text style={styles.title}>User Form with Complex State</Text>

      <TextInput
        style={[styles.input, errors.firstName && styles.inputError]}
        placeholder="First Name"
        value={formData.firstName}
        onChangeText={(value) => updateField('firstName', value)}
      />
      {errors.firstName && <Text style={styles.errorText}>{errors.firstName}</Text>}

      <TextInput
        style={[styles.input, errors.lastName && styles.inputError]}
        placeholder="Last Name"
        value={formData.lastName}
        onChangeText={(value) => updateField('lastName', value)}
      />
      {errors.lastName && <Text style={styles.errorText}>{errors.lastName}</Text>}

      <TextInput
        style={[styles.input, errors.email && styles.inputError]}
        placeholder="Email"
        value={formData.email}
        onChangeText={(value) => updateField('email', value)}
        keyboardType="email-address"
        autoCapitalize="none"
      />
      {errors.email && <Text style={styles.errorText}>{errors.email}</Text>}

      <TextInput
        style={[styles.input, errors.age && styles.inputError]}
        placeholder="Age"
        value={formData.age}
        onChangeText={(value) => updateField('age', value)}
        keyboardType="numeric"
      />
      {errors.age && <Text style={styles.errorText}>{errors.age}</Text>}

      <Text style={styles.label}>Interests:</Text>
      <View style={styles.interestsContainer}>
        {interests.map((interest) => (
          <TouchableOpacity
            key={interest}
            style={[
              styles.interestChip,
              formData.interests.includes(interest) && styles.interestChipSelected
            ]}
            onPress={() => toggleInterest(interest)}
          >
            <Text style={[
              styles.interestText,
              formData.interests.includes(interest) && styles.interestTextSelected
            ]}>
              {interest}
            </Text>
          </TouchableOpacity>
        ))}
      </View>

      <TouchableOpacity
        style={[styles.submitButton, isSubmitting && styles.submitButtonDisabled]}
        onPress={handleSubmit}
        disabled={isSubmitting}
      >
        <Text style={styles.submitButtonText}>
          {isSubmitting ? 'Submitting...' : 'Submit'}
        </Text>
      </TouchableOpacity>
    </View>
  );
};

const App = () => {
  return (
    <ScrollView style={styles.container}>
      <Counter />
      <TodoList />
      <UserForm />
    </ScrollView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#f5f5f5',
  },
  section: {
    backgroundColor: 'white',
    padding: 20,
    marginBottom: 20,
    borderRadius: 12,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  title: {
    fontSize: 20,
    fontWeight: 'bold',
    marginBottom: 15,
    color: '#333',
  },
  count: {
    fontSize: 24,
    fontWeight: 'bold',
    textAlign: 'center',
    marginBottom: 20,
    color: '#007AFF',
  },
  inputContainer: {
    flexDirection: 'row',
    marginBottom: 15,
  },
  input: {
    flex: 1,
    borderWidth: 1,
    borderColor: '#ddd',
    borderRadius: 8,
    padding: 12,
    fontSize: 16,
    marginRight: 10,
  },
  inputError: {
    borderColor: '#FF3B30',
  },
  label: {
    fontSize: 16,
    fontWeight: '600',
    marginBottom: 10,
    color: '#333',
  },
  buttonRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 10,
  },
  button: {
    paddingHorizontal: 20,
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
    minWidth: 80,
  },
  increment: {
    backgroundColor: '#4CD964',
  },
  decrement: {
    backgroundColor: '#FF3B30',
  },
  reset: {
    backgroundColor: '#FF9500',
  },
  buttonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
  todoList: {
    maxHeight: 200,
  },
  todoItem: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 10,
    borderBottomWidth: 1,
    borderBottomColor: '#f0f0f0',
  },
  todoCheckbox: {
    marginRight: 10,
  },
  checkbox: {
    fontSize: 18,
  },
  todoText: {
    flex: 1,
    fontSize: 16,
    color: '#333',
  },
  completedText: {
    textDecorationLine: 'line-through',
    color: '#999',
  },
  deleteButton: {
    padding: 5,
  },
  deleteText: {
    fontSize: 16,
  },
  addButton: {
    backgroundColor: '#007AFF',
    paddingHorizontal: 20,
    paddingVertical: 12,
    borderRadius: 8,
    justifyContent: 'center',
  },
  addButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
  emptyText: {
    textAlign: 'center',
    color: '#999',
    fontStyle: 'italic',
    marginTop: 20,
  },
  clearButton: {
    backgroundColor: '#FF3B30',
    padding: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 10,
  },
  clearButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
  errorText: {
    color: '#FF3B30',
    fontSize: 14,
    marginBottom: 10,
  },
  interestsContainer: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    marginBottom: 20,
  },
  interestChip: {
    backgroundColor: '#f0f0f0',
    paddingHorizontal: 12,
    paddingVertical: 8,
    borderRadius: 20,
    margin: 4,
  },
  interestChipSelected: {
    backgroundColor: '#007AFF',
  },
  interestText: {
    color: '#333',
    fontSize: 14,
  },
  interestTextSelected: {
    color: 'white',
  },
  submitButton: {
    backgroundColor: '#007AFF',
    padding: 15,
    borderRadius: 8,
    alignItems: 'center',
  },
  submitButtonDisabled: {
    backgroundColor: '#ccc',
  },
  submitButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
});

export default App;`},{title:"Global State Management with Context API",language:"javascript",code:`import React, { createContext, useContext, useReducer, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  FlatList,
  Alert
} from 'react-native';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Types
const ActionTypes = {
  ADD_TO_CART: 'ADD_TO_CART',
  REMOVE_FROM_CART: 'REMOVE_FROM_CART',
  UPDATE_QUANTITY: 'UPDATE_QUANTITY',
  CLEAR_CART: 'CLEAR_CART',
  SET_LOADING: 'SET_LOADING',
  SET_ERROR: 'SET_ERROR',
  CLEAR_ERROR: 'CLEAR_ERROR'
};

// Initial state
const initialState = {
  cart: [],
  loading: false,
  error: null
};

// Reducer
const cartReducer = (state, action) => {
  switch (action.type) {
    case ActionTypes.ADD_TO_CART:
      const existingItem = state.cart.find(item => item.id === action.payload.id);
      if (existingItem) {
        return {
          ...state,
          cart: state.cart.map(item =>
            item.id === action.payload.id
              ? { ...item, quantity: item.quantity + 1 }
              : item
          )
        };
      }
      return {
        ...state,
        cart: [...state.cart, { ...action.payload, quantity: 1 }]
      };

    case ActionTypes.REMOVE_FROM_CART:
      return {
        ...state,
        cart: state.cart.filter(item => item.id !== action.payload)
      };

    case ActionTypes.UPDATE_QUANTITY:
      return {
        ...state,
        cart: state.cart.map(item =>
          item.id === action.payload.id
            ? { ...item, quantity: Math.max(0, action.payload.quantity) }
            : item
        ).filter(item => item.quantity > 0)
      };

    case ActionTypes.CLEAR_CART:
      return {
        ...state,
        cart: []
      };

    case ActionTypes.SET_LOADING:
      return {
        ...state,
        loading: action.payload
      };

    case ActionTypes.SET_ERROR:
      return {
        ...state,
        error: action.payload,
        loading: false
      };

    case ActionTypes.CLEAR_ERROR:
      return {
        ...state,
        error: null
      };

    default:
      return state;
  }
};

// Context
const CartContext = createContext();

// Provider component
export const CartProvider = ({ children }) => {
  const [state, dispatch] = useReducer(cartReducer, initialState);

  // Load cart from AsyncStorage on mount
  useEffect(() => {
    const loadCart = async () => {
      try {
        const savedCart = await AsyncStorage.getItem('cart');
        if (savedCart) {
          const cartData = JSON.parse(savedCart);
          // Restore cart items
          cartData.forEach(item => {
            dispatch({ type: ActionTypes.ADD_TO_CART, payload: item });
          });
        }
      } catch (error) {
        console.error('Failed to load cart:', error);
      }
    };

    loadCart();
  }, []);

  // Save cart to AsyncStorage whenever it changes
  useEffect(() => {
    const saveCart = async () => {
      try {
        await AsyncStorage.setItem('cart', JSON.stringify(state.cart));
      } catch (error) {
        console.error('Failed to save cart:', error);
      }
    };

    saveCart();
  }, [state.cart]);

  // Actions
  const addToCart = (product) => {
    dispatch({ type: ActionTypes.ADD_TO_CART, payload: product });
  };

  const removeFromCart = (productId) => {
    dispatch({ type: ActionTypes.REMOVE_FROM_CART, payload: productId });
  };

  const updateQuantity = (productId, quantity) => {
    dispatch({
      type: ActionTypes.UPDATE_QUANTITY,
      payload: { id: productId, quantity }
    });
  };

  const clearCart = () => {
    Alert.alert(
      'Clear Cart',
      'Are you sure you want to clear your cart?',
      [
        { text: 'Cancel', style: 'cancel' },
        { text: 'Clear', style: 'destructive', onPress: () => dispatch({ type: ActionTypes.CLEAR_CART }) }
      ]
    );
  };

  const getTotalPrice = () => {
    return state.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
  };

  const getTotalItems = () => {
    return state.cart.reduce((total, item) => total + item.quantity, 0);
  };

  const value = {
    ...state,
    addToCart,
    removeFromCart,
    updateQuantity,
    clearCart,
    getTotalPrice,
    getTotalItems
  };

  return (
    <CartContext.Provider value={value}>
      {children}
    </CartContext.Provider>
  );
};

// Custom hook to use cart context
export const useCart = () => {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within a CartProvider');
  }
  return context;
};

// Sample products
const products = [
  { id: 1, name: 'iPhone 13', price: 999, description: 'Latest iPhone model' },
  { id: 2, name: 'MacBook Pro', price: 1999, description: 'Powerful laptop for developers' },
  { id: 3, name: 'iPad Air', price: 599, description: 'Versatile tablet' },
  { id: 4, name: 'AirPods Pro', price: 249, description: 'Wireless earbuds with noise cancellation' }
];

// Product List Component
const ProductList = () => {
  const { addToCart } = useCart();

  const renderProduct = ({ item }) => (
    <View style={styles.productCard}>
      <Text style={styles.productName}>{item.name}</Text>
      <Text style={styles.productDescription}>{item.description}</Text>
      <Text style={styles.productPrice}>\${item.price}</Text>
      <TouchableOpacity
        style={styles.addButton}
        onPress={() => addToCart(item)}
      >
        <Text style={styles.addButtonText}>Add to Cart</Text>
      </TouchableOpacity>
    </View>
  );

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Products</Text>
      <FlatList
        data={products}
        renderItem={renderProduct}
        keyExtractor={(item) => item.id.toString()}
        contentContainerStyle={styles.productList}
      />
    </View>
  );
};

// Cart Component
const Cart = () => {
  const {
    cart,
    removeFromCart,
    updateQuantity,
    clearCart,
    getTotalPrice,
    getTotalItems
  } = useCart();

  const renderCartItem = ({ item }) => (
    <View style={styles.cartItem}>
      <View style={styles.itemInfo}>
        <Text style={styles.itemName}>{item.name}</Text>
        <Text style={styles.itemPrice}>\${item.price}</Text>
      </View>

      <View style={styles.quantityControls}>
        <TouchableOpacity
          style={styles.quantityButton}
          onPress={() => updateQuantity(item.id, item.quantity - 1)}
        >
          <Text style={styles.quantityButtonText}>-</Text>
        </TouchableOpacity>

        <Text style={styles.quantityText}>{item.quantity}</Text>

        <TouchableOpacity
          style={styles.quantityButton}
          onPress={() => updateQuantity(item.id, item.quantity + 1)}
        >
          <Text style={styles.quantityButtonText}>+</Text>
        </TouchableOpacity>
      </View>

      <TouchableOpacity
        style={styles.removeButton}
        onPress={() => removeFromCart(item.id)}
      >
        <Text style={styles.removeButtonText}>Remove</Text>
      </TouchableOpacity>
    </View>
  );

  return (
    <View style={styles.container}>
      <View style={styles.cartHeader}>
        <Text style={styles.title}>Cart ({getTotalItems()} items)</Text>
        {cart.length > 0 && (
          <TouchableOpacity onPress={clearCart}>
            <Text style={styles.clearText}>Clear All</Text>
          </TouchableOpacity>
        )}
      </View>

      {cart.length === 0 ? (
        <Text style={styles.emptyText}>Your cart is empty</Text>
      ) : (
        <>
          <FlatList
            data={cart}
            renderItem={renderCartItem}
            keyExtractor={(item) => item.id.toString()}
            contentContainerStyle={styles.cartList}
          />

          <View style={styles.cartSummary}>
            <Text style={styles.totalText}>
              Total: \${getTotalPrice().toFixed(2)}
            </Text>
            <TouchableOpacity style={styles.checkoutButton}>
              <Text style={styles.checkoutButtonText}>Checkout</Text>
            </TouchableOpacity>
          </View>
        </>
      )}
    </View>
  );
};

// Main App Component
const App = () => {
  return (
    <CartProvider>
      <View style={styles.app}>
        <ProductList />
        <Cart />
      </View>
    </CartProvider>
  );
};

const styles = StyleSheet.create({
  app: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  container: {
    padding: 20,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 20,
    color: '#333',
  },
  productList: {
    paddingBottom: 20,
  },
  productCard: {
    backgroundColor: 'white',
    padding: 15,
    marginBottom: 10,
    borderRadius: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  productName: {
    fontSize: 18,
    fontWeight: '600',
    marginBottom: 5,
    color: '#333',
  },
  productDescription: {
    fontSize: 14,
    color: '#666',
    marginBottom: 10,
  },
  productPrice: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#007AFF',
    marginBottom: 10,
  },
  addButton: {
    backgroundColor: '#007AFF',
    padding: 10,
    borderRadius: 6,
    alignItems: 'center',
  },
  addButtonText: {
    color: 'white',
    fontWeight: '600',
  },
  cartHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 20,
  },
  clearText: {
    color: '#FF3B30',
    fontSize: 16,
  },
  emptyText: {
    textAlign: 'center',
    fontSize: 16,
    color: '#999',
    fontStyle: 'italic',
  },
  cartList: {
    paddingBottom: 20,
  },
  cartItem: {
    backgroundColor: 'white',
    padding: 15,
    marginBottom: 10,
    borderRadius: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  itemInfo: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 10,
  },
  itemName: {
    fontSize: 16,
    fontWeight: '600',
    color: '#333',
    flex: 1,
  },
  itemPrice: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#007AFF',
  },
  quantityControls: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 10,
  },
  quantityButton: {
    backgroundColor: '#f0f0f0',
    width: 30,
    height: 30,
    borderRadius: 15,
    alignItems: 'center',
    justifyContent: 'center',
  },
  quantityButtonText: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#333',
  },
  quantityText: {
    fontSize: 16,
    fontWeight: '600',
    marginHorizontal: 15,
    minWidth: 30,
    textAlign: 'center',
  },
  removeButton: {
    backgroundColor: '#FF3B30',
    padding: 8,
    borderRadius: 6,
    alignItems: 'center',
  },
  removeButtonText: {
    color: 'white',
    fontSize: 14,
    fontWeight: '600',
  },
  cartSummary: {
    backgroundColor: 'white',
    padding: 20,
    borderRadius: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  totalText: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#333',
    textAlign: 'center',
    marginBottom: 15,
  },
  checkoutButton: {
    backgroundColor: '#4CD964',
    padding: 15,
    borderRadius: 8,
    alignItems: 'center',
  },
  checkoutButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
});

export default App;`}]}],projects:[{title:"Cross-Platform E-commerce App",description:"Build a complete e-commerce mobile application with React Native, featuring product catalog, shopping cart, user authentication, and payment integration",difficulty:"advanced",estimatedHours:60,technologies:["React Native","Redux","React Navigation","AsyncStorage","Stripe","Firebase"],features:["Cross-platform iOS and Android support","Product catalog with search and filtering","User authentication and profile management","Shopping cart with persistent storage","Payment integration with Stripe","Order history and tracking","Push notifications","Offline data synchronization","Image upload and management","Real-time chat support","App store deployment preparation"]},{title:"Social Media Mobile App",description:"Create a social media application with React Native, including user profiles, posts, comments, likes, and real-time messaging",difficulty:"advanced",estimatedHours:55,technologies:["React Native","Socket.io","AsyncStorage","Image Picker","Camera","Geolocation"],features:["User registration and authentication","Create and view posts with images","Like, comment, and share functionality","Real-time messaging and notifications","User profiles with follower/following","Location-based content discovery","Push notifications for interactions","Offline content caching","Image and video upload","Privacy settings and content moderation","Dark mode support"]},{title:"Fitness Tracking App",description:"Build a comprehensive fitness tracking application with workout logging, progress tracking, and social features",difficulty:"intermediate",estimatedHours:40,technologies:["React Native","SQLite","Health Kit","Google Fit","Charts","Calendar"],features:["Workout logging and tracking","Exercise database with custom exercises","Progress charts and analytics","Integration with Health Kit/Google Fit","Calendar view for workout planning","Social features for sharing achievements","Goal setting and progress tracking","Rest timer and workout music integration","Offline workout capability","Data export and backup","Custom workout plan creation"]}],assessments:{quiz:[{question:"What is the main difference between React and React Native?",options:["React Native uses a different programming language","React Native renders native mobile components instead of web DOM","React Native is only for iOS development","React Native doesn't use JSX"],correctAnswer:1,explanation:"React Native renders native mobile components instead of web DOM elements, allowing for truly native mobile applications."},{question:"Which library is most commonly used for navigation in React Native?",options:["React Router","React Navigation","React Router Native","Native Navigation"],correctAnswer:1,explanation:"React Navigation is the most popular and feature-rich navigation library for React Native applications."},{question:"What is the purpose of Platform.select() in React Native?",options:["To select the best platform for deployment","To conditionally render components based on platform","To choose between different navigation patterns","To select the appropriate state management library"],correctAnswer:1,explanation:"Platform.select() allows you to write platform-specific code by providing different values for iOS and Android."},{question:"Which hook is commonly used for local state management in React Native?",options:["useEffect","useState","useContext","useNavigation"],correctAnswer:1,explanation:"useState is the primary hook for managing local component state in React Native."},{question:"What is AsyncStorage used for in React Native?",options:["Storing temporary data in memory","Persistent key-value storage","Managing application state","Caching network requests"],correctAnswer:1,explanation:"AsyncStorage provides persistent key-value storage for React Native applications, similar to localStorage in web browsers."}],evaluation:[{scenario:"Your team is building a cross-platform mobile application for a client. The application needs to work on both iOS and Android with native performance and user experience.",questions:["What factors would you consider when choosing between React Native and native development?","How would you structure the project for cross-platform development?","What strategies would you implement for handling platform-specific features?","How would you ensure consistent user experience across platforms?"]},{scenario:"You're developing a React Native application that requires complex state management, navigation between multiple screens, and integration with device features.",questions:["What navigation solution would you choose and why?","How would you implement state management for this application?","What strategies would you use for integrating device features like camera and location?","How would you handle offline functionality and data synchronization?"]}]},aiPrompts:["How do I set up a new React Native project?","What's the difference between React and React Native?","How do I handle platform-specific code in React Native?","How do I implement navigation in React Native?","How do I manage state in React Native applications?","How do I integrate native modules in React Native?","How do I optimize React Native app performance?","How do I handle push notifications in React Native?","How do I implement offline functionality in React Native?","How do I deploy React Native apps to app stores?","How do I use TypeScript with React Native?","How do I handle different screen sizes in React Native?","How do I implement authentication in React Native?","How do I use camera and image picker in React Native?","How do I handle app state changes in React Native?"],resources:[{title:"React Native Documentation",type:"documentation",url:"https://reactnative.dev/docs/getting-started",description:"Official React Native documentation with comprehensive guides and API reference"},{title:"React Navigation",type:"documentation",url:"https://reactnavigation.org/docs/getting-started",description:"Official documentation for React Navigation library"},{title:"Expo Documentation",type:"documentation",url:"https://docs.expo.dev/",description:"Expo documentation for easier React Native development"},{title:"React Native Elements",type:"library",url:"https://react-native-elements.github.io/react-native-elements/",description:"Cross-platform React Native UI toolkit"},{title:"React Native Directory",type:"directory",url:"https://reactnative.directory/",description:"Directory of React Native libraries and tools"}],toolsRequired:["Node.js (v14+)","npm or yarn","React Native CLI or Expo CLI","Android Studio (for Android development)","Xcode (for iOS development)","Visual Studio Code with React Native extensions","React Navigation","Redux or Zustand (state management)","AsyncStorage","React Native Vector Icons","React Native Gesture Handler","React Native Reanimated","Flipper (debugging tool)","Fastlane (deployment automation)","CodePush (over-the-air updates)","Detox (end-to-end testing)","Jest (unit testing)","ESLint (code linting)","Prettier (code formatting)","TypeScript (optional, for type safety)"],bestPractices:["Use Expo for rapid prototyping and simpler development","Implement proper error boundaries for crash prevention","Use platform-specific file extensions for platform code","Optimize images and assets for mobile devices","Implement proper loading states and error handling","Use FlatList for large lists with proper optimization","Implement proper keyboard handling for forms","Use React.memo for component optimization","Implement proper navigation with deep linking support","Use AsyncStorage wisely with proper error handling","Implement offline support for better user experience","Use proper TypeScript types for better development experience","Implement proper security measures for sensitive data","Use React Navigation hooks for navigation logic","Implement proper state management patterns","Use React Native's built-in performance monitoring","Implement proper app state handling (active, background, inactive)","Use proper image optimization and caching","Implement proper push notification handling","Use React Native's accessibility features","Implement proper internationalization support","Use proper error reporting and crash analytics","Implement proper app versioning and update mechanisms","Use React Native's built-in gesture system","Implement proper memory management","Use proper network request handling with timeouts","Implement proper data validation and sanitization","Use React Native's built-in animation system","Implement proper offline data synchronization","Use proper code splitting for better performance"],commonPitfalls:["Not handling platform differences properly","Using web-specific CSS properties in React Native","Not optimizing images and assets for mobile","Implementing complex navigation without proper planning","Not handling app state changes properly","Using too many bridge communications","Not implementing proper error handling","Using deprecated React Native APIs","Not testing on real devices during development","Implementing heavy computations on JavaScript thread","Not handling keyboard appearance properly","Using large bundle sizes without code splitting","Not implementing proper offline support","Using insecure data storage methods","Not handling different screen sizes properly","Implementing complex animations without optimization","Not using proper TypeScript types","Using outdated React Native versions","Not implementing proper security measures","Using too many third-party libraries","Not optimizing list rendering performance","Implementing complex state management unnecessarily","Not handling network connectivity properly","Using deprecated lifecycle methods","Not implementing proper accessibility","Using large images without optimization","Not handling app permissions properly","Implementing complex business logic in components","Not using proper error boundaries","Using synchronous storage operations","Not implementing proper loading states","Using deprecated navigation patterns","Not handling deep linking properly","Implementing complex gesture handling without optimization","Not using proper memory management techniques","Using outdated third-party libraries","Not implementing proper testing strategies","Using complex styling without optimization","Not handling different device orientations","Implementing heavy database operations on main thread"],careerRelevance:["React Native is one of the most popular cross-platform mobile frameworks","High demand for React Native developers in mobile app development","Cross-platform skills reduce development time and costs","React Native knowledge is valuable for startups and enterprises","Mobile development skills are essential in modern software development","React Native enables faster time-to-market for mobile applications","Cross-platform expertise is crucial for app development agencies","React Native skills complement React web development expertise","Mobile app development is a growing market with high demand","React Native enables building for multiple platforms with single codebase","Native performance with JavaScript development is highly valued","React Native community and ecosystem are rapidly growing","Cross-platform development skills are future-proof","Mobile app monetization opportunities are significant","React Native enables rapid prototyping and MVPs","Native module development skills are advanced and valuable","Performance optimization in React Native is a specialized skill","App store deployment knowledge is essential for mobile developers","Offline-first application development is increasingly important","Push notification and real-time features are in high demand","Integration with native device features is a key skill","State management in mobile applications is complex and valuable","Navigation patterns in mobile apps require specialized knowledge","Accessibility in mobile applications is increasingly important","Security in mobile applications is critical and specialized","Testing mobile applications requires specific knowledge","Performance monitoring and optimization are advanced skills","App architecture for mobile applications is specialized knowledge","User experience design for mobile is a valuable skill","Integration with backend services is essential for mobile apps","Deployment and distribution knowledge is crucial for mobile developers","Version management and updates are important mobile skills","Cross-platform compatibility testing is a specialized skill","Device-specific optimization is an advanced mobile skill","Battery and resource optimization is valuable knowledge","Offline data synchronization is a complex and valuable skill","Push notification management is specialized knowledge","In-app purchase implementation is advanced mobile development","App store optimization and marketing knowledge is valuable","User retention and engagement metrics are important skills","A/B testing in mobile applications is specialized knowledge","Crash reporting and analytics are essential mobile skills","Performance profiling and bottleneck identification are advanced","Memory management in mobile applications is critical knowledge","Network optimization for mobile is specialized skill","Background processing in mobile apps is advanced knowledge","Local storage and data persistence are important mobile skills","Biometric authentication integration is valuable knowledge","Geolocation and mapping integration are specialized skills","Camera and media handling in mobile is advanced knowledge","Audio and video processing in mobile apps is specialized","Sensor integration (accelerometer, gyroscope) is advanced","NFC and Bluetooth integration are specialized mobile skills","Widget development for mobile platforms is valuable knowledge","Wearable device integration is emerging and valuable","AR/VR integration in mobile apps is cutting-edge knowledge","Machine learning integration in mobile is advanced skill","IoT device integration with mobile apps is specialized","Blockchain integration in mobile applications is emerging","5G and edge computing integration is future-oriented","Quantum computing integration is cutting-edge knowledge"]},jM={id:"flutter",tier:5,name:"Flutter",description:"Master cross-platform mobile development with Flutter and Dart. Build beautiful, natively compiled applications for mobile, web, and desktop from a single codebase with comprehensive coverage of Material Design, state management, and platform integration.",difficulty:"advanced",estimatedHours:40,prerequisites:["javascript","react","nodejs"],learningObjectives:["Master Dart programming language fundamentals and advanced features","Build beautiful UIs with Flutter widgets and Material Design","Implement state management with Provider, Riverpod, and BLoC patterns","Create responsive layouts that work across different screen sizes","Integrate platform-specific features using platform channels","Handle asynchronous operations with Futures, Streams, and async/await","Implement navigation and routing in Flutter applications","Use Firebase for backend services and data persistence","Optimize Flutter app performance and reduce bundle size","Implement testing strategies for Flutter applications","Handle app lifecycle and background processing","Create custom widgets and reusable component libraries","Implement internationalization and localization","Use Flutter with popular backend services and APIs","Deploy Flutter apps to app stores and web platforms","Debug and troubleshoot Flutter applications effectively"],sections:[{title:"Dart Programming Fundamentals",content:`Dart is the programming language used by Flutter for building cross-platform applications. It combines the best features of modern programming languages with excellent performance and developer experience.

**Object-Oriented**: Dart is a true object-oriented language with classes, interfaces, and inheritance. Everything in Dart is an object, including numbers and functions.

**Strong Typing**: Dart supports both static and dynamic typing, allowing for type safety while maintaining flexibility.

**Async Programming**: Dart provides excellent support for asynchronous programming with async/await, Futures, and Streams.

**Garbage Collection**: Dart uses a generational garbage collector for efficient memory management.

**Just-In-Time (JIT) and Ahead-Of-Time (AOT)**: Dart uses JIT for development (hot reload) and AOT for production (fast startup and execution).

**Null Safety**: Dart's sound null safety helps prevent null reference errors at compile time.`,keyTopics:["Dart syntax and basic constructs","Object-oriented programming in Dart","Type system and generics","Asynchronous programming patterns","Error handling and exceptions","Collections and data structures"],practicalExercises:["Set up Dart development environment","Create basic Dart programs with classes and functions","Implement data structures using Dart collections","Handle asynchronous operations with Futures and Streams","Create generic classes and functions","Implement error handling and custom exceptions"],codeExamples:[{title:"Dart Basics and Object-Oriented Programming",language:"dart",code:`// Basic Dart syntax and types
void main() {
  // Variables and type inference
  var name = 'Flutter'; // String
  var year = 2024; // int
  var isAwesome = true; // bool
  var pi = 3.14159; // double

  // Explicit typing
  String greeting = 'Hello, Dart!';
  int age = 25;
  double height = 175.5;
  bool isStudent = false;

  // Nullable types (with null safety)
  String? nullableName;
  int? nullableAge;

  // Late initialization
  late String lateName;
  lateName = 'Initialized later';

  // Final and const
  final String finalName = 'Cannot be reassigned';
  const int maxRetries = 3;

  // Collections
  List<String> fruits = ['Apple', 'Banana', 'Orange'];
  Set<String> uniqueFruits = {'Apple', 'Banana', 'Apple'}; // Only unique values
  Map<String, int> scores = {'Alice': 95, 'Bob': 87, 'Charlie': 92};

  // Control flow
  if (age >= 18) {
    print('Adult');
  } else {
    print('Minor');
  }

  // Loops
  for (var fruit in fruits) {
    print(fruit);
  }

  // Switch statement
  switch (greeting) {
    case 'Hello, Dart!':
      print('Greeting received');
      break;
    default:
      print('Unknown greeting');
  }

  // Functions
  String greet(String name, [String? title]) {
    if (title != null) {
      return 'Hello, \${title} \${name}!';
    }
    return 'Hello, \${name}!';
  }

  // Arrow functions
  int add(int a, int b) => a + b;
  void printMessage(String message) => print(message);

  // Optional parameters
  void configure({String? theme, int? fontSize, bool? darkMode}) {
    theme ??= 'light';
    fontSize ??= 14;
    darkMode ??= false;

    print('Theme: \${theme}, Font Size: \${fontSize}, Dark Mode: \${darkMode}');
  }

  // Named parameters
  configure(theme: 'dark', fontSize: 16);

  print(greet('World'));
  print('Sum: \${add(5, 3)}');
}

// Classes and OOP
class Person {
  // Properties
  String name;
  int age;
  String? email;

  // Constructor
  Person(this.name, this.age, {this.email});

  // Named constructor
  Person.fromJson(Map<String, dynamic> json)
      : name = json['name'],
        age = json['age'],
        email = json['email'];

  // Methods
  void introduce() {
    print('Hi, I\\'m \${name} and I\\'m \${age} years old.');
  }

  // Getter
  String get displayName => name.toUpperCase();

  // Setter
  set displayName(String value) {
    name = value.toLowerCase();
  }

  // toString override
  @override
  String toString() => 'Person(name: \${name}, age: \${age}, email: \${email})';
}

// Inheritance
class Student extends Person {
  String school;
  List<double> grades;

  Student(String name, int age, this.school, {String? email})
      : grades = [],
        super(name, age, email: email);

  void addGrade(double grade) {
    if (grade >= 0 && grade <= 100) {
      grades.add(grade);
    }
  }

  double get averageGrade {
    if (grades.isEmpty) return 0.0;
    return grades.reduce((a, b) => a + b) / grades.length;
  }

  @override
  void introduce() {
    super.introduce();
    print('I study at \${school} and my average grade is \${averageGrade.toStringAsFixed(1)}');
  }
}

// Abstract classes
abstract class Shape {
  double get area;
  double get perimeter;

  void draw() {
    print('Drawing a shape');
  }
}

class Circle extends Shape {
  double radius;

  Circle(this.radius);

  @override
  double get area => 3.14159 * radius * radius;

  @override
  double get perimeter => 2 * 3.14159 * radius;

  @override
  void draw() {
    print('Drawing a circle with radius \${radius}');
  }
}

class Rectangle extends Shape {
  double width;
  double height;

  Rectangle(this.width, this.height);

  @override
  double get area => width * height;

  @override
  double get perimeter => 2 * (width + height);
}

// Mixins
mixin Logger {
  void log(String message) {
    final timestamp = DateTime.now().toIso8601String();
    print('[\\${timestamp}] \\${message}');
  }
}

class Service with Logger {
  void performAction() {
    log('Action started');
    // Perform some action
    log('Action completed');
  }
}

// Enums
enum Status {
  pending,
  active,
  inactive,
  deleted
}

enum Priority {
  low(1),
  medium(2),
  high(3);

  const Priority(this.value);
  final int value;
}

// Generics
class Stack<T> {
  final List<T> _items = [];

  void push(T item) => _items.add(item);
  T pop() => _items.removeLast();
  T peek() => _items.last;
  bool get isEmpty => _items.isEmpty;
  bool get isNotEmpty => _items.isNotEmpty;

  @override
  String toString() => _items.toString();
}

// Generic functions
T findMax<T extends Comparable<T>>(List<T> items) {
  if (items.isEmpty) throw ArgumentError('List cannot be empty');
  return items.reduce((a, b) => a.compareTo(b) > 0 ? a : b);
}

// Usage examples
void demonstrateOOP() {
  // Create instances
  var person = Person('Alice', 30, email: 'alice@example.com');
  person.introduce();
  print(person.displayName);

  var student = Student('Bob', 20, 'University of Dart');
  student.addGrade(85.5);
  student.addGrade(92.0);
  student.introduce();

  // Shapes
  var circle = Circle(5.0);
  print('Circle area: \\${circle.area}');
  circle.draw();

  var rectangle = Rectangle(10.0, 8.0);
  print('Rectangle area: \\${rectangle.area}');

  // Mixins
  var service = Service();
  service.performAction();

  // Generics
  var stringStack = Stack<String>();
  stringStack.push('Hello');
  stringStack.push('World');
  print('Stack: \\${stringStack}');
  print('Popped: \\${stringStack.pop()}');

  var numbers = [3, 1, 4, 1, 5, 9, 2, 6];
  print('Max number: \\${findMax(numbers)}');

  var words = ['apple', 'banana', 'cherry'];
  print('Max word: \\${findMax(words)}');
}
    },
    {
      title: "Flutter Widgets and Material Design",
      content: "Flutter's widget system is the core of building user interfaces. Everything in Flutter is a widget - from simple text to complex layouts. Material Design provides a comprehensive design system that ensures consistency across platforms.

**Widget Tree**: Flutter apps are built as a tree of widgets, where each widget nests inside another.

**Stateless vs Stateful**: Stateless widgets are immutable and don't change over time, while stateful widgets can rebuild when their state changes.

**Material Design**: Google's design language that provides guidelines for visual, motion, and interaction design.

**Themes**: Customize the look and feel of your app with themes and theme data.

**Responsive Design**: Create layouts that adapt to different screen sizes and orientations.

**Custom Widgets**: Build reusable components by composing existing widgets.",
      keyTopics: [
        "Widget composition and nesting",
        "StatelessWidget vs StatefulWidget",
        "Material Design components",
        "Layout widgets (Container, Row, Column, Stack)",
        "Theme customization",
        "Custom widget creation",
        "Responsive design patterns"
      ],
      practicalExercises: [
        "Create basic Flutter app structure",
        "Build layouts using Rows and Columns",
        "Implement Material Design components",
        "Create custom stateless widgets",
        "Build stateful widgets with user interaction",
        "Customize app themes and colors",
        "Implement responsive layouts"
      ],
      codeExamples: [
        {
          title: "Basic Flutter App Structure and Widgets",
          language: "dart",
          code: 'import \\'package:flutter/material.dart\\';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: \\'Flutter Demo\\',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        useMaterial3: true,
      ),
      home: const MyHomePage(),
    );
  }
}

class MyHomePage extends StatefulWidget {
  const MyHomePage({super.key});

  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text(\\'Flutter Demo Home Page\\'),
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            const Text(
              \\'You have pushed the button this many times:\\',
            ),
            Text(
              \\'$_counter\\',
              style: Theme.of(context).textTheme.headlineMedium,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: \\'Increment\\',
        child: const Icon(Icons.add),
      ),
    );
  }
}

// Custom Stateless Widget
class CustomCard extends StatelessWidget {
  final String title;
  final String description;
  final IconData icon;
  final VoidCallback? onTap;

  const CustomCard({
    super.key,
    required this.title,
    required this.description,
    required this.icon,
    this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 4,
      margin: const EdgeInsets.all(8),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Row(
            children: [
              Icon(
                icon,
                size: 48,
                color: Theme.of(context).primaryColor,
              ),
              const SizedBox(width: 16),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      title,
                      style: Theme.of(context).textTheme.titleLarge,
                    ),
                    const SizedBox(height: 4),
                    Text(
                      description,
                      style: Theme.of(context).textTheme.bodyMedium,
                    ),
                  ],
                ),
              ),
              const Icon(Icons.arrow_forward_ios, size: 16),
            ],
          ),
        ),
      ),
    );
  }
}

// Layout Examples
class LayoutExamples extends StatelessWidget {
  const LayoutExamples({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Layout Examples')),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Row Example
            const Text('Row Layout:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
            const SizedBox(height: 8),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceEvenly,
              children: [
                Container(
                  width: 50,
                  height: 50,
                  color: Colors.red,
                  child: const Center(child: Text('1', style: TextStyle(color: Colors.white))),
                ),
                Container(
                  width: 50,
                  height: 50,
                  color: Colors.green,
                  child: const Center(child: Text('2', style: TextStyle(color: Colors.white))),
                ),
                Container(
                  width: 50,
                  height: 50,
                  color: Colors.blue,
                  child: const Center(child: Text('3', style: TextStyle(color: Colors.white))),
                ),
              ],
            ),
            const SizedBox(height: 24),

            // Column Example
            const Text('Column Layout:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
            const SizedBox(height: 8),
            Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Container(
                  width: double.infinity,
                  height: 50,
                  color: Colors.purple,
                  child: const Center(child: Text('Header', style: TextStyle(color: Colors.white))),
                ),
                Container(
                  width: double.infinity,
                  height: 100,
                  color: Colors.orange,
                  child: const Center(child: Text('Content', style: TextStyle(color: Colors.white))),
                ),
                Container(
                  width: double.infinity,
                  height: 50,
                  color: Colors.teal,
                  child: const Center(child: Text('Footer', style: TextStyle(color: Colors.white))),
                ),
              ],
            ),
            const SizedBox(height: 24),

            // Stack Example
            const Text('Stack Layout:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
            const SizedBox(height: 8),
            SizedBox(
              height: 200,
              child: Stack(
                alignment: Alignment.center,
                children: [
                  Container(
                    width: 200,
                    height: 200,
                    color: Colors.grey[300],
                  ),
                  Container(
                    width: 150,
                    height: 150,
                    color: Colors.blue.withOpacity(0.7),
                  ),
                  const Positioned(
                    top: 20,
                    right: 20,
                    child: CircleAvatar(
                      backgroundColor: Colors.red,
                      child: Text('3', style: TextStyle(color: Colors.white)),
                    ),
                  ),
                ],
              ),
            ),
            const SizedBox(height: 24),

            // Expanded and Flexible
            const Text('Expanded/Flexible Layout:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
            const SizedBox(height: 8),
            Row(
              children: [
                Expanded(
                  flex: 2,
                  child: Container(
                    height: 50,
                    color: Colors.red,
                    child: const Center(child: Text('2x', style: TextStyle(color: Colors.white))),
                  ),
                ),
                Expanded(
                  flex: 1,
                  child: Container(
                    height: 50,
                    color: Colors.green,
                    child: const Center(child: Text('1x', style: TextStyle(color: Colors.white))),
                  ),
                ),
                Flexible(
                  child: Container(
                    height: 50,
                    color: Colors.blue,
                    child: const Center(child: Text('Flexible', style: TextStyle(color: Colors.white))),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}

// Material Design Components
class MaterialComponentsDemo extends StatelessWidget {
  const MaterialComponentsDemo({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Material Components')),
      body: ListView(
        padding: const EdgeInsets.all(16),
        children: [
          // Buttons
          const Text('Buttons:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          const SizedBox(height: 8),
          Wrap(
            spacing: 8,
            children: [
              ElevatedButton(
                onPressed: () {},
                child: const Text('Elevated'),
              ),
              FilledButton(
                onPressed: () {},
                child: const Text('Filled'),
              ),
              OutlinedButton(
                onPressed: () {},
                child: const Text('Outlined'),
              ),
              TextButton(
                onPressed: () {},
                child: const Text('Text'),
              ),
            ],
          ),
          const SizedBox(height: 24),

          // Text Fields
          const Text('Text Fields:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          const SizedBox(height: 8),
          const TextField(
            decoration: InputDecoration(
              labelText: 'Email',
              hintText: 'Enter your email',
              prefixIcon: Icon(Icons.email),
              border: OutlineInputBorder(),
            ),
          ),
          const SizedBox(height: 16),
          const TextField(
            obscureText: true,
            decoration: InputDecoration(
              labelText: 'Password',
              hintText: 'Enter your password',
              prefixIcon: Icon(Icons.lock),
              border: OutlineInputBorder(),
            ),
          ),
          const SizedBox(height: 24),

          // Cards and Chips
          const Text('Cards and Chips:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          const SizedBox(height: 8),
          Card(
            child: Padding(
              padding: const EdgeInsets.all(16),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const Text('Card Title', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
                  const SizedBox(height: 8),
                  const Text('This is a Material Design card component with some content.'),
                  const SizedBox(height: 16),
                  Wrap(
                    spacing: 8,
                    children: [
                      Chip(label: const Text('Flutter')),
                      Chip(label: const Text('Dart')),
                      Chip(label: const Text('Material Design')),
                    ],
                  ),
                ],
              ),
            ),
          ),
          const SizedBox(height: 24),

          // Progress Indicators
          const Text('Progress Indicators:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          const SizedBox(height: 8),
          const LinearProgressIndicator(),
          const SizedBox(height: 16),
          const CircularProgressIndicator(),
          const SizedBox(height: 24),

          // Dialogs and Snackbars
          const Text('Dialogs and Snackbars:', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          const SizedBox(height: 8),
          ElevatedButton(
            onPressed: () => _showDialog(context),
            child: const Text('Show Dialog'),
          ),
          const SizedBox(height: 8),
          ElevatedButton(
            onPressed: () => _showSnackbar(context),
            child: const Text('Show Snackbar'),
          ),
        ],
      ),
    );
  }

  void _showDialog(BuildContext context) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Alert Dialog'),
        content: const Text('This is a Material Design alert dialog.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('OK'),
          ),
        ],
      ),
    );
  }

  void _showSnackbar(BuildContext context) {
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(
        content: Text('This is a snackbar message!'),
        action: SnackBarAction(
          label: 'Undo',
          onPressed: null, // Add your undo logic here
        ),
      ),
    );
  }
}`}]}]},BM={id:"swift",tier:5,name:"Swift",description:"Master iOS and macOS development with Swift programming.",difficulty:"advanced",estimatedHours:40,prerequisites:["javascript","react","nodejs"],learningObjectives:[],modules:[]},zM={id:"kotlin",tier:5,name:"Kotlin for Android Development",description:"Master Kotlin programming for Android development with modern architecture patterns, Jetpack components, and best practices.",difficulty:"Advanced",estimatedHours:40,prerequisites:["javascript","react","nodejs"],learningObjectives:[],modules:[]},K_=[yM,vM,bM,wM,TM,SM,EM,CM,_M,AM,IM,xM,RM,kM,DM,PM,NM,OM,UM,MM,LM,qM,jM,BM,zM],J_=F.createContext(),Y_=()=>F.useContext(J_),Q_=({children:r})=>{const[e,n]=F.useState(new Set),[i,a]=F.useState(!0),[c,p]=F.useState(null);F.useEffect(()=>{const g=ry.onAuthStateChanged(b=>{p(b),b?(a(!0),mM(b.uid).then(E=>{n(new Set(E)),a(!1)}).catch(()=>a(!1))):(n(new Set),a(!1))});return()=>g()},[]);const f={completedLessons:e,markLessonCompleted:g=>{if(c&&!e.has(g)){const b=new Set(e);b.add(g),n(b),hM(c.uid,g),fM(c.uid).then(async()=>{const{streak:C}=await getUserGamificationData(c.uid);if(C.currentStreak===5){const M=yS.find(z=>z.id==="streak-5");M&&gS(c.uid,M)}});const E=K_.find(C=>C.lessons.some(M=>M.id===g));if(E&&E.lessons.every(M=>b.has(M.id))){const M=yS.find(z=>z.id===`${E.id}-novice`);M&&gS(c.uid,M)}}},loading:i};return R.jsx(J_.Provider,{value:f,children:r})};Q_.propTypes={children:Oe.node.isRequired};const X_=({modules:r,onLessonClick:e,selectedLesson:n})=>{const[i,a]=F.useState([]),{completedLessons:c,markLessonCompleted:p}=Y_(),h=F.useRef(null),f=(b,E)=>{e(b,E),p(b.id)},g=b=>{a(E=>E.includes(b)?E.filter(C=>C!==b):[...E,b])};return F.useEffect(()=>{if(n){const b=r.find(E=>E.sections.some(C=>C.title===n.title));b&&i.includes(b.id)&&g(b.id)}},[n]),F.useEffect(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},[n]),R.jsx("nav",{className:"learning-path",children:r.map(b=>{const E=i.includes(b.id),C=b.sections||[],M=C.filter(Q=>c.has(Q.id)).length,z=C.length>0&&M===C.length;return R.jsxs("div",{className:`path-module ${z?"completed":""}`,children:[R.jsxs("h2",{className:"module-title",onClick:()=>g(b.id),children:[R.jsx("span",{children:b.name}),R.jsx("span",{className:`toggle-icon ${E?"collapsed":""}`,children:"▼"})]}),!E&&R.jsx("ul",{className:"path-lessons",children:C.map(Q=>{const $=n&&n.title===Q.title,ie=c.has(Q.id),re=`path-lesson ${$?"selected":""} ${ie?"completed":""}`;return R.jsxs("li",{className:re,onClick:()=>f(Q,b),ref:$?h:null,children:[R.jsx("div",{className:"lesson-node",children:R.jsx("div",{className:"node-circle"})}),R.jsx("div",{className:"lesson-title",children:Q.title})]},Q.title)})})]},b.id)})})};X_.propTypes={modules:Oe.array.isRequired,onLessonClick:Oe.func.isRequired,selectedLesson:Oe.object};/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:Z_,setPrototypeOf:vS,isFrozen:FM,getPrototypeOf:VM,getOwnPropertyDescriptor:HM}=Object;let{freeze:Rn,seal:Tr,create:eA}=Object,{apply:zf,construct:Ff}=typeof Reflect<"u"&&Reflect;Rn||(Rn=function(e){return e});Tr||(Tr=function(e){return e});zf||(zf=function(e,n,i){return e.apply(n,i)});Ff||(Ff=function(e,n){return new e(...n)});const Ed=kn(Array.prototype.forEach),GM=kn(Array.prototype.lastIndexOf),bS=kn(Array.prototype.pop),dc=kn(Array.prototype.push),$M=kn(Array.prototype.splice),Ld=kn(String.prototype.toLowerCase),af=kn(String.prototype.toString),wS=kn(String.prototype.match),pc=kn(String.prototype.replace),WM=kn(String.prototype.indexOf),KM=kn(String.prototype.trim),Nr=kn(Object.prototype.hasOwnProperty),In=kn(RegExp.prototype.test),mc=JM(TypeError);function kn(r){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return zf(r,e,i)}}function JM(r){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Ff(r,n)}}function Le(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ld;vS&&vS(r,null);let i=e.length;for(;i--;){let a=e[i];if(typeof a=="string"){const c=n(a);c!==a&&(FM(e)||(e[i]=c),a=c)}r[a]=!0}return r}function YM(r){for(let e=0;e<r.length;e++)Nr(r,e)||(r[e]=null);return r}function qs(r){const e=eA(null);for(const[n,i]of Z_(r))Nr(r,n)&&(Array.isArray(i)?e[n]=YM(i):i&&typeof i=="object"&&i.constructor===Object?e[n]=qs(i):e[n]=i);return e}function hc(r,e){for(;r!==null;){const i=HM(r,e);if(i){if(i.get)return kn(i.get);if(typeof i.value=="function")return kn(i.value)}r=VM(r)}function n(){return null}return n}const TS=Rn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),lf=Rn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),cf=Rn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),QM=Rn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),uf=Rn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),XM=Rn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),SS=Rn(["#text"]),ES=Rn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),df=Rn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),CS=Rn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Cd=Rn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ZM=Tr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),eL=Tr(/<%[\w\W]*|[\w\W]*%>/gm),tL=Tr(/\$\{[\w\W]*/gm),nL=Tr(/^data-[\-\w.\u00B7-\uFFFF]+$/),rL=Tr(/^aria-[\-\w]+$/),tA=Tr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),sL=Tr(/^(?:\w+script|data):/i),iL=Tr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),nA=Tr(/^html$/i),oL=Tr(/^[a-z][.\w]*(-[.\w]+)+$/i);var _S=Object.freeze({__proto__:null,ARIA_ATTR:rL,ATTR_WHITESPACE:iL,CUSTOM_ELEMENT:oL,DATA_ATTR:nL,DOCTYPE_NAME:nA,ERB_EXPR:eL,IS_ALLOWED_URI:tA,IS_SCRIPT_OR_DATA:sL,MUSTACHE_EXPR:ZM,TMPLIT_EXPR:tL});const fc={element:1,text:3,progressingInstruction:7,comment:8,document:9},aL=function(){return typeof window>"u"?null:window},lL=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(i=n.getAttribute(a));const c="dompurify"+(i?"#"+i:"");try{return e.createPolicy(c,{createHTML(p){return p},createScriptURL(p){return p}})}catch{return console.warn("TrustedTypes policy "+c+" could not be created."),null}},AS=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function rA(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:aL();const e=fe=>rA(fe);if(e.version="3.2.6",e.removed=[],!r||!r.document||r.document.nodeType!==fc.document||!r.Element)return e.isSupported=!1,e;let{document:n}=r;const i=n,a=i.currentScript,{DocumentFragment:c,HTMLTemplateElement:p,Node:h,Element:f,NodeFilter:g,NamedNodeMap:b=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:E,DOMParser:C,trustedTypes:M}=r,z=f.prototype,Q=hc(z,"cloneNode"),$=hc(z,"remove"),ie=hc(z,"nextSibling"),re=hc(z,"childNodes"),ae=hc(z,"parentNode");if(typeof p=="function"){const fe=n.createElement("template");fe.content&&fe.content.ownerDocument&&(n=fe.content.ownerDocument)}let ve,he="";const{implementation:De,createNodeIterator:U,createDocumentFragment:_,getElementsByTagName:A}=n,{importNode:O}=i;let D=AS();e.isSupported=typeof Z_=="function"&&typeof ae=="function"&&De&&De.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:q,ERB_EXPR:x,TMPLIT_EXPR:At,DATA_ATTR:pt,ARIA_ATTR:K,IS_SCRIPT_OR_DATA:le,ATTR_WHITESPACE:ye,CUSTOM_ELEMENT:Ge}=_S;let{IS_ALLOWED_URI:k}=_S,J=null;const ce=Le({},[...TS,...lf,...cf,...uf,...SS]);let ne=null;const we=Le({},[...ES,...df,...CS,...Cd]);let ge=Object.seal(eA(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Se=null,Tt=null,Qe=!0,Dn=!0,Sr=!1,Xn=!0,Pn=!1,Zn=!0,Tn=!1,gs=!1,Xs=!1,jt=!1,Zs=!1,Fr=!1,ys=!0,Vr=!1;const cl="user-content-";let Hr=!0,Er=!1,Cr={},Xe=null;const $e=Le({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let mn=null;const Bt=Le({},["audio","video","img","source","image","track"]);let ei=null;const Go=Le({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),er="http://www.w3.org/1998/Math/MathML",tr="http://www.w3.org/2000/svg",sn="http://www.w3.org/1999/xhtml";let Kt=sn,Gr=!1,_r=null;const Qi=Le({},[er,tr,sn],af);let $r=Le({},["mi","mo","mn","ms","mtext"]),Wr=Le({},["annotation-xml"]);const Ar=Le({},["title","style","font","a","script"]);let Sn=null;const Xi=["application/xhtml+xml","text/html"],nr="text/html";let mt=null,En=null;const ti=n.createElement("form"),Ir=function(N){return N instanceof RegExp||N instanceof Function},ni=function(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(En&&En===N)){if((!N||typeof N!="object")&&(N={}),N=qs(N),Sn=Xi.indexOf(N.PARSER_MEDIA_TYPE)===-1?nr:N.PARSER_MEDIA_TYPE,mt=Sn==="application/xhtml+xml"?af:Ld,J=Nr(N,"ALLOWED_TAGS")?Le({},N.ALLOWED_TAGS,mt):ce,ne=Nr(N,"ALLOWED_ATTR")?Le({},N.ALLOWED_ATTR,mt):we,_r=Nr(N,"ALLOWED_NAMESPACES")?Le({},N.ALLOWED_NAMESPACES,af):Qi,ei=Nr(N,"ADD_URI_SAFE_ATTR")?Le(qs(Go),N.ADD_URI_SAFE_ATTR,mt):Go,mn=Nr(N,"ADD_DATA_URI_TAGS")?Le(qs(Bt),N.ADD_DATA_URI_TAGS,mt):Bt,Xe=Nr(N,"FORBID_CONTENTS")?Le({},N.FORBID_CONTENTS,mt):$e,Se=Nr(N,"FORBID_TAGS")?Le({},N.FORBID_TAGS,mt):qs({}),Tt=Nr(N,"FORBID_ATTR")?Le({},N.FORBID_ATTR,mt):qs({}),Cr=Nr(N,"USE_PROFILES")?N.USE_PROFILES:!1,Qe=N.ALLOW_ARIA_ATTR!==!1,Dn=N.ALLOW_DATA_ATTR!==!1,Sr=N.ALLOW_UNKNOWN_PROTOCOLS||!1,Xn=N.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pn=N.SAFE_FOR_TEMPLATES||!1,Zn=N.SAFE_FOR_XML!==!1,Tn=N.WHOLE_DOCUMENT||!1,jt=N.RETURN_DOM||!1,Zs=N.RETURN_DOM_FRAGMENT||!1,Fr=N.RETURN_TRUSTED_TYPE||!1,Xs=N.FORCE_BODY||!1,ys=N.SANITIZE_DOM!==!1,Vr=N.SANITIZE_NAMED_PROPS||!1,Hr=N.KEEP_CONTENT!==!1,Er=N.IN_PLACE||!1,k=N.ALLOWED_URI_REGEXP||tA,Kt=N.NAMESPACE||sn,$r=N.MATHML_TEXT_INTEGRATION_POINTS||$r,Wr=N.HTML_INTEGRATION_POINTS||Wr,ge=N.CUSTOM_ELEMENT_HANDLING||{},N.CUSTOM_ELEMENT_HANDLING&&Ir(N.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ge.tagNameCheck=N.CUSTOM_ELEMENT_HANDLING.tagNameCheck),N.CUSTOM_ELEMENT_HANDLING&&Ir(N.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ge.attributeNameCheck=N.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),N.CUSTOM_ELEMENT_HANDLING&&typeof N.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ge.allowCustomizedBuiltInElements=N.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pn&&(Dn=!1),Zs&&(jt=!0),Cr&&(J=Le({},SS),ne=[],Cr.html===!0&&(Le(J,TS),Le(ne,ES)),Cr.svg===!0&&(Le(J,lf),Le(ne,df),Le(ne,Cd)),Cr.svgFilters===!0&&(Le(J,cf),Le(ne,df),Le(ne,Cd)),Cr.mathMl===!0&&(Le(J,uf),Le(ne,CS),Le(ne,Cd))),N.ADD_TAGS&&(J===ce&&(J=qs(J)),Le(J,N.ADD_TAGS,mt)),N.ADD_ATTR&&(ne===we&&(ne=qs(ne)),Le(ne,N.ADD_ATTR,mt)),N.ADD_URI_SAFE_ATTR&&Le(ei,N.ADD_URI_SAFE_ATTR,mt),N.FORBID_CONTENTS&&(Xe===$e&&(Xe=qs(Xe)),Le(Xe,N.FORBID_CONTENTS,mt)),Hr&&(J["#text"]=!0),Tn&&Le(J,["html","head","body"]),J.table&&(Le(J,["tbody"]),delete Se.tbody),N.TRUSTED_TYPES_POLICY){if(typeof N.TRUSTED_TYPES_POLICY.createHTML!="function")throw mc('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof N.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw mc('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ve=N.TRUSTED_TYPES_POLICY,he=ve.createHTML("")}else ve===void 0&&(ve=lL(M,a)),ve!==null&&typeof he=="string"&&(he=ve.createHTML(""));Rn&&Rn(N),En=N}},ot=Le({},[...lf,...cf,...QM]),St=Le({},[...uf,...XM]),Et=function(N){let se=ae(N);(!se||!se.tagName)&&(se={namespaceURI:Kt,tagName:"template"});const de=Ld(N.tagName),Ze=Ld(se.tagName);return _r[N.namespaceURI]?N.namespaceURI===tr?se.namespaceURI===sn?de==="svg":se.namespaceURI===er?de==="svg"&&(Ze==="annotation-xml"||$r[Ze]):!!ot[de]:N.namespaceURI===er?se.namespaceURI===sn?de==="math":se.namespaceURI===tr?de==="math"&&Wr[Ze]:!!St[de]:N.namespaceURI===sn?se.namespaceURI===tr&&!Wr[Ze]||se.namespaceURI===er&&!$r[Ze]?!1:!St[de]&&(Ar[de]||!ot[de]):!!(Sn==="application/xhtml+xml"&&_r[N.namespaceURI]):!1},yt=function(N){dc(e.removed,{element:N});try{ae(N).removeChild(N)}catch{$(N)}},rr=function(N,se){try{dc(e.removed,{attribute:se.getAttributeNode(N),from:se})}catch{dc(e.removed,{attribute:null,from:se})}if(se.removeAttribute(N),N==="is")if(jt||Zs)try{yt(se)}catch{}else try{se.setAttribute(N,"")}catch{}},$o=function(N){let se=null,de=null;if(Xs)N="<remove></remove>"+N;else{const at=wS(N,/^[\r\n\t ]+/);de=at&&at[0]}Sn==="application/xhtml+xml"&&Kt===sn&&(N='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+N+"</body></html>");const Ze=ve?ve.createHTML(N):N;if(Kt===sn)try{se=new C().parseFromString(Ze,Sn)}catch{}if(!se||!se.documentElement){se=De.createDocument(Kt,"template",null);try{se.documentElement.innerHTML=Gr?he:Ze}catch{}}const It=se.body||se.documentElement;return N&&de&&It.insertBefore(n.createTextNode(de),It.childNodes[0]||null),Kt===sn?A.call(se,Tn?"html":"body")[0]:Tn?se.documentElement:It},xr=function(N){return U.call(N.ownerDocument||N,N,g.SHOW_ELEMENT|g.SHOW_COMMENT|g.SHOW_TEXT|g.SHOW_PROCESSING_INSTRUCTION|g.SHOW_CDATA_SECTION,null)},ri=function(N){return N instanceof E&&(typeof N.nodeName!="string"||typeof N.textContent!="string"||typeof N.removeChild!="function"||!(N.attributes instanceof b)||typeof N.removeAttribute!="function"||typeof N.setAttribute!="function"||typeof N.namespaceURI!="string"||typeof N.insertBefore!="function"||typeof N.hasChildNodes!="function")},Kr=function(N){return typeof h=="function"&&N instanceof h};function Jt(fe,N,se){Ed(fe,de=>{de.call(e,N,se,En)})}const sr=function(N){let se=null;if(Jt(D.beforeSanitizeElements,N,null),ri(N))return yt(N),!0;const de=mt(N.nodeName);if(Jt(D.uponSanitizeElement,N,{tagName:de,allowedTags:J}),Zn&&N.hasChildNodes()&&!Kr(N.firstElementChild)&&In(/<[/\w!]/g,N.innerHTML)&&In(/<[/\w!]/g,N.textContent)||N.nodeType===fc.progressingInstruction||Zn&&N.nodeType===fc.comment&&In(/<[/\w]/g,N.data))return yt(N),!0;if(!J[de]||Se[de]){if(!Se[de]&&Bn(de)&&(ge.tagNameCheck instanceof RegExp&&In(ge.tagNameCheck,de)||ge.tagNameCheck instanceof Function&&ge.tagNameCheck(de)))return!1;if(Hr&&!Xe[de]){const Ze=ae(N)||N.parentNode,It=re(N)||N.childNodes;if(It&&Ze){const at=It.length;for(let zt=at-1;zt>=0;--zt){const Qt=Q(It[zt],!0);Qt.__removalCount=(N.__removalCount||0)+1,Ze.insertBefore(Qt,ie(N))}}}return yt(N),!0}return N instanceof f&&!Et(N)||(de==="noscript"||de==="noembed"||de==="noframes")&&In(/<\/no(script|embed|frames)/i,N.innerHTML)?(yt(N),!0):(Pn&&N.nodeType===fc.text&&(se=N.textContent,Ed([q,x,At],Ze=>{se=pc(se,Ze," ")}),N.textContent!==se&&(dc(e.removed,{element:N.cloneNode()}),N.textContent=se)),Jt(D.afterSanitizeElements,N,null),!1)},jn=function(N,se,de){if(ys&&(se==="id"||se==="name")&&(de in n||de in ti))return!1;if(!(Dn&&!Tt[se]&&In(pt,se))){if(!(Qe&&In(K,se))){if(!ne[se]||Tt[se]){if(!(Bn(N)&&(ge.tagNameCheck instanceof RegExp&&In(ge.tagNameCheck,N)||ge.tagNameCheck instanceof Function&&ge.tagNameCheck(N))&&(ge.attributeNameCheck instanceof RegExp&&In(ge.attributeNameCheck,se)||ge.attributeNameCheck instanceof Function&&ge.attributeNameCheck(se))||se==="is"&&ge.allowCustomizedBuiltInElements&&(ge.tagNameCheck instanceof RegExp&&In(ge.tagNameCheck,de)||ge.tagNameCheck instanceof Function&&ge.tagNameCheck(de))))return!1}else if(!ei[se]){if(!In(k,pc(de,ye,""))){if(!((se==="src"||se==="xlink:href"||se==="href")&&N!=="script"&&WM(de,"data:")===0&&mn[N])){if(!(Sr&&!In(le,pc(de,ye,"")))){if(de)return!1}}}}}}return!0},Bn=function(N){return N!=="annotation-xml"&&wS(N,Ge)},Yt=function(N){Jt(D.beforeSanitizeAttributes,N,null);const{attributes:se}=N;if(!se||ri(N))return;const de={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ne,forceKeepAttr:void 0};let Ze=se.length;for(;Ze--;){const It=se[Ze],{name:at,namespaceURI:zt,value:Qt}=It,hn=mt(at),xt=Qt;let ht=at==="value"?xt:KM(xt);if(de.attrName=hn,de.attrValue=ht,de.keepAttr=!0,de.forceKeepAttr=void 0,Jt(D.uponSanitizeAttribute,N,de),ht=de.attrValue,Vr&&(hn==="id"||hn==="name")&&(rr(at,N),ht=cl+ht),Zn&&In(/((--!?|])>)|<\/(style|title)/i,ht)){rr(at,N);continue}if(de.forceKeepAttr)continue;if(!de.keepAttr){rr(at,N);continue}if(!Xn&&In(/\/>/i,ht)){rr(at,N);continue}Pn&&Ed([q,x,At],ir=>{ht=pc(ht,ir," ")});const Zi=mt(N.nodeName);if(!jn(Zi,hn,ht)){rr(at,N);continue}if(ve&&typeof M=="object"&&typeof M.getAttributeType=="function"&&!zt)switch(M.getAttributeType(Zi,hn)){case"TrustedHTML":{ht=ve.createHTML(ht);break}case"TrustedScriptURL":{ht=ve.createScriptURL(ht);break}}if(ht!==xt)try{zt?N.setAttributeNS(zt,at,ht):N.setAttribute(at,ht),ri(N)?yt(N):bS(e.removed)}catch{rr(at,N)}}Jt(D.afterSanitizeAttributes,N,null)},vt=function fe(N){let se=null;const de=xr(N);for(Jt(D.beforeSanitizeShadowDOM,N,null);se=de.nextNode();)Jt(D.uponSanitizeShadowNode,se,null),sr(se),Yt(se),se.content instanceof c&&fe(se.content);Jt(D.afterSanitizeShadowDOM,N,null)};return e.sanitize=function(fe){let N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},se=null,de=null,Ze=null,It=null;if(Gr=!fe,Gr&&(fe="<!-->"),typeof fe!="string"&&!Kr(fe))if(typeof fe.toString=="function"){if(fe=fe.toString(),typeof fe!="string")throw mc("dirty is not a string, aborting")}else throw mc("toString is not a function");if(!e.isSupported)return fe;if(gs||ni(N),e.removed=[],typeof fe=="string"&&(Er=!1),Er){if(fe.nodeName){const Qt=mt(fe.nodeName);if(!J[Qt]||Se[Qt])throw mc("root node is forbidden and cannot be sanitized in-place")}}else if(fe instanceof h)se=$o("<!---->"),de=se.ownerDocument.importNode(fe,!0),de.nodeType===fc.element&&de.nodeName==="BODY"||de.nodeName==="HTML"?se=de:se.appendChild(de);else{if(!jt&&!Pn&&!Tn&&fe.indexOf("<")===-1)return ve&&Fr?ve.createHTML(fe):fe;if(se=$o(fe),!se)return jt?null:Fr?he:""}se&&Xs&&yt(se.firstChild);const at=xr(Er?fe:se);for(;Ze=at.nextNode();)sr(Ze),Yt(Ze),Ze.content instanceof c&&vt(Ze.content);if(Er)return fe;if(jt){if(Zs)for(It=_.call(se.ownerDocument);se.firstChild;)It.appendChild(se.firstChild);else It=se;return(ne.shadowroot||ne.shadowrootmode)&&(It=O.call(i,It,!0)),It}let zt=Tn?se.outerHTML:se.innerHTML;return Tn&&J["!doctype"]&&se.ownerDocument&&se.ownerDocument.doctype&&se.ownerDocument.doctype.name&&In(nA,se.ownerDocument.doctype.name)&&(zt="<!DOCTYPE "+se.ownerDocument.doctype.name+`>
`+zt),Pn&&Ed([q,x,At],Qt=>{zt=pc(zt,Qt," ")}),ve&&Fr?ve.createHTML(zt):zt},e.setConfig=function(){let fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ni(fe),gs=!0},e.clearConfig=function(){En=null,gs=!1},e.isValidAttribute=function(fe,N,se){En||ni({});const de=mt(fe),Ze=mt(N);return jn(de,Ze,se)},e.addHook=function(fe,N){typeof N=="function"&&dc(D[fe],N)},e.removeHook=function(fe,N){if(N!==void 0){const se=GM(D[fe],N);return se===-1?void 0:$M(D[fe],se,1)[0]}return bS(D[fe])},e.removeHooks=function(fe){D[fe]=[]},e.removeAllHooks=function(){D=AS()},e}var sA=rA();const IS={"html-introduction":"Here's a tip: Always use semantic HTML tags like `<header>`, `<footer>`, and `<article>`. It improves accessibility and SEO!","css-selectors":"CSS Specificity is key! An ID selector (`#id`) is more specific than a class selector (`.class`), which is more specific than a type selector (`p`).","javascript-variables":"Remember the difference between `let`, `const`, and `var`. Use `const` by default and `let` when you know the variable will be reassigned.","git-basics":"A great Git habit is to make small, frequent commits with clear messages. It makes your project history much easier to understand!",default:"Select a lesson to get a specific AI tip, or ask me a question about web development!"},cL=r=>new Promise(e=>{setTimeout(()=>{const n=IS[r]||IS.default;e({text:n})},1200)}),uL=r=>new Promise(e=>{setTimeout(()=>{const n=r.toLowerCase();let i="I'm still learning about that topic. Try asking me about HTML, CSS, or gamification!";n.includes("html")||n.includes("semantic")?i="<strong>Semantic HTML</strong> is the practice of using HTML tags that convey the meaning of the information in the tag. For example, using <strong>&lt;header&gt;</strong> for your page header, <strong>&lt;nav&gt;</strong> for navigation links, and <strong>&lt;article&gt;</strong> for your main content. It's crucial for accessibility and SEO!":n.includes("css")||n.includes("style")?i="<strong>CSS Specificity</strong> is the set of rules browsers use to determine which style declaration is applied to an element. An inline style is most specific, followed by IDs, then classes/attributes, and finally element selectors. Understanding this hierarchy is key to avoiding styling conflicts.":(n.includes("streak")||n.includes("badge"))&&(i="You can earn <strong>badges</strong> by completing all lessons in a module (like the 'HTML Novice' badge). You can build your <strong>learning streak</strong> by completing at least one lesson each day. Keep it up to earn streak-related badges!"),e({text:i})},1500)}),iA=({context:r})=>{const[e,n]=F.useState(""),[i,a]=F.useState(!1),[c,p]=F.useState(""),h=async()=>{a(!0),n("");try{const g=await cL(r);n(g.text)}catch(g){console.error("Error fetching AI response:",g),n("Sorry, I could not fetch a tip at the moment.")}finally{a(!1)}},f=async g=>{if(g.preventDefault(),!!c.trim()){a(!0),n("");try{const b=await uL(c),E=sA.sanitize(b.text);n(E)}catch(b){console.error("Error fetching AI answer:",b),n("Sorry, I could not get an answer at this time.")}finally{a(!1)}}};return R.jsxs("div",{className:"ai-prompt-container",children:[R.jsx("h4",{children:"AI Assistant"}),R.jsx("p",{children:"Need a hint or a deeper explanation? Get a quick tip or ask a question."}),R.jsx("div",{className:"ai-actions",children:R.jsx("button",{onClick:h,disabled:i,children:i?"Thinking...":"Get an AI Tip"})}),R.jsxs("form",{onSubmit:f,className:"ai-question-form",children:[R.jsx("textarea",{value:c,onChange:g=>p(g.target.value),placeholder:"Ask a question about web development...",rows:"3",disabled:i}),R.jsx("button",{type:"submit",disabled:i||!c.trim(),children:"Submit Question"})]}),e&&R.jsx("div",{className:"ai-response",children:R.jsx("div",{dangerouslySetInnerHTML:{__html:e}})})]})};iA.propTypes={context:Oe.string};const xS=()=>{window.speechSynthesis&&window.speechSynthesis.cancel()},oA=({title:r,content:e})=>{const[n,i]=F.useState(!1),[a,c]=F.useState(null);F.useEffect(()=>()=>{xS()},[]),F.useEffect(()=>{if(!a)return;const h=()=>{i(!1)};return a.addEventListener("end",h),window.speechSynthesis.speak(a),()=>{a.removeEventListener("end",h)}},[a]);const p=()=>{if(n)xS(),i(!1),c(null);else{const f=`${r}. ${e}`.replace(/<[^>]+>/g,""),g=new SpeechSynthesisUtterance(f);c(g),i(!0)}};return R.jsx("button",{onClick:p,className:"tts-button",children:n?"⏹️ Stop Audio":"▶️ Play Audio"})};oA.propTypes={title:Oe.string.isRequired,content:Oe.string.isRequired};const aA=({lesson:r,aiPrompts:e})=>{if(!r)return R.jsx("div",{className:"lesson-view",children:"Select a lesson to start."});const n=i=>({__html:sA.sanitize(i,{ADD_TAGS:["pre","code"]})});return R.jsxs("div",{className:"lesson-view",children:[R.jsxs("div",{className:"lesson-header",children:[R.jsx("h2",{dangerouslySetInnerHTML:n(r.title)}),R.jsx(oA,{title:r.title,content:r.content})]}),R.jsx("div",{className:"lesson-content",dangerouslySetInnerHTML:n(r.content.replace(/\n/g,"<br />"))}),r.keyTopics&&r.keyTopics.length>0&&R.jsxs("div",{className:"key-topics",children:[R.jsx("h3",{children:"Key Topics"}),R.jsx("ul",{children:r.keyTopics.map(i=>R.jsx("li",{children:i},i))})]}),r.codeExamples&&r.codeExamples.length>0&&R.jsxs("div",{className:"code-examples",children:[R.jsx("h3",{children:"Code Examples"}),r.codeExamples.map((i,a)=>R.jsxs("div",{className:"code-example",children:[R.jsx("h4",{dangerouslySetInnerHTML:n(i.title)}),R.jsx("pre",{className:"code-block",children:R.jsx("code",{children:i.code})})]},a))]}),R.jsx(iA,{context:r.id})]})};aA.propTypes={lesson:Oe.object};const dL=()=>{const[r,e]=F.useState(null),[n,i]=F.useState(null),{markLessonCompleted:a}=Y_(),c=(p,h)=>{e(p),i(h),a(p.id)};return R.jsxs("div",{className:"learning-layout",children:[R.jsx(X_,{modules:K_,onLessonClick:c,selectedLesson:r}),R.jsx(aA,{lesson:r})]})};Ji(xn,"portfolios");const pL=(r,e)=>{const n=Ji(xn,`portfolios/${r}/projects`);return Yg(n,e)},mL=async r=>{const e=Ji(xn,`portfolios/${r}/projects`);return(await Zc(e)).docs.map(i=>({id:i.id,...i.data()}))},hL=(r,e,n)=>{const i=Yi(xn,`portfolios/${r}/projects`,e);return Jg(i,n)},fL=(r,e)=>{const n=Yi(xn,`portfolios/${r}/projects`,e);return xO(n)},lA=({project:r,onEdit:e,onDelete:n})=>R.jsxs("div",{className:"project-card",children:[R.jsx("img",{src:r.imageUrl||"https://via.placeholder.com/300x200",alt:r.title,className:"project-image"}),R.jsxs("div",{className:"project-content",children:[R.jsx("h3",{children:r.title}),R.jsx("p",{children:r.description}),R.jsxs("div",{className:"project-links",children:[r.projectUrl&&R.jsx("a",{href:r.projectUrl,target:"_blank",rel:"noopener noreferrer",children:"View Project"}),r.githubUrl&&R.jsx("a",{href:r.githubUrl,target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]}),R.jsxs("div",{className:"project-actions",children:[R.jsx("button",{onClick:()=>e(r),className:"edit-btn",children:"Edit"}),R.jsx("button",{onClick:()=>n(r.id),className:"delete-btn",children:"Delete"})]})]})]});lA.propTypes={project:Oe.shape({id:Oe.string.isRequired,title:Oe.string.isRequired,description:Oe.string.isRequired,imageUrl:Oe.string,projectUrl:Oe.string,githubUrl:Oe.string}).isRequired,onEdit:Oe.func.isRequired,onDelete:Oe.func.isRequired};const cA=({onSubmit:r,projectToEdit:e,onCancel:n})=>{const[i,a]=F.useState({title:"",description:"",imageUrl:"",projectUrl:"",githubUrl:""});F.useEffect(()=>{a(e||{title:"",description:"",imageUrl:"",projectUrl:"",githubUrl:""})},[e]);const c=h=>{const{name:f,value:g}=h.target;a(b=>({...b,[f]:g}))},p=h=>{h.preventDefault(),r(i),a({title:"",description:"",imageUrl:"",projectUrl:"",githubUrl:""})};return R.jsxs("form",{onSubmit:p,className:"project-form",children:[R.jsx("h2",{children:e?"Edit Project":"Add New Project"}),R.jsxs("div",{className:"form-group",children:[R.jsx("label",{htmlFor:"title",children:"Title"}),R.jsx("input",{type:"text",name:"title",value:i.title,onChange:c,required:!0})]}),R.jsxs("div",{className:"form-group",children:[R.jsx("label",{htmlFor:"description",children:"Description"}),R.jsx("textarea",{name:"description",value:i.description,onChange:c,required:!0})]}),R.jsxs("div",{className:"form-group",children:[R.jsx("label",{htmlFor:"imageUrl",children:"Image URL"}),R.jsx("input",{type:"url",name:"imageUrl",value:i.imageUrl,onChange:c})]}),R.jsxs("div",{className:"form-group",children:[R.jsx("label",{htmlFor:"projectUrl",children:"Project URL"}),R.jsx("input",{type:"url",name:"projectUrl",value:i.projectUrl,onChange:c})]}),R.jsxs("div",{className:"form-group",children:[R.jsx("label",{htmlFor:"githubUrl",children:"GitHub URL"}),R.jsx("input",{type:"url",name:"githubUrl",value:i.githubUrl,onChange:c})]}),R.jsxs("div",{className:"form-actions",children:[R.jsx("button",{type:"submit",className:"submit-btn",children:e?"Update Project":"Add Project"}),n&&R.jsx("button",{type:"button",onClick:n,className:"cancel-btn",children:"Cancel"})]})]})};cA.propTypes={onSubmit:Oe.func.isRequired,projectToEdit:Oe.object,onCancel:Oe.func};const gL=()=>{const{currentUser:r}=eu(),[e,n]=F.useState([]),[i,a]=F.useState(null),[c,p]=F.useState(!0),[h,f]=F.useState(null),g=async()=>{if(r)try{p(!0);const z=await mL(r.uid);n(z),f(null)}catch(z){f("Failed to fetch projects. Please try again later."),console.error(z)}finally{p(!1)}};F.useEffect(()=>{g()},[r]);const b=async z=>{try{i?await hL(r.uid,i.id,z):await pL(r.uid,z),a(null),g()}catch(Q){f("Failed to save project. Please try again."),console.error(Q)}},E=z=>{a(z),window.scrollTo(0,0)},C=async z=>{if(window.confirm("Are you sure you want to delete this project?"))try{await fL(r.uid,z),g()}catch(Q){f("Failed to delete project. Please try again."),console.error(Q)}},M=()=>{a(null)};return r?R.jsxs("div",{className:"portfolio-page",children:[R.jsx("h1",{children:"My Portfolio"}),R.jsx(cA,{onSubmit:b,projectToEdit:i,onCancel:M}),h&&R.jsx("p",{className:"error-message",children:h}),c?R.jsx("p",{children:"Loading projects..."}):R.jsx("div",{className:"projects-grid",children:e.length>0?e.map(z=>R.jsx(lA,{project:z,onEdit:E,onDelete:C},z.id)):R.jsx("p",{children:"You haven't added any projects yet. Use the form above to get started!"})})]}):R.jsx("div",{className:"portfolio-page",children:R.jsx("h2",{children:"Please log in to manage your portfolio."})})},uA=({currentStreak:r})=>R.jsx("div",{className:"learning-streak",children:r>1?R.jsxs("p",{children:["🔥 ",r," Day Streak"]}):R.jsx("p",{children:"Start your learning streak today!"})});uA.propTypes={currentStreak:Oe.number.isRequired};const dA=({badge:r})=>R.jsxs("div",{className:"badge-card",children:[R.jsx("div",{className:"badge-icon",children:r.icon}),R.jsxs("div",{className:"badge-details",children:[R.jsx("h4",{className:"badge-name",children:r.name}),R.jsx("p",{className:"badge-description",children:r.description})]})]});dA.propTypes={badge:Oe.shape({icon:Oe.string.isRequired,name:Oe.string.isRequired,description:Oe.string.isRequired}).isRequired};const yL=()=>{const{currentUser:r}=eu(),[e,n]=F.useState({streak:{currentStreak:0},badges:[]}),[i,a]=F.useState(!0),[c,p]=F.useState(null);return F.useEffect(()=>{(async()=>{if(!r){a(!1);return}try{a(!0);const f=await gM(r.uid);n(f),p(null)}catch(f){p("Failed to load profile data. Please try again later."),console.error(f)}finally{a(!1)}})()},[r]),i?R.jsx("div",{className:"profile-page",children:R.jsx("h2",{children:"Loading Profile..."})}):c?R.jsx("div",{className:"profile-page",children:R.jsx("p",{className:"error-message",children:c})}):r?R.jsxs("div",{className:"profile-page",children:[R.jsx("h1",{children:"My Achievements"}),R.jsx(uA,{currentStreak:e.streak.currentStreak}),R.jsxs("div",{className:"badges-section",children:[R.jsx("h2",{children:"My Badges"}),e.badges.length>0?R.jsx("div",{className:"badges-grid",children:e.badges.map(h=>R.jsx(dA,{badge:h},h.id))}):R.jsx("p",{children:"You haven't earned any badges yet. Keep learning to unlock them!"})]})]}):R.jsx("div",{className:"profile-page",children:R.jsx("h2",{children:"Please log in to view your profile."})})},js=({title:r,value:e,icon:n,trend:i})=>R.jsxs("div",{className:"metrics-card",children:[R.jsxs("div",{className:"metrics-header",children:[R.jsx("h3",{className:"metrics-title",children:r}),R.jsx("div",{className:"metrics-icon",children:n})]}),R.jsx("div",{className:"metrics-value",children:e}),i&&R.jsx("div",{className:"metrics-trend",children:i})]});js.propTypes={title:Oe.string.isRequired,value:Oe.oneOfType([Oe.string,Oe.number]).isRequired,icon:Oe.string,trend:Oe.string};const Vf=({data:r,type:e})=>R.jsxs("div",{className:"analytics-chart",children:[R.jsxs("h3",{children:[e," Chart"]}),R.jsxs("div",{className:"chart-placeholder",children:[R.jsxs("p",{children:["Chart visualization for ",e]}),R.jsx("div",{className:"chart-data",children:r&&Object.entries(r).map(([n,i])=>R.jsxs("div",{className:"data-point",children:[n,": ",i]},n))})]})]});Vf.propTypes={data:Oe.object,type:Oe.string.isRequired};const pA=({activities:r})=>R.jsxs("div",{className:"activity-log",children:[R.jsx("h3",{children:"Recent Activities"}),R.jsx("div",{className:"activity-list",children:r.length>0?r.map((e,n)=>R.jsxs("div",{className:"activity-item",children:[R.jsx("div",{className:"activity-type",children:e.activityType}),R.jsx("div",{className:"activity-meta",children:e.metadata&&Object.keys(e.metadata).length>0&&R.jsx("span",{children:JSON.stringify(e.metadata)})}),R.jsx("div",{className:"activity-timestamp",children:e.timestamp?new Date(e.timestamp.seconds*1e3).toLocaleString():"N/A"})]},n)):R.jsx("p",{children:"No recent activities."})})]});pA.propTypes={activities:Oe.arrayOf(Oe.shape({activityType:Oe.string.isRequired,metadata:Oe.object,timestamp:Oe.object})).isRequired};const vL=()=>{const{currentUser:r}=eu(),[e,n]=F.useState(null),[i,a]=F.useState(null),[c,p]=F.useState(null),[h,f]=F.useState(!0),[g,b]=F.useState(null);return F.useEffect(()=>{(async()=>{if(!r){f(!1);return}try{f(!0);const[C,M,z]=await Promise.all([QU(r.uid),XU(),ZU()]);n(C),a(M),p(z),b(null)}catch(C){b("Failed to load analytics data. Please try again later."),console.error(C)}finally{f(!1)}})()},[r]),h?R.jsx("div",{className:"analytics-dashboard",children:R.jsx("h2",{children:"Loading Analytics..."})}):g?R.jsx("div",{className:"analytics-dashboard",children:R.jsx("p",{className:"error-message",children:g})}):r?R.jsxs("div",{className:"analytics-dashboard",children:[R.jsx("h1",{children:"Analytics Dashboard"}),R.jsxs("div",{className:"metrics-grid",children:[R.jsx(js,{title:"Your Activities",value:e?.totalActivities||0,icon:"📊",trend:"+12% this week"}),R.jsx(js,{title:"Lessons Completed",value:e?.lessonCompletions||0,icon:"✅",trend:"+5% this week"}),R.jsx(js,{title:"Badges Earned",value:e?.badgeEarnings||0,icon:"🏆",trend:"+2 this week"}),R.jsx(js,{title:"Platform Users",value:i?.uniqueUsers||0,icon:"👥"})]}),R.jsxs("div",{className:"charts-section",children:[R.jsx(Vf,{data:e,type:"User Progress"}),R.jsx(Vf,{data:i,type:"Platform Overview"})]}),R.jsx("div",{className:"activity-section",children:R.jsx(pA,{activities:e?.recentActivities||[]})}),R.jsxs("div",{className:"performance-section",children:[R.jsx("h2",{children:"Performance Metrics"}),R.jsxs("div",{className:"metrics-grid",children:[R.jsx(js,{title:"Avg Session Duration",value:`${c?.averageSessionDuration||0} min`,icon:"⏱️"}),R.jsx(js,{title:"Page Load Time",value:`${c?.pageLoadTime||0} s`,icon:"⚡"}),R.jsx(js,{title:"Error Rate",value:`${((c?.errorRate||0)*100).toFixed(1)}%`,icon:"⚠️"}),R.jsx(js,{title:"User Retention",value:`${((c?.userRetention||0)*100).toFixed(1)}%`,icon:"🔄"})]})]})]}):R.jsx("div",{className:"analytics-dashboard",children:R.jsx("h2",{children:"Please log in to view analytics."})})},bL=()=>{const{currentUser:r}=eu();return R.jsxs(q0,{children:[R.jsx(Io,{path:"/auth",element:r?R.jsx(Oa,{to:"/"}):R.jsx(lM,{})}),R.jsx(Io,{path:"/",element:r?R.jsx(dL,{}):R.jsx(Oa,{to:"/auth"})}),R.jsx(Io,{path:"/portfolio",element:r?R.jsx(gL,{}):R.jsx(Oa,{to:"/auth"})}),R.jsx(Io,{path:"/profile",element:r?R.jsx(yL,{}):R.jsx(Oa,{to:"/auth"})}),R.jsx(Io,{path:"/analytics",element:r?R.jsx(vL,{}):R.jsx(Oa,{to:"/auth"})}),R.jsx(Io,{path:"*",element:R.jsx(Oa,{to:"/"})})]})};function wL(){return R.jsx(eM,{children:R.jsx(Q_,{children:R.jsx(ax,{children:R.jsx(rM,{children:R.jsx(bL,{})})})})})}KI.createRoot(document.getElementById("root")).render(R.jsx(BI.StrictMode,{children:R.jsx(wL,{})}));
